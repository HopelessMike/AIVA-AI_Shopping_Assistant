import{a as zn,b as Ho,g as In,R as Us,r as d,u as ir,c as Go,d as Wo,e as Qo,f as Zt,L as qr,N as ds,B as Jo}from"./react-vendor-Bydu6J3a.js";import{m as _,A as ar}from"./animation-DoJXsEng.js";import{M as Ft,S as sr,a as Ko,b as Dr,H as Br,c as jt,G as Xo,d as Vr,P as Yo,C as Zo,Z as Bs,F as fs,e as ei,L as ti,X as Mt,T as Vs,f as Hs,g as ri,A as ni,h as Gs,i as Ws,j as si,k as oi,R as ii,l as ai,m as dn,n as Qs,N as ci,V as Js,o as li,U as ui,p as di,q as fi}from"./ui-DjfJgPDo.js";import{r as pi}from"./voice-BWufaHyz.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function r(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(o){if(o.ep)return;o.ep=!0;const i=r(o);fetch(o.href,i)}})();var fn={exports:{}},er={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ps;function mi(){if(ps)return er;ps=1;var e=zn(),t=Symbol.for("react.element"),r=Symbol.for("react.fragment"),n=Object.prototype.hasOwnProperty,o=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function a(c,u,p){var l,m={},v=null,S=null;p!==void 0&&(v=""+p),u.key!==void 0&&(v=""+u.key),u.ref!==void 0&&(S=u.ref);for(l in u)n.call(u,l)&&!i.hasOwnProperty(l)&&(m[l]=u[l]);if(c&&c.defaultProps)for(l in u=c.defaultProps,u)m[l]===void 0&&(m[l]=u[l]);return{$$typeof:t,type:c,key:v,ref:S,props:m,_owner:o.current}}return er.Fragment=r,er.jsx=a,er.jsxs=a,er}var ms;function hi(){return ms||(ms=1,fn.exports=mi()),fn.exports}var s=hi(),Pr={},hs;function gi(){if(hs)return Pr;hs=1;var e=Ho();return Pr.createRoot=e.createRoot,Pr.hydrateRoot=e.hydrateRoot,Pr}var yi=gi();const xi=In(yi),bi=({onVoiceToggle:e})=>s.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 via-blue-50 to-indigo-100",children:[s.jsx(_.section,{className:"relative overflow-hidden py-20 px-4",initial:{opacity:0},animate:{opacity:1},transition:{duration:.8},children:s.jsx("div",{className:"max-w-7xl mx-auto",children:s.jsxs("div",{className:"relative z-10 text-center",children:[s.jsxs(_.h1,{className:"text-6xl md:text-7xl font-bold mb-8",initial:{y:50,opacity:0},animate:{y:0,opacity:1},transition:{delay:.2,duration:.8},children:[s.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-purple-600 to-blue-600",children:"Il Futuro dello Shopping"}),s.jsx("br",{}),s.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-purple-600",children:"è Vocale"})]}),s.jsx(_.p,{className:"text-xl md:text-2xl text-gray-700 mb-12 max-w-4xl mx-auto leading-relaxed",initial:{y:30,opacity:0},animate:{y:0,opacity:1},transition:{delay:.4,duration:.8},children:"Scopri AIVA, il tuo personal shopper AI che ti aiuta a trovare l'outfit perfetto con comandi vocali in italiano."}),s.jsx(_.div,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},transition:{delay:.6,duration:.8,type:"spring",stiffness:200},className:"mb-16",children:s.jsxs(_.button,{onClick:e,className:"group relative px-12 py-6 bg-gradient-to-r from-purple-600 to-blue-600 text-white text-2xl font-bold rounded-full shadow-2xl hover:shadow-purple-500/25 transform transition-all duration-300",whileHover:{scale:1.05,boxShadow:"0 20px 40px rgba(147, 51, 234, 0.3)"},whileTap:{scale:.95},children:[s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsxs(_.div,{className:"relative",animate:{rotate:[0,10,-10,0]},transition:{duration:2,repeat:1/0},children:[s.jsx(Ft,{size:32}),s.jsx(_.div,{className:"absolute -inset-2 bg-white/20 rounded-full",animate:{scale:[1,1.2,1]},transition:{duration:1.5,repeat:1/0}})]}),s.jsx("span",{children:"Inizia Shopping Vocale"}),s.jsx(sr,{size:24,className:"text-yellow-300"})]}),s.jsx(_.div,{className:"absolute inset-0 rounded-full bg-white/20",initial:{scale:0,opacity:1},animate:{scale:2,opacity:0},transition:{duration:1,repeat:1/0,delay:.5}})]})}),s.jsxs("div",{className:"absolute inset-0 pointer-events-none hidden md:block z-0",children:[s.jsx(_.div,{className:"absolute top-16 left-8 text-pink-400",animate:{y:[0,-15,0],rotate:[0,10,0]},transition:{duration:3,repeat:1/0},children:s.jsx(Ko,{size:64})}),s.jsx(_.div,{className:"absolute top-24 right-12 text-purple-400",animate:{y:[0,20,0],rotate:[0,-8,0]},transition:{duration:4,repeat:1/0,delay:.5},children:s.jsx(Dr,{size:56})}),s.jsx(_.div,{className:"absolute top-32 left-1/4 text-blue-400",animate:{y:[0,-10,0],rotate:[0,5,0]},transition:{duration:2.5,repeat:1/0,delay:1},children:s.jsx(Br,{size:70})}),s.jsx(_.div,{className:"absolute top-48 right-8 text-green-400",animate:{y:[0,15,0],rotate:[0,-12,0]},transition:{duration:3.5,repeat:1/0,delay:.3},children:s.jsx(jt,{size:60})}),s.jsx(_.div,{className:"absolute top-56 left-12 text-yellow-400",animate:{y:[0,-20,0],rotate:[0,8,0]},transition:{duration:2.8,repeat:1/0,delay:.8},children:s.jsx(Xo,{size:60})}),s.jsx(_.div,{className:"absolute top-64 right-1/3 text-red-400",animate:{y:[0,12,0],rotate:[0,-6,0]},transition:{duration:3.2,repeat:1/0,delay:1.2},children:"              "}),s.jsx(_.div,{className:"absolute bottom-48 left-16 text-indigo-400",animate:{y:[0,-18,0],rotate:[0,7,0]},transition:{duration:2.7,repeat:1/0,delay:.6},children:s.jsx(Vr,{size:50})}),s.jsx(_.div,{className:"absolute bottom-40 right-16 text-orange-400",animate:{y:[0,14,0],rotate:[0,-9,0]},transition:{duration:3.8,repeat:1/0,delay:1.1},children:s.jsx(Yo,{size:50})}),s.jsx(_.div,{className:"absolute bottom-32 left-1/3 text-cyan-400",animate:{y:[0,-16,0],rotate:[0,11,0]},transition:{duration:2.9,repeat:1/0,delay:.4}}),s.jsx(_.div,{className:"absolute bottom-24 right-1/4 text-rose-400",animate:{y:[0,22,0],rotate:[0,-7,0]},transition:{duration:3.3,repeat:1/0,delay:.9},children:s.jsx(Zo,{size:75})})]})]})})}),s.jsx(_.section,{className:"py-20 px-4 bg-white/50 backdrop-blur-sm",initial:{opacity:0,y:50},animate:{opacity:1,y:0},transition:{delay:.8,duration:.8},children:s.jsxs("div",{className:"max-w-6xl mx-auto",children:[s.jsxs("div",{className:"text-center mb-16",children:[s.jsx("h2",{className:"text-4xl font-bold text-gray-800 mb-4",children:"Perché Scegliere AIVA"}),s.jsx("p",{className:"text-xl text-gray-600",children:"Un'esperienza di shopping rivoluzionaria"})]}),s.jsxs("div",{className:"grid md:grid-cols-3 gap-12",children:[s.jsxs(_.div,{className:"text-center p-8 bg-white/70 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300",whileHover:{y:-5},children:[s.jsx("div",{className:"w-20 h-20 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full flex items-center justify-center mx-auto mb-6",children:s.jsx(Ft,{size:40,className:"text-white"})}),s.jsx("h3",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Comandi Vocali"}),s.jsx("p",{className:"text-gray-600 text-lg",children:"Cerca, filtra, apri le pagine e aggiungi al carrello con la voce"})]}),s.jsxs(_.div,{className:"text-center p-8 bg-white/70 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300",whileHover:{y:-5},children:[s.jsx("div",{className:"w-20 h-20 bg-gradient-to-r from-blue-500 to-cyan-500 rounded-full flex items-center justify-center mx-auto mb-6",children:s.jsx(sr,{size:40,className:"text-white"})}),s.jsx("h3",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Risposte in Tempo Reale"}),s.jsx("p",{className:"text-gray-600 text-lg",children:"AIVA parla mentre elabora: risposte fluide e naturali, anche interruttibili"})]}),s.jsxs(_.div,{className:"text-center p-8 bg-white/70 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300",whileHover:{y:-5},children:[s.jsx("div",{className:"w-20 h-20 bg-gradient-to-r from-emerald-500 to-teal-500 rounded-full flex items-center justify-center mx-auto mb-6",children:s.jsx(Bs,{size:40,className:"text-white"})}),s.jsx("h3",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Navigazione Istantanea"}),s.jsx("p",{className:"text-gray-600 text-lg",children:"Vai a Prodotti, Offerte o Carrello senza toccare lo schermo: basta dirlo"})]})]})]})}),s.jsx(_.section,{className:"py-20 px-4 bg-gradient-to-r from-purple-600 to-blue-600",initial:{opacity:0,y:50},animate:{opacity:1,y:0},transition:{delay:1,duration:.8},children:s.jsx("div",{className:"max-w-4xl mx-auto text-center text-white",children:s.jsxs(_.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},transition:{delay:1.2,duration:.8},children:[s.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-6",children:"Prova l'Esperienza Shopping del Futuro"}),s.jsx("p",{className:"text-xl md:text-2xl mb-8 opacity-90",children:'Clicca sul microfono e dì "Cerco una felpa nera" per iniziare'}),s.jsx(_.button,{onClick:e,className:"px-10 py-5 bg-white text-purple-600 font-bold text-xl rounded-full shadow-2xl hover:shadow-white/25 transform transition-all duration-300",whileHover:{scale:1.05,boxShadow:"0 20px 40px rgba(255, 255, 255, 0.3)"},whileTap:{scale:.95},children:s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(Ft,{size:28}),s.jsx("span",{children:"Attiva Assistente Vocale"})]})})]})})})]}),gs="aiva_session_id",pn="__AIVA_SESSION_ID__",Cn="X-Session-Id",wi=()=>`sess-${Date.now()}-${Math.random().toString(36).slice(2,10)}`;function Lt(){var t,r;if(typeof window>"u")return null;if(window[pn])return window[pn];let e=null;try{e=((t=window.localStorage)==null?void 0:t.getItem(gs))||null}catch{e=null}if(!e){e=wi();try{(r=window.localStorage)==null||r.setItem(gs,e)}catch{}}return window[pn]=e,e}function et(e={}){const t=Lt();if(!t)return{...e};const r={...e.headers||{}};return r[Cn]||(r[Cn]=t),{...e,headers:r}}const vi=()=>"http://localhost:8000/api".replace(/\/+$/,""),_e=vi();_e.replace(/\/api$/,"");const Si=(e="")=>{if(!e)return _e;if(e.startsWith("http"))return e;const t=_e.endsWith("/")?_e.slice(0,-1):_e,r=e.startsWith("/")?e.slice(1):e;return`${t}/${r}`},mn=async(e,t={})=>{const r=Si(e),n=et({credentials:t.credentials??"include",...t}),o=await fetch(r,n);if(!o.ok)throw new Error(`${t.method||"GET"} ${r} ${o.status}`);return o.json()},$t={async getProducts(e={}){const t=new URLSearchParams(e),r=await fetch(`${_e}/products?${t.toString()}`,et({credentials:"include"}));if(!r.ok)throw new Error(`GET /products ${r.status}`);return r.json()},async getSizeGuide(e){const t=await fetch(`${_e}/size-guide/${encodeURIComponent(e)}`,et());if(!t.ok)throw new Error(`GET /size-guide ${t.status}`);return t.json()},async getProduct(e){const t=await fetch(`${_e}/products/${e}`,et({credentials:"include"}));if(!t.ok)throw new Error(`GET /products/${e} ${t.status}`);return t.json()},async checkAvailability(e,t,r){const n=new URLSearchParams({size:t,color:r}),o=await fetch(`${_e}/products/${e}/availability?${n.toString()}`,et());if(!o.ok)throw new Error(`GET /availability ${o.status}`);return o.json()},async getRecommendations(e={}){const t=new URLSearchParams(e),r=await fetch(`${_e}/recommendations?${t.toString()}`,et());if(!r.ok)throw new Error(`GET /recommendations ${r.status}`);return r.json()},async searchProducts(e,t={}){const r=new URLSearchParams({q:e,...t}),n=await fetch(`${_e}/products?${r.toString()}`,et());if(!n.ok)throw new Error(`GET /products ${n.status}`);return n.json()}},tr={async processVoiceCommand(e,t={},r){var a;const n={text:e,context:t||{}},o=r||((a=n.context)==null?void 0:a.session_id)||Lt();o&&(n.session_id=o,n.context={...n.context,session_id:o});const i=await fetch(`${_e}/voice/command`,et({method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(n)}));if(!i.ok)throw new Error(`POST /voice/command ${i.status}`);return i.json()},async transcribeAudio({audio:e,sampleRate:t=16e3,language:r="it-IT",sessionId:n}={}){const o=n||Lt(),i={audio:e,sample_rate:t,language:r,session_id:o},a=await fetch(`${_e}/speech-to-text`,et({method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(i)}));if(!a.ok)throw new Error(`POST /speech-to-text ${a.status}`);return a.json()},async synthesizeSpeech({text:e,voice:t,sessionId:r}={}){const n=r||Lt(),o={text:e,voice:t,session_id:n},i=await fetch(`${_e}/tts`,et({method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(o)}));if(!i.ok)throw new Error(`POST /tts ${i.status}`);return i.json()}},ji={getSizeGuide:async e=>mn(`/size-guide/${encodeURIComponent(e)}`,{credentials:"omit"}),getShippingInfo:async()=>mn("/shipping-info",{credentials:"omit"}),getPromotions:async()=>mn("/promotions",{credentials:"omit"})};function Ni(e){throw new Error("WebSocket disabilitato in ambiente Vercel")}const Ks="/ldr-icons";function Ci(){return typeof window>"u"?!1:window.location.pathname.startsWith(Ks)}function Ei(e){const t=e.startsWith("/")?e:`/${e}`;return typeof window<"u"&&Ci()?`${Ks}${t}`:t}function Ti(e){return Ei(e)}function En(e){if(!e)return e;const t=String(e);return t.startsWith("http://")||t.startsWith("https://")||t.startsWith("data:")?t:Ti(t)}const Ri={},ys=e=>{let t;const r=new Set,n=(l,m)=>{const v=typeof l=="function"?l(t):l;if(!Object.is(v,t)){const S=t;t=m??(typeof v!="object"||v===null)?v:Object.assign({},t,v),r.forEach(y=>y(t,S))}},o=()=>t,u={setState:n,getState:o,getInitialState:()=>p,subscribe:l=>(r.add(l),()=>r.delete(l)),destroy:()=>{(Ri?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),r.clear()}},p=t=e(n,o,u);return u},_i=e=>e?ys(e):ys;var hn={exports:{}},gn={},yn={exports:{}},xn={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xs;function Ai(){if(xs)return xn;xs=1;var e=zn();function t(m,v){return m===v&&(m!==0||1/m===1/v)||m!==m&&v!==v}var r=typeof Object.is=="function"?Object.is:t,n=e.useState,o=e.useEffect,i=e.useLayoutEffect,a=e.useDebugValue;function c(m,v){var S=v(),y=n({inst:{value:S,getSnapshot:v}}),x=y[0].inst,b=y[1];return i(function(){x.value=S,x.getSnapshot=v,u(x)&&b({inst:x})},[m,S,v]),o(function(){return u(x)&&b({inst:x}),m(function(){u(x)&&b({inst:x})})},[m]),a(S),S}function u(m){var v=m.getSnapshot;m=m.value;try{var S=v();return!r(m,S)}catch{return!0}}function p(m,v){return v()}var l=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?p:c;return xn.useSyncExternalStore=e.useSyncExternalStore!==void 0?e.useSyncExternalStore:l,xn}var bs;function ki(){return bs||(bs=1,yn.exports=Ai()),yn.exports}/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ws;function Pi(){if(ws)return gn;ws=1;var e=zn(),t=ki();function r(p,l){return p===l&&(p!==0||1/p===1/l)||p!==p&&l!==l}var n=typeof Object.is=="function"?Object.is:r,o=t.useSyncExternalStore,i=e.useRef,a=e.useEffect,c=e.useMemo,u=e.useDebugValue;return gn.useSyncExternalStoreWithSelector=function(p,l,m,v,S){var y=i(null);if(y.current===null){var x={hasValue:!1,value:null};y.current=x}else x=y.current;y=c(function(){function N($){if(!E){if(E=!0,O=$,$=v($),S!==void 0&&x.hasValue){var z=x.value;if(S(z,$))return V=z}return V=$}if(z=V,n(O,$))return z;var F=v($);return S!==void 0&&S(z,F)?(O=$,z):(O=$,V=F)}var E=!1,O,V,se=m===void 0?null:m;return[function(){return N(l())},se===null?void 0:function(){return N(se())}]},[l,m,v,S]);var b=o(p,y[0],y[1]);return a(function(){x.hasValue=!0,x.value=b},[b]),u(b),b},gn}var vs;function zi(){return vs||(vs=1,hn.exports=Pi()),hn.exports}var Ii=zi();const Oi=In(Ii),Xs={},{useDebugValue:Fi}=Us,{useSyncExternalStoreWithSelector:Li}=Oi;let Ss=!1;const $i=e=>e;function Mi(e,t=$i,r){(Xs?"production":void 0)!=="production"&&r&&!Ss&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),Ss=!0);const n=Li(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,r);return Fi(n),n}const js=e=>{(Xs?"production":void 0)!=="production"&&typeof e!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const t=typeof e=="function"?_i(e):e,r=(n,o)=>Mi(t,n,o);return Object.assign(r,t),r},qi=e=>e?js(e):js,Fr={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_API_BASE_URL:"http://localhost:8000/api",VITE_ASSETS_BASE_URL:"http://localhost:8000/static/images",VITE_BACKEND_URL:"http://localhost:8000",VITE_DEBUG_MODE:"false",VITE_DEFAULT_LANGUAGE:"it-IT",VITE_ENABLE_ANALYTICS:"false",VITE_ENABLE_VOICE:"true",VITE_ENABLE_WEBSOCKET:"true",VITE_PRIMARY_COLOR:"",VITE_PUBLIC_URL:"http://localhost:5173",VITE_SECONDARY_COLOR:"",VITE_SUPPORTED_LANGUAGES:"it-IT,en-US",VITE_THEME:"light",VITE_TTS_LANGUAGE:"it-IT",VITE_TTS_PITCH:"1.0",VITE_TTS_RATE:"1.0",VITE_VERCEL_MODE:"true",VITE_VOICE_RECOGNITION_LANGUAGE:"it-IT",VITE_WS_URL:"ws://localhost:8000"},Tn=new Map,zr=e=>{const t=Tn.get(e);return t?Object.fromEntries(Object.entries(t.stores).map(([r,n])=>[r,n.getState()])):{}},Di=(e,t,r)=>{if(e===void 0)return{type:"untracked",connection:t.connect(r)};const n=Tn.get(r.name);if(n)return{type:"tracked",store:e,...n};const o={connection:t.connect(r),stores:{}};return Tn.set(r.name,o),{type:"tracked",store:e,...o}},Ui=(e,t={})=>(r,n,o)=>{const{enabled:i,anonymousActionType:a,store:c,...u}=t;let p;try{p=(i??(Fr?"production":void 0)!=="production")&&window.__REDUX_DEVTOOLS_EXTENSION__}catch{}if(!p)return(Fr?"production":void 0)!=="production"&&i&&console.warn("[zustand devtools middleware] Please install/enable Redux devtools extension"),e(r,n,o);const{connection:l,...m}=Di(c,p,u);let v=!0;o.setState=(x,b,N)=>{const E=r(x,b);if(!v)return E;const O=N===void 0?{type:a||"anonymous"}:typeof N=="string"?{type:N}:N;return c===void 0?(l==null||l.send(O,n()),E):(l==null||l.send({...O,type:`${c}/${O.type}`},{...zr(u.name),[c]:o.getState()}),E)};const S=(...x)=>{const b=v;v=!1,r(...x),v=b},y=e(o.setState,n,o);if(m.type==="untracked"?l==null||l.init(y):(m.stores[m.store]=o,l==null||l.init(Object.fromEntries(Object.entries(m.stores).map(([x,b])=>[x,x===m.store?y:b.getState()])))),o.dispatchFromDevtools&&typeof o.dispatch=="function"){let x=!1;const b=o.dispatch;o.dispatch=(...N)=>{(Fr?"production":void 0)!=="production"&&N[0].type==="__setState"&&!x&&(console.warn('[zustand devtools middleware] "__setState" action type is reserved to set state from the devtools. Avoid using it.'),x=!0),b(...N)}}return l.subscribe(x=>{var b;switch(x.type){case"ACTION":if(typeof x.payload!="string"){console.error("[zustand devtools middleware] Unsupported action format");return}return bn(x.payload,N=>{if(N.type==="__setState"){if(c===void 0){S(N.state);return}Object.keys(N.state).length!==1&&console.error(`
                    [zustand devtools middleware] Unsupported __setState action format. 
                    When using 'store' option in devtools(), the 'state' should have only one key, which is a value of 'store' that was passed in devtools(),
                    and value of this only key should be a state object. Example: { "type": "__setState", "state": { "abc123Store": { "foo": "bar" } } }
                    `);const E=N.state[c];if(E==null)return;JSON.stringify(o.getState())!==JSON.stringify(E)&&S(E);return}o.dispatchFromDevtools&&typeof o.dispatch=="function"&&o.dispatch(N)});case"DISPATCH":switch(x.payload.type){case"RESET":return S(y),c===void 0?l==null?void 0:l.init(o.getState()):l==null?void 0:l.init(zr(u.name));case"COMMIT":if(c===void 0){l==null||l.init(o.getState());return}return l==null?void 0:l.init(zr(u.name));case"ROLLBACK":return bn(x.state,N=>{if(c===void 0){S(N),l==null||l.init(o.getState());return}S(N[c]),l==null||l.init(zr(u.name))});case"JUMP_TO_STATE":case"JUMP_TO_ACTION":return bn(x.state,N=>{if(c===void 0){S(N);return}JSON.stringify(o.getState())!==JSON.stringify(N[c])&&S(N[c])});case"IMPORT_STATE":{const{nextLiftedState:N}=x.payload,E=(b=N.computedStates.slice(-1)[0])==null?void 0:b.state;if(!E)return;S(c===void 0?E:E[c]),l==null||l.send(null,N);return}case"PAUSE_RECORDING":return v=!v}return}}),y},Bi=Ui,bn=(e,t)=>{let r;try{r=JSON.parse(e)}catch(n){console.error("[zustand devtools middleware] Could not parse the received json",n)}r!==void 0&&t(r)};function Vi(e,t){let r;try{r=e()}catch{return}return{getItem:o=>{var i;const a=u=>u===null?null:JSON.parse(u,void 0),c=(i=r.getItem(o))!=null?i:null;return c instanceof Promise?c.then(a):a(c)},setItem:(o,i)=>r.setItem(o,JSON.stringify(i,void 0)),removeItem:o=>r.removeItem(o)}}const or=e=>t=>{try{const r=e(t);return r instanceof Promise?r:{then(n){return or(n)(r)},catch(n){return this}}}catch(r){return{then(n){return this},catch(n){return or(n)(r)}}}},Hi=(e,t)=>(r,n,o)=>{let i={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:b=>b,version:0,merge:(b,N)=>({...N,...b}),...t},a=!1;const c=new Set,u=new Set;let p;try{p=i.getStorage()}catch{}if(!p)return e((...b)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),r(...b)},n,o);const l=or(i.serialize),m=()=>{const b=i.partialize({...n()});let N;const E=l({state:b,version:i.version}).then(O=>p.setItem(i.name,O)).catch(O=>{N=O});if(N)throw N;return E},v=o.setState;o.setState=(b,N)=>{v(b,N),m()};const S=e((...b)=>{r(...b),m()},n,o);let y;const x=()=>{var b;if(!p)return;a=!1,c.forEach(E=>E(n()));const N=((b=i.onRehydrateStorage)==null?void 0:b.call(i,n()))||void 0;return or(p.getItem.bind(p))(i.name).then(E=>{if(E)return i.deserialize(E)}).then(E=>{if(E)if(typeof E.version=="number"&&E.version!==i.version){if(i.migrate)return i.migrate(E.state,E.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return E.state}).then(E=>{var O;return y=i.merge(E,(O=n())!=null?O:S),r(y,!0),m()}).then(()=>{N==null||N(y,void 0),a=!0,u.forEach(E=>E(y))}).catch(E=>{N==null||N(void 0,E)})};return o.persist={setOptions:b=>{i={...i,...b},b.getStorage&&(p=b.getStorage())},clearStorage:()=>{p==null||p.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>x(),hasHydrated:()=>a,onHydrate:b=>(c.add(b),()=>{c.delete(b)}),onFinishHydration:b=>(u.add(b),()=>{u.delete(b)})},x(),y||S},Gi=(e,t)=>(r,n,o)=>{let i={storage:Vi(()=>localStorage),partialize:x=>x,version:0,merge:(x,b)=>({...b,...x}),...t},a=!1;const c=new Set,u=new Set;let p=i.storage;if(!p)return e((...x)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),r(...x)},n,o);const l=()=>{const x=i.partialize({...n()});return p.setItem(i.name,{state:x,version:i.version})},m=o.setState;o.setState=(x,b)=>{m(x,b),l()};const v=e((...x)=>{r(...x),l()},n,o);o.getInitialState=()=>v;let S;const y=()=>{var x,b;if(!p)return;a=!1,c.forEach(E=>{var O;return E((O=n())!=null?O:v)});const N=((b=i.onRehydrateStorage)==null?void 0:b.call(i,(x=n())!=null?x:v))||void 0;return or(p.getItem.bind(p))(i.name).then(E=>{if(E)if(typeof E.version=="number"&&E.version!==i.version){if(i.migrate)return[!0,i.migrate(E.state,E.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,E.state];return[!1,void 0]}).then(E=>{var O;const[V,se]=E;if(S=i.merge(se,(O=n())!=null?O:v),r(S,!0),V)return l()}).then(()=>{N==null||N(S,void 0),S=n(),a=!0,u.forEach(E=>E(S))}).catch(E=>{N==null||N(void 0,E)})};return o.persist={setOptions:x=>{i={...i,...x},x.storage&&(p=x.storage)},clearStorage:()=>{p==null||p.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>y(),hasHydrated:()=>a,onHydrate:x=>(c.add(x),()=>{c.delete(x)}),onFinishHydration:x=>(u.add(x),()=>{u.delete(x)})},i.skipHydration||y(),S||v},Wi=(e,t)=>"getStorage"in t||"serialize"in t||"deserialize"in t?((Fr?"production":void 0)!=="production"&&console.warn("[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead."),Hi(e,t)):Gi(e,t),Qi=Wi,Ji=e=>(e||"").toString().normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").toLowerCase().replace(/[^a-z0-9]+/g," ").trim(),It=e=>{if(typeof window>"u")return;const t=(e||[]).map(n=>{var o,i,a;return{item_id:n.id,product_id:(o=n.product)==null?void 0:o.id,name:(i=n.product)==null?void 0:i.name,size:n.size,color:n.color,quantity:n.quantity,price:(a=n.product)==null?void 0:a.price}}),r={};for(const n of t){const o=Ji(`${n.name} ${n.size||""} ${n.color||""}`);o&&(r[o]=n.item_id)}window.cartSnapshot=t,window.cartItemsMap=r},Le=qi(Bi(Qi((e,t)=>({cart:[],cartTotal:0,cartCount:0,preferences:{size:null,color:null,gender:null,style:null},isVoiceAssistantOpen:!1,isMobileMenuOpen:!1,isCartOpen:!1,currentPage:"home",voiceHistory:[],isListening:!1,products:[],filteredProducts:[],selectedProduct:null,searchQuery:"",activeFilters:{category:null,gender:null,size:null,color:null,minPrice:0,maxPrice:1e3,onSale:!1,brand:null,style:null},addToCart:(r,n,o,i=1)=>{e(a=>{const c=a.cart.find(m=>m.product.id===r.id&&m.size===n&&m.color===o);let u;c?u=a.cart.map(m=>m===c?{...m,quantity:m.quantity+i}:m):u=[...a.cart,{id:`cart-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,product:r,size:n,color:o,quantity:i,addedAt:new Date().toISOString()}];const p=u.reduce((m,v)=>m+v.product.price*v.quantity,0),l=u.reduce((m,v)=>m+v.quantity,0);return It(u),{cart:u,cartTotal:p,cartCount:l}})},removeFromCart:r=>{e(n=>{const o=n.cart.filter(c=>c.id!==r),i=o.reduce((c,u)=>c+u.product.price*u.quantity,0),a=o.reduce((c,u)=>c+u.quantity,0);return It(o),{cart:o,cartTotal:i,cartCount:a}})},clearCart:()=>{e({cart:[],cartTotal:0,cartCount:0}),It([])},updateQuantity:(r,n)=>{if(n<=0){t().removeFromCart(r);return}e(o=>{const i=o.cart.map(u=>u.id===r?{...u,quantity:n}:u),a=i.reduce((u,p)=>u+p.product.price*p.quantity,0),c=i.reduce((u,p)=>u+p.quantity,0);return It(i),{cart:i,cartTotal:a,cartCount:c}})},setCartFromServer:r=>{e(n=>{const o=Array.isArray(r==null?void 0:r.items)?r.items:[],i=Number((r==null?void 0:r.item_count)??(r==null?void 0:r.count)??(r==null?void 0:r.total_items)??0)||0,a=Number((r==null?void 0:r.grand_total)??(r==null?void 0:r.total)??(r==null?void 0:r.subtotal)??0)||0,c=o.length>0||i>0||a>0||n.cart.length===0,u=c?o:n.cart,p=c?a||u.reduce((m,v)=>{var S;return m+(((S=v.product)==null?void 0:S.price)||0)*(v.quantity||0)},0):n.cartTotal,l=c?i||u.reduce((m,v)=>m+(v.quantity||0),0):n.cartCount;return It(u),{cart:u,cartTotal:p,cartCount:l}})},setPreferences:r=>{e(n=>({preferences:{...n.preferences,...r}}))},updatePreference:(r,n)=>{e(o=>({preferences:{...o.preferences,[r]:n}}))},setCurrentPage:r=>e({currentPage:r}),toggleVoiceAssistant:()=>{e(r=>({isVoiceAssistantOpen:!r.isVoiceAssistantOpen}))},addVoiceHistory:r=>{e(n=>({voiceHistory:[...n.voiceHistory,{...r,timestamp:new Date().toISOString(),id:`voice-${Date.now()}`}].slice(-50)}))},clearVoiceHistory:()=>e({voiceHistory:[]}),setProducts:r=>{e({products:r,filteredProducts:r})},setSearchQuery:r=>{e(n=>{const o=r.toLowerCase();if(!r)return{searchQuery:"",filteredProducts:n.products};const i={maglia:["maglia","maglietta","t-shirt","polo"],felpa:["felpa","hoodie","felpa con cappuccio"],pantaloni:["pantaloni","jeans","denim","chino"],scarpe:["scarpe","sneakers","stivali","sandali"],giacca:["giacca","giubbotto","bomber","cappotto"]};let a=[o];for(const[u,p]of Object.entries(i))p.some(l=>o.includes(l))&&(a=[...a,...p]);const c=n.products.filter(u=>{const p=[u.name,u.description,u.brand,u.category,u.subcategory,...u.tags||[]].join(" ").toLowerCase();return a.some(l=>p.includes(l))});return{searchQuery:r,filteredProducts:c}})},setFilter:(r,n)=>{e(o=>{const i={...o.activeFilters,[r]:n},a=t().applyFilters(o.products,i,o.searchQuery);return{activeFilters:i,filteredProducts:a}})},setMultipleFilters:r=>{e(n=>{const o={...n.activeFilters,...r},i=t().applyFilters(n.products,o,n.searchQuery);return{activeFilters:o,filteredProducts:i}})},clearFilters:()=>{e(r=>({activeFilters:{category:null,gender:null,size:null,color:null,minPrice:0,maxPrice:1e3,onSale:!1,brand:null,style:null},filteredProducts:r.products,searchQuery:""}))},applyFilters:(r,n,o="")=>{let i=[...r];if(o){const a=o.toLowerCase();i=i.filter(c=>[c.name,c.description,c.brand,c.category,c.subcategory,...c.tags||[]].join(" ").toLowerCase().includes(a))}return n.category&&(i=i.filter(a=>a.category===n.category||a.subcategory===n.category)),n.gender&&(i=i.filter(a=>a.gender===n.gender||a.gender==="unisex")),n.size&&(i=i.filter(a=>a.variants&&a.variants.some(c=>c.size===n.size&&c.available))),n.color&&(i=i.filter(a=>a.variants&&a.variants.some(c=>c.color.toLowerCase().includes(n.color.toLowerCase())))),n.minPrice>0&&(i=i.filter(a=>a.price>=n.minPrice)),n.maxPrice<1e3&&(i=i.filter(a=>a.price<=n.maxPrice)),n.onSale&&(i=i.filter(a=>a.on_sale||a.discount_percentage>0)),n.brand&&(i=i.filter(a=>a.brand.toLowerCase().includes(n.brand.toLowerCase()))),n.style&&(i=i.filter(a=>a.style&&a.style.toLowerCase().includes(n.style.toLowerCase()))),i},filterProducts:r=>{e(n=>{const o={...n.activeFilters,...r},i=t().applyFilters(n.products,o,n.searchQuery);return{activeFilters:o,filteredProducts:i}})},searchProducts:(r,n={})=>{e(o=>{const i={...o.activeFilters,...n},a=t().applyFilters(o.products,i,r);return{searchQuery:r,activeFilters:i,filteredProducts:a}})},setSelectedProduct:r=>e({selectedProduct:r}),getProductById:r=>t().products.find(o=>o.id===r),isProductInCart:(r,n=null,o=null)=>t().cart.some(a=>{const c=a.product.id===r,u=!n||a.size===n,p=!o||a.color===o;return c&&u&&p}),getCartItemCount:(r,n=null,o=null)=>{const a=t().cart.find(c=>{const u=c.product.id===r,p=!n||c.size===n,l=!o||c.color===o;return u&&p&&l});return a?a.quantity:0},processVoiceCommand:(r,n)=>{switch(t(),r){case"search_products":n.query&&t().searchProducts(n.query,n.filters||{});break;case"add_to_cart":if(n.product_id){const o=t().getProductById(n.product_id);o&&t().addToCart(o,n.size||"M",n.color||"nero",n.quantity||1)}break;case"clear_cart":t().clearCart();break;case"set_preferences":n.preferences&&t().setPreferences(n.preferences);break;default:console.log("Unknown voice command:",r)}t().addVoiceHistory({command:r,parameters:n,result:"processed"})},getShoppingInsights:()=>{const r=t(),n=r.cartTotal,o=r.cartCount,i=r.voiceHistory.filter(c=>c.command==="search_products").map(c=>{var u;return(u=c.parameters)==null?void 0:u.query}).filter(Boolean),a=r.preferences.size||(r.cart.length>0?r.cart[0].size:null);return{totalSpent:n,itemsInCart:o,favoriteCategories:i,preferredSize:a,searchHistory:r.voiceHistory.slice(-10),lastUpdated:new Date().toISOString()}}}),{name:"aiva-storage",partialize:e=>({cart:e.cart,cartTotal:e.cartTotal,cartCount:e.cartCount,preferences:e.preferences,voiceHistory:e.voiceHistory.slice(-20)}),onRehydrateStorage:()=>(e,t)=>{if(!t)try{It((e==null?void 0:e.cart)||[])}catch(r){console.warn("Failed to publish cart snapshot after rehydrate:",r)}}}),{name:"aiva-store"}));function Ys(e,t){return function(){return e.apply(t,arguments)}}const{toString:Ki}=Object.prototype,{getPrototypeOf:On}=Object,{iterator:Hr,toStringTag:Zs}=Symbol,Gr=(e=>t=>{const r=Ki.call(t);return e[r]||(e[r]=r.slice(8,-1).toLowerCase())})(Object.create(null)),Be=e=>(e=e.toLowerCase(),t=>Gr(t)===e),Wr=e=>t=>typeof t===e,{isArray:Dt}=Array,qt=Wr("undefined");function cr(e){return e!==null&&!qt(e)&&e.constructor!==null&&!qt(e.constructor)&&Ae(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const eo=Be("ArrayBuffer");function Xi(e){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(e):t=e&&e.buffer&&eo(e.buffer),t}const Yi=Wr("string"),Ae=Wr("function"),to=Wr("number"),lr=e=>e!==null&&typeof e=="object",Zi=e=>e===!0||e===!1,Lr=e=>{if(Gr(e)!=="object")return!1;const t=On(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Zs in e)&&!(Hr in e)},ea=e=>{if(!lr(e)||cr(e))return!1;try{return Object.keys(e).length===0&&Object.getPrototypeOf(e)===Object.prototype}catch{return!1}},ta=Be("Date"),ra=Be("File"),na=Be("Blob"),sa=Be("FileList"),oa=e=>lr(e)&&Ae(e.pipe),ia=e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||Ae(e.append)&&((t=Gr(e))==="formdata"||t==="object"&&Ae(e.toString)&&e.toString()==="[object FormData]"))},aa=Be("URLSearchParams"),[ca,la,ua,da]=["ReadableStream","Request","Response","Headers"].map(Be),fa=e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function ur(e,t,{allOwnKeys:r=!1}={}){if(e===null||typeof e>"u")return;let n,o;if(typeof e!="object"&&(e=[e]),Dt(e))for(n=0,o=e.length;n<o;n++)t.call(null,e[n],n,e);else{if(cr(e))return;const i=r?Object.getOwnPropertyNames(e):Object.keys(e),a=i.length;let c;for(n=0;n<a;n++)c=i[n],t.call(null,e[c],c,e)}}function ro(e,t){if(cr(e))return null;t=t.toLowerCase();const r=Object.keys(e);let n=r.length,o;for(;n-- >0;)if(o=r[n],t===o.toLowerCase())return o;return null}const wt=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:globalThis,no=e=>!qt(e)&&e!==wt;function Rn(){const{caseless:e,skipUndefined:t}=no(this)&&this||{},r={},n=(o,i)=>{const a=e&&ro(r,i)||i;Lr(r[a])&&Lr(o)?r[a]=Rn(r[a],o):Lr(o)?r[a]=Rn({},o):Dt(o)?r[a]=o.slice():(!t||!qt(o))&&(r[a]=o)};for(let o=0,i=arguments.length;o<i;o++)arguments[o]&&ur(arguments[o],n);return r}const pa=(e,t,r,{allOwnKeys:n}={})=>(ur(t,(o,i)=>{r&&Ae(o)?e[i]=Ys(o,r):e[i]=o},{allOwnKeys:n}),e),ma=e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),ha=(e,t,r,n)=>{e.prototype=Object.create(t.prototype,n),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),r&&Object.assign(e.prototype,r)},ga=(e,t,r,n)=>{let o,i,a;const c={};if(t=t||{},e==null)return t;do{for(o=Object.getOwnPropertyNames(e),i=o.length;i-- >0;)a=o[i],(!n||n(a,e,t))&&!c[a]&&(t[a]=e[a],c[a]=!0);e=r!==!1&&On(e)}while(e&&(!r||r(e,t))&&e!==Object.prototype);return t},ya=(e,t,r)=>{e=String(e),(r===void 0||r>e.length)&&(r=e.length),r-=t.length;const n=e.indexOf(t,r);return n!==-1&&n===r},xa=e=>{if(!e)return null;if(Dt(e))return e;let t=e.length;if(!to(t))return null;const r=new Array(t);for(;t-- >0;)r[t]=e[t];return r},ba=(e=>t=>e&&t instanceof e)(typeof Uint8Array<"u"&&On(Uint8Array)),wa=(e,t)=>{const n=(e&&e[Hr]).call(e);let o;for(;(o=n.next())&&!o.done;){const i=o.value;t.call(e,i[0],i[1])}},va=(e,t)=>{let r;const n=[];for(;(r=e.exec(t))!==null;)n.push(r);return n},Sa=Be("HTMLFormElement"),ja=e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,n,o){return n.toUpperCase()+o}),Ns=(({hasOwnProperty:e})=>(t,r)=>e.call(t,r))(Object.prototype),Na=Be("RegExp"),so=(e,t)=>{const r=Object.getOwnPropertyDescriptors(e),n={};ur(r,(o,i)=>{let a;(a=t(o,i,e))!==!1&&(n[i]=a||o)}),Object.defineProperties(e,n)},Ca=e=>{so(e,(t,r)=>{if(Ae(e)&&["arguments","caller","callee"].indexOf(r)!==-1)return!1;const n=e[r];if(Ae(n)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")})}})},Ea=(e,t)=>{const r={},n=o=>{o.forEach(i=>{r[i]=!0})};return Dt(e)?n(e):n(String(e).split(t)),r},Ta=()=>{},Ra=(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t;function _a(e){return!!(e&&Ae(e.append)&&e[Zs]==="FormData"&&e[Hr])}const Aa=e=>{const t=new Array(10),r=(n,o)=>{if(lr(n)){if(t.indexOf(n)>=0)return;if(cr(n))return n;if(!("toJSON"in n)){t[o]=n;const i=Dt(n)?[]:{};return ur(n,(a,c)=>{const u=r(a,o+1);!qt(u)&&(i[c]=u)}),t[o]=void 0,i}}return n};return r(e,0)},ka=Be("AsyncFunction"),Pa=e=>e&&(lr(e)||Ae(e))&&Ae(e.then)&&Ae(e.catch),oo=((e,t)=>e?setImmediate:t?((r,n)=>(wt.addEventListener("message",({source:o,data:i})=>{o===wt&&i===r&&n.length&&n.shift()()},!1),o=>{n.push(o),wt.postMessage(r,"*")}))(`axios@${Math.random()}`,[]):r=>setTimeout(r))(typeof setImmediate=="function",Ae(wt.postMessage)),za=typeof queueMicrotask<"u"?queueMicrotask.bind(wt):typeof process<"u"&&process.nextTick||oo,Ia=e=>e!=null&&Ae(e[Hr]),g={isArray:Dt,isArrayBuffer:eo,isBuffer:cr,isFormData:ia,isArrayBufferView:Xi,isString:Yi,isNumber:to,isBoolean:Zi,isObject:lr,isPlainObject:Lr,isEmptyObject:ea,isReadableStream:ca,isRequest:la,isResponse:ua,isHeaders:da,isUndefined:qt,isDate:ta,isFile:ra,isBlob:na,isRegExp:Na,isFunction:Ae,isStream:oa,isURLSearchParams:aa,isTypedArray:ba,isFileList:sa,forEach:ur,merge:Rn,extend:pa,trim:fa,stripBOM:ma,inherits:ha,toFlatObject:ga,kindOf:Gr,kindOfTest:Be,endsWith:ya,toArray:xa,forEachEntry:wa,matchAll:va,isHTMLForm:Sa,hasOwnProperty:Ns,hasOwnProp:Ns,reduceDescriptors:so,freezeMethods:Ca,toObjectSet:Ea,toCamelCase:ja,noop:Ta,toFiniteNumber:Ra,findKey:ro,global:wt,isContextDefined:no,isSpecCompliantForm:_a,toJSONObject:Aa,isAsyncFn:ka,isThenable:Pa,setImmediate:oo,asap:za,isIterable:Ia};function J(e,t,r,n,o){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),r&&(this.config=r),n&&(this.request=n),o&&(this.response=o,this.status=o.status?o.status:null)}g.inherits(J,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:g.toJSONObject(this.config),code:this.code,status:this.status}}});const io=J.prototype,ao={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{ao[e]={value:e}});Object.defineProperties(J,ao);Object.defineProperty(io,"isAxiosError",{value:!0});J.from=(e,t,r,n,o,i)=>{const a=Object.create(io);g.toFlatObject(e,a,function(l){return l!==Error.prototype},p=>p!=="isAxiosError");const c=e&&e.message?e.message:"Error",u=t==null&&e?e.code:t;return J.call(a,c,u,r,n,o),e&&a.cause==null&&Object.defineProperty(a,"cause",{value:e,configurable:!0}),a.name=e&&e.name||"Error",i&&Object.assign(a,i),a};const Oa=null;function _n(e){return g.isPlainObject(e)||g.isArray(e)}function co(e){return g.endsWith(e,"[]")?e.slice(0,-2):e}function Cs(e,t,r){return e?e.concat(t).map(function(o,i){return o=co(o),!r&&i?"["+o+"]":o}).join(r?".":""):t}function Fa(e){return g.isArray(e)&&!e.some(_n)}const La=g.toFlatObject(g,{},null,function(t){return/^is[A-Z]/.test(t)});function Qr(e,t,r){if(!g.isObject(e))throw new TypeError("target must be an object");t=t||new FormData,r=g.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,function(x,b){return!g.isUndefined(b[x])});const n=r.metaTokens,o=r.visitor||l,i=r.dots,a=r.indexes,u=(r.Blob||typeof Blob<"u"&&Blob)&&g.isSpecCompliantForm(t);if(!g.isFunction(o))throw new TypeError("visitor must be a function");function p(y){if(y===null)return"";if(g.isDate(y))return y.toISOString();if(g.isBoolean(y))return y.toString();if(!u&&g.isBlob(y))throw new J("Blob is not supported. Use a Buffer instead.");return g.isArrayBuffer(y)||g.isTypedArray(y)?u&&typeof Blob=="function"?new Blob([y]):Buffer.from(y):y}function l(y,x,b){let N=y;if(y&&!b&&typeof y=="object"){if(g.endsWith(x,"{}"))x=n?x:x.slice(0,-2),y=JSON.stringify(y);else if(g.isArray(y)&&Fa(y)||(g.isFileList(y)||g.endsWith(x,"[]"))&&(N=g.toArray(y)))return x=co(x),N.forEach(function(O,V){!(g.isUndefined(O)||O===null)&&t.append(a===!0?Cs([x],V,i):a===null?x:x+"[]",p(O))}),!1}return _n(y)?!0:(t.append(Cs(b,x,i),p(y)),!1)}const m=[],v=Object.assign(La,{defaultVisitor:l,convertValue:p,isVisitable:_n});function S(y,x){if(!g.isUndefined(y)){if(m.indexOf(y)!==-1)throw Error("Circular reference detected in "+x.join("."));m.push(y),g.forEach(y,function(N,E){(!(g.isUndefined(N)||N===null)&&o.call(t,N,g.isString(E)?E.trim():E,x,v))===!0&&S(N,x?x.concat(E):[E])}),m.pop()}}if(!g.isObject(e))throw new TypeError("data must be an object");return S(e),t}function Es(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(n){return t[n]})}function Fn(e,t){this._pairs=[],e&&Qr(e,this,t)}const lo=Fn.prototype;lo.append=function(t,r){this._pairs.push([t,r])};lo.toString=function(t){const r=t?function(n){return t.call(this,n,Es)}:Es;return this._pairs.map(function(o){return r(o[0])+"="+r(o[1])},"").join("&")};function $a(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function uo(e,t,r){if(!t)return e;const n=r&&r.encode||$a;g.isFunction(r)&&(r={serialize:r});const o=r&&r.serialize;let i;if(o?i=o(t,r):i=g.isURLSearchParams(t)?t.toString():new Fn(t,r).toString(n),i){const a=e.indexOf("#");a!==-1&&(e=e.slice(0,a)),e+=(e.indexOf("?")===-1?"?":"&")+i}return e}class Ts{constructor(){this.handlers=[]}use(t,r,n){return this.handlers.push({fulfilled:t,rejected:r,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){g.forEach(this.handlers,function(n){n!==null&&t(n)})}}const fo={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Ma=typeof URLSearchParams<"u"?URLSearchParams:Fn,qa=typeof FormData<"u"?FormData:null,Da=typeof Blob<"u"?Blob:null,Ua={isBrowser:!0,classes:{URLSearchParams:Ma,FormData:qa,Blob:Da},protocols:["http","https","file","blob","url","data"]},Ln=typeof window<"u"&&typeof document<"u",An=typeof navigator=="object"&&navigator||void 0,Ba=Ln&&(!An||["ReactNative","NativeScript","NS"].indexOf(An.product)<0),Va=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Ha=Ln&&window.location.href||"http://localhost",Ga=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Ln,hasStandardBrowserEnv:Ba,hasStandardBrowserWebWorkerEnv:Va,navigator:An,origin:Ha},Symbol.toStringTag,{value:"Module"})),Ce={...Ga,...Ua};function Wa(e,t){return Qr(e,new Ce.classes.URLSearchParams,{visitor:function(r,n,o,i){return Ce.isNode&&g.isBuffer(r)?(this.append(n,r.toString("base64")),!1):i.defaultVisitor.apply(this,arguments)},...t})}function Qa(e){return g.matchAll(/\w+|\[(\w*)]/g,e).map(t=>t[0]==="[]"?"":t[1]||t[0])}function Ja(e){const t={},r=Object.keys(e);let n;const o=r.length;let i;for(n=0;n<o;n++)i=r[n],t[i]=e[i];return t}function po(e){function t(r,n,o,i){let a=r[i++];if(a==="__proto__")return!0;const c=Number.isFinite(+a),u=i>=r.length;return a=!a&&g.isArray(o)?o.length:a,u?(g.hasOwnProp(o,a)?o[a]=[o[a],n]:o[a]=n,!c):((!o[a]||!g.isObject(o[a]))&&(o[a]=[]),t(r,n,o[a],i)&&g.isArray(o[a])&&(o[a]=Ja(o[a])),!c)}if(g.isFormData(e)&&g.isFunction(e.entries)){const r={};return g.forEachEntry(e,(n,o)=>{t(Qa(n),o,r,0)}),r}return null}function Ka(e,t,r){if(g.isString(e))try{return(t||JSON.parse)(e),g.trim(e)}catch(n){if(n.name!=="SyntaxError")throw n}return(r||JSON.stringify)(e)}const dr={transitional:fo,adapter:["xhr","http","fetch"],transformRequest:[function(t,r){const n=r.getContentType()||"",o=n.indexOf("application/json")>-1,i=g.isObject(t);if(i&&g.isHTMLForm(t)&&(t=new FormData(t)),g.isFormData(t))return o?JSON.stringify(po(t)):t;if(g.isArrayBuffer(t)||g.isBuffer(t)||g.isStream(t)||g.isFile(t)||g.isBlob(t)||g.isReadableStream(t))return t;if(g.isArrayBufferView(t))return t.buffer;if(g.isURLSearchParams(t))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let c;if(i){if(n.indexOf("application/x-www-form-urlencoded")>-1)return Wa(t,this.formSerializer).toString();if((c=g.isFileList(t))||n.indexOf("multipart/form-data")>-1){const u=this.env&&this.env.FormData;return Qr(c?{"files[]":t}:t,u&&new u,this.formSerializer)}}return i||o?(r.setContentType("application/json",!1),Ka(t)):t}],transformResponse:[function(t){const r=this.transitional||dr.transitional,n=r&&r.forcedJSONParsing,o=this.responseType==="json";if(g.isResponse(t)||g.isReadableStream(t))return t;if(t&&g.isString(t)&&(n&&!this.responseType||o)){const a=!(r&&r.silentJSONParsing)&&o;try{return JSON.parse(t,this.parseReviver)}catch(c){if(a)throw c.name==="SyntaxError"?J.from(c,J.ERR_BAD_RESPONSE,this,null,this.response):c}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Ce.classes.FormData,Blob:Ce.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};g.forEach(["delete","get","head","post","put","patch"],e=>{dr.headers[e]={}});const Xa=g.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Ya=e=>{const t={};let r,n,o;return e&&e.split(`
`).forEach(function(a){o=a.indexOf(":"),r=a.substring(0,o).trim().toLowerCase(),n=a.substring(o+1).trim(),!(!r||t[r]&&Xa[r])&&(r==="set-cookie"?t[r]?t[r].push(n):t[r]=[n]:t[r]=t[r]?t[r]+", "+n:n)}),t},Rs=Symbol("internals");function rr(e){return e&&String(e).trim().toLowerCase()}function $r(e){return e===!1||e==null?e:g.isArray(e)?e.map($r):String(e)}function Za(e){const t=Object.create(null),r=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=r.exec(e);)t[n[1]]=n[2];return t}const ec=e=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim());function wn(e,t,r,n,o){if(g.isFunction(n))return n.call(this,t,r);if(o&&(t=r),!!g.isString(t)){if(g.isString(n))return t.indexOf(n)!==-1;if(g.isRegExp(n))return n.test(t)}}function tc(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,r,n)=>r.toUpperCase()+n)}function rc(e,t){const r=g.toCamelCase(" "+t);["get","set","has"].forEach(n=>{Object.defineProperty(e,n+r,{value:function(o,i,a){return this[n].call(this,t,o,i,a)},configurable:!0})})}let ke=class{constructor(t){t&&this.set(t)}set(t,r,n){const o=this;function i(c,u,p){const l=rr(u);if(!l)throw new Error("header name must be a non-empty string");const m=g.findKey(o,l);(!m||o[m]===void 0||p===!0||p===void 0&&o[m]!==!1)&&(o[m||u]=$r(c))}const a=(c,u)=>g.forEach(c,(p,l)=>i(p,l,u));if(g.isPlainObject(t)||t instanceof this.constructor)a(t,r);else if(g.isString(t)&&(t=t.trim())&&!ec(t))a(Ya(t),r);else if(g.isObject(t)&&g.isIterable(t)){let c={},u,p;for(const l of t){if(!g.isArray(l))throw TypeError("Object iterator must return a key-value pair");c[p=l[0]]=(u=c[p])?g.isArray(u)?[...u,l[1]]:[u,l[1]]:l[1]}a(c,r)}else t!=null&&i(r,t,n);return this}get(t,r){if(t=rr(t),t){const n=g.findKey(this,t);if(n){const o=this[n];if(!r)return o;if(r===!0)return Za(o);if(g.isFunction(r))return r.call(this,o,n);if(g.isRegExp(r))return r.exec(o);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,r){if(t=rr(t),t){const n=g.findKey(this,t);return!!(n&&this[n]!==void 0&&(!r||wn(this,this[n],n,r)))}return!1}delete(t,r){const n=this;let o=!1;function i(a){if(a=rr(a),a){const c=g.findKey(n,a);c&&(!r||wn(n,n[c],c,r))&&(delete n[c],o=!0)}}return g.isArray(t)?t.forEach(i):i(t),o}clear(t){const r=Object.keys(this);let n=r.length,o=!1;for(;n--;){const i=r[n];(!t||wn(this,this[i],i,t,!0))&&(delete this[i],o=!0)}return o}normalize(t){const r=this,n={};return g.forEach(this,(o,i)=>{const a=g.findKey(n,i);if(a){r[a]=$r(o),delete r[i];return}const c=t?tc(i):String(i).trim();c!==i&&delete r[i],r[c]=$r(o),n[c]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const r=Object.create(null);return g.forEach(this,(n,o)=>{n!=null&&n!==!1&&(r[o]=t&&g.isArray(n)?n.join(", "):n)}),r}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,r])=>t+": "+r).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...r){const n=new this(t);return r.forEach(o=>n.set(o)),n}static accessor(t){const n=(this[Rs]=this[Rs]={accessors:{}}).accessors,o=this.prototype;function i(a){const c=rr(a);n[c]||(rc(o,a),n[c]=!0)}return g.isArray(t)?t.forEach(i):i(t),this}};ke.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);g.reduceDescriptors(ke.prototype,({value:e},t)=>{let r=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(n){this[r]=n}}});g.freezeMethods(ke);function vn(e,t){const r=this||dr,n=t||r,o=ke.from(n.headers);let i=n.data;return g.forEach(e,function(c){i=c.call(r,i,o.normalize(),t?t.status:void 0)}),o.normalize(),i}function mo(e){return!!(e&&e.__CANCEL__)}function Ut(e,t,r){J.call(this,e??"canceled",J.ERR_CANCELED,t,r),this.name="CanceledError"}g.inherits(Ut,J,{__CANCEL__:!0});function ho(e,t,r){const n=r.config.validateStatus;!r.status||!n||n(r.status)?e(r):t(new J("Request failed with status code "+r.status,[J.ERR_BAD_REQUEST,J.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r))}function nc(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}function sc(e,t){e=e||10;const r=new Array(e),n=new Array(e);let o=0,i=0,a;return t=t!==void 0?t:1e3,function(u){const p=Date.now(),l=n[i];a||(a=p),r[o]=u,n[o]=p;let m=i,v=0;for(;m!==o;)v+=r[m++],m=m%e;if(o=(o+1)%e,o===i&&(i=(i+1)%e),p-a<t)return;const S=l&&p-l;return S?Math.round(v*1e3/S):void 0}}function oc(e,t){let r=0,n=1e3/t,o,i;const a=(p,l=Date.now())=>{r=l,o=null,i&&(clearTimeout(i),i=null),e(...p)};return[(...p)=>{const l=Date.now(),m=l-r;m>=n?a(p,l):(o=p,i||(i=setTimeout(()=>{i=null,a(o)},n-m)))},()=>o&&a(o)]}const Ur=(e,t,r=3)=>{let n=0;const o=sc(50,250);return oc(i=>{const a=i.loaded,c=i.lengthComputable?i.total:void 0,u=a-n,p=o(u),l=a<=c;n=a;const m={loaded:a,total:c,progress:c?a/c:void 0,bytes:u,rate:p||void 0,estimated:p&&c&&l?(c-a)/p:void 0,event:i,lengthComputable:c!=null,[t?"download":"upload"]:!0};e(m)},r)},_s=(e,t)=>{const r=e!=null;return[n=>t[0]({lengthComputable:r,total:e,loaded:n}),t[1]]},As=e=>(...t)=>g.asap(()=>e(...t)),ic=Ce.hasStandardBrowserEnv?((e,t)=>r=>(r=new URL(r,Ce.origin),e.protocol===r.protocol&&e.host===r.host&&(t||e.port===r.port)))(new URL(Ce.origin),Ce.navigator&&/(msie|trident)/i.test(Ce.navigator.userAgent)):()=>!0,ac=Ce.hasStandardBrowserEnv?{write(e,t,r,n,o,i){const a=[e+"="+encodeURIComponent(t)];g.isNumber(r)&&a.push("expires="+new Date(r).toGMTString()),g.isString(n)&&a.push("path="+n),g.isString(o)&&a.push("domain="+o),i===!0&&a.push("secure"),document.cookie=a.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function cc(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}function lc(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}function go(e,t,r){let n=!cc(t);return e&&(n||r==!1)?lc(e,t):t}const ks=e=>e instanceof ke?{...e}:e;function St(e,t){t=t||{};const r={};function n(p,l,m,v){return g.isPlainObject(p)&&g.isPlainObject(l)?g.merge.call({caseless:v},p,l):g.isPlainObject(l)?g.merge({},l):g.isArray(l)?l.slice():l}function o(p,l,m,v){if(g.isUndefined(l)){if(!g.isUndefined(p))return n(void 0,p,m,v)}else return n(p,l,m,v)}function i(p,l){if(!g.isUndefined(l))return n(void 0,l)}function a(p,l){if(g.isUndefined(l)){if(!g.isUndefined(p))return n(void 0,p)}else return n(void 0,l)}function c(p,l,m){if(m in t)return n(p,l);if(m in e)return n(void 0,p)}const u={url:i,method:i,data:i,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:c,headers:(p,l,m)=>o(ks(p),ks(l),m,!0)};return g.forEach(Object.keys({...e,...t}),function(l){const m=u[l]||o,v=m(e[l],t[l],l);g.isUndefined(v)&&m!==c||(r[l]=v)}),r}const yo=e=>{const t=St({},e);let{data:r,withXSRFToken:n,xsrfHeaderName:o,xsrfCookieName:i,headers:a,auth:c}=t;if(t.headers=a=ke.from(a),t.url=uo(go(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),c&&a.set("Authorization","Basic "+btoa((c.username||"")+":"+(c.password?unescape(encodeURIComponent(c.password)):""))),g.isFormData(r)){if(Ce.hasStandardBrowserEnv||Ce.hasStandardBrowserWebWorkerEnv)a.setContentType(void 0);else if(g.isFunction(r.getHeaders)){const u=r.getHeaders(),p=["content-type","content-length"];Object.entries(u).forEach(([l,m])=>{p.includes(l.toLowerCase())&&a.set(l,m)})}}if(Ce.hasStandardBrowserEnv&&(n&&g.isFunction(n)&&(n=n(t)),n||n!==!1&&ic(t.url))){const u=o&&i&&ac.read(i);u&&a.set(o,u)}return t},uc=typeof XMLHttpRequest<"u",dc=uc&&function(e){return new Promise(function(r,n){const o=yo(e);let i=o.data;const a=ke.from(o.headers).normalize();let{responseType:c,onUploadProgress:u,onDownloadProgress:p}=o,l,m,v,S,y;function x(){S&&S(),y&&y(),o.cancelToken&&o.cancelToken.unsubscribe(l),o.signal&&o.signal.removeEventListener("abort",l)}let b=new XMLHttpRequest;b.open(o.method.toUpperCase(),o.url,!0),b.timeout=o.timeout;function N(){if(!b)return;const O=ke.from("getAllResponseHeaders"in b&&b.getAllResponseHeaders()),se={data:!c||c==="text"||c==="json"?b.responseText:b.response,status:b.status,statusText:b.statusText,headers:O,config:e,request:b};ho(function(z){r(z),x()},function(z){n(z),x()},se),b=null}"onloadend"in b?b.onloadend=N:b.onreadystatechange=function(){!b||b.readyState!==4||b.status===0&&!(b.responseURL&&b.responseURL.indexOf("file:")===0)||setTimeout(N)},b.onabort=function(){b&&(n(new J("Request aborted",J.ECONNABORTED,e,b)),b=null)},b.onerror=function(V){const se=V&&V.message?V.message:"Network Error",$=new J(se,J.ERR_NETWORK,e,b);$.event=V||null,n($),b=null},b.ontimeout=function(){let V=o.timeout?"timeout of "+o.timeout+"ms exceeded":"timeout exceeded";const se=o.transitional||fo;o.timeoutErrorMessage&&(V=o.timeoutErrorMessage),n(new J(V,se.clarifyTimeoutError?J.ETIMEDOUT:J.ECONNABORTED,e,b)),b=null},i===void 0&&a.setContentType(null),"setRequestHeader"in b&&g.forEach(a.toJSON(),function(V,se){b.setRequestHeader(se,V)}),g.isUndefined(o.withCredentials)||(b.withCredentials=!!o.withCredentials),c&&c!=="json"&&(b.responseType=o.responseType),p&&([v,y]=Ur(p,!0),b.addEventListener("progress",v)),u&&b.upload&&([m,S]=Ur(u),b.upload.addEventListener("progress",m),b.upload.addEventListener("loadend",S)),(o.cancelToken||o.signal)&&(l=O=>{b&&(n(!O||O.type?new Ut(null,e,b):O),b.abort(),b=null)},o.cancelToken&&o.cancelToken.subscribe(l),o.signal&&(o.signal.aborted?l():o.signal.addEventListener("abort",l)));const E=nc(o.url);if(E&&Ce.protocols.indexOf(E)===-1){n(new J("Unsupported protocol "+E+":",J.ERR_BAD_REQUEST,e));return}b.send(i||null)})},fc=(e,t)=>{const{length:r}=e=e?e.filter(Boolean):[];if(t||r){let n=new AbortController,o;const i=function(p){if(!o){o=!0,c();const l=p instanceof Error?p:this.reason;n.abort(l instanceof J?l:new Ut(l instanceof Error?l.message:l))}};let a=t&&setTimeout(()=>{a=null,i(new J(`timeout ${t} of ms exceeded`,J.ETIMEDOUT))},t);const c=()=>{e&&(a&&clearTimeout(a),a=null,e.forEach(p=>{p.unsubscribe?p.unsubscribe(i):p.removeEventListener("abort",i)}),e=null)};e.forEach(p=>p.addEventListener("abort",i));const{signal:u}=n;return u.unsubscribe=()=>g.asap(c),u}},pc=function*(e,t){let r=e.byteLength;if(r<t){yield e;return}let n=0,o;for(;n<r;)o=n+t,yield e.slice(n,o),n=o},mc=async function*(e,t){for await(const r of hc(e))yield*pc(r,t)},hc=async function*(e){if(e[Symbol.asyncIterator]){yield*e;return}const t=e.getReader();try{for(;;){const{done:r,value:n}=await t.read();if(r)break;yield n}}finally{await t.cancel()}},Ps=(e,t,r,n)=>{const o=mc(e,t);let i=0,a,c=u=>{a||(a=!0,n&&n(u))};return new ReadableStream({async pull(u){try{const{done:p,value:l}=await o.next();if(p){c(),u.close();return}let m=l.byteLength;if(r){let v=i+=m;r(v)}u.enqueue(new Uint8Array(l))}catch(p){throw c(p),p}},cancel(u){return c(u),o.return()}},{highWaterMark:2})},zs=64*1024,{isFunction:Ir}=g,gc=(({Request:e,Response:t})=>({Request:e,Response:t}))(g.global),{ReadableStream:Is,TextEncoder:Os}=g.global,Fs=(e,...t)=>{try{return!!e(...t)}catch{return!1}},yc=e=>{e=g.merge.call({skipUndefined:!0},gc,e);const{fetch:t,Request:r,Response:n}=e,o=t?Ir(t):typeof fetch=="function",i=Ir(r),a=Ir(n);if(!o)return!1;const c=o&&Ir(Is),u=o&&(typeof Os=="function"?(y=>x=>y.encode(x))(new Os):async y=>new Uint8Array(await new r(y).arrayBuffer())),p=i&&c&&Fs(()=>{let y=!1;const x=new r(Ce.origin,{body:new Is,method:"POST",get duplex(){return y=!0,"half"}}).headers.has("Content-Type");return y&&!x}),l=a&&c&&Fs(()=>g.isReadableStream(new n("").body)),m={stream:l&&(y=>y.body)};o&&["text","arrayBuffer","blob","formData","stream"].forEach(y=>{!m[y]&&(m[y]=(x,b)=>{let N=x&&x[y];if(N)return N.call(x);throw new J(`Response type '${y}' is not supported`,J.ERR_NOT_SUPPORT,b)})});const v=async y=>{if(y==null)return 0;if(g.isBlob(y))return y.size;if(g.isSpecCompliantForm(y))return(await new r(Ce.origin,{method:"POST",body:y}).arrayBuffer()).byteLength;if(g.isArrayBufferView(y)||g.isArrayBuffer(y))return y.byteLength;if(g.isURLSearchParams(y)&&(y=y+""),g.isString(y))return(await u(y)).byteLength},S=async(y,x)=>{const b=g.toFiniteNumber(y.getContentLength());return b??v(x)};return async y=>{let{url:x,method:b,data:N,signal:E,cancelToken:O,timeout:V,onDownloadProgress:se,onUploadProgress:$,responseType:z,headers:F,withCredentials:q="same-origin",fetchOptions:C}=yo(y),D=t||fetch;z=z?(z+"").toLowerCase():"text";let H=fc([E,O&&O.toAbortSignal()],V),K=null;const me=H&&H.unsubscribe&&(()=>{H.unsubscribe()});let Ee;try{if($&&p&&b!=="get"&&b!=="head"&&(Ee=await S(F,N))!==0){let R=new r(x,{method:"POST",body:N,duplex:"half"}),P;if(g.isFormData(N)&&(P=R.headers.get("content-type"))&&F.setContentType(P),R.body){const[A,ce]=_s(Ee,Ur(As($)));N=Ps(R.body,zs,A,ce)}}g.isString(q)||(q=q?"include":"omit");const be=i&&"credentials"in r.prototype,at={...C,signal:H,method:b.toUpperCase(),headers:F.normalize().toJSON(),body:N,duplex:"half",credentials:be?q:void 0};K=i&&new r(x,at);let ve=await(i?D(K,C):D(x,at));const Nt=l&&(z==="stream"||z==="response");if(l&&(se||Nt&&me)){const R={};["status","statusText","headers"].forEach(ge=>{R[ge]=ve[ge]});const P=g.toFiniteNumber(ve.headers.get("content-length")),[A,ce]=se&&_s(P,Ur(As(se),!0))||[];ve=new n(Ps(ve.body,zs,A,()=>{ce&&ce(),me&&me()}),R)}z=z||"text";let Ve=await m[g.findKey(m,z)||"text"](ve,y);return!Nt&&me&&me(),await new Promise((R,P)=>{ho(R,P,{data:Ve,headers:ke.from(ve.headers),status:ve.status,statusText:ve.statusText,config:y,request:K})})}catch(be){throw me&&me(),be&&be.name==="TypeError"&&/Load failed|fetch/i.test(be.message)?Object.assign(new J("Network Error",J.ERR_NETWORK,y,K),{cause:be.cause||be}):J.from(be,be&&be.code,y,K)}}},xc=new Map,xo=e=>{let t=e?e.env:{};const{fetch:r,Request:n,Response:o}=t,i=[n,o,r];let a=i.length,c=a,u,p,l=xc;for(;c--;)u=i[c],p=l.get(u),p===void 0&&l.set(u,p=c?new Map:yc(t)),l=p;return p};xo();const kn={http:Oa,xhr:dc,fetch:{get:xo}};g.forEach(kn,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});const Ls=e=>`- ${e}`,bc=e=>g.isFunction(e)||e===null||e===!1,bo={getAdapter:(e,t)=>{e=g.isArray(e)?e:[e];const{length:r}=e;let n,o;const i={};for(let a=0;a<r;a++){n=e[a];let c;if(o=n,!bc(n)&&(o=kn[(c=String(n)).toLowerCase()],o===void 0))throw new J(`Unknown adapter '${c}'`);if(o&&(g.isFunction(o)||(o=o.get(t))))break;i[c||"#"+a]=o}if(!o){const a=Object.entries(i).map(([u,p])=>`adapter ${u} `+(p===!1?"is not supported by the environment":"is not available in the build"));let c=r?a.length>1?`since :
`+a.map(Ls).join(`
`):" "+Ls(a[0]):"as no adapter specified";throw new J("There is no suitable adapter to dispatch the request "+c,"ERR_NOT_SUPPORT")}return o},adapters:kn};function Sn(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Ut(null,e)}function $s(e){return Sn(e),e.headers=ke.from(e.headers),e.data=vn.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),bo.getAdapter(e.adapter||dr.adapter,e)(e).then(function(n){return Sn(e),n.data=vn.call(e,e.transformResponse,n),n.headers=ke.from(n.headers),n},function(n){return mo(n)||(Sn(e),n&&n.response&&(n.response.data=vn.call(e,e.transformResponse,n.response),n.response.headers=ke.from(n.response.headers))),Promise.reject(n)})}const wo="1.12.2",Jr={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{Jr[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}});const Ms={};Jr.transitional=function(t,r,n){function o(i,a){return"[Axios v"+wo+"] Transitional option '"+i+"'"+a+(n?". "+n:"")}return(i,a,c)=>{if(t===!1)throw new J(o(a," has been removed"+(r?" in "+r:"")),J.ERR_DEPRECATED);return r&&!Ms[a]&&(Ms[a]=!0,console.warn(o(a," has been deprecated since v"+r+" and will be removed in the near future"))),t?t(i,a,c):!0}};Jr.spelling=function(t){return(r,n)=>(console.warn(`${n} is likely a misspelling of ${t}`),!0)};function wc(e,t,r){if(typeof e!="object")throw new J("options must be an object",J.ERR_BAD_OPTION_VALUE);const n=Object.keys(e);let o=n.length;for(;o-- >0;){const i=n[o],a=t[i];if(a){const c=e[i],u=c===void 0||a(c,i,e);if(u!==!0)throw new J("option "+i+" must be "+u,J.ERR_BAD_OPTION_VALUE);continue}if(r!==!0)throw new J("Unknown option "+i,J.ERR_BAD_OPTION)}}const Mr={assertOptions:wc,validators:Jr},Ze=Mr.validators;let vt=class{constructor(t){this.defaults=t||{},this.interceptors={request:new Ts,response:new Ts}}async request(t,r){try{return await this._request(t,r)}catch(n){if(n instanceof Error){let o={};Error.captureStackTrace?Error.captureStackTrace(o):o=new Error;const i=o.stack?o.stack.replace(/^.+\n/,""):"";try{n.stack?i&&!String(n.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+i):n.stack=i}catch{}}throw n}}_request(t,r){typeof t=="string"?(r=r||{},r.url=t):r=t||{},r=St(this.defaults,r);const{transitional:n,paramsSerializer:o,headers:i}=r;n!==void 0&&Mr.assertOptions(n,{silentJSONParsing:Ze.transitional(Ze.boolean),forcedJSONParsing:Ze.transitional(Ze.boolean),clarifyTimeoutError:Ze.transitional(Ze.boolean)},!1),o!=null&&(g.isFunction(o)?r.paramsSerializer={serialize:o}:Mr.assertOptions(o,{encode:Ze.function,serialize:Ze.function},!0)),r.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?r.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:r.allowAbsoluteUrls=!0),Mr.assertOptions(r,{baseUrl:Ze.spelling("baseURL"),withXsrfToken:Ze.spelling("withXSRFToken")},!0),r.method=(r.method||this.defaults.method||"get").toLowerCase();let a=i&&g.merge(i.common,i[r.method]);i&&g.forEach(["delete","get","head","post","put","patch","common"],y=>{delete i[y]}),r.headers=ke.concat(a,i);const c=[];let u=!0;this.interceptors.request.forEach(function(x){typeof x.runWhen=="function"&&x.runWhen(r)===!1||(u=u&&x.synchronous,c.unshift(x.fulfilled,x.rejected))});const p=[];this.interceptors.response.forEach(function(x){p.push(x.fulfilled,x.rejected)});let l,m=0,v;if(!u){const y=[$s.bind(this),void 0];for(y.unshift(...c),y.push(...p),v=y.length,l=Promise.resolve(r);m<v;)l=l.then(y[m++],y[m++]);return l}v=c.length;let S=r;for(;m<v;){const y=c[m++],x=c[m++];try{S=y(S)}catch(b){x.call(this,b);break}}try{l=$s.call(this,S)}catch(y){return Promise.reject(y)}for(m=0,v=p.length;m<v;)l=l.then(p[m++],p[m++]);return l}getUri(t){t=St(this.defaults,t);const r=go(t.baseURL,t.url,t.allowAbsoluteUrls);return uo(r,t.params,t.paramsSerializer)}};g.forEach(["delete","get","head","options"],function(t){vt.prototype[t]=function(r,n){return this.request(St(n||{},{method:t,url:r,data:(n||{}).data}))}});g.forEach(["post","put","patch"],function(t){function r(n){return function(i,a,c){return this.request(St(c||{},{method:t,headers:n?{"Content-Type":"multipart/form-data"}:{},url:i,data:a}))}}vt.prototype[t]=r(),vt.prototype[t+"Form"]=r(!0)});let vc=class vo{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let r;this.promise=new Promise(function(i){r=i});const n=this;this.promise.then(o=>{if(!n._listeners)return;let i=n._listeners.length;for(;i-- >0;)n._listeners[i](o);n._listeners=null}),this.promise.then=o=>{let i;const a=new Promise(c=>{n.subscribe(c),i=c}).then(o);return a.cancel=function(){n.unsubscribe(i)},a},t(function(i,a,c){n.reason||(n.reason=new Ut(i,a,c),r(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const r=this._listeners.indexOf(t);r!==-1&&this._listeners.splice(r,1)}toAbortSignal(){const t=new AbortController,r=n=>{t.abort(n)};return this.subscribe(r),t.signal.unsubscribe=()=>this.unsubscribe(r),t.signal}static source(){let t;return{token:new vo(function(o){t=o}),cancel:t}}};function Sc(e){return function(r){return e.apply(null,r)}}function jc(e){return g.isObject(e)&&e.isAxiosError===!0}const Pn={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Pn).forEach(([e,t])=>{Pn[t]=e});function So(e){const t=new vt(e),r=Ys(vt.prototype.request,t);return g.extend(r,vt.prototype,t,{allOwnKeys:!0}),g.extend(r,t,null,{allOwnKeys:!0}),r.create=function(o){return So(St(e,o))},r}const ie=So(dr);ie.Axios=vt;ie.CanceledError=Ut;ie.CancelToken=vc;ie.isCancel=mo;ie.VERSION=wo;ie.toFormData=Qr;ie.AxiosError=J;ie.Cancel=ie.CanceledError;ie.all=function(t){return Promise.all(t)};ie.spread=Sc;ie.isAxiosError=jc;ie.mergeConfig=St;ie.AxiosHeaders=ke;ie.formToJSON=e=>po(g.isHTMLForm(e)?new FormData(e):e);ie.getAdapter=bo.getAdapter;ie.HttpStatusCode=Pn;ie.default=ie;const{Axios:nl,AxiosError:sl,CanceledError:ol,isCancel:il,CancelToken:al,VERSION:cl,all:ll,Cancel:ul,isAxiosError:dl,spread:fl,toFormData:pl,AxiosHeaders:ml,HttpStatusCode:hl,formToJSON:gl,getAdapter:yl,mergeConfig:xl}=ie,Nc=()=>"http://localhost:8000".replace(/\/+$/,""),pt=Nc(),Ot=()=>{const e=Lt();return e?{[Cn]:e}:{}};function Cc(e){return(e||"").toString().normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").toLowerCase().replace(/[^a-z0-9]+/g," ").trim()}async function Or(){try{const e=await ie.get(`${pt}/api/cart`,{headers:Ot()}),t=Le.getState().setCartFromServer;typeof t=="function"&&t(e.data)}catch(e){console.warn("Cart sync from server failed:",(e==null?void 0:e.message)||e)}}function bt(e){try{const t=(e||[]).map(n=>{var o,i,a;return{item_id:n.id,product_id:(o=n.product)==null?void 0:o.id,name:(i=n.product)==null?void 0:i.name,size:n.size,color:n.color,quantity:n.quantity,price:(a=n.product)==null?void 0:a.price}}),r={};for(const n of t){const o=Cc(`${n.name} ${n.size||""} ${n.color||""}`);o&&(r[o]=n.item_id)}window.cartSnapshot=t,window.cartItemsMap=r,window.dispatchEvent(new CustomEvent("aiva-cart-changed",{detail:t}))}catch{}}function qs(e=5){var t;try{const r=Le.getState(),n=Array.isArray(r.cart)?r.cart:[];if(n.length===0)return"Il carrello è vuoto.";const o=[];for(let c=0;c<Math.min(n.length,e);c++){const u=n[c],p=((t=u==null?void 0:u.product)==null?void 0:t.name)||"prodotto",l=(u==null?void 0:u.quantity)||1,m=u!=null&&u.size?`, taglia ${u.size}`:"",v=u!=null&&u.color?`, ${u.color}`:"",S=l===1?"pezzo":"pezzi";o.push(`${l} ${S} di ${p}${m}${v}`)}const i=n.length-Math.min(n.length,e),a=i>0?`, e altri ${i} articoli.`:".";return`Nel carrello ci sono: ${o.join(". ")}${a}`}catch{return"Il carrello è vuoto."}}const Bt=()=>{const{cart:e,cartTotal:t,cartCount:r,addToCart:n,removeFromCart:o,clearCart:i,updateQuantity:a}=Le(),[c,u]=d.useState(!1),[p,l]=d.useState(null),[m,v]=d.useState(0);d.useEffect(()=>{t>=100?v(0):r>0?v(9.9):v(0)},[t,r]),d.useEffect(()=>{bt(e)},[e]);const S=d.useCallback(async(F,q,C,D=1)=>{try{if(u(!0),l(null),!(await ie.get(`${pt}/api/products/${F.id}/availability`,{params:{size:q,color:C},headers:Ot()})).data.available)throw new Error("Variante non disponibile");return n(F,q,C,D),bt(Le.getState().cart),await ie.post(`${pt}/api/cart/items`,{product_id:F.id,size:q,color:C,quantity:D},{headers:{...Ot(),"Content-Type":"application/json"}}),await Or(),!0}catch(H){return l(H.message||"Errore aggiunta al carrello"),console.error("Add to cart error:",H),!1}finally{u(!1)}},[n]),y=d.useCallback(async F=>{try{return u(!0),l(null),o(F),bt(Le.getState().cart),await ie.delete(`${pt}/api/cart/items/${F}`,{headers:Ot()}),await Or(),!0}catch(q){return l(q.message||"Errore rimozione dal carrello"),console.error("Remove from cart error:",q),!1}finally{u(!1)}},[o]),x=d.useCallback(async()=>{if(e.length===0)return l("Il carrello è vuoto"),!1;const F=e[e.length-1];return y(F.id)},[e,y]),b=d.useCallback(async F=>{try{u(!0),l(null);const q=e.filter(C=>C.product.category.toLowerCase()===F.toLowerCase());if(q.length===0)return l(`Nessun prodotto della categoria ${F} nel carrello`),!1;for(const C of q)o(C.id);return bt(Le.getState().cart),await ie.post(`${pt}/api/cart/remove-category`,{category:F}),!0}catch(q){return l(q.message||"Errore rimozione categoria"),!1}finally{u(!1)}},[e,o]),N=d.useCallback(async(F,q)=>{if(q<1||q>10)return l("Quantità deve essere tra 1 e 10"),!1;try{return u(!0),l(null),a(F,q),bt(Le.getState().cart),await ie.put(`${pt}/api/cart/items/${F}`,{quantity:q},{headers:Ot()}),await Or(),!0}catch(C){return l(C.message||"Errore aggiornamento quantità"),!1}finally{u(!1)}},[a]),E=d.useCallback(async(F,q=1)=>{const C=e.find(H=>H.id===F);if(!C)return l("Prodotto non trovato nel carrello"),!1;const D=C.quantity+q;return N(F,D)},[e,N]),O=d.useCallback(async(F,q=1)=>{const C=e.find(H=>H.id===F);if(!C)return l("Prodotto non trovato nel carrello"),!1;const D=C.quantity-q;return D<=0?y(F):N(F,D)},[e,N,y]),V=d.useCallback(async()=>{try{return u(!0),l(null),i(),bt(Le.getState().cart),await ie.post(`${pt}/api/cart/clear`,{},{headers:Ot()}),await Or(),!0}catch(F){return l(F.message||"Errore svuotamento carrello"),!1}finally{u(!1)}},[i]),se=d.useCallback(()=>{const F=t,q=m,C=F+q;return{items:e,itemCount:r,subtotal:F,shipping:q,total:C}},[e,r,t,m]),$=d.useCallback((F,q=null,C=null)=>e.some(D=>{const H=D.product.id===F,K=!q||D.size===q,me=!C||D.color===C;return H&&K&&me}),[e]),z=d.useCallback((F,q=null,C=null)=>{const D=e.find(H=>{const K=H.product.id===F,me=!q||H.size===q,Ee=!C||H.color===C;return K&&me&&Ee});return D?D.quantity:0},[e]);return d.useEffect(()=>{(async()=>{try{const q=await ie.get(`${pt}/api/cart`),C=Le.getState().setCartFromServer;typeof C=="function"&&C(q.data)}catch(q){console.error("Failed to sync cart:",q)}})()},[]),{cart:e,cartCount:r,cartTotal:t,shipping:m,grandTotal:t+m,loading:c,error:p,addToCart:S,removeFromCart:y,removeLastItem:x,removeByCategory:b,updateQuantity:N,increaseQuantity:E,decreaseQuantity:O,clearCart:V,getCartSummary:se,isInCart:$,getItemQuantity:z}},jo=()=>{const[e,t]=d.useState([]),[r,n]=d.useState(!1);d.useEffect(()=>{const l=localStorage.getItem("aiva-favorites");if(l)try{t(JSON.parse(l))}catch(m){console.error("Error loading favorites:",m),t([])}},[]),d.useEffect(()=>{localStorage.setItem("aiva-favorites",JSON.stringify(e))},[e]);const o=d.useCallback(l=>{t(m=>m.some(S=>S.id===l.id)?m:[...m,l])},[]),i=d.useCallback(l=>{t(m=>m.filter(v=>v.id!==l))},[]),a=d.useCallback(l=>{e.some(v=>v.id===l.id)?i(l.id):o(l)},[e,o,i]),c=d.useCallback(l=>e.some(m=>m.id===l),[e]),u=d.useCallback(()=>{t([])},[]),p=e.length;return{favorites:e,favoritesCount:p,addToFavorites:o,removeFromFavorites:i,toggleFavorite:a,isFavorite:c,clearFavorites:u,loading:r}},Ec=({product:e,onAddToCart:t,onToggleFavorite:r,isFavorite:n})=>{var u;const[o,i]=d.useState(!1),a=ir(),c=()=>{a(`/products/${e.id}`)};return s.jsxs(_.div,{className:"bg-white rounded-xl shadow-sm overflow-hidden cursor-pointer",whileHover:{y:-8,shadow:"xl"},transition:{type:"spring",stiffness:300},onHoverStart:()=>i(!0),onHoverEnd:()=>i(!1),onClick:c,children:[s.jsxs("div",{className:"relative overflow-hidden h-72 bg-gray-100",children:[s.jsx(_.img,{src:En(((u=e.images)==null?void 0:u[0])||e.image||"/static/images/placeholder.jpg"),alt:e.name,className:"w-full h-full object-cover",animate:{scale:o?1.1:1},transition:{duration:.3}}),(()=>{const p=Number(e.discount_percentage??e.discount??0),l=Number(e.original_price??e.originalPrice??0),m=Number(e.price??0);return p>0&&l>m})()&&s.jsxs(_.div,{className:"absolute top-4 left-4 bg-red-500 text-white px-3 py-1 rounded-full text-sm font-bold",initial:{rotate:-15},animate:{rotate:o?0:-15},children:["-",Number(e.discount_percentage??e.discount??0),"%"]}),s.jsx(_.div,{className:"absolute top-4 right-4",whileHover:{scale:1.2},whileTap:{scale:.9},onClick:p=>{p.stopPropagation(),r(e)},children:s.jsx("button",{className:`p-2 rounded-full shadow-md transition-colors ${n?"bg-red-500 text-white hover:bg-red-600":"bg-white text-gray-600 hover:bg-gray-100"}`,children:s.jsx(Br,{size:20,fill:n?"currentColor":"none"})})})]}),s.jsxs("div",{className:"p-4",children:[s.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wider mb-1",children:e.brand}),s.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:e.name}),s.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[s.jsx("div",{className:"flex items-center",children:[...Array(5)].map((p,l)=>s.jsx(Vr,{size:14,className:l<Math.floor(e.rating)?"text-yellow-400 fill-current":"text-gray-300"},l))}),s.jsxs("span",{className:"text-xs text-gray-500",children:["(",e.reviews,")"]})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[(()=>{const p=Number(e.discount_percentage??e.discount??0),l=Number(e.original_price??e.originalPrice??0),m=Number(e.price??0);return p>0&&l>m?s.jsxs("span",{className:"text-sm text-gray-400 line-through mr-2",children:["€",l.toFixed(2)]}):null})(),s.jsxs("span",{className:"text-xl font-bold text-gray-900",children:["€",Number(e.price??0).toFixed(2)]})]}),s.jsx(_.button,{onClick:p=>{p.stopPropagation(),t(e)},className:"p-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",whileHover:{scale:1.05},whileTap:{scale:.95},children:s.jsx(jt,{size:20})})]})]})]})},Tc=()=>{var Ve;const[e,t]=d.useState([]),[r,n]=d.useState([]),[o,i]=d.useState(!0),[a,c]=d.useState(null),[u,p]=d.useState(""),[l,m]=d.useState(""),[v,S]=d.useState("name"),[y,x]=d.useState("grid"),[b,N]=d.useState(!1),[E,O]=d.useState(null),[V,se]=d.useState(""),[$,z]=d.useState(""),[F,q]=d.useState(!1),{toggleFavorite:C,isFavorite:D}=jo(),{addToCart:H}=Bt(),K=[{id:"",name:"Tutte le categorie"},{id:"t-shirt",name:"T-Shirt"},{id:"camicia",name:"Camicie"},{id:"maglione",name:"Maglioni"},{id:"felpa",name:"Felpe"},{id:"giacca",name:"Giacche"},{id:"pantaloni",name:"Pantaloni"},{id:"shorts",name:"Shorts"},{id:"gonna",name:"Gonne"},{id:"vestito",name:"Vestiti"},{id:"scarpe",name:"Scarpe"},{id:"accessori",name:"Accessori"}];d.useEffect(()=>{(async()=>{try{i(!0),c(null);const P={};l&&(P.category=l),u&&(P.q=u);const A=await $t.getProducts(P);t(A),n(A)}catch(P){console.error("Error loading products:",P),c("Errore nel caricamento dei prodotti. Riprova più tardi.")}finally{i(!1)}})()},[l,u]),d.useEffect(()=>{let R=[...e];R.sort((P,A)=>{switch(v){case"price-low":return P.price-A.price;case"price-high":return A.price-P.price;case"rating":return A.rating-P.rating;case"name":default:return P.name.localeCompare(A.name)}}),n(R)},[e,v]),d.useEffect(()=>{const R=ce=>(ce||"").toLowerCase().normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").replace(/[^a-z0-9\s]/g,"").trim(),P=(r||[]).map(ce=>ce.id),A=Object.fromEntries((r||[]).map(ce=>[R(ce.name),ce.id]));return window.visibleProductIds=P,window.visibleProductsMap=A,window.productsSearchQuery=u||"",window.productsSelectedCategory=l||"",window.applyProductFilters=({query:ce,q:ge,category:Q,sort:$e,price_range:Me}={})=>{const Pe=ce??ge;typeof Pe=="string"&&p(Pe),typeof Q=="string"&&m(Q),typeof $e=="string"&&S($e),Me==="low-to-high"&&S("price-low"),Me==="high-to-low"&&S("price-high"),window.scrollTo({top:0,behavior:"smooth"})},()=>{delete window.visibleProductIds,delete window.visibleProductsMap,delete window.applyProductFilters,delete window.productsSearchQuery,delete window.productsSelectedCategory}},[r,u,l,p,m,S]);const me=R=>{const P=new Set;return((R==null?void 0:R.variants)||[]).forEach(A=>{A.available&&P.add(A.size)}),Array.from(P)},Ee=R=>{const P=new Set;return((R==null?void 0:R.variants)||[]).forEach(A=>{A.available&&P.add(A.color)}),Array.from(P)},be=(R,P,A)=>((R==null?void 0:R.variants)||[]).some(ge=>ge.size===P&&ge.color===A&&ge.available),at=R=>{O(R);const P=me(R),A=Ee(R),ce=P[0]||"",ge=A[0]||"";se(ce),z(ge),N(!0)},ve=R=>{at(R)},Nt=async()=>{if(E&&!(!V||!$)&&be(E,V,$))try{q(!0),await H(E,V,$,1),N(!1),O(null),console.log("Product added to cart:",E==null?void 0:E.name)}catch(R){console.error("Error adding to cart:",R)}finally{q(!1)}};return o?s.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600 mx-auto mb-4"}),s.jsx("p",{className:"text-gray-600",children:"Caricamento prodotti..."})]})}):s.jsxs("div",{className:"min-h-screen bg-gray-50",children:[s.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[s.jsxs(_.div,{className:"mb-8",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[s.jsx("h1",{className:"text-4xl font-bold text-gray-900 mb-4",children:"Prodotti"}),s.jsx("p",{className:"text-gray-600",children:"Scopri la nostra collezione di moda italiana"})]}),s.jsx(_.div,{className:"bg-white rounded-lg shadow-sm p-6 mb-8",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:s.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 items-center justify-between",children:[s.jsx("div",{className:"flex-1 max-w-md",children:s.jsx("input",{type:"text",placeholder:"Cerca prodotti...",value:u,onChange:R=>p(R.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(fs,{size:20,className:"text-gray-500"}),s.jsx("select",{value:l,onChange:R=>m(R.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:K.map(R=>s.jsx("option",{value:R.id,children:R.name},R.id))})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-gray-500",children:"Ordina per:"}),s.jsxs("select",{value:v,onChange:R=>S(R.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[s.jsx("option",{value:"name",children:"Nome"}),s.jsx("option",{value:"price-low",children:"Prezzo: Basso-Alto"}),s.jsx("option",{value:"price-high",children:"Prezzo: Alto-Basso"}),s.jsx("option",{value:"rating",children:"Valutazione"})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:()=>x("grid"),className:`p-2 rounded ${y==="grid"?"bg-blue-100 text-blue-600":"text-gray-500"}`,children:s.jsx(ei,{size:20})}),s.jsx("button",{onClick:()=>x("list"),className:`p-2 rounded ${y==="list"?"bg-blue-100 text-blue-600":"text-gray-500"}`,children:s.jsx(ti,{size:20})})]})]})}),s.jsx("div",{className:"mb-6",children:s.jsxs("p",{className:"text-gray-600",children:[r.length," prodotti trovati",u&&` per "${u}"`,l&&` in ${(Ve=K.find(R=>R.id===l))==null?void 0:Ve.name}`]})}),s.jsx(_.div,{className:`grid gap-6 ${y==="grid"?"grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4":"grid-cols-1"}`,initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},children:r.map((R,P)=>s.jsx(_.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:P*.1},children:s.jsx(Ec,{product:R,onAddToCart:ve,onToggleFavorite:C,isFavorite:D(R.id)})},R.id))}),r.length===0&&s.jsxs(_.div,{className:"text-center py-12",initial:{opacity:0},animate:{opacity:1},children:[s.jsx("div",{className:"text-gray-400 mb-4",children:s.jsx(fs,{size:64,className:"mx-auto"})}),s.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Nessun prodotto trovato"}),s.jsx("p",{className:"text-gray-600 mb-4",children:"Prova a modificare i filtri o la ricerca"}),s.jsx("button",{onClick:()=>{p(""),m("")},className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Rimuovi filtri"})]})]}),b&&E&&s.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[s.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>N(!1)}),s.jsxs(_.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"relative bg-white rounded-2xl shadow-xl w-full max-w-md p-6 z-10",onClick:R=>R.stopPropagation(),children:[s.jsxs("div",{className:"flex items-start justify-between mb-4",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:E.name}),s.jsx("p",{className:"text-sm text-gray-500",children:E.brand})]}),s.jsx("button",{onClick:()=>N(!1),className:"p-2 rounded-full hover:bg-gray-100",children:s.jsx(Mt,{size:18})})]}),s.jsxs("div",{className:"space-y-5",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Seleziona taglia"}),s.jsx("div",{className:"flex flex-wrap gap-2",children:me(E).map(R=>s.jsx("button",{onClick:()=>se(R),className:`px-3 py-2 rounded-lg border text-sm font-medium ${V===R?"border-blue-600 text-blue-600 bg-blue-50":"border-gray-300 text-gray-700 hover:border-gray-400"}`,children:R},R))})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Seleziona colore"}),s.jsx("div",{className:"flex flex-wrap gap-2",children:Ee(E).map(R=>s.jsx("button",{onClick:()=>z(R),className:`px-3 py-2 rounded-lg border text-sm font-medium capitalize ${$===R?"border-blue-600 text-blue-600 bg-blue-50":"border-gray-300 text-gray-700 hover:border-gray-400"}`,children:R},R))})]}),s.jsxs("div",{className:"flex items-center gap-3 pt-2",children:[s.jsxs("button",{onClick:Nt,disabled:F||!V||!$||!be(E,V,$),className:"flex-1 inline-flex items-center justify-center gap-2 bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 disabled:opacity-60",children:[s.jsx(jt,{size:18}),F?"Aggiungo...":"Aggiungi al carrello"]}),s.jsx("button",{onClick:()=>N(!1),className:"px-4 py-3 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-50",children:"Annulla"})]})]})]})]})]})},Rc=({offer:e,onAddToCart:t})=>{const[r,n]=d.useState(!1);return s.jsxs(_.div,{className:"bg-white rounded-xl shadow-sm overflow-hidden cursor-pointer relative",whileHover:{y:-8,shadow:"xl"},transition:{type:"spring",stiffness:300},onHoverStart:()=>n(!0),onHoverEnd:()=>n(!1),children:[s.jsx("div",{className:"absolute top-4 left-4 z-10",children:s.jsxs(_.div,{className:"bg-red-500 text-white px-3 py-1 rounded-full text-sm font-bold flex items-center gap-1",initial:{rotate:-15},animate:{rotate:r?0:-15},children:[s.jsx(Vs,{size:14}),"-",e.discount,"%"]})}),s.jsxs("div",{className:"relative overflow-hidden h-72 bg-gray-100",children:[s.jsx(_.img,{src:e.image,alt:e.name,className:"w-full h-full object-cover",animate:{scale:r?1.1:1},transition:{duration:.3}}),s.jsx(_.div,{className:"absolute top-4 right-16",whileHover:{scale:1.2},whileTap:{scale:.9},children:s.jsx("button",{className:"p-2 bg-white rounded-full shadow-md hover:bg-gray-100",children:s.jsx(Br,{size:20,className:"text-gray-600"})})})]}),s.jsxs("div",{className:"p-4",children:[s.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wider mb-1",children:e.brand}),s.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:e.name}),s.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[s.jsx("div",{className:"flex items-center",children:[...Array(5)].map((o,i)=>s.jsx(Vr,{size:14,className:i<Math.floor(e.rating)?"text-yellow-400 fill-current":"text-gray-300"},i))}),s.jsxs("span",{className:"text-xs text-gray-500",children:["(",e.reviews,")"]})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsxs("span",{className:"text-sm text-gray-400 line-through mr-2",children:["€",Number(e.originalPrice??0).toFixed(2)]}),s.jsxs("span",{className:"text-xl font-bold text-red-600",children:["€",Number(e.price??0).toFixed(2)]}),s.jsxs("div",{className:"text-xs text-green-600 font-semibold",children:["Risparmi €",(Number(e.originalPrice??0)-Number(e.price??0)).toFixed(2)]})]}),s.jsx(_.button,{onClick:()=>t(e),className:"p-2 bg-red-600 text-white rounded-lg hover:bg-red-700",whileHover:{scale:1.05},whileTap:{scale:.95},children:s.jsx(jt,{size:20})})]})]})]})},_c=()=>{const[e,t]=d.useState([]),[r,n]=d.useState(!0),[o,i]=d.useState(null),{addToCart:a}=Bt(),[c,u]=d.useState(!1),[p,l]=d.useState(null),[m,v]=d.useState(""),[S,y]=d.useState(""),[x,b]=d.useState(!1);d.useEffect(()=>{(async()=>{try{n(!0),i(null);const H=(await $t.getProducts({on_sale:!0})).map((K,me)=>{var Ee;return{id:K.id,name:K.name,brand:K.brand,price:K.price,originalPrice:K.original_price,discount:K.discount_percentage,image:((Ee=K.images)==null?void 0:Ee[0])||"https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?w=400",rating:K.rating,reviews:K.reviews,category:K.category,variants:K.variants}});t(H)}catch(D){console.error("Error loading offers:",D),i("Errore nel caricamento delle offerte. Riprova più tardi.")}finally{n(!1)}})()},[]),d.useEffect(()=>{try{const C={};(e||[]).forEach(D=>{const H=(D.name||"").toLowerCase().normalize("NFKD").replace(/[^\w\s]/g,"").trim();H&&(C[H]=D.id)}),window.visibleProductsMap=C,window.visibleProductIds=(e||[]).map(D=>D.id),window.currentPageContext="offers"}catch{}return()=>{if(window.currentPageContext==="offers")try{delete window.visibleProductsMap,delete window.visibleProductIds,delete window.currentPageContext}catch{}}},[e]),d.useEffect(()=>{const C=D=>{};return window.addEventListener("offers-apply-filters",C),()=>window.removeEventListener("offers-apply-filters",C)},[]);const N=C=>{const D=new Set;return((C==null?void 0:C.variants)||[]).forEach(H=>{H!=null&&H.available&&D.add(H.size)}),Array.from(D)},E=(C,D=null)=>{const H=new Set;return((C==null?void 0:C.variants)||[]).forEach(K=>{K!=null&&K.available&&(D&&K.size!==D||H.add(K.color))}),Array.from(H)},O=(C,D,H)=>!C||!D||!H?!1:(C.variants||[]).some(K=>(K==null?void 0:K.available)&&K.size===D&&K.color===H),V=()=>{u(!1),l(null),v(""),y(""),b(!1)},se=C=>{if(!C)return;l(C);const H=N(C)[0]||"",K=E(C,H),me=E(C),Ee=K[0]||me[0]||"";v(H),y(Ee),u(!0)},$=C=>{if(v(C),!p)return;const D=E(p,C);y(H=>D.includes(H)?H:D[0]||"")},z=C=>{y(C)},F=async()=>{if(!(!p||!m||!S)&&O(p,m,S))try{b(!0);const C=p==null?void 0:p.name;await a(p,m,S,1),V(),console.log("Offer added to cart:",C)}catch(C){console.error("Error adding offer to cart:",C)}finally{b(!1)}},q=C=>{se(C)};return r?s.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-red-600 mx-auto mb-4"}),s.jsx("p",{className:"text-gray-600",children:"Caricamento offerte..."})]})}):s.jsx("div",{className:"min-h-screen bg-gray-50",children:s.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[s.jsxs(_.div,{className:"mb-8",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[s.jsx("h1",{className:"text-4xl font-bold text-gray-900 mb-4",children:"Offerte Speciali"}),s.jsx("p",{className:"text-gray-600",children:"Scopri una selezione di prodotti in sconto"})]}),s.jsx("div",{className:"mb-6",children:s.jsxs("p",{className:"text-gray-600",children:[e.length," offerte disponibili"]})}),s.jsx(_.div,{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},children:e.map((C,D)=>s.jsx(_.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:D*.1},children:s.jsx(Rc,{offer:C,onAddToCart:q})},C.id))}),e.length===0&&s.jsxs(_.div,{className:"text-center py-12",initial:{opacity:0},animate:{opacity:1},children:[s.jsx("div",{className:"text-gray-400 mb-4",children:s.jsx(Vs,{size:64,className:"mx-auto"})}),s.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Nessuna offerta trovata"}),s.jsx("p",{className:"text-gray-600 mb-4",children:"Controlla di nuovo più tardi per nuove offerte"})]}),c&&p&&s.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[s.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:V}),s.jsxs(_.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"relative bg-white rounded-2xl shadow-xl w-full max-w-md p-6 z-10",onClick:C=>C.stopPropagation(),children:[s.jsxs("div",{className:"flex items-start justify-between mb-4",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:p.name}),s.jsx("p",{className:"text-sm text-gray-500",children:p.brand})]}),s.jsx("button",{onClick:V,className:"p-2 rounded-full hover:bg-gray-100",children:s.jsx(Mt,{size:18})})]}),s.jsxs("div",{className:"space-y-5",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Seleziona taglia"}),s.jsx("div",{className:"flex flex-wrap gap-2",children:N(p).map(C=>s.jsx("button",{onClick:()=>$(C),className:`px-3 py-2 rounded-lg border text-sm font-medium ${m===C?"border-red-600 text-red-600 bg-red-50":"border-gray-300 text-gray-700 hover:border-gray-400"}`,children:C},C))})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Seleziona colore"}),s.jsx("div",{className:"flex flex-wrap gap-2",children:E(p,m||void 0).map(C=>s.jsx("button",{onClick:()=>z(C),className:`px-3 py-2 rounded-lg border text-sm font-medium capitalize ${S===C?"border-red-600 text-red-600 bg-red-50":"border-gray-300 text-gray-700 hover:border-gray-400"}`,children:C},C))})]}),s.jsxs("div",{className:"flex items-center gap-3 pt-2",children:[s.jsxs("button",{onClick:F,disabled:x||!m||!S||!O(p,m,S),className:"flex-1 inline-flex items-center justify-center gap-2 bg-red-600 text-white py-3 rounded-lg hover:bg-red-700 disabled:opacity-60",children:[s.jsx(jt,{size:18}),x?"Aggiungo...":"Aggiungi al carrello"]}),s.jsx("button",{onClick:V,className:"px-4 py-3 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-50",children:"Annulla"})]})]})]})]}),s.jsxs(_.div,{className:"mt-16 bg-gradient-to-r from-red-500 to-orange-500 rounded-xl p-8 text-white text-center",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},children:[s.jsx("h2",{className:"text-3xl font-bold mb-4",children:"Non Perdere le Offerte!"}),s.jsx("p",{className:"text-xl mb-6 opacity-90",children:"Iscriviti alla newsletter per ricevere notifiche sulle offerte esclusive"}),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 max-w-md mx-auto",children:[s.jsx("input",{type:"email",placeholder:"La tua email",className:"flex-1 px-4 py-3 rounded-lg text-gray-900 placeholder-gray-500"}),s.jsx("button",{className:"px-6 py-3 bg-white text-red-600 font-semibold rounded-lg hover:bg-gray-100",children:"Iscriviti"})]})]})]})})},Ac=({item:e,onUpdateQuantity:t,onRemove:r})=>{var c,u,p,l,m,v,S;const n=ir(),[o,i]=d.useState(!1),a=()=>{i(!0),setTimeout(()=>{r(e.id)},300)};return s.jsx(_.div,{className:`bg-white rounded-lg shadow-sm p-4 border ${o?"opacity-50":""}`,initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.3},children:s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("div",{className:"w-20 h-20 bg-gray-100 rounded-lg overflow-hidden cursor-pointer",onClick:()=>{var y;(y=e==null?void 0:e.product)!=null&&y.id&&n(`/products/${e.product.id}`)},title:"Vai alla pagina prodotto",role:"button",children:s.jsx("img",{src:((u=(c=e.product)==null?void 0:c.images)==null?void 0:u[0])||((p=e.product)==null?void 0:p.image),alt:(l=e.product)==null?void 0:l.name,className:"w-full h-full object-cover"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"font-semibold text-gray-900 mb-1",children:(m=e.product)==null?void 0:m.name}),s.jsx("p",{className:"text-sm text-gray-500 mb-2",children:(v=e.product)==null?void 0:v.brand}),s.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[s.jsxs("span",{children:["Taglia: ",e.size]}),s.jsxs("span",{children:["Colore: ",e.color]})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:()=>t(e.id,e.quantity-1),disabled:e.quantity<=1,className:"p-1 rounded-full bg-gray-100 hover:bg-gray-200 disabled:opacity-50",children:s.jsx(Gs,{size:16})}),s.jsx("span",{className:"w-8 text-center font-semibold",children:e.quantity}),s.jsx("button",{onClick:()=>t(e.id,e.quantity+1),disabled:e.quantity>=10,className:"p-1 rounded-full bg-gray-100 hover:bg-gray-200 disabled:opacity-50",children:s.jsx(Ws,{size:16})})]}),s.jsx("div",{className:"text-right",children:s.jsxs("div",{className:"font-semibold text-gray-900",children:["€",((((S=e.product)==null?void 0:S.price)||0)*e.quantity).toFixed(2)]})}),s.jsx("button",{onClick:a,className:"p-2 text-red-500 hover:bg-red-50 rounded-lg",children:s.jsx(si,{size:18})})]})})},kc=()=>{const e=ir(),{cart:t,cartTotal:r,cartCount:n,shipping:o,updateQuantity:i,removeFromCart:a,clearCart:c}=Bt();d.useEffect(()=>{Array.isArray(t)&&bt(t)},[t]);const u=r,p=r+o;return t.length===0?s.jsx("div",{className:"min-h-screen bg-gray-50",children:s.jsx("div",{className:"max-w-4xl mx-auto px-4 py-8",children:s.jsxs(_.div,{className:"text-center py-16",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[s.jsx("div",{className:"text-gray-400 mb-6",children:s.jsx(jt,{size:80,className:"mx-auto"})}),s.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Il tuo carrello è vuoto"}),s.jsx("p",{className:"text-gray-600 mb-8",children:"Aggiungi alcuni prodotti per iniziare lo shopping"}),s.jsx(_.button,{className:"px-8 py-4 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700",onClick:()=>e("/products"),whileHover:{scale:1.05},whileTap:{scale:.95},children:"Inizia Shopping"})]})})}):s.jsx("div",{className:"min-h-screen bg-gray-50",children:s.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-8",children:[s.jsxs(_.div,{className:"mb-8",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[s.jsx("h1",{className:"text-4xl font-bold text-gray-900 mb-4",children:"Carrello"}),s.jsxs("p",{className:"text-gray-600",children:[n," ",n===1?"articolo":"articoli"," nel carrello"]})]}),s.jsxs("div",{className:"grid lg:grid-cols-3 gap-8",children:[s.jsxs("div",{className:"lg:col-span-2",children:[s.jsxs(_.div,{className:"bg-white rounded-lg shadow-sm p-6 mb-6",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"I tuoi articoli"}),s.jsx("button",{onClick:c,className:"text-red-500 hover:text-red-700 text-sm font-medium",children:"Svuota carrello"})]}),s.jsx(ar,{children:s.jsx("div",{className:"space-y-4",children:t.map(l=>s.jsx(Ac,{item:l,onUpdateQuantity:i,onRemove:a},l.id))})})]}),s.jsxs(_.div,{className:"bg-blue-50 rounded-lg p-6",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:[s.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[s.jsx(Hs,{className:"text-blue-600",size:24}),s.jsx("h3",{className:"font-semibold text-gray-900",children:"Spedizione"})]}),s.jsx("p",{className:"text-gray-600 mb-2",children:o===0?"🎉 Spedizione gratuita! Il tuo ordine supera i 100€":`Aggiungi €${(100-u).toFixed(2)} per la spedizione gratuita`}),s.jsx("div",{className:"text-sm text-gray-500",children:"Consegna stimata: 3-5 giorni lavorativi"})]})]}),s.jsxs("div",{className:"lg:col-span-1",children:[s.jsxs(_.div,{className:"bg-white rounded-lg shadow-sm p-6 sticky top-8",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:[s.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:"Riepilogo ordine"}),s.jsxs("div",{className:"space-y-4 mb-6",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"Subtotale"}),s.jsxs("span",{className:"font-semibold",children:["€",u.toFixed(2)]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"Spedizione"}),s.jsx("span",{className:"font-semibold",children:o===0?"Gratuita":`€${o.toFixed(2)}`})]}),s.jsx("div",{className:"border-t pt-4",children:s.jsxs("div",{className:"flex justify-between text-lg font-bold",children:[s.jsx("span",{children:"Totale"}),s.jsxs("span",{children:["€",p.toFixed(2)]})]})})]}),s.jsxs(_.button,{className:"w-full py-4 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 mb-4 flex items-center justify-center gap-2",whileHover:{scale:1.02},whileTap:{scale:.98},children:[s.jsx(ri,{size:20}),"Procedi al Checkout",s.jsx(ni,{size:20})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("p",{className:"text-sm text-gray-500 mb-2",children:"Pagamenti sicuri"}),s.jsxs("div",{className:"flex justify-center gap-2",children:[s.jsx("div",{className:"w-8 h-5 bg-gray-200 rounded text-xs flex items-center justify-center",children:"VISA"}),s.jsx("div",{className:"w-8 h-5 bg-gray-200 rounded text-xs flex items-center justify-center",children:"MC"}),s.jsx("div",{className:"w-8 h-5 bg-gray-200 rounded text-xs flex items-center justify-center",children:"PP"})]})]})]}),s.jsxs(_.div,{className:"bg-white rounded-lg shadow-sm p-6 mt-6",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},children:[s.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Codice promozionale"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("input",{type:"text",placeholder:"Inserisci codice",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),s.jsx("button",{className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200",children:"Applica"})]})]})]})]})]})})},Pc=()=>{var se;const{id:e}=Go(),t=ir(),{addToCart:r}=Bt(),{toggleFavorite:n,isFavorite:o}=jo(),[i,a]=d.useState(null),[c,u]=d.useState(!0),[p,l]=d.useState(null),[m,v]=d.useState(""),[S,y]=d.useState(""),[x,b]=d.useState(1),[N,E]=d.useState(0);d.useEffect(()=>(e&&(async()=>{try{u(!0),l(null);const z=await $t.getProduct(e);a(z);const q=(C=>(C||"").replace(/```[\s\S]*?```/g," ").replace(/`[^`]*`/g," ").replace(/[\*_~>#-]+/g," ").replace(/\[(.*?)\]\((.*?)\)/g,"$1").replace(/\s{2,}/g," ").trim())(z.description_long||z.description||"");window.currentProductContext={id:z.id,name:z.name,description_text:q,category:z.category,gender:z.gender,price:z.price,brand:z.brand,image:z.image,variants:(z.variants||[]).map(C=>{var D;return{size:typeof C.size=="string"?C.size:(D=C.size)==null?void 0:D.value,color:C.color,available:C.available,stock:C.stock}}),product:{...z,description:z.description,description_long:z.description_long},lastUpdated:Date.now()},z.variants&&z.variants.length>0&&(v(z.variants[0].size),y(z.variants[0].color))}catch(z){console.error("Error loading product:",z),l("Errore nel caricamento del prodotto")}finally{u(!1)}})(),()=>{var z;((z=window.currentProductContext)==null?void 0:z.id)===e&&delete window.currentProductContext}),[e]);const O=async()=>{if(!(!m||!S))try{await r(i,m,S,x)}catch($){console.error("Error adding to cart:",$)}},V=()=>{i&&n(i)};return c?s.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-purple-600 mx-auto mb-4"}),s.jsx("p",{className:"text-gray-600",children:"Caricamento prodotto..."})]})}):p||!i?s.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:s.jsxs("div",{className:"text-center p-8 bg-white rounded-lg shadow-md",children:[s.jsx("h2",{className:"text-2xl font-bold text-red-600 mb-4",children:"Errore!"}),s.jsx("p",{className:"text-gray-700 mb-6",children:p||"Prodotto non trovato"}),s.jsx("button",{onClick:()=>t("/products"),className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition duration-300",children:"Torna ai Prodotti"})]})}):s.jsx("div",{className:"min-h-screen bg-gray-50",children:s.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[s.jsxs(_.button,{onClick:()=>t(-1),className:"flex items-center text-gray-600 hover:text-gray-900 mb-6",whileHover:{x:-5},children:[s.jsx(oi,{size:20,className:"mr-2"}),"Torna indietro"]}),s.jsxs("div",{className:"grid lg:grid-cols-2 gap-12",children:[s.jsxs("div",{className:"space-y-4",children:[s.jsx(_.div,{className:"aspect-square bg-white rounded-2xl overflow-hidden shadow-lg",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.5},children:s.jsx("img",{src:En(((se=i.images)==null?void 0:se[N])||i.image||"/static/images/placeholder-lg.jpg"),alt:i.name,className:"w-full h-full object-cover"})}),i.images&&i.images.length>1&&s.jsx("div",{className:"grid grid-cols-4 gap-2",children:i.images.map(($,z)=>s.jsx(_.button,{onClick:()=>E(z),className:`aspect-square rounded-lg overflow-hidden ${N===z?"ring-2 ring-blue-500":""}`,whileHover:{scale:1.05},whileTap:{scale:.95},children:s.jsx("img",{src:En($),alt:`${i.name} ${z+1}`,className:"w-full h-full object-cover"})},z))})]}),s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:i.name}),s.jsx("p",{className:"text-lg text-gray-600 mb-4",children:i.brand}),s.jsxs("div",{className:"flex items-center mb-4",children:[s.jsx("div",{className:"flex text-yellow-400",children:[...Array(5)].map(($,z)=>s.jsx(Vr,{size:20,fill:z<Math.floor(i.rating)?"currentColor":"none",stroke:"currentColor"},z))}),s.jsxs("span",{className:"text-sm text-gray-500 ml-2",children:["(",i.reviews," recensioni)"]})]}),s.jsxs("div",{className:"mb-6",children:[Number(i.discount_percentage??0)>0&&Number(i.original_price??0)>Number(i.price??0)?s.jsxs("span",{className:"text-lg text-gray-400 line-through mr-2",children:["€",Number(i.original_price??0).toFixed(2)]}):null,s.jsxs("span",{className:"text-3xl font-bold text-gray-900",children:["€",Number(i.price??0).toFixed(2)]}),Number(i.discount_percentage??0)>0&&s.jsxs("span",{className:"ml-3 bg-red-500 text-white px-3 py-1 rounded-full text-sm font-bold",children:["-",Number(i.discount_percentage??0),"%"]})]})]}),i.variants&&s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Taglia"}),s.jsx("div",{className:"flex flex-wrap gap-2",children:[...new Set(i.variants.map($=>$.size))].map($=>s.jsx(_.button,{onClick:()=>v($),className:`px-4 py-2 border rounded-lg font-medium ${m===$?"border-blue-500 bg-blue-50 text-blue-600":"border-gray-300 text-gray-700 hover:border-gray-400"}`,whileHover:{scale:1.05},whileTap:{scale:.95},children:$},$))})]}),i.variants&&s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Colore"}),s.jsx("div",{className:"flex flex-wrap gap-2",children:[...new Set(i.variants.map($=>$.color))].map($=>s.jsx(_.button,{onClick:()=>y($),className:`px-4 py-2 border rounded-lg font-medium capitalize ${S===$?"border-blue-500 bg-blue-50 text-blue-600":"border-gray-300 text-gray-700 hover:border-gray-400"}`,whileHover:{scale:1.05},whileTap:{scale:.95},children:$},$))})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Quantità"}),s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(_.button,{onClick:()=>b(Math.max(1,x-1)),className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-50",whileTap:{scale:.95},children:s.jsx(Gs,{size:16})}),s.jsx("span",{className:"text-lg font-medium px-4",children:x}),s.jsx(_.button,{onClick:()=>b(x+1),className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-50",whileTap:{scale:.95},children:s.jsx(Ws,{size:16})})]})]}),s.jsx("div",{className:"space-y-4",children:s.jsxs("div",{className:"flex space-x-4",children:[s.jsxs(_.button,{onClick:O,className:"flex-1 bg-blue-600 text-white py-4 px-6 rounded-lg font-semibold hover:bg-blue-700 flex items-center justify-center",whileHover:{scale:1.02},whileTap:{scale:.98},children:[s.jsx(jt,{size:20,className:"mr-2"}),"Aggiungi al Carrello"]}),s.jsx(_.button,{onClick:V,className:`p-4 rounded-lg border-2 ${i&&o(i.id)?"border-red-500 bg-red-50 text-red-600":"border-gray-300 text-gray-600 hover:border-gray-400"}`,whileHover:{scale:1.05},whileTap:{scale:.95},children:s.jsx(Br,{size:20,fill:i&&o(i.id)?"currentColor":"none"})})]})}),s.jsxs("div",{className:"grid grid-cols-1 gap-4 pt-6 border-t",children:[s.jsxs("div",{className:"flex items-center text-gray-600",children:[s.jsx(Hs,{size:20,className:"mr-3"}),s.jsx("span",{children:"Spedizione gratuita sopra i €100"})]}),s.jsxs("div",{className:"flex items-center text-gray-600",children:[s.jsx(ii,{size:20,className:"mr-3"}),s.jsx("span",{children:"Reso gratuito entro 30 giorni"})]}),s.jsxs("div",{className:"flex items-center text-gray-600",children:[s.jsx(ai,{size:20,className:"mr-3"}),s.jsx("span",{children:"Pagamenti sicuri"})]})]})]})]})]})})},zc=({isListening:e,isProcessing:t,isConnected:r,isSpeaking:n,isExecutingFunction:o,currentFunction:i,messages:a,error:c,onClose:u,isAssistantActive:p})=>{const[l,m]=d.useState(!1);d.useEffect(()=>{if(e||t||n||o||c||p)m(!0);else{const x=setTimeout(()=>{m(!1)},2e3);return()=>clearTimeout(x)}},[e,t,n,o,c,p]);const S=c?{icon:Mt,text:"Errore - Clicca per chiudere",color:"bg-red-500",textColor:"text-white",animate:!1}:o?{icon:{navigate_to_page:ci,search_products:Qs,add_to_cart:Dr,get_cart_summary:Dr,get_recommendations:sr}[i]||Bs,text:"Eseguo comando...",color:"bg-green-500",textColor:"text-white",animate:!0}:n?{icon:Js,text:"AIVA sta parlando",color:"bg-purple-500",textColor:"text-white",animate:!0}:t?{icon:dn,text:"",color:"bg-blue-500",textColor:"text-white",animate:!0}:e?{icon:Ft,text:"Ti sto ascoltando",color:"bg-blue-500",textColor:"text-white",animate:!0}:{icon:li,text:"AIVA pronta",color:"bg-gray-700",textColor:"text-white",animate:!1},y=x=>{x.stopPropagation(),console.log("🔴 VoiceVisualizer: Closing assistant completely"),m(!1),u&&u()};return l?s.jsx(ar,{children:s.jsx(_.div,{initial:{opacity:0,y:-20,scale:.9},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-20,scale:.9},className:"fixed top-6 left-0 right-0 z-[100]",style:{pointerEvents:"none"},children:s.jsxs("div",{className:"relative mx-auto",style:{width:"400px",maxWidth:"90vw",pointerEvents:"auto"},children:[s.jsx(_.div,{className:"bg-black/90 backdrop-blur-xl rounded-2xl border border-white/10 shadow-2xl",style:{height:"80px",width:"100%"},initial:{scale:.9},animate:{scale:1},transition:{type:"spring",damping:20},children:s.jsxs("div",{className:"flex items-center justify-between p-4 h-full",children:[s.jsxs("div",{className:"flex items-center space-x-4 flex-1",children:[s.jsxs("div",{className:"relative flex-shrink-0",children:[s.jsx(_.div,{className:`w-12 h-12 rounded-full ${S.color} flex items-center justify-center`,animate:S.animate?{scale:[1,1.1,1]}:{},transition:{duration:1.2,repeat:S.animate?1/0:0,ease:"easeInOut"},children:S.icon===dn?s.jsx(dn,{className:"w-6 h-6 text-white animate-spin"}):s.jsx(S.icon,{className:"w-6 h-6 text-white"})}),S.animate&&s.jsx(_.div,{className:`absolute inset-0 rounded-full ${S.color} opacity-40`,animate:{scale:[1,1.6],opacity:[.4,0]},transition:{duration:1.8,repeat:1/0,ease:"easeOut"}})]}),s.jsxs("div",{className:"flex flex-col min-w-0 flex-1",children:[s.jsx("span",{className:`font-medium text-sm ${S.textColor} truncate`,children:S.text}),s.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[s.jsx("div",{className:`w-2 h-2 rounded-full ${r?"bg-green-400":"bg-red-400"}`}),s.jsx("span",{className:"text-white/60 text-xs",children:r?"Connesso":"Connessione..."})]})]})]}),s.jsxs("div",{className:"flex items-center space-x-3 flex-shrink-0",children:[(e||n)&&s.jsx("div",{className:"flex items-center space-x-1",children:[...Array(4)].map((x,b)=>s.jsx(_.div,{className:`w-1 rounded-full ${e?"bg-blue-400":"bg-purple-400"}`,animate:{height:[6,18,6]},transition:{duration:.8,repeat:1/0,delay:b*.15,ease:"easeInOut"}},b))}),s.jsx(_.button,{onClick:y,className:"p-2 rounded-full bg-white/10 hover:bg-white/20 transition-colors flex-shrink-0",whileHover:{scale:1.1},whileTap:{scale:.95},title:"Chiudi assistente vocale",children:s.jsx(Mt,{className:"w-4 h-4 text-white/80"})})]})]})}),!1,o&&i&&s.jsx(_.div,{className:"absolute -bottom-8 left-1/2 transform -translate-x-1/2",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},children:s.jsxs("div",{className:"bg-green-500/90 text-white text-xs px-3 py-1 rounded-full backdrop-blur-sm",children:[i==="search_products"&&"🔍 Ricerca in corso",i==="add_to_cart"&&"🛒 Aggiunta al carrello",i==="navigate_to_page"&&"📍 Navigazione",!["search_products","add_to_cart","navigate_to_page"].includes(i)&&"⚡ Esecuzione"]})})]})})}):null},Ds=(e=[])=>{if(!Array.isArray(e)||e.length===0)return"";const t=Math.floor(Math.random()*e.length);return e[t]??e[0]},Ic=(e="")=>(e||"").replace(/```[\s\S]*?```/g," ").replace(/`[^`]*`/g," ").replace(/[\*_~>#-]+/g," ").replace(/\[(.*?)\]\((.*?)\)/g,"$1").replace(/\s{2,}/g," ").trim(),nr=16e3,Oc=(e=[])=>{if(!Array.isArray(e)||e.length===0)return new Float32Array(0);const t=e.reduce((o,i)=>o+i.length,0),r=new Float32Array(t);let n=0;return e.forEach(o=>{r.set(o,n),n+=o.length}),r},Fc=(e,t,r=nr)=>{if(!e||!e.length||!t||t===r)return e||new Float32Array(0);const n=t/r,o=Math.round(e.length/n),i=new Float32Array(o);let a=0,c=0;for(;a<i.length;){const u=Math.round((a+1)*n);let p=0,l=0;for(let m=c;m<u&&m<e.length;m+=1)p+=e[m],l+=1;i[a]=l>0?p/l:0,a+=1,c=u}return i},Lc=e=>{const t=new ArrayBuffer(e.length*2),r=new DataView(t);let n=0;for(let o=0;o<e.length;o+=1,n+=2){const i=Math.max(-1,Math.min(1,e[o]||0));r.setInt16(n,i<0?i*32768:i*32767,!0)}return new Uint8Array(t)},$c=e=>{if(!e)return"";let t="";const r=new Uint8Array(e),n=32768;for(let o=0;o<r.length;o+=n){const i=r.subarray(o,o+n);t+=String.fromCharCode.apply(null,i)}return btoa(t)},Mc=e=>{const t=atob(e),r=t.length,n=new Uint8Array(r);for(let o=0;o<r;o+=1)n[o]=t.charCodeAt(o);return n.buffer},qc=(e={})=>{var t;return{size:typeof e.size=="string"?e.size:(t=e.size)==null?void 0:t.value,color:e.color,available:e.available,stock:e.stock}},jn=(e,t=1)=>{const r=Number(e);return Number.isFinite(r)?Math.min(10,Math.max(1,Math.round(r))):t},Nn=(e={},t=null)=>{if(!t||typeof t!="object")return e;const r=Ic(t.description_long||t.description||e.description_text||""),n=Array.isArray(t.variants)?t.variants.map(qc):e.variants||[];return{...e,id:t.id||e.id,name:t.name||e.name,category:t.category||e.category,gender:t.gender||e.gender,price:t.price??e.price,brand:t.brand??e.brand,image:t.image??e.image,description_text:r,variants:n,product:t,lastUpdated:Date.now()}},Dc=()=>{const[e,t]=d.useState(!1),[r,n]=d.useState(!1),[o,i]=d.useState([]),[a,c]=d.useState(!1),[u,p]=d.useState(!1),[l,m]=d.useState(null),[v,S]=d.useState(null),[y,x]=d.useState(""),[b,N]=d.useState(!1),[E,O]=d.useState(!0),[V,se]=d.useState(!1),[$,z]=d.useState(0),F=ir(),{addToCart:q,removeFromCart:C,clearCart:D,removeLastItem:H,updateQuantity:K}=Bt(),{setSearchQuery:me,filterProducts:Ee,setMultipleFilters:be,clearFilters:at}=Le(),ve=d.useRef(null),Nt=typeof window<"u"?Lt():null,Ve=d.useRef(Nt||`session-${Date.now()}-${Math.random().toString(36).substr(2,9)}`);d.useRef(null),d.useRef(0);const R=d.useRef(null),P=d.useRef([]),A=d.useRef(!1);d.useEffect(()=>{A.current=a},[a]);const ce=d.useRef(!1),ge=d.useRef(null),Q=d.useRef(null);d.useRef([]);const $e=d.useRef(null),Me=d.useRef(""),Pe=d.useRef(""),Ct=d.useRef(!1),fr=d.useRef(!1),Et=d.useRef(!1),Te=d.useRef([]),qe=d.useRef(null),Tt=d.useRef([]),Kr=d.useRef(null),mt=d.useRef(null),Vt=d.useRef(!1),Xr=d.useRef(null),Ht=d.useRef(!1),$n=d.useRef(!1),Se=d.useRef(!1),Co=d.useRef(!1),Rt=d.useRef(Date.now()),Mn=d.useRef(""),tt=d.useRef(!1),pr=d.useRef(null),mr=d.useRef([]),He=d.useRef(""),Yr=d.useRef({onceSpoken:!1}),qn=d.useRef(!1),_t=d.useRef(""),Ge=typeof window<"u"&&typeof navigator<"u",ht=Ge&&/iP(ad|hone|od)/i.test(navigator.userAgent),Eo=Ge&&/Safari/i.test(navigator.userAgent)&&!/Chrome|CriOS|Android/i.test(navigator.userAgent),hr=ht&&Eo,gr=d.useRef(!1),Gt=d.useRef({active:!1,aborting:!1}),At=d.useCallback(()=>!Ge||typeof window>"u"?!1:"webkitSpeechRecognition"in window||"SpeechRecognition"in window,[Ge]),yr=d.useMemo(()=>Ge?!!(!At()||ht):!1,[Ge,At,ht]),Dn=d.useMemo(()=>!Ge||typeof window>"u"?!1:!!(!("speechSynthesis"in window)||ht),[Ge,ht]),ye=d.useCallback(()=>(typeof window<"u"&&window.speechSynthesis?window.speechSynthesis.speaking:!1)||Vt.current,[]),kt=d.useRef(null),xr=d.useRef(null),To=d.useRef(null),Wt=d.useRef(null),gt={default:{window:9e3,closingGrace:1e3,prompts:["Se hai bisogno di altro, sono qui.","Ok! Buon proseguimento, chiamami se ti serve aiuto.","Resto a disposizione se ti serve altro.","Quando vuoi riprendere, basta dirmelo.","Sono qui se ti viene in mente qualcos'altro da vedere.","Va bene, resto in ascolto per quando ti serve.","Va benissimo, resto disponibile se vuoi continuare più tardi.","Prenditi pure il tuo tempo, io rimango qui.","Chiamami pure quando ti viene voglia di esplorare altri look.","Se vuoi riprendere, basta dirmelo e continuiamo da dove eravamo."]},followUp:{window:13e3,closingGrace:1600,prompts:["Nessun problema, fammi sapere come vuoi procedere.","Va bene, ti ascolto quando sei pronto.","Prenditi pure un momento per pensarci, resto in ascolto.","Ok, dimmi pure appena hai deciso come continuare.","Tranquillo, fammi sapere quando vuoi proseguire."]},task:{window:11e3,closingGrace:1300,prompts:["Va bene, continuo a seguire la tua richiesta.","Perfetto, dimmi pure gli altri dettagli quando vuoi.","Ok, resto qui finché non mi dai nuove indicazioni.","Ricevuto, se vuoi aggiungere altro basta dirmelo.","Va benissimo, proseguiamo quando sei pronto."]}},Ro=450,ct=d.useRef(null),Zr=d.useRef(null),br=d.useRef(!1),We=d.useRef(null),G=d.useRef(!1),en=d.useRef({}),tn=d.useCallback(async()=>{const f=window.currentProductContext||{};if(f.product&&typeof f.product=="object"){const h=Nn(f,f.product);return window.currentProductContext=h,h}if(!f.id)return f;try{const h=await $t.getProduct(f.id);if(h){const j=Nn(f,h);return window.currentProductContext=j,j}}catch(h){console.warn("Unable to hydrate current product context",h)}return window.currentProductContext||f},[$t]),_o=["Ecco.","Subito.","Fatto.","Ci siamo."],Un=["Ecco il carrello.","Carrello aperto.","Tieni il carrello.","Pronto."],Ao=["Ecco le offerte.","Sconti in vista.","Promozioni aperte.","Offerte pronte."],ko=["Ecco i risultati.","Ecco qui.","Pronto.","Fatto."],Po=["Filtri applicati.","Lista aggiornata.","Pronto così.","Fatto."],zo=["Ecco la scheda.","Mostrato.","Eccolo qui.","Fatto."],Io=["Aggiunto al carrello.","Fatto.","Inserito.","Dentro al carrello."],Oo=["Tolto dal carrello.","Rimosso.","Fatto.","Via dal carrello."],Fo=["Carrello svuotato.","Tutto pulito.","Vuoto.","Fatto."],Bn=d.useCallback((f,h=[],j="")=>{const w=Array.isArray(h)?h.filter(Boolean):[];if(w.length===0)return j;const T=en.current[f],I=w.filter(M=>M!==T),U=Ds(I.length>0?I:w)||j||w[0];return en.current[f]=U,U||j},[]),rt=d.useCallback((f,h=[],j="",w,T={})=>{const{oncePerTurn:I=!1,overrideText:U=null,immediate:M=!1}=T||{},B=(U||Bn(f,h,j)||"").trim();if(!B){typeof w=="function"&&w();return}if(I){if(Yr.current.onceSpoken){typeof w=="function"&&w();return}Yr.current.onceSpoken=!0}const fe=Xr.current;typeof fe=="function"?fe(B,w,M,{enqueue:!1}):typeof w=="function"&&w()},[Bn]),Vn=d.useCallback(()=>{Yr.current.onceSpoken=!1},[]),Hn=d.useCallback(()=>{ct.current&&(clearTimeout(ct.current),ct.current=null),We.current&&(clearTimeout(We.current),We.current=null)},[]),rn=d.useRef("default"),wr=d.useRef(""),Qe=d.useRef(""),vr=d.useRef(null),nn=d.useRef(()=>{}),De=d.useCallback(f=>{const h=gt[f]?f:"default";rn.current=h},[]),Pt=d.useCallback(()=>{const f=rn.current;return gt[f]||gt.default},[]),Gn=d.useCallback(()=>{const f=Pt();return typeof f.window=="number"?f.window:gt.default.window},[Pt]),Wn=d.useCallback(()=>{const f=Pt();return typeof f.closingGrace=="number"?f.closingGrace:gt.default.closingGrace},[Pt]),Qn=d.useCallback(()=>{const f=Pt(),h=Array.isArray(f.prompts)?f.prompts.filter(Boolean):[],j=gt.default.prompts.filter(Boolean),w=h.length?h:j;if(!w.length)return"";const T=wr.current,I=w.filter(M=>M!==T),U=Ds(I.length?I:w)||w[0];return wr.current=U,U},[Pt]),ze=d.useCallback(()=>{vr.current&&(clearTimeout(vr.current),vr.current=null)},[]),Sr=d.useCallback((f,h)=>{if(h&&gt[h]){De(h);return}const j=(f||"").toString().trim().toLowerCase();if(!j)return;if(/[?]\s*$/.test(j)||/(preferisci|vuoi|ti serve|posso|che ne pensi|hai bisogno)/.test(j)){De("followUp");return}if(/(aggiunto|fatto|eccoti|ecco|ho trovato|dimmi se vuoi|quando sei pronto|se vuoi aggiungere)/.test(j)){De("task");return}rn.current!=="default"&&De("default")},[De]),le=d.useRef(!1),Jn=d.useRef(!0),Je=d.useRef(!1);d.useRef(!1);const yt=d.useRef(null),Kn=d.useRef(0),Xn=d.useCallback(()=>{try{if(A.current)return;const f=Date.now();if(f-Kn.current<2e3)return;const h=window.AudioContext||window.webkitAudioContext;yt.current||(yt.current=new h);const j=yt.current,w=j.createOscillator(),T=j.createGain();w.type="sine",w.frequency.setValueAtTime(880,j.currentTime),T.gain.setValueAtTime(1e-4,j.currentTime),T.gain.exponentialRampToValueAtTime(.2,j.currentTime+.01),w.connect(T).connect(j.destination),w.start(),T.gain.exponentialRampToValueAtTime(1e-4,j.currentTime+.15),w.stop(j.currentTime+.18),Kn.current=f}catch{}},[]),Yn=d.useCallback(()=>{if("speechSynthesis"in window)try{if(gr.current){if(window.speechSynthesis.paused)try{window.speechSynthesis.resume()}catch{}return}gr.current=!0;const f=new SpeechSynthesisUtterance(" ");f.volume=0,f.rate=1,f.pitch=1,f.onend=()=>{try{window.speechSynthesis.cancel()}catch{}},window.speechSynthesis.speak(f)}catch(f){gr.current=!1,console.warn("Speech synthesis prime failed",f)}},[]),lt=d.useCallback(async()=>{var f;try{const h=window.AudioContext||window.webkitAudioContext;if(h&&(yt.current||(yt.current=new h),((f=yt.current)==null?void 0:f.state)==="suspended"&&await yt.current.resume(),kt.current&&kt.current.state==="suspended"&&await kt.current.resume()),typeof window.speechSynthesis<"u"){if(window.speechSynthesis.paused)try{window.speechSynthesis.resume()}catch{}Yn()}}catch(h){gr.current=!1,console.warn("Audio pipeline resume failed",h)}},[Yn]),sn=d.useCallback(async()=>{try{const f=window.AudioContext||window.webkitAudioContext;if(!f)return;kt.current||(kt.current=new f);const h=kt.current,j=await navigator.mediaDevices.getUserMedia({audio:!0});xr.current=j;const w=h.createMediaStreamSource(j),T=h.createAnalyser();T.fftSize=512,To.current=T,w.connect(T);let I=0;const U=.02,M=12,B=new Uint8Array(T.fftSize),fe=()=>{T.getByteTimeDomainData(B);let oe=0;for(let Xe=0;Xe<B.length;Xe++){const Ye=(B[Xe]-128)/128;oe+=Ye*Ye}if(I=Math.sqrt(oe/B.length)>U?I+1:0,I>=M){try{window.speechSynthesis.cancel()}catch{}Te.current=[],Me.current="",Ht.current=!0,fr.current=!1,N(!1),le.current=!1,G.current&&!A.current&&!Je.current&&!le.current&&P.current.length===0&&(G.current=!1),c(!1),A.current=!1,G.current=!1,Ke(),Q.current&&Q.current();return}Wt.current=requestAnimationFrame(fe)};Wt.current=requestAnimationFrame(fe)}catch{}},[]),Ke=d.useCallback(()=>{try{Wt.current&&cancelAnimationFrame(Wt.current)}catch{}Wt.current=null;try{xr.current&&xr.current.getTracks().forEach(f=>f.stop())}catch{}xr.current=null},[]),Qt=d.useCallback((f=!1)=>{if(hr&&!f){t(!1);return}if(ze(),Qe.current="",R.current)try{const h=R.current;R.current=null;try{h.onend=null}catch{}try{h.stop()}catch{}}catch{}t(!1)},[hr,ze]);d.useEffect(()=>{le.current=b},[b]),d.useEffect(()=>{Jn.current=E},[E]),d.useEffect(()=>{Je.current=u},[u]),d.useEffect(()=>{A.current=a},[a]),d.useEffect(()=>{Co.current=r},[r]),d.useEffect(()=>{qn.current=e},[e]);const Zn=6e4,Lo=15e3,es=d.useCallback(()=>{const f=["Ciao! Sono AIVA, la tua personal shopper AI. Come posso aiutarti oggi?","Benvenuto. Sono AIVA, qui per aiutarti a navigare tra le nostre collezioni. Cerchi ispirazione o hai già un'idea precisa?","Ciao! Sono AIVA, l'assistente AI pronta a trasformare la tua esperienza di shopping. Cosa posso fare per te?","Benvenuto nel nostro ecommerce. Sono AIVA, la tua personal shopper AI. Quali prodotti ti piacerebbe vedere?","Sono AIVA, la tua assistente allo shopping. Insieme possiamo scoprire le nuove collezioni o trovare esattamente ciò che desideri. Da dove vogliamo cominciare?","Benvenuto! Sono AIVA e sono qui per aiutarti a trovare l'outfit perfetto. Puoi dirmi cosa cerchi oppure chiedermi di mostrarti le ultime offerte."],h=["Eccomi di nuovo.","Rieccomi.","Bentornato.","Sono di nuovo qui. Dimmi pure.","Pronta a continuare. Hai trovato qualcosa che ti piace o cerchiamo altro?","Ok, continuiamo. Cosa facciamo ora?","Pronti a ripartire. Ti ascolto."],j=w=>!w||w.length===0?"":w[Math.floor(Math.random()*w.length)]||"";return $===0?(z(1),j(f)):j(h)},[$]);d.useEffect(()=>{Se.current=V},[V]);const ts=d.useCallback(()=>{const f=window.speechSynthesis.getVoices(),h=[{name:"Google italiano",lang:"it-IT",gender:"female"},{name:"Alice",lang:"it-IT"},{name:"Elsa",lang:"it-IT"},{name:"Carla",lang:"it-IT"},{name:"Microsoft Elsa",lang:"it-IT"},{name:"Microsoft Cosimo",lang:"it-IT"},{lang:"it-IT",gender:"female"},{lang:"it-IT"},{lang:"it"}];for(const w of h){const T=f.find(I=>{var fe;const U=I.lang.toLowerCase().startsWith(((fe=w.lang)==null?void 0:fe.toLowerCase())||"it"),M=!w.name||I.name.toLowerCase().includes(w.name.toLowerCase()),B=!w.gender||I.name.toLowerCase().includes("female")||I.name.toLowerCase().includes("donna")||I.name.toLowerCase().includes("alice")||I.name.toLowerCase().includes("elsa")||I.name.toLowerCase().includes("carla");return U&&M&&B});if(T)return console.log("🎤 Selected voice:",T.name,T.lang),pr.current=T,T}const j=f.find(w=>w.lang.toLowerCase().startsWith("it"));return j?(console.log("🎤 Fallback Italian voice:",j.name),pr.current=j,j):null},[]);d.useEffect(()=>{const f=()=>{ts()};return f(),window.speechSynthesis.onvoiceschanged!==void 0&&(window.speechSynthesis.onvoiceschanged=f),setTimeout(f,100),setTimeout(f,500),()=>{window.speechSynthesis.onvoiceschanged!==void 0&&(window.speechSynthesis.onvoiceschanged=null)}},[ts]);const jr=d.useCallback(f=>{const h=(f||"").split(new RegExp("(?<=[\\.!?])\\s+")).map(j=>j.trim()).filter(Boolean);return h.length?h:[(f||"").trim()].filter(Boolean)},[]),Nr=d.useCallback((f,h)=>{const j=(h||"").trim();if(!j)return;const w=[...mr.current,{role:f,content:j}];mr.current=w.slice(-20)},[]),rs=d.useCallback(f=>{Nr("user",f)},[Nr]),on=d.useCallback(f=>{Nr("assistant",f),Sr(f)},[Nr,Sr]),Jt=d.useCallback((f=0)=>{f>3||Se.current&&(qn.current||A.current||le.current||P.current.length>0||ye()||Q.current&&(Q.current(),setTimeout(()=>Jt(f+1),300+f*200)))},[ye]),pe=d.useCallback(()=>{!ye()&&!le.current&&Te.current.length===0&&(G.current=!1,c(!1),A.current=!1,Se.current&&P.current.length===0&&(Q.current&&Q.current(),setTimeout(()=>Jt(),180)))},[Jt,ye]),Cr=d.useCallback(f=>{console.log("[filters] Applying UI filters:",f),setTimeout(()=>{if(f.category){const h=document.querySelector("select");if(h){for(let j of h.options)if(j.value.toLowerCase()===f.category.toLowerCase()){h.value=j.value,h.dispatchEvent(new Event("change",{bubbles:!0}));break}}}if(f.price_range){const h=document.querySelectorAll("select")[1];h&&(f.price_range==="low-to-high"?h.value="price-low":f.price_range==="high-to-low"&&(h.value="price-high"),h.dispatchEvent(new Event("change",{bubbles:!0})))}Ee(f)},300)},[Ee]),Er=d.useCallback((f=700)=>{setTimeout(()=>{Se.current&&!tt.current&&!ye()&&!le.current&&!A.current&&P.current.length===0&&Q.current&&Q.current()},f)},[ye]),an=d.useCallback(async(f,h)=>{var j,w,T,I;if(console.log("🎯 Executing function:",f,h),p(!0),m(f),Rt.current=Date.now(),R.current){try{R.current.stop()}catch(U){console.log("Could not stop recognition:",U.message)}t(!1)}try{switch(await new Promise(U=>setTimeout(U,300)),f){case"navigate_to_page":case"navigate":{const L={home:"/",prodotti:"/products",products:"/products",offerte:"/offers",offers:"/offers",carrello:"/cart",cart:"/cart",checkout:"/checkout"}[h.page]||"/";if(console.log("[nav] Navigating to:",L),F(L),Me.current="",Ht.current=!1,L==="/products"){const X=h.resetFilters===!0;let ee={};if(X)try{at(),me(""),typeof window<"u"&&(window.productsSearchQuery="",window.productsSelectedCategory="")}catch(Y){console.warn("Failed to reset filters on navigation",Y)}h.filters&&typeof h.filters=="object"&&(ee={...h.filters}),h.category&&!ee.category&&(ee.category=h.category);const te=P.current[0];te&&te.name==="apply_ui_filters"&&te.params&&typeof te.params.filters=="object"?(ee={...ee,...te.params.filters},P.current.shift()):te&&te.name==="search_products"&&te.params&&!te.params.query&&typeof te.params.filters=="object"&&(ee={...ee,...te.params.filters},P.current.shift());const de=Y=>{const Oe=Y&&Object.keys(Y).length>0?Y:{};setTimeout(()=>{try{Object.keys(Oe).length>0?be(Oe):X&&at(),typeof window<"u"&&typeof window.applyProductFilters=="function"?window.applyProductFilters(Oe):Cr(Oe)}catch(Fe){console.warn("Failed to apply filters after navigation",Fe)}},350)};Object.keys(ee).length>0?de(ee):X&&de({})}const W=L==="/cart"?{key:"nav-cart",messages:Un,fallback:"Ecco il carrello."}:L==="/offers"?{key:"nav-offers",messages:Ao,fallback:"Ecco le offerte."}:{key:"nav-default",messages:_o,fallback:"Ecco."},re=()=>{const X=P.current.length>0;c(!1),A.current=!1,X?(Vn(),G.current=!0):(G.current=!1,Q.current&&Q.current())};rt(W.key,W.messages,W.fallback,re,{oncePerTurn:!0}),Er(1e3);break}case"search_products":const U=h.query||"",M=h.filters||{};console.log("🔍 Searching:",U,"Filters:",M);const B=!!M.on_sale,fe=window.location.pathname;if(B){fe!=="/offers"&&F("/offers");try{window.dispatchEvent(new CustomEvent("offers-apply-filters",{detail:{filters:M,query:U}}))}catch{}}else fe!=="/products"&&F("/products"),setTimeout(()=>{if(U){me(U);const k=document.querySelector('input[placeholder="Cerca prodotti..."]');k&&(k.value=U,k.dispatchEvent(new Event("input",{bubbles:!0})))}Object.keys(M).length>0&&(be(M),h.applyUIFilters!==!1&&Cr(M))},500);rt("search",ko,"Ecco i risultati.",()=>{const k=P.current.length>0;c(!1),A.current=!1,k?G.current=!0:(G.current=!1,Q.current&&Q.current())},{oncePerTurn:!0});break;case"apply_ui_filters":console.log("🎨 Applying UI filters:",h.filters),window.applyProductFilters?window.applyProductFilters(h.filters||{}):Cr(h.filters||{}),rt("filters",Po,"Filtri applicati.",()=>{const k=P.current.length>0;c(!1),A.current=!1,k?G.current=!0:(G.current=!1,Q.current&&Q.current())},{oncePerTurn:!0});break;case"get_product_details":const Xe=h.product_id;console.log("📦 Showing product:",Xe),F(`/products/${Xe}`),rt("product",zo,"Ecco la scheda.",()=>{const k=P.current.length>0;c(!1),A.current=!1,k?G.current=!0:(G.current=!1,Q.current&&Q.current())},{oncePerTurn:!0});break;case"open_product_by_name":{const k=((h==null?void 0:h.name)||"").toLowerCase().trim(),L=(j=window.visibleProductsMap)==null?void 0:j[k];L?(F(`/products/${L}`),Er(800)):(F("/products"),setTimeout(()=>{window.applyProductFilters&&window.applyProductFilters({query:h==null?void 0:h.name})},300),Er(800));break}case"add_to_cart":{console.log("[cart] Adding to cart:",h);const k=(L="")=>{const W={nero:"nero",black:"nero",bianco:"bianco",white:"bianco","blu navy":"blu navy",navy:"blu navy","blu scuro":"blu navy",blu:"blu",azzurro:"azzurro",rosso:"rosso",borgogna:"bordeaux",bordeaux:"bordeaux","verde oliva":"verde oliva",oliva:"verde oliva",verde:"verde","grigio melange":"grigio melange",melange:"grigio melange",antracite:"grigio antracite",grigio:"grigio",beige:"beige",panna:"panna",crema:"panna",cammello:"cammello",marrone:"marrone",rosa:"rosa",giallo:"giallo",viola:"viola"},re=(L||"").toLowerCase(),X=Object.keys(W).sort((te,de)=>de.length-te.length);for(const te of X)if(re.includes(te))return W[te];const ee=re.split(/[\s/,-]+/).filter(Boolean);for(const te of ee)if(W[te])return W[te];return re||"nero"};try{const L=jn(h.quantity??1,1),W=(h.size||"M").toUpperCase(),re=k(h.color||"nero");if(window.location.pathname.includes("/products/")){setTimeout(()=>{const Fe=document.querySelectorAll("button");for(let it of Fe)if(it.textContent.trim().toUpperCase()===W.toUpperCase()){it.click();break}setTimeout(()=>{for(let it of document.querySelectorAll("button"))if(it.textContent.toLowerCase().includes(re.toLowerCase())){it.click();break}},300)},200);const Y=await tn(),Oe=Y==null?void 0:Y.product;if(Oe){if(!await q(Oe,W,re,L))throw new Error("Cart update rejected")}else{const Fe={id:h.product_id||(Y==null?void 0:Y.id)||"550e8400-0001-41d4-a716-446655440001",name:h.product_name||(Y==null?void 0:Y.name)||"Prodotto",price:(Y==null?void 0:Y.price)||h.price||49.9,brand:(Y==null?void 0:Y.brand)||"Fashion Brand"};if(!await q(Fe,W,re,L))throw new Error("Fallback cart update failed")}}else{const Y={id:h.product_id||"550e8400-0001-41d4-a716-446655440001",name:h.product_name||"Prodotto",price:h.price||49.9,brand:"Fashion Brand"};if(!await q(Y,W,re,L))throw new Error("Remote cart update failed")}const ee=h.skipAck===!0,te=typeof h.overrideAck=="string"?h.overrideAck:null,de=()=>{const Y=P.current.length>0;c(!1),A.current=!1,Y?G.current=!0:pe()};ee?de():rt("cart-add",Io,"Aggiunto al carrello.",de,{oncePerTurn:!1,overrideText:te||void 0})}catch(L){console.error("Error adding to cart:",L),ue("Non sono riuscita ad aggiungerlo al carrello.",()=>{c(!1),A.current=!1,pe()},!1,{enqueue:!1})}break}case"remove_from_cart":{const{item_id:k,product_name:L,size:W,color:re}=h||{};let X=k;if(!X&&L){const ee=(te=>(te||"").toString().normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").toLowerCase().replace(/[^a-z0-9]+/g," ").trim())(`${L} ${W||""} ${re||""}`);X=(w=window.cartItemsMap)==null?void 0:w[ee]}console.log("[cart] Removing from cart:",X||k),X?(await C(X),rt("cart-remove",Oo,"Rimosso dal carrello.",()=>{const te=P.current.length>0;c(!1),A.current=!1,te?G.current=!0:pe()},{oncePerTurn:!1})):ue("Non trovo quel prodotto nel carrello. Puoi ripetere il nome o dirmi la taglia e il colore?");break}case"update_cart_quantity":console.log("📝 Updating quantity:",h),h.item_id&&h.quantity&&await K(h.item_id,h.quantity);break;case"get_cart_summary":case"view_cart":console.log("🛒 Opening cart"),F("/cart"),rt("nav-cart",Un,"Ecco il carrello.",()=>{const k=P.current.length>0;c(!1),A.current=!1,k?G.current=!0:(G.current=!1,Q.current&&Q.current())},{oncePerTurn:!0});break;case"clear_cart":console.log("🗑️ Clearing cart"),await D(),rt("cart-clear",Fo,"Carrello svuotato.",()=>{const k=P.current.length>0;c(!1),A.current=!1,k?G.current=!0:(G.current=!1,Q.current&&Q.current())},{oncePerTurn:!1});break;case"get_current_promotions":case"show_offers":console.log("🏷️ Showing offers"),F("/offers"),ue("Ecco le offerte.",()=>{c(!1),A.current=!1,G.current=!1,Q.current&&Q.current()},!1,{enqueue:!1});break;case"get_shipping_info":{console.log("🚚 Fetching shipping info");try{const k=await ji.getShippingInfo(),L=(k.shipping_zones||[]).find(de=>(de.zone||"").toLowerCase().includes("italia")||(de.zone||"").toLowerCase().includes("penisola"))||((T=k.shipping_zones)==null?void 0:T[0]),W=(L==null?void 0:L.standard)||k.standard_shipping,re=(L==null?void 0:L.express)||k.express_shipping,X=k.pickup_point,ee=[];if(k.free_shipping_threshold!=null&&ee.push(`spedizione gratuita sopra i €${Number(k.free_shipping_threshold).toFixed(2)}`),W){const de=typeof W=="object"?W.price:W,Y=typeof W=="object"?W.delivery_window||W.delivery_time:k.delivery_time_standard;ee.push(`standard a €${Number(de).toFixed(2)} con consegna in ${Y||"pochi giorni"}`)}if(re){const de=typeof re=="object"?re.price:re,Y=typeof re=="object"?re.delivery_window||re.delivery_time:k.delivery_time_express;ee.push(`express a €${Number(de).toFixed(2)} con arrivo in ${Y||"1-2 giorni"}`)}if(X&&X.enabled!==!1){const de=X.delivery_window||X.delivery_time||"24 ore";ee.push(`ritiro gratuito in boutique disponibile entro ${de}`)}(I=k.saturday_delivery)!=null&&I.enabled&&ee.push(`consegna il sabato a €${Number(k.saturday_delivery.price).toFixed(2)} su ${k.saturday_delivery.area}`);const te=ee.length?`Ecco le nostre opzioni di spedizione: ${ee.join(", ")}.`:"Le nostre spedizioni sono attive, ma non riesco a recuperare tutti i dettagli in questo momento.";ue(te,()=>{c(!1),A.current=!1,G.current=!1,Q.current&&Q.current()},!1,{enqueue:!1})}catch(k){console.error("Errore recuperando le spedizioni",k),ue("Non riesco a recuperare le informazioni di spedizione ora, riprova tra qualche istante.",()=>{c(!1),A.current=!1,G.current=!1,Q.current&&Q.current()},!1,{enqueue:!1})}break}case"get_recommendations":console.log("💡 Getting recommendations"),F("/products"),setTimeout(()=>{const k=new CustomEvent("show-recommendations");window.dispatchEvent(k)},300);break;case"close_conversation":console.log("👋 Closing conversation"),st();break;case"get_size_guide":try{const k=await $t.getSizeGuide(h.category||"pantaloni"),L=[];for(const[W,re]of Object.entries(k))L.push(`${W}: ${Object.entries(re).map(([X,ee])=>`${X}=${ee}`).join(", ")}`);ue(`Ecco la guida taglie per ${h.category}: ${L.join(". ")}`,()=>{c(!1),A.current=!1,G.current=!1,Q.current&&Q.current()},!1,{enqueue:!1})}catch{ue("Non sono riuscita a recuperare la guida taglie al momento.",()=>{c(!1),A.current=!1,G.current=!1,Q.current&&Q.current()},!1,{enqueue:!1})}break;default:console.warn("❓ Unknown function:",f)}}catch(U){console.error("❌ Error executing function:",U),S("Errore nell'esecuzione del comando")}finally{setTimeout(()=>{p(!1),m(null),Ue(),!b&&!ye()&&(G.current=!1,c(!1),A.current=!1,Se.current&&!tt.current&&P.current.length===0&&cn())},200)}},[F,q,C,D,H,K,me,be,at,Cr,Er,rt,pe,b,ye]),Ue=d.useCallback(()=>{if(Je.current)return;const f=P.current.shift();f&&(Je.current=!0,setTimeout(async()=>{try{await an(f.name,f.params)}finally{Je.current=!1,P.current.length>0?Ue():Se.current&&!ye()&&!le.current&&!A.current&&Q.current&&Q.current()}},0))},[an,ye]),ns=d.useCallback(()=>{var Yt;if(!yr)return null;if(typeof navigator>"u"||!((Yt=navigator.mediaDevices)!=null&&Yt.getUserMedia))return console.warn("Media devices API not available for server STT fallback"),null;const f={start:null,result:null,error:null,end:null,audioend:null};let h=null,j=null,w=null,T=null,I=[],U=!1,M=nr,B=0,fe=0;const oe=(k,L)=>{const W=f[k];if(typeof W=="function")try{W(L)}catch(re){console.error(`Server STT listener ${k} failed`,re)}},ot=async()=>{if(w){try{w.disconnect()}catch(k){console.warn("Processor disconnect failed",k)}w.onaudioprocess=null}if(T)try{T.disconnect()}catch{}if(h)try{await h.close()}catch{}j&&j.getTracks().forEach(k=>{try{k.stop()}catch{}}),h=null,j=null,w=null,T=null},Xe=(k,L=0)=>{const W={transcript:k,confidence:L},X=[{0:W,length:1,isFinal:!0,item:()=>W}];return X.item=ee=>X[ee],{resultIndex:0,results:X}},Ye=async(k="stop",L=!0)=>{if(U)return;U=!0,Gt.current.active=!1;const W=I.slice();I=[];const re=M;if(await ot(),oe("audioend"),!L||W.length===0){L&&W.length===0&&oe("error",{error:"no-speech"}),oe("end"),U=!1;return}try{const X=Oc(W),ee=Fc(X,re,nr),te=Lc(ee),de=$c(te.buffer);if(!de)oe("error",{error:"no-speech"});else{const Y=await tr.transcribeAudio({audio:de,sampleRate:nr,language:"it-IT",sessionId:Ve.current}),Oe=((Y==null?void 0:Y.text)||"").trim(),Fe=typeof(Y==null?void 0:Y.confidence)=="number"?Y.confidence:0;Oe?oe("result",Xe(Oe,Fe)):oe("error",{error:"no-speech"})}}catch(X){console.error("Server STT transcription error",X),oe("error",{error:"network",message:(X==null?void 0:X.message)||"Errore nella trascrizione audio"})}oe("end"),U=!1},Xt={continuous:!1,interimResults:!0,lang:"it-IT",maxAlternatives:1,start:async()=>{if(Gt.current.active)return;try{j=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0}})}catch(L){console.error("Microphone permission denied",L),oe("error",{error:(L==null?void 0:L.name)||"not-allowed",message:L==null?void 0:L.message}),oe("end");return}const k=window.AudioContext||window.webkitAudioContext;if(!k){oe("error",{error:"audio-context-unavailable"}),oe("end");return}try{if(h=new k,h.state==="suspended")try{await h.resume()}catch{}M=h.sampleRate||nr,T=h.createMediaStreamSource(j),w=h.createScriptProcessor(4096,1,1),I=[],B=Date.now(),fe=B,w.onaudioprocess=L=>{if(!Gt.current.active)return;const W=L.inputBuffer.getChannelData(0);I.push(new Float32Array(W));let re=0;for(let te=0;te<W.length;te+=1){const de=W[te];re+=de*de}const X=Math.sqrt(re/W.length),ee=Date.now();X>.015?B=ee:ee-B>900&&I.length>4&&Ye("silence"),ee-fe>14e3&&Ye("timeout")},T.connect(w),w.connect(h.destination),Gt.current.active=!0,oe("start")}catch(L){console.error("Failed to init server STT pipeline",L),oe("error",{error:(L==null?void 0:L.name)||"unknown",message:L==null?void 0:L.message}),await ot(),oe("end")}},stop:()=>Ye("stop"),abort:()=>Ye("abort",!1)};return Object.defineProperties(Xt,{onstart:{get:()=>f.start,set:k=>{f.start=k}},onresult:{get:()=>f.result,set:k=>{f.result=k}},onerror:{get:()=>f.error,set:k=>{f.error=k}},onend:{get:()=>f.end,set:k=>{f.end=k}},onaudioend:{get:()=>f.audioend,set:k=>{f.audioend=k}}}),Xt},[yr,tr,Ve,Gt]),Tr=d.useCallback(()=>{if(yr)return ns();if(!At())return null;const f=window.SpeechRecognition||window.webkitSpeechRecognition,h=new f;h.continuous=!1,h.interimResults=!0,h.lang="it-IT",h.maxAlternatives=1,h.onstart=()=>{if(console.log("🎤 Recognition started"),ze(),Qe.current="",t(!0),S(null),O(!0),Rt.current=Date.now(),tt.current=!1,!ct.current){const w=Gn();ct.current=setTimeout(()=>{if(!le.current&&!A.current){const T=Qn(),I=()=>{const U=Wn();We.current=setTimeout(()=>{!le.current&&!A.current&&st()},U)};T?ue(T,()=>{I()},!1,{enqueue:!1,listeningProfile:"default"}):I()}},w)}};const j=(w=!1)=>{ze();const T=Qe.current.trim();if(T){if(Qe.current="",console.log("💬 User said:",T),Hn(),Zr.current=null,br.current=!1,x(T),Rr(),typeof nn.current=="function")try{nn.current(T)}catch(I){console.error("Voice command dispatch failed",I)}if(w&&R.current)try{R.current.stop()}catch{}}};return h.onresult=w=>{if(!le.current&&Jn.current){let T="",I="";for(let U=w.resultIndex;U<w.results.length;U++){const M=w.results[U][0].transcript;w.results[U].isFinal?T+=M:I+=M}I&&(x(I),ct.current&&(clearTimeout(ct.current),ct.current=null),We.current&&(clearTimeout(We.current),We.current=null)),T&&(Qe.current=`${Qe.current} ${T}`.trim(),ze(),vr.current=setTimeout(()=>j(!0),Ro))}},h.onerror=w=>{w.error!=="aborted"&&w.error!=="no-speech"&&(ze(),Qe.current="",w.error==="network"?S("Errore di connessione. Riprova."):S(`Errore microfono: ${w.error}`),t(!1))},h.onend=()=>{console.log("🔚 Recognition ended"),j(!1),ze(),Qe.current="",t(!1),Se.current&&!le.current&&!Je.current&&!tt.current&&!A.current&&!ye()&&!G.current&&!We.current&&P.current.length===0&&(lt(),setTimeout(()=>{Se.current&&!le.current&&!A.current&&!G.current&&!We.current&&Q.current&&Q.current()},ht?250:500))},h},[lt,ht,Qn,Gn,Wn,ze,At,ns,yr]),cn=d.useCallback(()=>{if(!(tt.current||!Se.current||le.current||Je.current||A.current||P.current.length>0||ye())){if(Zr.current||(Zr.current=`ls-${Date.now()}`,br.current=!1),br.current||(Xn(),br.current=!0),tt.current=!0,!hr&&R.current){try{R.current.stop()}catch{}R.current=null}setTimeout(()=>{if(Se.current&&!le.current&&!Je.current&&!A.current)try{if(R.current||(R.current=Tr()),R.current)try{R.current.start()}catch(f){console.warn("Recognition restart failed",f)}}catch(f){console.error("Failed to restart:",f)}tt.current=!1},220)}},[b,u,Tr,Xn,hr,ye]);d.useEffect(()=>{Q.current=cn},[cn]);const nt=d.useCallback(()=>{var f,h;if(mt.current){try{mt.current.onended=null,mt.current.stop(),(h=(f=mt.current).disconnect)==null||h.call(f)}catch(j){console.warn("Failed to stop server TTS source",j)}mt.current=null}Vt.current=!1,Tt.current=[],N(!1),le.current=!1,Ke()},[Ke]),st=d.useCallback(()=>{if(console.log("🛑 Stopping assistant"),R.current){try{R.current.stop()}catch{}R.current=null}if(typeof window<"u"&&window.speechSynthesis)try{window.speechSynthesis.cancel()}catch{}nt(),Te.current=[],qe.current&&(clearTimeout(qe.current),qe.current=null),Pe.current="",Ct.current=!1,$e.current&&(clearTimeout($e.current),$e.current=null),Hn(),ze(),Qe.current="",wr.current="",typeof Ke=="function"&&Ke(),t(!1),N(!1),p(!1),c(!1),se(!1),O(!0),Se.current=!1,tt.current=!1,P.current=[],G.current=!1,c(!1),A.current=!1,mr.current=[],He.current="",_t.current="",en.current={},De("default"),console.log("✅ Assistant stopped")},[ze,De,nt]),Rr=d.useCallback(()=>{Rt.current=Date.now(),$e.current&&clearTimeout($e.current),Se.current&&($e.current=setTimeout(()=>{Date.now()-Rt.current>=Zn?(console.log("⏰ Inactivity timeout reached"),ue("Sono ancora qui se hai bisogno. Dì qualcosa o chiuderò la conversazione.",()=>{setTimeout(()=>{Date.now()-Rt.current>=Zn+1e4&&st()},1e4)})):Rr()},Lo))},[st]);window.__AIVA_SINGLETON__||(window.__AIVA_SINGLETON__={ws:null,listeners:new Set,queue:[],lastFnSigTs:new Map});const Ie=window.__AIVA_SINGLETON__;d.useEffect(()=>{if(Ie.ws&&Ie.ws.readyState===WebSocket.OPEN)console.log("🔌 WebSocket reusing existing connection"),n(!0),ve.current=Ie.ws;else{const h=()=>{try{const j=Ni(Ve.current);Ie.ws=j,j.onopen=()=>{if(console.log("🔌 WebSocket connected"),n(!0),ve.current=j,Ie.queue&&Ie.queue.length){for(const w of Ie.queue)try{j.send(JSON.stringify(w))}catch{}Ie.queue=[]}},j.onmessage=w=>{try{const T=JSON.parse(w.data);Ie.listeners.forEach(I=>I(T))}catch(T){console.error("Parse error:",T)}},j.onerror=w=>{console.error("WebSocket error:",w)},j.onclose=()=>{console.log("WebSocket disconnected"),n(!1),ve.current=null,Ie.ws=null;let w=0;(()=>{if(w>=5)return;w+=1;const I=Math.min(1e3*Math.pow(2,w),1e4);setTimeout(()=>{h()},I)})()}}catch(j){console.error("Connection failed:",j)}};h()}const f=h=>{if(ge.current)try{ge.current(h)}catch(j){console.error(j)}};return Ie.listeners.add(f),()=>{Ie.listeners.delete(f)}},[]);const $o=f=>(f||"").replace(/```[\s\S]*?```/g," ").replace(/`[^`]*`/g," ").replace(/[\*_~>#-]+/g," ").replace(/\[(.*?)\]\((.*?)\)/g,"$1").replace(/\b\d+\s+(pezzi?|in\s+magazzino|disponibili)\b[^,.]*[.,]?/gi,"").replace(/(\btaglia\b[^.]*?)\s*(,\s*)?\b\d+\b[^.]*\./gi,"$1.").replace(/\bXXXL\b/gi,"ics ics ics elle").replace(/\bXXL\b/gi,"ics ics elle").replace(/\bXL\b/gi,"ics elle").replace(/\bXXS\b/gi,"ics ics esse").replace(/\bXS\b/gi,"ics esse").replace(/vuoi[^.?!]*(taglie|colori|materiali)[^.?!]*[.?!]/gi," ").replace(/\s{2,}/g," ").trim(),ss=d.useCallback(async()=>{if(!Ge)return null;const f=window.AudioContext||window.webkitAudioContext;if(!f)return null;Kr.current||(Kr.current=new f);const h=Kr.current;if(h.state==="suspended")try{await h.resume()}catch(j){console.warn("Unable to resume TTS audio context",j)}return h},[Ge]),os=d.useCallback(async()=>{if(!Vt.current&&Tt.current.length!==0){for(Vt.current=!0,lt(),Qt(),N(!0),le.current=!0,O(!1),$n.current=!0,sn();Tt.current.length>0;){const f=Tt.current[0];try{const h=await tr.synthesizeSpeech({text:f.text,voice:f.voice,sessionId:Ve.current}),j=h==null?void 0:h.audio;if(!j)throw new Error("tts-empty-response");const w=Mc(j),T=await ss();if(!T)throw new Error("audio-context-unavailable");const I=await new Promise((U,M)=>{const B=w.slice(0);T.decodeAudioData(B,U,M)});await new Promise(U=>{const M=T.createBufferSource();M.buffer=I,M.connect(T.destination),mt.current=M,M.onended=()=>{mt.current=null,U()},M.start(0)}),typeof f.onEnd=="function"&&f.onEnd()}catch(h){console.error("Server TTS playback error",h);const j=Xr.current;if(typeof window<"u"&&window.speechSynthesis&&typeof j=="function")try{j(f.text,f.onEnd,f.immediate,{enqueue:f.enqueue,listeningProfile:f.listeningProfile,forceBrowser:!0})}catch(T){console.error("Browser TTS fallback failed",T),typeof f.onEnd=="function"&&f.onEnd(h)}else typeof f.onEnd=="function"&&f.onEnd(h)}Tt.current.shift()}Ke(),N(!1),le.current=!1,Vt.current=!1,Et.current&&(Et.current=!1),pe()}},[ss,pe,lt,Qt,sn,Ke,tr]),_r=d.useCallback((f,h,j=!1,w={})=>{const T={text:f,onEnd:h,voice:(w==null?void 0:w.voice)||null,enqueue:(w==null?void 0:w.enqueue)??!1,listeningProfile:(w==null?void 0:w.listeningProfile)||null,immediate:j};j&&nt(),Tt.current.push(T),os()},[os,nt]),ue=d.useCallback((f,h,j=!1,w={})=>{const{enqueue:T=!1,listeningProfile:I,forceBrowser:U=!1}=w||{},M=$o(f);if(Sr(M,I),Dn&&!U){_r(M,h,j,{voice:I,enqueue:T,listeningProfile:I});return}if((typeof window>"u"||!window.speechSynthesis)&&!U){_r(M,h,j,{voice:I,enqueue:T,listeningProfile:I});return}try{if(lt(),Qt(),N(!0),le.current=!0,j){try{window.speechSynthesis.cancel()}catch{}Te.current=[]}if((T?jr(M):[M]).forEach(fe=>{if(!fe)return;const oe=new SpeechSynthesisUtterance(fe);oe.lang="it-IT",oe.rate=1,oe.pitch=1.1,oe.volume=.9,pr.current&&(oe.voice=pr.current),oe.onstart=()=>{N(!0),le.current=!0,O(!1),$n.current=!0,qe.current&&(clearTimeout(qe.current),qe.current=null),sn()},oe.onend=()=>{if(Te.current.shift(),Te.current.length>0){const ot=Te.current[0];try{ot&&window.speechSynthesis.speak(ot)}catch{}}Te.current.length===0&&(Ke(),N(!1),le.current=!1,Et.current&&(Et.current=!1,pe()),typeof h=="function"&&h())},Te.current.push(oe)}),!window.speechSynthesis.speaking){const fe=Te.current[0];fe&&window.speechSynthesis.speak(fe)}qe.current||(qe.current=setTimeout(()=>{!window.speechSynthesis.speaking&&Te.current.length===0&&(N(!1),le.current=!1,pe())},1500))}catch(B){console.error("Browser TTS failed, switching to server fallback",B),U?typeof h=="function"&&h(B):_r(M,h,!0,{voice:I,enqueue:T,listeningProfile:I})}},[Sr,_r,pe,lt,Qt,jr,Dn]);d.useEffect(()=>{Xr.current=ue},[ue]);const Kt=d.useCallback((f=!1)=>{const h=(Pe.current||"").replace(/\s+/g," ").trim();if(!h)return!1;const j=jr(h);if(!j.length)return!1;const w=[];let T=!1;return j.forEach((I,U)=>{const M=I.trim();if(!M)return;const B=/[\.!?…:]\s*$/.test(M);f||B||M.length>160?(ue(M,()=>{},!1,{enqueue:!0}),T=!0,Ct.current=!0):w.push(M)}),Pe.current=w.join(" "),T},[jr,ue]),is=d.useCallback(f=>{var h,j;if(Se.current){if(console.log("📨 WebSocket message:",f.type),Ht.current&&f.type!=="processing_start"){console.log("⏭️ Dropped stale WS message:",f.type);return}switch(i(w=>[...w,f]),Rt.current=Date.now(),f.type){case"processing_start":{c(!0),A.current=!0,O(!1),ce.current=!1,Qt(),Me.current="",Pe.current="",Ct.current=!1,He.current="",_t.current="",Ht.current=!1;break}case"function_start":break;case"stream_start":{Me.current="",Pe.current="",Ct.current=!1,He.current="",fr.current=!0,Et.current=!1;break}case"text_chunk":{if(typeof f.content=="string"){const w=(f.content||"").trim();w&&(He.current=`${He.current} ${w}`.trim(),Me.current=`${Me.current} ${w}`.trim(),Pe.current=`${Pe.current} ${w}`.trim(),Kt(!1)&&(ce.current=!0))}break}case"stream_complete":{Kt(!0)&&(ce.current=!0),fr.current=!1,Et.current=!0,Me.current="",Pe.current="",!ye()&&Te.current.length===0&&(c(!1),A.current=!1,pe());break}case"function_complete":{const T=((M,B)=>{try{return`${M}:${JSON.stringify(B)}`}catch{return`${M}:<unserializable>`}})(f.function,f.parameters||{}),I=Date.now(),U=(((h=window.__AIVA_SINGLETON__)==null?void 0:h.lastFnSigTs)||new Map).get(T)||0;if(window.__AIVA_SINGLETON__){if(I-U<1500)break;window.__AIVA_SINGLETON__.lastFnSigTs.set(T,I)}if(c(!1),A.current=!1,f.function&&f.parameters){const M=(Mn.current||"").toLowerCase();if(/(carrello|svuota|rimuovi|togli|elenca|prodotti nel carrello)/.test(M)&&f.function==="navigate_to_page"&&((j=f.parameters)==null?void 0:j.page)==="prodotti")break;if(/^(sì|si|ok|va bene|perfetto|d'accordo|come no|certo|ottimo|grazie|no grazie|basta cos[ìi]|tutto ok|tutto bene|va benissimo|benissimo)[!.\s]*$/.test(M.trim())&&["navigate_to_page","navigate","search_products","get_product_details"].includes(f.function)){console.log("⏭️ Ignoro funzione non richiesta dopo conferma breve");break}P.current.push({name:f.function,params:f.parameters})}else ue("Ok. Puoi ripetere la richiesta con qualche dettaglio in più?",()=>{G.current=!1,pe()},!1,{enqueue:!1});break}case"response":{if(f.message){const w=(f.message||"").trim();if(w){He.current||(He.current=w);const T=f.streamed?He.current:w;T&&_t.current!==T&&(on(T),_t.current=T),f.streamed?Kt(!0)&&(ce.current=!0):(c(!0),A.current=!0,ce.current=!0,ue(w,()=>{c(!1),A.current=!1,pe()},!1,{enqueue:!1}))}}break}case"complete":{if(Kt(!0)&&(ce.current=!0),f.message){const T=(f.message||"").trim();T&&(He.current||(He.current=T),_t.current!==T&&(on(T),_t.current=T),!Ct.current&&!f.streamed&&(ce.current=!0,ue(T,()=>{c(!1),A.current=!1,pe()},!1,{enqueue:!1})))}else!fr.current&&Te.current.length===0&&!ye()?(c(!1),A.current=!1,pe()):(qe.current&&clearTimeout(qe.current),qe.current=setTimeout(()=>{c(!1),A.current=!1,pe()},1500));P.current.length>0&&!Je.current&&Ue();break}case"error":{if(typeof window<"u"&&window.speechSynthesis)try{window.speechSynthesis.cancel()}catch{}nt(),Te.current=[],N(!1),le.current=!1,c(!1),A.current=!1,G.current=!1,Pe.current="",Ct.current=!1,S(f.message||"Errore"),pe();break}}}},[ue,an,st,on,Kt,pe,ye,nt]);d.useEffect(()=>{ge.current=is},[is]);const as=d.useCallback(async f=>{var h;try{if((f==null?void 0:f.type)==="voice_command"){const j=await tr.processVoiceCommand(f.text,f.context,(h=f.context)==null?void 0:h.session_id),w=Array.isArray(j==null?void 0:j.events)?j.events:[];if(w.length===0){ge.current&&ge.current({type:"error",message:"Risposta vuota dal server vocale"});return}for(const T of w)try{ge.current&&ge.current(T)}catch{}}}catch(j){console.error("HTTP voice command failed",j),ge.current&&ge.current({type:"error",message:"Errore richiesta voce"})}},[]),cs=d.useCallback(async f=>{var h,j,w,T,I,U,M;if(f.trim()){Mn.current=f,De("task");try{if(le.current||ye()){if(typeof window<"u"&&window.speechSynthesis)try{window.speechSynthesis.cancel()}catch{}nt(),typeof Ke=="function"&&Ke(),Te.current=[],Me.current="",Ht.current=!0,G.current=!1,c(!1),A.current=!1,N(!1),le.current=!1}if(G.current||A.current){console.log("🔒 Ignoro comando: turno in corso"),Q.current&&Q.current();return}if(We.current){console.log("⏳ Ignoro comando: chiusura in corso");return}G.current=!0;const B=f.toLowerCase(),fe=/(apri|mostra|vai|portami).*(il\s+)?carrello|^carrello$/,oe=/(apri|mostra|vai|portami).*(offerte|in offerta|sconti)|^(offerte|sconti|saldi)$/,ot=/(torna|vai).*(home|pagina iniziale)|^home$/,Xe=/((apri|mostra|vai|portami).*(pagina\s+)?prodotti(?!.*carrello))|^tutti i prodotti$|^prodotti$|^catalogo$|^mostra tutto$|^mostrami tutto$/,Ye=[/descrivimi/i,/descrivilo/i,/descrivila/i,/descriv[iy]/i,/descrizione/i,/dettagli/i,/informazioni?(?: sul| del)? prodotto/i,/leggi .*descrizione/i,/dimmi .*descrizione/i,/mostra .*descrizione/i],Xt=/(elenca|leggi|dimmi|quali|mostra).*(prodotti|articoli).*(nel\s+)?carrello|cosa.*(c\s'?|è|ho).*(nel\s+)?carrello/,Yt=/(svuota|svuotare|svuotalo|svuotami|rimuovi|togli|cancella).*(tutti|tutto)?.*(prodotti|articoli)?.*(dal\s+)?carrello/,k=/(?:mostra|apri).*(?:il\s+)?prodotto\s+(.+)/,L=(ne="")=>ne.toString().normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").toLowerCase().replace(/[^a-z0-9]+/g," ").trim(),W=/(aggiungi|metti|mettilo|mettila).*(nel\s+)?carrello(?::|\s|\,)*(?:.*?(taglia)\s+([xslm]{1,3}|xs|xxs|xl|xxl|s|m|l))?(?:.*?(colore)\s+([a-zà-ù\s]+))?/i,re={xs:"XS",xxs:"XXS",s:"S",m:"M",l:"L",xl:"XL",xxl:"XXL"},X={nero:"nero",black:"nero",bianco:"bianco",white:"bianco",blu:"blu","blu navy":"blu navy",navy:"blu navy","blu scuro":"blu navy",azzurro:"azzurro",rosso:"rosso",borgogna:"bordeaux",bordeaux:"bordeaux","verde militare":"verde militare",militare:"verde militare",verde:"verde","verde oliva":"verde oliva",oliva:"verde oliva",grigio:"grigio","grigio melange":"grigio melange",melange:"grigio melange",antracite:"grigio antracite",beige:"beige",panna:"panna",crema:"panna",cammello:"cammello",rosa:"rosa",marrone:"marrone",giallo:"giallo",viola:"viola",kaki:"kaki",khaki:"kaki",cachi:"kaki",caqui:"kaki"},ee={uno:1,una:1,un:1,due:2,tre:3,quattro:4,cinque:5,sei:6,sette:7,otto:8,nove:9,dieci:10},te=(ne="")=>{const Z=ne.normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").toLowerCase().trim(),he=Object.keys(X).sort((xe,je)=>je.length-xe.length);for(const xe of he)if(Z.includes(xe))return X[xe];return Z||void 0},de=(ne="")=>{const Z=ne.normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").toLowerCase();if(!Z)return[];const he=Object.keys(X).sort((we,ut)=>ut.length-we.length),xe=[];let je=Z;for(const we of he)if(je.includes(we)){const ut=X[we];xe.includes(ut)||xe.push(ut),je=je.replace(we," ")}return xe},Y=(ne="")=>{const Z=ne.normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").toLowerCase(),he=Z.match(/(?:aggiungi|aggiungine|metti|mettimene|mettil[oa])(.*)/),xe=he?he[1]:Z,je=xe.match(/(\d{1,2})\s*(?:pezzi|articoli|prodotti|paia|capi)?/);if(je){const we=parseInt(je[1],10);if(!Number.isNaN(we))return we}for(const[we,ut]of Object.entries(ee))if(new RegExp(`\\b${we}\\b`,"i").test(xe))return ut;return null};if(fe.test(B)){G.current=!0,c(!0),A.current=!0,P.current.push({name:"get_cart_summary",params:{}}),Ue();return}if(Xt.test(B)){G.current=!0,c(!0),A.current=!0;const ne=qs(6);ue(ne,()=>{c(!1),A.current=!1,G.current=!1,pe()},!1,{enqueue:!1});return}if(oe.test(B)){G.current=!0,c(!0),A.current=!0,P.current.push({name:"show_offers",params:{}}),Ue();return}if(ot.test(B)){G.current=!0,c(!0),A.current=!0,P.current.push({name:"navigate_to_page",params:{page:"home"}}),Ue();return}if(Yt.test(B)){G.current=!0,c(!0),A.current=!0,P.current.push({name:"clear_cart",params:{}}),Ue();return}if(Xe.test(B)){const ne=/(tutti|mostra tutto|mostrami tutto|catalogo)/.test(B);c(!0),A.current=!0;const Z={page:"prodotti"};ne&&(Z.resetFilters=!0),P.current.push({name:"navigate_to_page",params:Z}),Ue();return}if((()=>{var ne;return(ne=window.currentProductContext)!=null&&ne.description_text?!!(Ye.some(Z=>Z.test(B))||B.includes("descrizione")&&(B.includes("prodotto")||B.includes("articolo"))||B.includes("descrivi")&&(B.includes("prodotto")||B.includes("articolo"))):!1})()){G.current=!0,c(!0),A.current=!0;try{const ne=await tn(),Z=ne&&typeof ne=="object"?ne:window.currentProductContext||{};let he=Z==null?void 0:Z.description_text;if(!he&&(Z!=null&&Z.product)){const we=Nn(Z,Z.product);window.currentProductContext=we,he=we.description_text}const xe=(Z==null?void 0:Z.name)||((h=Z==null?void 0:Z.product)==null?void 0:h.name)||"prodotto",je=he?`${xe}. ${he}`.slice(0,900):`Non riesco a trovare ulteriori dettagli su ${xe}. Posso aiutarti in altro modo?`;ue(je,()=>{c(!1),A.current=!1,pe()},!1,{enqueue:!1})}catch(ne){console.error("Errore descrizione prodotto:",ne),ue("Non sono riuscita a recuperare la descrizione del prodotto.",()=>{c(!1),A.current=!1,pe()},!1,{enqueue:!1})}return}if(W.test(f)&&((j=window.currentProductContext)!=null&&j.id)){const ne=Array.isArray((w=window.currentProductContext)==null?void 0:w.variants)?window.currentProductContext.variants:[],Z=((T=ne[0])==null?void 0:T.size)||"M",he=((I=ne[0])==null?void 0:I.color)||"nero",xe=Y(f),je=jn(xe??1,1),we=(ae="")=>{const Ne=ae.toLowerCase().replace(/[^a-z0-9]/g,"");return(re[Ne]||ae||Z||"M").toString().toUpperCase()},ut=new Set(ne.map(ae=>(ae.color||"").toLowerCase())),Ar=(ae="")=>{const Ne=de(ae);let Re=Ne.find(ft=>ut.has(ft.toLowerCase()))||Ne[0]||te(ae);Re||(Re=he||"nero");const dt=ne.find(ft=>(ft.color||"").toLowerCase()===Re.toLowerCase());return(dt==null?void 0:dt.color)||Re},qo=ae=>{const Re=Math.max(0,ae-40),dt=Math.min(f.length,ae+40),ft=f.slice(Re,dt).normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").toLowerCase(),kr=ft.match(/(\d{1,2})\s*(pezzi|pezzo|articoli|prodotti|paia|capi)?/);if(kr){const zt=parseInt(kr[1],10);if(Number.isFinite(zt))return zt}for(const[zt,Vo]of Object.entries(ee))if(new RegExp(`\b${zt}\b`,"i").test(ft))return Vo;return null},xt=[],ls=new Set,ln=ae=>{if(!ae||!ae.size)return;const Ne=`${ae.size.toUpperCase()}|${(ae.color||"").toLowerCase()}`;if(ls.has(Ne))return;ls.add(Ne);const Re=jn(ae.quantity??je,je);xt.push({size:ae.size.toUpperCase(),color:ae.color,quantity:Re})},un=f.match(W);if(un){const ae=we(un[4]||Z),Ne=Ar(un[6]||he);ln({size:ae,color:Ne,quantity:je})}const Do=/taglia\s+([a-z0-9]{1,3}|xxs|xs|s|m|l|xl|xxl|xxxl)/gi;Array.from(f.matchAll(Do)).forEach(ae=>{const Ne=ae.index??0,Re=ae[1]||"",dt=f.slice(Ne,Ne+120),ft=qo(Ne),kr=we(Re||Z),zt=Ar(dt||he);ln({size:kr,color:zt,quantity:ft??je})}),xt.length===0&&ln({size:we(Z),color:Ar(he),quantity:je});const Uo=window.currentProductContext.id,Bo=((U=window.currentProductContext)==null?void 0:U.name)||"questo prodotto",us=xt.length>1?`Ho aggiunto ${xt.length} varianti di ${Bo} al carrello.`:null;G.current=!0,c(!0),A.current=!0,xt.forEach((ae,Ne)=>{const Re=Ne===xt.length-1;P.current.push({name:"add_to_cart",params:{product_id:Uo,size:ae.size,color:ae.color,quantity:ae.quantity,skipAck:xt.length>1&&!Re,overrideAck:Re&&us?us:void 0}})}),Ue();return}const Fe=B.match(k);if(Fe&&Fe[1]){const ne=L(Fe[1]),Z=window.visibleProductsMap||{};let he=null;if(Z[ne])he=Z[ne];else for(const xe of Object.keys(Z))if(xe.includes(ne)){he=Z[xe];break}if(he){G.current=!0,c(!0),A.current=!0,P.current.push({name:"get_product_details",params:{product_id:he}}),Ue();return}}const it=B.trim();if(/(basta|chiudi|puoi andare|stop|non.*altro|alla prossima|ci sentiamo|puoi riposarti)/i.test(B)||/^(grazie( mille)?( di tutto)?(,? (ciao|a presto|alla prossima|buona giornata|buona serata))?|ti ringrazio(,? (ciao|a presto|alla prossima|buona giornata|buona serata))?)$/.test(it)||/^ciao(?:\s+(?:e\s+)?(grazie|alla prossima|per ora|ti ringrazio|a presto|buona serata|buona giornata).*)$/.test(it)){ue("Perfetto, alla prossima!",()=>st());return}i(ne=>[...ne,{type:"user",text:f,timestamp:new Date().toISOString()}]),x(""),as({type:"voice_command",text:f,context:{session_id:Ve.current,timestamp:new Date().toISOString(),current_page:window.location.pathname,cart_count:((M=window.cartSnapshot)==null?void 0:M.length)??Le.getState().cartCount,cart:window.cartSnapshot||[],cart_items_map:window.cartItemsMap||{},preferences:Le.getState().preferences,session_count:$,current_product:window.currentProductContext||null,visible_products:window.visibleProductIds||[],visible_products_map:window.visibleProductsMap||{},ui_filters:{q:window.productsSearchQuery||"",category:window.productsSelectedCategory||""},history:mr.current.slice(-12)}}),rs(f)}catch(B){console.error("Voice command handling error:",B),c(!1),A.current=!1,G.current=!1,pe()}}},[as,$,ue,st,rs,pe,tn,De,ye,nt,Vn,Ue,qs]);d.useEffect(()=>{nn.current=cs},[cs]);const Mo=d.useCallback(async()=>{if(console.log("🎤 Toggle listening:",e,"Active:",V),!At()){S("Browser non supporta il riconoscimento vocale");return}if(S(null),e||V)st();else{console.log("▶️ Starting assistant"),se(!0),Se.current=!0,tt.current=!1,De("default"),wr.current="",Qe.current="",ze(),Rr();try{if((await navigator.mediaDevices.getUserMedia({audio:!0})).getTracks().forEach(j=>j.stop()),await lt(),R.current||(R.current=Tr()),R.current)try{R.current.start()}catch(j){console.warn("Initial recognition start failed",j)}const h=es();ue(h,()=>{setTimeout(()=>{Se.current&&!A.current&&!Je.current&&!ye()&&Q.current&&Q.current(),setTimeout(()=>Jt(),180)},250)},!0,{enqueue:!1}),G.current=!1}catch(f){console.error("Microphone error:",f),S("Permessi microfono negati"),se(!1),Se.current=!1}}},[e,V,Tr,ue,es,st,Rr,lt,De,ze,ye,Jt]);return d.useEffect(()=>()=>{R.current&&R.current.stop(),typeof window<"u"&&window.speechSynthesis&&window.speechSynthesis.cancel(),nt(),ve.current&&ve.current.close(),$e.current&&clearTimeout($e.current)},[]),{isListening:e,isConnected:r,messages:o,isProcessing:a,isExecutingFunction:u,currentFunction:l,error:v,transcript:y,isSpeaking:b,isUserTurn:E,isAssistantActive:V,toggleListening:Mo,clearError:()=>S(null),browserSupportsSpeechRecognition:At()}},Uc=({isListening:e,isConnected:t,error:r,onToggleListening:n,browserSupportsSpeechRecognition:o,isAssistantActive:i})=>{const[a,c]=d.useState(!1),u=()=>{if(!o){console.warn("Speech recognition not supported"),alert("Il riconoscimento vocale non è disponibile nel tuo browser. Prova con Chrome o Edge per la migliore esperienza.");return}n()},l=r?{bg:"bg-gradient-to-r from-red-500 to-red-600",pulse:!1,icon:fi,tooltip:"Errore - Clicca per riprovare"}:i?e?{bg:"bg-gradient-to-r from-blue-500 to-purple-500",pulse:!0,icon:Ft,tooltip:"In ascolto - Clicca per fermare"}:{bg:"bg-gradient-to-r from-purple-500 to-pink-500",pulse:!1,icon:Js,tooltip:"AIVA attiva - Clicca per chiudere"}:{bg:"bg-gradient-to-r from-blue-600 to-purple-600",pulse:!1,icon:Ft,tooltip:"Attiva AIVA - Il tuo Personal Shopper AI"};return s.jsxs(_.div,{className:"fixed bottom-4 right-4 md:bottom-8 md:right-8 z-[120] pointer-events-auto",style:{bottom:"calc(env(safe-area-inset-bottom, 0px) + 1rem)",right:"calc(env(safe-area-inset-right, 0px) + 1rem)"},initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},transition:{delay:.5,type:"spring",stiffness:260,damping:20},children:[s.jsxs(_.button,{onClick:u,onHoverStart:()=>c(!0),onHoverEnd:()=>c(!1),className:`relative group ${l.bg} p-6 rounded-full shadow-2xl text-white overflow-hidden`,whileHover:{scale:1.1},whileTap:{scale:.95},disabled:!1,children:[s.jsx(_.div,{className:"absolute inset-0 bg-gradient-to-r from-pink-500 via-purple-500 to-blue-500",animate:{backgroundPosition:l.pulse?["0% 50%","100% 50%","0% 50%"]:["0% 50%"]},transition:{duration:2,repeat:l.pulse?1/0:0,ease:"linear"},style:{backgroundSize:"200% 200%"}}),l.pulse&&s.jsxs(s.Fragment,{children:[s.jsx(_.span,{className:"absolute inset-0 rounded-full border-4 border-white",animate:{scale:[1,2.2],opacity:[.6,0]},transition:{duration:1.5,repeat:1/0,ease:"easeOut"}}),s.jsx(_.span,{className:"absolute inset-0 rounded-full border-4 border-white",animate:{scale:[1,2.2],opacity:[.6,0]},transition:{duration:1.5,repeat:1/0,ease:"easeOut",delay:.5}})]}),s.jsx(_.div,{className:"relative z-10",animate:{rotate:l.pulse?[0,10,-10,0]:0,scale:i?[1,1.1,1]:1},transition:{duration:.8,repeat:l.pulse?1/0:0},children:s.jsx(l.icon,{size:28})}),a&&t&&s.jsx(_.div,{className:"absolute -top-1 -right-1",initial:{scale:0},animate:{scale:1},exit:{scale:0},children:s.jsx(sr,{className:"text-yellow-300",size:20})})]}),s.jsx(ar,{children:a&&s.jsxs(_.div,{initial:{opacity:0,y:10,scale:.9},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:10,scale:.9},className:"absolute bottom-full mb-3 right-0 bg-gray-900 text-white text-sm py-2 px-4 rounded-lg whitespace-nowrap max-w-xs",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(sr,{size:16,className:"text-yellow-300 flex-shrink-0"}),s.jsx("span",{children:l.tooltip})]}),s.jsx("div",{className:"absolute bottom-0 right-8 transform translate-y-1/2 rotate-45 w-2 h-2 bg-gray-900"})]})}),s.jsx("div",{className:`absolute bottom-1 right-1 w-3 h-3 rounded-full border-2 border-white ${t?"bg-green-400":"bg-yellow-400"}`,title:t?"Connesso":"In connessione..."}),r&&s.jsx(_.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"absolute bottom-full mb-2 right-0 bg-red-500 text-white text-sm py-2 px-4 rounded-lg whitespace-nowrap max-w-xs",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Mt,{size:16}),s.jsx("span",{children:r})]})})]})},Bc=({cartItemsCount:e})=>{const[t,r]=d.useState(!1),n=_(qr),o=[{id:"products",label:"Prodotti",icon:"📦",path:"/products"},{id:"offers",label:"Offerte",icon:"🏷️",path:"/offers"},{id:"cart",label:"Carrello",icon:"🛒",path:"/cart",badge:e}];return s.jsxs(_.nav,{className:"sticky top-0 z-40 bg-white shadow-sm",initial:{y:-100},animate:{y:0},transition:{type:"spring",stiffness:100},children:[s.jsx("div",{className:"max-w-7xl mx-auto px-4",children:s.jsxs("div",{className:"flex items-center justify-between h-16",children:[s.jsxs("div",{className:"flex items-center gap-8",children:[s.jsx(n,{to:"/",className:"text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-purple-600 cursor-pointer select-none",whileHover:{scale:1.05},style:{userSelect:"none",WebkitUserSelect:"none"},children:"AIVA Fashion"}),s.jsx("div",{className:"hidden md:flex items-center gap-6",children:o.map(i=>s.jsx(ds,{to:i.path,className:({isActive:a})=>`text-gray-700 hover:text-blue-600 transition ${a?"text-blue-600 font-semibold":""}`,children:i.label},i.id))})]}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("button",{className:"p-2 text-gray-600 hover:text-blue-600",children:s.jsx(Qs,{size:20})}),s.jsx("button",{className:"p-2 text-gray-600 hover:text-blue-600",children:s.jsx(ui,{size:20})}),s.jsxs(qr,{to:"/cart",className:"relative p-2 text-gray-600 hover:text-blue-600",children:[s.jsx(Dr,{size:20}),e>0&&s.jsx(_.span,{initial:{scale:0},animate:{scale:1},className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center",children:e})]}),s.jsx("button",{onClick:()=>r(!t),className:"md:hidden p-2 text-gray-600",children:t?s.jsx(Mt,{size:20}):s.jsx(di,{size:20})})]})]})}),s.jsx(ar,{children:t&&s.jsx(_.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"md:hidden bg-white border-t",children:s.jsx("div",{className:"px-4 py-4 space-y-2",children:o.map(i=>s.jsxs(ds,{to:i.path,className:({isActive:a})=>`block py-2 px-3 rounded-lg text-gray-700 hover:text-blue-600 hover:bg-blue-50 ${a?"text-blue-600 font-semibold bg-blue-50":""}`,onClick:()=>r(!1),children:[s.jsx("span",{className:"mr-2",children:i.icon}),i.label,i.badge>0&&s.jsx("span",{className:"ml-2 bg-red-500 text-white text-xs rounded-full px-2 py-1",children:i.badge})]},i.id))})})})]})},Vc=()=>{const e=()=>{try{window.scrollTo({top:0,behavior:"smooth"})}catch{}};return s.jsxs("footer",{className:"bg-gray-900 text-gray-300 py-12 px-4",children:[s.jsxs("div",{className:"max-w-7xl mx-auto grid md:grid-cols-3 gap-8",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-white font-bold text-xl mb-4",children:"AIVA Fashion"}),s.jsx("p",{className:"text-sm",children:"Concept interattivo per portfolio – non è un e‑commerce reale."})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"text-white font-semibold mb-4",children:"Info"}),s.jsx("p",{className:"text-sm leading-6",children:"Questo sito è un progetto dimostrativo creato da Michele Miranda per mostrare integrazione tra assistente vocale, AI e interfaccia e‑commerce. I prodotti, i prezzi e le promozioni hanno scopo illustrativo."})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"text-white font-semibold mb-4",children:"Shop"}),s.jsxs("ul",{className:"space-y-2 text-sm",children:[s.jsx("li",{children:s.jsx(qr,{to:"/products",className:"hover:text-white transition",children:"Prodotti"})}),s.jsx("li",{children:s.jsx(qr,{to:"/offers",className:"hover:text-white transition",children:"Offerte"})}),s.jsx("li",{children:s.jsx("button",{onClick:e,className:"hover:text-white transition",children:"Torna Su"})})]})]})]}),s.jsx("div",{className:"max-w-7xl mx-auto mt-8 pt-8 border-t border-gray-800 text-center text-sm",children:s.jsx("p",{children:"© 2025 AIVA Fashion – Concept per il portfolio di Michele Miranda"})})]})};function Hc(){const e=Wo(),{cartCount:t}=Bt(),{isListening:r,isConnected:n,messages:o,isProcessing:i,isExecutingFunction:a,currentFunction:c,error:u,isSpeaking:p,isAssistantActive:l,toggleListening:m,clearError:v,browserSupportsSpeechRecognition:S}=Dc();d.useEffect(()=>{if(u){const x=setTimeout(()=>{v()},5e3);return()=>clearTimeout(x)}},[u,v]);const y=()=>{console.log("🔴 App: Closing assistant completely"),m()};return s.jsxs("div",{className:"min-h-screen bg-gray-50",children:[s.jsx(Bc,{cartItemsCount:t}),s.jsx(ar,{mode:"wait",children:s.jsx(_.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:s.jsxs(Qo,{children:[s.jsx(Zt,{path:"/",element:s.jsx(bi,{onVoiceToggle:m})}),s.jsx(Zt,{path:"/products",element:s.jsx(Tc,{})}),s.jsx(Zt,{path:"/products/:id",element:s.jsx(Pc,{})}),s.jsx(Zt,{path:"/offers",element:s.jsx(_c,{})}),s.jsx(Zt,{path:"/cart",element:s.jsx(kc,{})})]})},e.pathname)}),s.jsx(Vc,{}),s.jsx(Uc,{isListening:r,isConnected:n,error:u,onToggleListening:m,browserSupportsSpeechRecognition:S,isAssistantActive:l}),l&&s.jsx(zc,{isListening:r,isProcessing:i,isConnected:n,isSpeaking:p,isExecutingFunction:a,currentFunction:c,messages:o,error:u,onClose:y,isAssistantActive:l})]})}var Gc=pi();const No=In(Gc);typeof globalThis.regeneratorRuntime>"u"&&(globalThis.regeneratorRuntime=No);typeof window<"u"&&(window.regeneratorRuntime=No);console.log("Polyfills loaded successfully");const Wc=Us.Fragment;xi.createRoot(document.getElementById("root")).render(s.jsx(Wc,{children:s.jsx(Jo,{children:s.jsx(Hc,{})})}));
//# sourceMappingURL=index-CmHok1Lo.js.map
