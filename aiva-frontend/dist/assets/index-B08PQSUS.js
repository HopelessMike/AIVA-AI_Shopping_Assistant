import{a as kn,b as Go,g as Pn,R as Hs,r as d,u as or,c as Wo,d as Qo,e as Jo,f as Zt,L as Lr,N as ms,B as Ko}from"./react-vendor-Bydu6J3a.js";import{m as _,A as ir}from"./animation-DoJXsEng.js";import{M as Ot,S as $t,a as Xo,b as $r,H as qr,c as St,G as Yo,d as Dr,P as Zo,C as ei,Z as Gs,F as hs,e as ti,L as ri,X as Mt,T as Ws,f as Qs,g as ni,A as si,h as Js,i as Ks,j as oi,k as ii,R as ai,l as ci,m as ln,n as Xs,N as li,V as Ys,o as ui,U as di,p as fi,q as pi}from"./ui-DjfJgPDo.js";import{r as mi}from"./voice-BWufaHyz.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function r(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(o){if(o.ep)return;o.ep=!0;const i=r(o);fetch(o.href,i)}})();var un={exports:{}},er={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gs;function hi(){if(gs)return er;gs=1;var e=kn(),t=Symbol.for("react.element"),r=Symbol.for("react.fragment"),n=Object.prototype.hasOwnProperty,o=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function a(c,u,f){var l,m={},v=null,S=null;f!==void 0&&(v=""+f),u.key!==void 0&&(v=""+u.key),u.ref!==void 0&&(S=u.ref);for(l in u)n.call(u,l)&&!i.hasOwnProperty(l)&&(m[l]=u[l]);if(c&&c.defaultProps)for(l in u=c.defaultProps,u)m[l]===void 0&&(m[l]=u[l]);return{$$typeof:t,type:c,key:v,ref:S,props:m,_owner:o.current}}return er.Fragment=r,er.jsx=a,er.jsxs=a,er}var ys;function gi(){return ys||(ys=1,un.exports=hi()),un.exports}var s=gi(),_r={},xs;function yi(){if(xs)return _r;xs=1;var e=Go();return _r.createRoot=e.createRoot,_r.hydrateRoot=e.hydrateRoot,_r}var xi=yi();const bi=Pn(xi),wi=({onVoiceToggle:e})=>s.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 via-blue-50 to-indigo-100",children:[s.jsx(_.section,{className:"relative overflow-hidden py-20 px-4",initial:{opacity:0},animate:{opacity:1},transition:{duration:.8},children:s.jsx("div",{className:"max-w-7xl mx-auto",children:s.jsxs("div",{className:"relative z-10 text-center",children:[s.jsxs(_.h1,{className:"text-6xl md:text-7xl font-bold mb-8",initial:{y:50,opacity:0},animate:{y:0,opacity:1},transition:{delay:.2,duration:.8},children:[s.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-purple-600 to-blue-600",children:"Il Futuro dello Shopping"}),s.jsx("br",{}),s.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-purple-600",children:"è Vocale"})]}),s.jsx(_.p,{className:"text-xl md:text-2xl text-gray-700 mb-12 max-w-4xl mx-auto leading-relaxed",initial:{y:30,opacity:0},animate:{y:0,opacity:1},transition:{delay:.4,duration:.8},children:"Scopri AIVA, il tuo personal shopper AI che ti aiuta a trovare l'outfit perfetto con comandi vocali in italiano."}),s.jsx(_.div,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},transition:{delay:.6,duration:.8,type:"spring",stiffness:200},className:"mb-16",children:s.jsxs(_.button,{onClick:e,className:"group relative px-12 py-6 bg-gradient-to-r from-purple-600 to-blue-600 text-white text-2xl font-bold rounded-full shadow-2xl hover:shadow-purple-500/25 transform transition-all duration-300",whileHover:{scale:1.05,boxShadow:"0 20px 40px rgba(147, 51, 234, 0.3)"},whileTap:{scale:.95},children:[s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsxs(_.div,{className:"relative",animate:{rotate:[0,10,-10,0]},transition:{duration:2,repeat:1/0},children:[s.jsx(Ot,{size:32}),s.jsx(_.div,{className:"absolute -inset-2 bg-white/20 rounded-full",animate:{scale:[1,1.2,1]},transition:{duration:1.5,repeat:1/0}})]}),s.jsx("span",{children:"Inizia Shopping Vocale"}),s.jsx($t,{size:24,className:"text-yellow-300"})]}),s.jsx(_.div,{className:"absolute inset-0 rounded-full bg-white/20",initial:{scale:0,opacity:1},animate:{scale:2,opacity:0},transition:{duration:1,repeat:1/0,delay:.5}})]})}),s.jsxs("div",{className:"absolute inset-0 pointer-events-none hidden md:block z-0",children:[s.jsx(_.div,{className:"absolute top-16 left-8 text-pink-400",animate:{y:[0,-15,0],rotate:[0,10,0]},transition:{duration:3,repeat:1/0},children:s.jsx(Xo,{size:64})}),s.jsx(_.div,{className:"absolute top-24 right-12 text-purple-400",animate:{y:[0,20,0],rotate:[0,-8,0]},transition:{duration:4,repeat:1/0,delay:.5},children:s.jsx($r,{size:56})}),s.jsx(_.div,{className:"absolute top-32 left-1/4 text-blue-400",animate:{y:[0,-10,0],rotate:[0,5,0]},transition:{duration:2.5,repeat:1/0,delay:1},children:s.jsx(qr,{size:70})}),s.jsx(_.div,{className:"absolute top-48 right-8 text-green-400",animate:{y:[0,15,0],rotate:[0,-12,0]},transition:{duration:3.5,repeat:1/0,delay:.3},children:s.jsx(St,{size:60})}),s.jsx(_.div,{className:"absolute top-56 left-12 text-yellow-400",animate:{y:[0,-20,0],rotate:[0,8,0]},transition:{duration:2.8,repeat:1/0,delay:.8},children:s.jsx(Yo,{size:60})}),s.jsx(_.div,{className:"absolute top-64 right-1/3 text-red-400",animate:{y:[0,12,0],rotate:[0,-6,0]},transition:{duration:3.2,repeat:1/0,delay:1.2},children:"              "}),s.jsx(_.div,{className:"absolute bottom-48 left-16 text-indigo-400",animate:{y:[0,-18,0],rotate:[0,7,0]},transition:{duration:2.7,repeat:1/0,delay:.6},children:s.jsx(Dr,{size:50})}),s.jsx(_.div,{className:"absolute bottom-40 right-16 text-orange-400",animate:{y:[0,14,0],rotate:[0,-9,0]},transition:{duration:3.8,repeat:1/0,delay:1.1},children:s.jsx(Zo,{size:50})}),s.jsx(_.div,{className:"absolute bottom-32 left-1/3 text-cyan-400",animate:{y:[0,-16,0],rotate:[0,11,0]},transition:{duration:2.9,repeat:1/0,delay:.4}}),s.jsx(_.div,{className:"absolute bottom-24 right-1/4 text-rose-400",animate:{y:[0,22,0],rotate:[0,-7,0]},transition:{duration:3.3,repeat:1/0,delay:.9},children:s.jsx(ei,{size:75})})]})]})})}),s.jsx(_.section,{className:"py-20 px-4 bg-white/50 backdrop-blur-sm",initial:{opacity:0,y:50},animate:{opacity:1,y:0},transition:{delay:.8,duration:.8},children:s.jsxs("div",{className:"max-w-6xl mx-auto",children:[s.jsxs("div",{className:"text-center mb-16",children:[s.jsx("h2",{className:"text-4xl font-bold text-gray-800 mb-4",children:"Perché Scegliere AIVA"}),s.jsx("p",{className:"text-xl text-gray-600",children:"Un'esperienza di shopping rivoluzionaria"})]}),s.jsxs("div",{className:"grid md:grid-cols-3 gap-12",children:[s.jsxs(_.div,{className:"text-center p-8 bg-white/70 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300",whileHover:{y:-5},children:[s.jsx("div",{className:"w-20 h-20 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full flex items-center justify-center mx-auto mb-6",children:s.jsx(Ot,{size:40,className:"text-white"})}),s.jsx("h3",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Comandi Vocali"}),s.jsx("p",{className:"text-gray-600 text-lg",children:"Cerca, filtra, apri le pagine e aggiungi al carrello con la voce"})]}),s.jsxs(_.div,{className:"text-center p-8 bg-white/70 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300",whileHover:{y:-5},children:[s.jsx("div",{className:"w-20 h-20 bg-gradient-to-r from-blue-500 to-cyan-500 rounded-full flex items-center justify-center mx-auto mb-6",children:s.jsx($t,{size:40,className:"text-white"})}),s.jsx("h3",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Risposte in Tempo Reale"}),s.jsx("p",{className:"text-gray-600 text-lg",children:"AIVA parla mentre elabora: risposte fluide e naturali, anche interruttibili"})]}),s.jsxs(_.div,{className:"text-center p-8 bg-white/70 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300",whileHover:{y:-5},children:[s.jsx("div",{className:"w-20 h-20 bg-gradient-to-r from-emerald-500 to-teal-500 rounded-full flex items-center justify-center mx-auto mb-6",children:s.jsx(Gs,{size:40,className:"text-white"})}),s.jsx("h3",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Navigazione Istantanea"}),s.jsx("p",{className:"text-gray-600 text-lg",children:"Vai a Prodotti, Offerte o Carrello senza toccare lo schermo: basta dirlo"})]})]})]})}),s.jsx(_.section,{className:"py-20 px-4 bg-gradient-to-r from-purple-600 to-blue-600",initial:{opacity:0,y:50},animate:{opacity:1,y:0},transition:{delay:1,duration:.8},children:s.jsx("div",{className:"max-w-4xl mx-auto text-center text-white",children:s.jsxs(_.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},transition:{delay:1.2,duration:.8},children:[s.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-6",children:"Prova l'Esperienza Shopping del Futuro"}),s.jsx("p",{className:"text-xl md:text-2xl mb-8 opacity-90",children:'Clicca sul microfono e dì "Cerco una felpa nera" per iniziare'}),s.jsx(_.button,{onClick:e,className:"px-10 py-5 bg-white text-purple-600 font-bold text-xl rounded-full shadow-2xl hover:shadow-white/25 transform transition-all duration-300",whileHover:{scale:1.05,boxShadow:"0 20px 40px rgba(255, 255, 255, 0.3)"},whileTap:{scale:.95},children:s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(Ot,{size:28}),s.jsx("span",{children:"Attiva Assistente Vocale"})]})})]})})})]}),bs="aiva_session_id",dn="__AIVA_SESSION_ID__",jn="X-Session-Id",vi=()=>`sess-${Date.now()}-${Math.random().toString(36).slice(2,10)}`;function Ft(){var t,r;if(typeof window>"u")return null;if(window[dn])return window[dn];let e=null;try{e=((t=window.localStorage)==null?void 0:t.getItem(bs))||null}catch{e=null}if(!e){e=vi();try{(r=window.localStorage)==null||r.setItem(bs,e)}catch{}}return window[dn]=e,e}function Ze(e={}){const t=Ft();if(!t)return{...e};const r={...e.headers||{}};return r[jn]||(r[jn]=t),{...e,headers:r}}const Si=()=>"http://localhost:8000/api".replace(/\/+$/,""),Re=Si();Re.replace(/\/api$/,"");const ji=(e="")=>{if(!e)return Re;if(e.startsWith("http"))return e;const t=Re.endsWith("/")?Re.slice(0,-1):Re,r=e.startsWith("/")?e.slice(1):e;return`${t}/${r}`},fn=async(e,t={})=>{const r=ji(e),n=Ze({credentials:t.credentials??"include",...t}),o=await fetch(r,n);if(!o.ok)throw new Error(`${t.method||"GET"} ${r} ${o.status}`);return o.json()},Lt={async getProducts(e={}){const t=new URLSearchParams(e),r=await fetch(`${Re}/products?${t.toString()}`,Ze({credentials:"include"}));if(!r.ok)throw new Error(`GET /products ${r.status}`);return r.json()},async getSizeGuide(e){const t=await fetch(`${Re}/size-guide/${encodeURIComponent(e)}`,Ze());if(!t.ok)throw new Error(`GET /size-guide ${t.status}`);return t.json()},async getProduct(e){const t=await fetch(`${Re}/products/${e}`,Ze({credentials:"include"}));if(!t.ok)throw new Error(`GET /products/${e} ${t.status}`);return t.json()},async checkAvailability(e,t,r){const n=new URLSearchParams({size:t,color:r}),o=await fetch(`${Re}/products/${e}/availability?${n.toString()}`,Ze());if(!o.ok)throw new Error(`GET /availability ${o.status}`);return o.json()},async getRecommendations(e={}){const t=new URLSearchParams(e),r=await fetch(`${Re}/recommendations?${t.toString()}`,Ze());if(!r.ok)throw new Error(`GET /recommendations ${r.status}`);return r.json()},async searchProducts(e,t={}){const r=new URLSearchParams({q:e,...t}),n=await fetch(`${Re}/products?${r.toString()}`,Ze());if(!n.ok)throw new Error(`GET /products ${n.status}`);return n.json()}},tr={async processVoiceCommand(e,t={},r){var a;const n={text:e,context:t||{}},o=r||((a=n.context)==null?void 0:a.session_id)||Ft();o&&(n.session_id=o,n.context={...n.context,session_id:o});const i=await fetch(`${Re}/voice/command`,Ze({method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(n)}));if(!i.ok)throw new Error(`POST /voice/command ${i.status}`);return i.json()},async transcribeAudio({audio:e,sampleRate:t=16e3,language:r="it-IT",sessionId:n}={}){const o=n||Ft(),i={audio:e,sample_rate:t,language:r,session_id:o},a=await fetch(`${Re}/speech-to-text`,Ze({method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(i)}));if(!a.ok)throw new Error(`POST /speech-to-text ${a.status}`);return a.json()},async synthesizeSpeech({text:e,voice:t,sessionId:r}={}){const n=r||Ft(),o={text:e,voice:t,session_id:n},i=await fetch(`${Re}/tts`,Ze({method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(o)}));if(!i.ok)throw new Error(`POST /tts ${i.status}`);return i.json()}},Ni={getSizeGuide:async e=>fn(`/size-guide/${encodeURIComponent(e)}`,{credentials:"omit"}),getShippingInfo:async()=>fn("/shipping-info",{credentials:"omit"}),getPromotions:async()=>fn("/promotions",{credentials:"omit"})};function Ci(e){throw new Error("WebSocket disabilitato in ambiente Vercel")}const Zs="/ldr-icons";function Ei(){return typeof window>"u"?!1:window.location.pathname.startsWith(Zs)}function Ti(e){const t=e.startsWith("/")?e:`/${e}`;return typeof window<"u"&&Ei()?`${Zs}${t}`:t}function Ri(e){return Ti(e)}function Nn(e){if(!e)return e;const t=String(e);return t.startsWith("http://")||t.startsWith("https://")||t.startsWith("data:")?t:Ri(t)}const _i={},ws=e=>{let t;const r=new Set,n=(l,m)=>{const v=typeof l=="function"?l(t):l;if(!Object.is(v,t)){const S=t;t=m??(typeof v!="object"||v===null)?v:Object.assign({},t,v),r.forEach(y=>y(t,S))}},o=()=>t,u={setState:n,getState:o,getInitialState:()=>f,subscribe:l=>(r.add(l),()=>r.delete(l)),destroy:()=>{(_i?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),r.clear()}},f=t=e(n,o,u);return u},Ai=e=>e?ws(e):ws;var pn={exports:{}},mn={},hn={exports:{}},gn={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vs;function ki(){if(vs)return gn;vs=1;var e=kn();function t(m,v){return m===v&&(m!==0||1/m===1/v)||m!==m&&v!==v}var r=typeof Object.is=="function"?Object.is:t,n=e.useState,o=e.useEffect,i=e.useLayoutEffect,a=e.useDebugValue;function c(m,v){var S=v(),y=n({inst:{value:S,getSnapshot:v}}),x=y[0].inst,b=y[1];return i(function(){x.value=S,x.getSnapshot=v,u(x)&&b({inst:x})},[m,S,v]),o(function(){return u(x)&&b({inst:x}),m(function(){u(x)&&b({inst:x})})},[m]),a(S),S}function u(m){var v=m.getSnapshot;m=m.value;try{var S=v();return!r(m,S)}catch{return!0}}function f(m,v){return v()}var l=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?f:c;return gn.useSyncExternalStore=e.useSyncExternalStore!==void 0?e.useSyncExternalStore:l,gn}var Ss;function Pi(){return Ss||(Ss=1,hn.exports=ki()),hn.exports}/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var js;function zi(){if(js)return mn;js=1;var e=kn(),t=Pi();function r(f,l){return f===l&&(f!==0||1/f===1/l)||f!==f&&l!==l}var n=typeof Object.is=="function"?Object.is:r,o=t.useSyncExternalStore,i=e.useRef,a=e.useEffect,c=e.useMemo,u=e.useDebugValue;return mn.useSyncExternalStoreWithSelector=function(f,l,m,v,S){var y=i(null);if(y.current===null){var x={hasValue:!1,value:null};y.current=x}else x=y.current;y=c(function(){function N($){if(!E){if(E=!0,O=$,$=v($),S!==void 0&&x.hasValue){var z=x.value;if(S(z,$))return V=z}return V=$}if(z=V,n(O,$))return z;var F=v($);return S!==void 0&&S(z,F)?(O=$,z):(O=$,V=F)}var E=!1,O,V,se=m===void 0?null:m;return[function(){return N(l())},se===null?void 0:function(){return N(se())}]},[l,m,v,S]);var b=o(f,y[0],y[1]);return a(function(){x.hasValue=!0,x.value=b},[b]),u(b),b},mn}var Ns;function Ii(){return Ns||(Ns=1,pn.exports=zi()),pn.exports}var Oi=Ii();const Fi=Pn(Oi),eo={},{useDebugValue:Li}=Hs,{useSyncExternalStoreWithSelector:$i}=Fi;let Cs=!1;const Mi=e=>e;function qi(e,t=Mi,r){(eo?"production":void 0)!=="production"&&r&&!Cs&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),Cs=!0);const n=$i(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,r);return Li(n),n}const Es=e=>{(eo?"production":void 0)!=="production"&&typeof e!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const t=typeof e=="function"?Ai(e):e,r=(n,o)=>qi(t,n,o);return Object.assign(r,t),r},Di=e=>e?Es(e):Es,zr={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_API_BASE_URL:"http://localhost:8000/api",VITE_ASSETS_BASE_URL:"http://localhost:8000/static/images",VITE_BACKEND_URL:"http://localhost:8000",VITE_DEBUG_MODE:"false",VITE_DEFAULT_LANGUAGE:"it-IT",VITE_ENABLE_ANALYTICS:"false",VITE_ENABLE_VOICE:"true",VITE_ENABLE_WEBSOCKET:"true",VITE_PRIMARY_COLOR:"",VITE_PUBLIC_URL:"http://localhost:5173",VITE_SECONDARY_COLOR:"",VITE_SUPPORTED_LANGUAGES:"it-IT,en-US",VITE_THEME:"light",VITE_TTS_LANGUAGE:"it-IT",VITE_TTS_PITCH:"1.0",VITE_TTS_RATE:"1.0",VITE_VERCEL_MODE:"true",VITE_VOICE_RECOGNITION_LANGUAGE:"it-IT",VITE_WS_URL:"ws://localhost:8000"},Cn=new Map,Ar=e=>{const t=Cn.get(e);return t?Object.fromEntries(Object.entries(t.stores).map(([r,n])=>[r,n.getState()])):{}},Ui=(e,t,r)=>{if(e===void 0)return{type:"untracked",connection:t.connect(r)};const n=Cn.get(r.name);if(n)return{type:"tracked",store:e,...n};const o={connection:t.connect(r),stores:{}};return Cn.set(r.name,o),{type:"tracked",store:e,...o}},Bi=(e,t={})=>(r,n,o)=>{const{enabled:i,anonymousActionType:a,store:c,...u}=t;let f;try{f=(i??(zr?"production":void 0)!=="production")&&window.__REDUX_DEVTOOLS_EXTENSION__}catch{}if(!f)return(zr?"production":void 0)!=="production"&&i&&console.warn("[zustand devtools middleware] Please install/enable Redux devtools extension"),e(r,n,o);const{connection:l,...m}=Ui(c,f,u);let v=!0;o.setState=(x,b,N)=>{const E=r(x,b);if(!v)return E;const O=N===void 0?{type:a||"anonymous"}:typeof N=="string"?{type:N}:N;return c===void 0?(l==null||l.send(O,n()),E):(l==null||l.send({...O,type:`${c}/${O.type}`},{...Ar(u.name),[c]:o.getState()}),E)};const S=(...x)=>{const b=v;v=!1,r(...x),v=b},y=e(o.setState,n,o);if(m.type==="untracked"?l==null||l.init(y):(m.stores[m.store]=o,l==null||l.init(Object.fromEntries(Object.entries(m.stores).map(([x,b])=>[x,x===m.store?y:b.getState()])))),o.dispatchFromDevtools&&typeof o.dispatch=="function"){let x=!1;const b=o.dispatch;o.dispatch=(...N)=>{(zr?"production":void 0)!=="production"&&N[0].type==="__setState"&&!x&&(console.warn('[zustand devtools middleware] "__setState" action type is reserved to set state from the devtools. Avoid using it.'),x=!0),b(...N)}}return l.subscribe(x=>{var b;switch(x.type){case"ACTION":if(typeof x.payload!="string"){console.error("[zustand devtools middleware] Unsupported action format");return}return yn(x.payload,N=>{if(N.type==="__setState"){if(c===void 0){S(N.state);return}Object.keys(N.state).length!==1&&console.error(`
                    [zustand devtools middleware] Unsupported __setState action format. 
                    When using 'store' option in devtools(), the 'state' should have only one key, which is a value of 'store' that was passed in devtools(),
                    and value of this only key should be a state object. Example: { "type": "__setState", "state": { "abc123Store": { "foo": "bar" } } }
                    `);const E=N.state[c];if(E==null)return;JSON.stringify(o.getState())!==JSON.stringify(E)&&S(E);return}o.dispatchFromDevtools&&typeof o.dispatch=="function"&&o.dispatch(N)});case"DISPATCH":switch(x.payload.type){case"RESET":return S(y),c===void 0?l==null?void 0:l.init(o.getState()):l==null?void 0:l.init(Ar(u.name));case"COMMIT":if(c===void 0){l==null||l.init(o.getState());return}return l==null?void 0:l.init(Ar(u.name));case"ROLLBACK":return yn(x.state,N=>{if(c===void 0){S(N),l==null||l.init(o.getState());return}S(N[c]),l==null||l.init(Ar(u.name))});case"JUMP_TO_STATE":case"JUMP_TO_ACTION":return yn(x.state,N=>{if(c===void 0){S(N);return}JSON.stringify(o.getState())!==JSON.stringify(N[c])&&S(N[c])});case"IMPORT_STATE":{const{nextLiftedState:N}=x.payload,E=(b=N.computedStates.slice(-1)[0])==null?void 0:b.state;if(!E)return;S(c===void 0?E:E[c]),l==null||l.send(null,N);return}case"PAUSE_RECORDING":return v=!v}return}}),y},Vi=Bi,yn=(e,t)=>{let r;try{r=JSON.parse(e)}catch(n){console.error("[zustand devtools middleware] Could not parse the received json",n)}r!==void 0&&t(r)};function Hi(e,t){let r;try{r=e()}catch{return}return{getItem:o=>{var i;const a=u=>u===null?null:JSON.parse(u,void 0),c=(i=r.getItem(o))!=null?i:null;return c instanceof Promise?c.then(a):a(c)},setItem:(o,i)=>r.setItem(o,JSON.stringify(i,void 0)),removeItem:o=>r.removeItem(o)}}const sr=e=>t=>{try{const r=e(t);return r instanceof Promise?r:{then(n){return sr(n)(r)},catch(n){return this}}}catch(r){return{then(n){return this},catch(n){return sr(n)(r)}}}},Gi=(e,t)=>(r,n,o)=>{let i={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:b=>b,version:0,merge:(b,N)=>({...N,...b}),...t},a=!1;const c=new Set,u=new Set;let f;try{f=i.getStorage()}catch{}if(!f)return e((...b)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),r(...b)},n,o);const l=sr(i.serialize),m=()=>{const b=i.partialize({...n()});let N;const E=l({state:b,version:i.version}).then(O=>f.setItem(i.name,O)).catch(O=>{N=O});if(N)throw N;return E},v=o.setState;o.setState=(b,N)=>{v(b,N),m()};const S=e((...b)=>{r(...b),m()},n,o);let y;const x=()=>{var b;if(!f)return;a=!1,c.forEach(E=>E(n()));const N=((b=i.onRehydrateStorage)==null?void 0:b.call(i,n()))||void 0;return sr(f.getItem.bind(f))(i.name).then(E=>{if(E)return i.deserialize(E)}).then(E=>{if(E)if(typeof E.version=="number"&&E.version!==i.version){if(i.migrate)return i.migrate(E.state,E.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return E.state}).then(E=>{var O;return y=i.merge(E,(O=n())!=null?O:S),r(y,!0),m()}).then(()=>{N==null||N(y,void 0),a=!0,u.forEach(E=>E(y))}).catch(E=>{N==null||N(void 0,E)})};return o.persist={setOptions:b=>{i={...i,...b},b.getStorage&&(f=b.getStorage())},clearStorage:()=>{f==null||f.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>x(),hasHydrated:()=>a,onHydrate:b=>(c.add(b),()=>{c.delete(b)}),onFinishHydration:b=>(u.add(b),()=>{u.delete(b)})},x(),y||S},Wi=(e,t)=>(r,n,o)=>{let i={storage:Hi(()=>localStorage),partialize:x=>x,version:0,merge:(x,b)=>({...b,...x}),...t},a=!1;const c=new Set,u=new Set;let f=i.storage;if(!f)return e((...x)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),r(...x)},n,o);const l=()=>{const x=i.partialize({...n()});return f.setItem(i.name,{state:x,version:i.version})},m=o.setState;o.setState=(x,b)=>{m(x,b),l()};const v=e((...x)=>{r(...x),l()},n,o);o.getInitialState=()=>v;let S;const y=()=>{var x,b;if(!f)return;a=!1,c.forEach(E=>{var O;return E((O=n())!=null?O:v)});const N=((b=i.onRehydrateStorage)==null?void 0:b.call(i,(x=n())!=null?x:v))||void 0;return sr(f.getItem.bind(f))(i.name).then(E=>{if(E)if(typeof E.version=="number"&&E.version!==i.version){if(i.migrate)return[!0,i.migrate(E.state,E.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,E.state];return[!1,void 0]}).then(E=>{var O;const[V,se]=E;if(S=i.merge(se,(O=n())!=null?O:v),r(S,!0),V)return l()}).then(()=>{N==null||N(S,void 0),S=n(),a=!0,u.forEach(E=>E(S))}).catch(E=>{N==null||N(void 0,E)})};return o.persist={setOptions:x=>{i={...i,...x},x.storage&&(f=x.storage)},clearStorage:()=>{f==null||f.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>y(),hasHydrated:()=>a,onHydrate:x=>(c.add(x),()=>{c.delete(x)}),onFinishHydration:x=>(u.add(x),()=>{u.delete(x)})},i.skipHydration||y(),S||v},Qi=(e,t)=>"getStorage"in t||"serialize"in t||"deserialize"in t?((zr?"production":void 0)!=="production"&&console.warn("[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead."),Gi(e,t)):Wi(e,t),Ji=Qi,Ki=e=>(e||"").toString().normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").toLowerCase().replace(/[^a-z0-9]+/g," ").trim(),zt=e=>{if(typeof window>"u")return;const t=(e||[]).map(n=>{var o,i,a;return{item_id:n.id,product_id:(o=n.product)==null?void 0:o.id,name:(i=n.product)==null?void 0:i.name,size:n.size,color:n.color,quantity:n.quantity,price:(a=n.product)==null?void 0:a.price}}),r={};for(const n of t){const o=Ki(`${n.name} ${n.size||""} ${n.color||""}`);o&&(r[o]=n.item_id)}window.cartSnapshot=t,window.cartItemsMap=r},Le=Di(Vi(Ji((e,t)=>({cart:[],cartTotal:0,cartCount:0,preferences:{size:null,color:null,gender:null,style:null},isVoiceAssistantOpen:!1,isMobileMenuOpen:!1,isCartOpen:!1,currentPage:"home",voiceHistory:[],isListening:!1,products:[],filteredProducts:[],selectedProduct:null,searchQuery:"",activeFilters:{category:null,gender:null,size:null,color:null,minPrice:0,maxPrice:1e3,onSale:!1,brand:null,style:null},addToCart:(r,n,o,i=1)=>{e(a=>{const c=a.cart.find(m=>m.product.id===r.id&&m.size===n&&m.color===o);let u;c?u=a.cart.map(m=>m===c?{...m,quantity:m.quantity+i}:m):u=[...a.cart,{id:`cart-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,product:r,size:n,color:o,quantity:i,addedAt:new Date().toISOString()}];const f=u.reduce((m,v)=>m+v.product.price*v.quantity,0),l=u.reduce((m,v)=>m+v.quantity,0);return zt(u),{cart:u,cartTotal:f,cartCount:l}})},removeFromCart:r=>{e(n=>{const o=n.cart.filter(c=>c.id!==r),i=o.reduce((c,u)=>c+u.product.price*u.quantity,0),a=o.reduce((c,u)=>c+u.quantity,0);return zt(o),{cart:o,cartTotal:i,cartCount:a}})},clearCart:()=>{e({cart:[],cartTotal:0,cartCount:0}),zt([])},updateQuantity:(r,n)=>{if(n<=0){t().removeFromCart(r);return}e(o=>{const i=o.cart.map(u=>u.id===r?{...u,quantity:n}:u),a=i.reduce((u,f)=>u+f.product.price*f.quantity,0),c=i.reduce((u,f)=>u+f.quantity,0);return zt(i),{cart:i,cartTotal:a,cartCount:c}})},setCartFromServer:r=>{e(n=>{const o=Array.isArray(r==null?void 0:r.items)?r.items:[],i=Number((r==null?void 0:r.item_count)??(r==null?void 0:r.count)??(r==null?void 0:r.total_items)??0)||0,a=Number((r==null?void 0:r.grand_total)??(r==null?void 0:r.total)??(r==null?void 0:r.subtotal)??0)||0,c=o.length>0||i>0||a>0||n.cart.length===0,u=c?o:n.cart,f=c?a||u.reduce((m,v)=>{var S;return m+(((S=v.product)==null?void 0:S.price)||0)*(v.quantity||0)},0):n.cartTotal,l=c?i||u.reduce((m,v)=>m+(v.quantity||0),0):n.cartCount;return zt(u),{cart:u,cartTotal:f,cartCount:l}})},setPreferences:r=>{e(n=>({preferences:{...n.preferences,...r}}))},updatePreference:(r,n)=>{e(o=>({preferences:{...o.preferences,[r]:n}}))},setCurrentPage:r=>e({currentPage:r}),toggleVoiceAssistant:()=>{e(r=>({isVoiceAssistantOpen:!r.isVoiceAssistantOpen}))},addVoiceHistory:r=>{e(n=>({voiceHistory:[...n.voiceHistory,{...r,timestamp:new Date().toISOString(),id:`voice-${Date.now()}`}].slice(-50)}))},clearVoiceHistory:()=>e({voiceHistory:[]}),setProducts:r=>{e({products:r,filteredProducts:r})},setSearchQuery:r=>{e(n=>{const o=r.toLowerCase();if(!r)return{searchQuery:"",filteredProducts:n.products};const i={maglia:["maglia","maglietta","t-shirt","polo"],felpa:["felpa","hoodie","felpa con cappuccio"],pantaloni:["pantaloni","jeans","denim","chino"],scarpe:["scarpe","sneakers","stivali","sandali"],giacca:["giacca","giubbotto","bomber","cappotto"]};let a=[o];for(const[u,f]of Object.entries(i))f.some(l=>o.includes(l))&&(a=[...a,...f]);const c=n.products.filter(u=>{const f=[u.name,u.description,u.brand,u.category,u.subcategory,...u.tags||[]].join(" ").toLowerCase();return a.some(l=>f.includes(l))});return{searchQuery:r,filteredProducts:c}})},setFilter:(r,n)=>{e(o=>{const i={...o.activeFilters,[r]:n},a=t().applyFilters(o.products,i,o.searchQuery);return{activeFilters:i,filteredProducts:a}})},setMultipleFilters:r=>{e(n=>{const o={...n.activeFilters,...r},i=t().applyFilters(n.products,o,n.searchQuery);return{activeFilters:o,filteredProducts:i}})},clearFilters:()=>{e(r=>({activeFilters:{category:null,gender:null,size:null,color:null,minPrice:0,maxPrice:1e3,onSale:!1,brand:null,style:null},filteredProducts:r.products,searchQuery:""}))},applyFilters:(r,n,o="")=>{let i=[...r];if(o){const a=o.toLowerCase();i=i.filter(c=>[c.name,c.description,c.brand,c.category,c.subcategory,...c.tags||[]].join(" ").toLowerCase().includes(a))}return n.category&&(i=i.filter(a=>a.category===n.category||a.subcategory===n.category)),n.gender&&(i=i.filter(a=>a.gender===n.gender||a.gender==="unisex")),n.size&&(i=i.filter(a=>a.variants&&a.variants.some(c=>c.size===n.size&&c.available))),n.color&&(i=i.filter(a=>a.variants&&a.variants.some(c=>c.color.toLowerCase().includes(n.color.toLowerCase())))),n.minPrice>0&&(i=i.filter(a=>a.price>=n.minPrice)),n.maxPrice<1e3&&(i=i.filter(a=>a.price<=n.maxPrice)),n.onSale&&(i=i.filter(a=>a.on_sale||a.discount_percentage>0)),n.brand&&(i=i.filter(a=>a.brand.toLowerCase().includes(n.brand.toLowerCase()))),n.style&&(i=i.filter(a=>a.style&&a.style.toLowerCase().includes(n.style.toLowerCase()))),i},filterProducts:r=>{e(n=>{const o={...n.activeFilters,...r},i=t().applyFilters(n.products,o,n.searchQuery);return{activeFilters:o,filteredProducts:i}})},searchProducts:(r,n={})=>{e(o=>{const i={...o.activeFilters,...n},a=t().applyFilters(o.products,i,r);return{searchQuery:r,activeFilters:i,filteredProducts:a}})},setSelectedProduct:r=>e({selectedProduct:r}),getProductById:r=>t().products.find(o=>o.id===r),isProductInCart:(r,n=null,o=null)=>t().cart.some(a=>{const c=a.product.id===r,u=!n||a.size===n,f=!o||a.color===o;return c&&u&&f}),getCartItemCount:(r,n=null,o=null)=>{const a=t().cart.find(c=>{const u=c.product.id===r,f=!n||c.size===n,l=!o||c.color===o;return u&&f&&l});return a?a.quantity:0},processVoiceCommand:(r,n)=>{switch(t(),r){case"search_products":n.query&&t().searchProducts(n.query,n.filters||{});break;case"add_to_cart":if(n.product_id){const o=t().getProductById(n.product_id);o&&t().addToCart(o,n.size||"M",n.color||"nero",n.quantity||1)}break;case"clear_cart":t().clearCart();break;case"set_preferences":n.preferences&&t().setPreferences(n.preferences);break;default:console.log("Unknown voice command:",r)}t().addVoiceHistory({command:r,parameters:n,result:"processed"})},getShoppingInsights:()=>{const r=t(),n=r.cartTotal,o=r.cartCount,i=r.voiceHistory.filter(c=>c.command==="search_products").map(c=>{var u;return(u=c.parameters)==null?void 0:u.query}).filter(Boolean),a=r.preferences.size||(r.cart.length>0?r.cart[0].size:null);return{totalSpent:n,itemsInCart:o,favoriteCategories:i,preferredSize:a,searchHistory:r.voiceHistory.slice(-10),lastUpdated:new Date().toISOString()}}}),{name:"aiva-storage",partialize:e=>({cart:e.cart,cartTotal:e.cartTotal,cartCount:e.cartCount,preferences:e.preferences,voiceHistory:e.voiceHistory.slice(-20)}),onRehydrateStorage:()=>(e,t)=>{if(!t)try{zt((e==null?void 0:e.cart)||[])}catch(r){console.warn("Failed to publish cart snapshot after rehydrate:",r)}}}),{name:"aiva-store"}));function to(e,t){return function(){return e.apply(t,arguments)}}const{toString:Xi}=Object.prototype,{getPrototypeOf:zn}=Object,{iterator:Ur,toStringTag:ro}=Symbol,Br=(e=>t=>{const r=Xi.call(t);return e[r]||(e[r]=r.slice(8,-1).toLowerCase())})(Object.create(null)),Be=e=>(e=e.toLowerCase(),t=>Br(t)===e),Vr=e=>t=>typeof t===e,{isArray:Dt}=Array,qt=Vr("undefined");function ar(e){return e!==null&&!qt(e)&&e.constructor!==null&&!qt(e.constructor)&&_e(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const no=Be("ArrayBuffer");function Yi(e){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(e):t=e&&e.buffer&&no(e.buffer),t}const Zi=Vr("string"),_e=Vr("function"),so=Vr("number"),cr=e=>e!==null&&typeof e=="object",ea=e=>e===!0||e===!1,Ir=e=>{if(Br(e)!=="object")return!1;const t=zn(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(ro in e)&&!(Ur in e)},ta=e=>{if(!cr(e)||ar(e))return!1;try{return Object.keys(e).length===0&&Object.getPrototypeOf(e)===Object.prototype}catch{return!1}},ra=Be("Date"),na=Be("File"),sa=Be("Blob"),oa=Be("FileList"),ia=e=>cr(e)&&_e(e.pipe),aa=e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||_e(e.append)&&((t=Br(e))==="formdata"||t==="object"&&_e(e.toString)&&e.toString()==="[object FormData]"))},ca=Be("URLSearchParams"),[la,ua,da,fa]=["ReadableStream","Request","Response","Headers"].map(Be),pa=e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function lr(e,t,{allOwnKeys:r=!1}={}){if(e===null||typeof e>"u")return;let n,o;if(typeof e!="object"&&(e=[e]),Dt(e))for(n=0,o=e.length;n<o;n++)t.call(null,e[n],n,e);else{if(ar(e))return;const i=r?Object.getOwnPropertyNames(e):Object.keys(e),a=i.length;let c;for(n=0;n<a;n++)c=i[n],t.call(null,e[c],c,e)}}function oo(e,t){if(ar(e))return null;t=t.toLowerCase();const r=Object.keys(e);let n=r.length,o;for(;n-- >0;)if(o=r[n],t===o.toLowerCase())return o;return null}const bt=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:globalThis,io=e=>!qt(e)&&e!==bt;function En(){const{caseless:e,skipUndefined:t}=io(this)&&this||{},r={},n=(o,i)=>{const a=e&&oo(r,i)||i;Ir(r[a])&&Ir(o)?r[a]=En(r[a],o):Ir(o)?r[a]=En({},o):Dt(o)?r[a]=o.slice():(!t||!qt(o))&&(r[a]=o)};for(let o=0,i=arguments.length;o<i;o++)arguments[o]&&lr(arguments[o],n);return r}const ma=(e,t,r,{allOwnKeys:n}={})=>(lr(t,(o,i)=>{r&&_e(o)?e[i]=to(o,r):e[i]=o},{allOwnKeys:n}),e),ha=e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),ga=(e,t,r,n)=>{e.prototype=Object.create(t.prototype,n),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),r&&Object.assign(e.prototype,r)},ya=(e,t,r,n)=>{let o,i,a;const c={};if(t=t||{},e==null)return t;do{for(o=Object.getOwnPropertyNames(e),i=o.length;i-- >0;)a=o[i],(!n||n(a,e,t))&&!c[a]&&(t[a]=e[a],c[a]=!0);e=r!==!1&&zn(e)}while(e&&(!r||r(e,t))&&e!==Object.prototype);return t},xa=(e,t,r)=>{e=String(e),(r===void 0||r>e.length)&&(r=e.length),r-=t.length;const n=e.indexOf(t,r);return n!==-1&&n===r},ba=e=>{if(!e)return null;if(Dt(e))return e;let t=e.length;if(!so(t))return null;const r=new Array(t);for(;t-- >0;)r[t]=e[t];return r},wa=(e=>t=>e&&t instanceof e)(typeof Uint8Array<"u"&&zn(Uint8Array)),va=(e,t)=>{const n=(e&&e[Ur]).call(e);let o;for(;(o=n.next())&&!o.done;){const i=o.value;t.call(e,i[0],i[1])}},Sa=(e,t)=>{let r;const n=[];for(;(r=e.exec(t))!==null;)n.push(r);return n},ja=Be("HTMLFormElement"),Na=e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,n,o){return n.toUpperCase()+o}),Ts=(({hasOwnProperty:e})=>(t,r)=>e.call(t,r))(Object.prototype),Ca=Be("RegExp"),ao=(e,t)=>{const r=Object.getOwnPropertyDescriptors(e),n={};lr(r,(o,i)=>{let a;(a=t(o,i,e))!==!1&&(n[i]=a||o)}),Object.defineProperties(e,n)},Ea=e=>{ao(e,(t,r)=>{if(_e(e)&&["arguments","caller","callee"].indexOf(r)!==-1)return!1;const n=e[r];if(_e(n)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")})}})},Ta=(e,t)=>{const r={},n=o=>{o.forEach(i=>{r[i]=!0})};return Dt(e)?n(e):n(String(e).split(t)),r},Ra=()=>{},_a=(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t;function Aa(e){return!!(e&&_e(e.append)&&e[ro]==="FormData"&&e[Ur])}const ka=e=>{const t=new Array(10),r=(n,o)=>{if(cr(n)){if(t.indexOf(n)>=0)return;if(ar(n))return n;if(!("toJSON"in n)){t[o]=n;const i=Dt(n)?[]:{};return lr(n,(a,c)=>{const u=r(a,o+1);!qt(u)&&(i[c]=u)}),t[o]=void 0,i}}return n};return r(e,0)},Pa=Be("AsyncFunction"),za=e=>e&&(cr(e)||_e(e))&&_e(e.then)&&_e(e.catch),co=((e,t)=>e?setImmediate:t?((r,n)=>(bt.addEventListener("message",({source:o,data:i})=>{o===bt&&i===r&&n.length&&n.shift()()},!1),o=>{n.push(o),bt.postMessage(r,"*")}))(`axios@${Math.random()}`,[]):r=>setTimeout(r))(typeof setImmediate=="function",_e(bt.postMessage)),Ia=typeof queueMicrotask<"u"?queueMicrotask.bind(bt):typeof process<"u"&&process.nextTick||co,Oa=e=>e!=null&&_e(e[Ur]),g={isArray:Dt,isArrayBuffer:no,isBuffer:ar,isFormData:aa,isArrayBufferView:Yi,isString:Zi,isNumber:so,isBoolean:ea,isObject:cr,isPlainObject:Ir,isEmptyObject:ta,isReadableStream:la,isRequest:ua,isResponse:da,isHeaders:fa,isUndefined:qt,isDate:ra,isFile:na,isBlob:sa,isRegExp:Ca,isFunction:_e,isStream:ia,isURLSearchParams:ca,isTypedArray:wa,isFileList:oa,forEach:lr,merge:En,extend:ma,trim:pa,stripBOM:ha,inherits:ga,toFlatObject:ya,kindOf:Br,kindOfTest:Be,endsWith:xa,toArray:ba,forEachEntry:va,matchAll:Sa,isHTMLForm:ja,hasOwnProperty:Ts,hasOwnProp:Ts,reduceDescriptors:ao,freezeMethods:Ea,toObjectSet:Ta,toCamelCase:Na,noop:Ra,toFiniteNumber:_a,findKey:oo,global:bt,isContextDefined:io,isSpecCompliantForm:Aa,toJSONObject:ka,isAsyncFn:Pa,isThenable:za,setImmediate:co,asap:Ia,isIterable:Oa};function J(e,t,r,n,o){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),r&&(this.config=r),n&&(this.request=n),o&&(this.response=o,this.status=o.status?o.status:null)}g.inherits(J,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:g.toJSONObject(this.config),code:this.code,status:this.status}}});const lo=J.prototype,uo={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{uo[e]={value:e}});Object.defineProperties(J,uo);Object.defineProperty(lo,"isAxiosError",{value:!0});J.from=(e,t,r,n,o,i)=>{const a=Object.create(lo);g.toFlatObject(e,a,function(l){return l!==Error.prototype},f=>f!=="isAxiosError");const c=e&&e.message?e.message:"Error",u=t==null&&e?e.code:t;return J.call(a,c,u,r,n,o),e&&a.cause==null&&Object.defineProperty(a,"cause",{value:e,configurable:!0}),a.name=e&&e.name||"Error",i&&Object.assign(a,i),a};const Fa=null;function Tn(e){return g.isPlainObject(e)||g.isArray(e)}function fo(e){return g.endsWith(e,"[]")?e.slice(0,-2):e}function Rs(e,t,r){return e?e.concat(t).map(function(o,i){return o=fo(o),!r&&i?"["+o+"]":o}).join(r?".":""):t}function La(e){return g.isArray(e)&&!e.some(Tn)}const $a=g.toFlatObject(g,{},null,function(t){return/^is[A-Z]/.test(t)});function Hr(e,t,r){if(!g.isObject(e))throw new TypeError("target must be an object");t=t||new FormData,r=g.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,function(x,b){return!g.isUndefined(b[x])});const n=r.metaTokens,o=r.visitor||l,i=r.dots,a=r.indexes,u=(r.Blob||typeof Blob<"u"&&Blob)&&g.isSpecCompliantForm(t);if(!g.isFunction(o))throw new TypeError("visitor must be a function");function f(y){if(y===null)return"";if(g.isDate(y))return y.toISOString();if(g.isBoolean(y))return y.toString();if(!u&&g.isBlob(y))throw new J("Blob is not supported. Use a Buffer instead.");return g.isArrayBuffer(y)||g.isTypedArray(y)?u&&typeof Blob=="function"?new Blob([y]):Buffer.from(y):y}function l(y,x,b){let N=y;if(y&&!b&&typeof y=="object"){if(g.endsWith(x,"{}"))x=n?x:x.slice(0,-2),y=JSON.stringify(y);else if(g.isArray(y)&&La(y)||(g.isFileList(y)||g.endsWith(x,"[]"))&&(N=g.toArray(y)))return x=fo(x),N.forEach(function(O,V){!(g.isUndefined(O)||O===null)&&t.append(a===!0?Rs([x],V,i):a===null?x:x+"[]",f(O))}),!1}return Tn(y)?!0:(t.append(Rs(b,x,i),f(y)),!1)}const m=[],v=Object.assign($a,{defaultVisitor:l,convertValue:f,isVisitable:Tn});function S(y,x){if(!g.isUndefined(y)){if(m.indexOf(y)!==-1)throw Error("Circular reference detected in "+x.join("."));m.push(y),g.forEach(y,function(N,E){(!(g.isUndefined(N)||N===null)&&o.call(t,N,g.isString(E)?E.trim():E,x,v))===!0&&S(N,x?x.concat(E):[E])}),m.pop()}}if(!g.isObject(e))throw new TypeError("data must be an object");return S(e),t}function _s(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(n){return t[n]})}function In(e,t){this._pairs=[],e&&Hr(e,this,t)}const po=In.prototype;po.append=function(t,r){this._pairs.push([t,r])};po.toString=function(t){const r=t?function(n){return t.call(this,n,_s)}:_s;return this._pairs.map(function(o){return r(o[0])+"="+r(o[1])},"").join("&")};function Ma(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function mo(e,t,r){if(!t)return e;const n=r&&r.encode||Ma;g.isFunction(r)&&(r={serialize:r});const o=r&&r.serialize;let i;if(o?i=o(t,r):i=g.isURLSearchParams(t)?t.toString():new In(t,r).toString(n),i){const a=e.indexOf("#");a!==-1&&(e=e.slice(0,a)),e+=(e.indexOf("?")===-1?"?":"&")+i}return e}class As{constructor(){this.handlers=[]}use(t,r,n){return this.handlers.push({fulfilled:t,rejected:r,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){g.forEach(this.handlers,function(n){n!==null&&t(n)})}}const ho={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},qa=typeof URLSearchParams<"u"?URLSearchParams:In,Da=typeof FormData<"u"?FormData:null,Ua=typeof Blob<"u"?Blob:null,Ba={isBrowser:!0,classes:{URLSearchParams:qa,FormData:Da,Blob:Ua},protocols:["http","https","file","blob","url","data"]},On=typeof window<"u"&&typeof document<"u",Rn=typeof navigator=="object"&&navigator||void 0,Va=On&&(!Rn||["ReactNative","NativeScript","NS"].indexOf(Rn.product)<0),Ha=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Ga=On&&window.location.href||"http://localhost",Wa=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:On,hasStandardBrowserEnv:Va,hasStandardBrowserWebWorkerEnv:Ha,navigator:Rn,origin:Ga},Symbol.toStringTag,{value:"Module"})),je={...Wa,...Ba};function Qa(e,t){return Hr(e,new je.classes.URLSearchParams,{visitor:function(r,n,o,i){return je.isNode&&g.isBuffer(r)?(this.append(n,r.toString("base64")),!1):i.defaultVisitor.apply(this,arguments)},...t})}function Ja(e){return g.matchAll(/\w+|\[(\w*)]/g,e).map(t=>t[0]==="[]"?"":t[1]||t[0])}function Ka(e){const t={},r=Object.keys(e);let n;const o=r.length;let i;for(n=0;n<o;n++)i=r[n],t[i]=e[i];return t}function go(e){function t(r,n,o,i){let a=r[i++];if(a==="__proto__")return!0;const c=Number.isFinite(+a),u=i>=r.length;return a=!a&&g.isArray(o)?o.length:a,u?(g.hasOwnProp(o,a)?o[a]=[o[a],n]:o[a]=n,!c):((!o[a]||!g.isObject(o[a]))&&(o[a]=[]),t(r,n,o[a],i)&&g.isArray(o[a])&&(o[a]=Ka(o[a])),!c)}if(g.isFormData(e)&&g.isFunction(e.entries)){const r={};return g.forEachEntry(e,(n,o)=>{t(Ja(n),o,r,0)}),r}return null}function Xa(e,t,r){if(g.isString(e))try{return(t||JSON.parse)(e),g.trim(e)}catch(n){if(n.name!=="SyntaxError")throw n}return(r||JSON.stringify)(e)}const ur={transitional:ho,adapter:["xhr","http","fetch"],transformRequest:[function(t,r){const n=r.getContentType()||"",o=n.indexOf("application/json")>-1,i=g.isObject(t);if(i&&g.isHTMLForm(t)&&(t=new FormData(t)),g.isFormData(t))return o?JSON.stringify(go(t)):t;if(g.isArrayBuffer(t)||g.isBuffer(t)||g.isStream(t)||g.isFile(t)||g.isBlob(t)||g.isReadableStream(t))return t;if(g.isArrayBufferView(t))return t.buffer;if(g.isURLSearchParams(t))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let c;if(i){if(n.indexOf("application/x-www-form-urlencoded")>-1)return Qa(t,this.formSerializer).toString();if((c=g.isFileList(t))||n.indexOf("multipart/form-data")>-1){const u=this.env&&this.env.FormData;return Hr(c?{"files[]":t}:t,u&&new u,this.formSerializer)}}return i||o?(r.setContentType("application/json",!1),Xa(t)):t}],transformResponse:[function(t){const r=this.transitional||ur.transitional,n=r&&r.forcedJSONParsing,o=this.responseType==="json";if(g.isResponse(t)||g.isReadableStream(t))return t;if(t&&g.isString(t)&&(n&&!this.responseType||o)){const a=!(r&&r.silentJSONParsing)&&o;try{return JSON.parse(t,this.parseReviver)}catch(c){if(a)throw c.name==="SyntaxError"?J.from(c,J.ERR_BAD_RESPONSE,this,null,this.response):c}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:je.classes.FormData,Blob:je.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};g.forEach(["delete","get","head","post","put","patch"],e=>{ur.headers[e]={}});const Ya=g.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Za=e=>{const t={};let r,n,o;return e&&e.split(`
`).forEach(function(a){o=a.indexOf(":"),r=a.substring(0,o).trim().toLowerCase(),n=a.substring(o+1).trim(),!(!r||t[r]&&Ya[r])&&(r==="set-cookie"?t[r]?t[r].push(n):t[r]=[n]:t[r]=t[r]?t[r]+", "+n:n)}),t},ks=Symbol("internals");function rr(e){return e&&String(e).trim().toLowerCase()}function Or(e){return e===!1||e==null?e:g.isArray(e)?e.map(Or):String(e)}function ec(e){const t=Object.create(null),r=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=r.exec(e);)t[n[1]]=n[2];return t}const tc=e=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim());function xn(e,t,r,n,o){if(g.isFunction(n))return n.call(this,t,r);if(o&&(t=r),!!g.isString(t)){if(g.isString(n))return t.indexOf(n)!==-1;if(g.isRegExp(n))return n.test(t)}}function rc(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,r,n)=>r.toUpperCase()+n)}function nc(e,t){const r=g.toCamelCase(" "+t);["get","set","has"].forEach(n=>{Object.defineProperty(e,n+r,{value:function(o,i,a){return this[n].call(this,t,o,i,a)},configurable:!0})})}let Ae=class{constructor(t){t&&this.set(t)}set(t,r,n){const o=this;function i(c,u,f){const l=rr(u);if(!l)throw new Error("header name must be a non-empty string");const m=g.findKey(o,l);(!m||o[m]===void 0||f===!0||f===void 0&&o[m]!==!1)&&(o[m||u]=Or(c))}const a=(c,u)=>g.forEach(c,(f,l)=>i(f,l,u));if(g.isPlainObject(t)||t instanceof this.constructor)a(t,r);else if(g.isString(t)&&(t=t.trim())&&!tc(t))a(Za(t),r);else if(g.isObject(t)&&g.isIterable(t)){let c={},u,f;for(const l of t){if(!g.isArray(l))throw TypeError("Object iterator must return a key-value pair");c[f=l[0]]=(u=c[f])?g.isArray(u)?[...u,l[1]]:[u,l[1]]:l[1]}a(c,r)}else t!=null&&i(r,t,n);return this}get(t,r){if(t=rr(t),t){const n=g.findKey(this,t);if(n){const o=this[n];if(!r)return o;if(r===!0)return ec(o);if(g.isFunction(r))return r.call(this,o,n);if(g.isRegExp(r))return r.exec(o);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,r){if(t=rr(t),t){const n=g.findKey(this,t);return!!(n&&this[n]!==void 0&&(!r||xn(this,this[n],n,r)))}return!1}delete(t,r){const n=this;let o=!1;function i(a){if(a=rr(a),a){const c=g.findKey(n,a);c&&(!r||xn(n,n[c],c,r))&&(delete n[c],o=!0)}}return g.isArray(t)?t.forEach(i):i(t),o}clear(t){const r=Object.keys(this);let n=r.length,o=!1;for(;n--;){const i=r[n];(!t||xn(this,this[i],i,t,!0))&&(delete this[i],o=!0)}return o}normalize(t){const r=this,n={};return g.forEach(this,(o,i)=>{const a=g.findKey(n,i);if(a){r[a]=Or(o),delete r[i];return}const c=t?rc(i):String(i).trim();c!==i&&delete r[i],r[c]=Or(o),n[c]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const r=Object.create(null);return g.forEach(this,(n,o)=>{n!=null&&n!==!1&&(r[o]=t&&g.isArray(n)?n.join(", "):n)}),r}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,r])=>t+": "+r).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...r){const n=new this(t);return r.forEach(o=>n.set(o)),n}static accessor(t){const n=(this[ks]=this[ks]={accessors:{}}).accessors,o=this.prototype;function i(a){const c=rr(a);n[c]||(nc(o,a),n[c]=!0)}return g.isArray(t)?t.forEach(i):i(t),this}};Ae.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);g.reduceDescriptors(Ae.prototype,({value:e},t)=>{let r=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(n){this[r]=n}}});g.freezeMethods(Ae);function bn(e,t){const r=this||ur,n=t||r,o=Ae.from(n.headers);let i=n.data;return g.forEach(e,function(c){i=c.call(r,i,o.normalize(),t?t.status:void 0)}),o.normalize(),i}function yo(e){return!!(e&&e.__CANCEL__)}function Ut(e,t,r){J.call(this,e??"canceled",J.ERR_CANCELED,t,r),this.name="CanceledError"}g.inherits(Ut,J,{__CANCEL__:!0});function xo(e,t,r){const n=r.config.validateStatus;!r.status||!n||n(r.status)?e(r):t(new J("Request failed with status code "+r.status,[J.ERR_BAD_REQUEST,J.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r))}function sc(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}function oc(e,t){e=e||10;const r=new Array(e),n=new Array(e);let o=0,i=0,a;return t=t!==void 0?t:1e3,function(u){const f=Date.now(),l=n[i];a||(a=f),r[o]=u,n[o]=f;let m=i,v=0;for(;m!==o;)v+=r[m++],m=m%e;if(o=(o+1)%e,o===i&&(i=(i+1)%e),f-a<t)return;const S=l&&f-l;return S?Math.round(v*1e3/S):void 0}}function ic(e,t){let r=0,n=1e3/t,o,i;const a=(f,l=Date.now())=>{r=l,o=null,i&&(clearTimeout(i),i=null),e(...f)};return[(...f)=>{const l=Date.now(),m=l-r;m>=n?a(f,l):(o=f,i||(i=setTimeout(()=>{i=null,a(o)},n-m)))},()=>o&&a(o)]}const Mr=(e,t,r=3)=>{let n=0;const o=oc(50,250);return ic(i=>{const a=i.loaded,c=i.lengthComputable?i.total:void 0,u=a-n,f=o(u),l=a<=c;n=a;const m={loaded:a,total:c,progress:c?a/c:void 0,bytes:u,rate:f||void 0,estimated:f&&c&&l?(c-a)/f:void 0,event:i,lengthComputable:c!=null,[t?"download":"upload"]:!0};e(m)},r)},Ps=(e,t)=>{const r=e!=null;return[n=>t[0]({lengthComputable:r,total:e,loaded:n}),t[1]]},zs=e=>(...t)=>g.asap(()=>e(...t)),ac=je.hasStandardBrowserEnv?((e,t)=>r=>(r=new URL(r,je.origin),e.protocol===r.protocol&&e.host===r.host&&(t||e.port===r.port)))(new URL(je.origin),je.navigator&&/(msie|trident)/i.test(je.navigator.userAgent)):()=>!0,cc=je.hasStandardBrowserEnv?{write(e,t,r,n,o,i){const a=[e+"="+encodeURIComponent(t)];g.isNumber(r)&&a.push("expires="+new Date(r).toGMTString()),g.isString(n)&&a.push("path="+n),g.isString(o)&&a.push("domain="+o),i===!0&&a.push("secure"),document.cookie=a.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function lc(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}function uc(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}function bo(e,t,r){let n=!lc(t);return e&&(n||r==!1)?uc(e,t):t}const Is=e=>e instanceof Ae?{...e}:e;function vt(e,t){t=t||{};const r={};function n(f,l,m,v){return g.isPlainObject(f)&&g.isPlainObject(l)?g.merge.call({caseless:v},f,l):g.isPlainObject(l)?g.merge({},l):g.isArray(l)?l.slice():l}function o(f,l,m,v){if(g.isUndefined(l)){if(!g.isUndefined(f))return n(void 0,f,m,v)}else return n(f,l,m,v)}function i(f,l){if(!g.isUndefined(l))return n(void 0,l)}function a(f,l){if(g.isUndefined(l)){if(!g.isUndefined(f))return n(void 0,f)}else return n(void 0,l)}function c(f,l,m){if(m in t)return n(f,l);if(m in e)return n(void 0,f)}const u={url:i,method:i,data:i,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:c,headers:(f,l,m)=>o(Is(f),Is(l),m,!0)};return g.forEach(Object.keys({...e,...t}),function(l){const m=u[l]||o,v=m(e[l],t[l],l);g.isUndefined(v)&&m!==c||(r[l]=v)}),r}const wo=e=>{const t=vt({},e);let{data:r,withXSRFToken:n,xsrfHeaderName:o,xsrfCookieName:i,headers:a,auth:c}=t;if(t.headers=a=Ae.from(a),t.url=mo(bo(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),c&&a.set("Authorization","Basic "+btoa((c.username||"")+":"+(c.password?unescape(encodeURIComponent(c.password)):""))),g.isFormData(r)){if(je.hasStandardBrowserEnv||je.hasStandardBrowserWebWorkerEnv)a.setContentType(void 0);else if(g.isFunction(r.getHeaders)){const u=r.getHeaders(),f=["content-type","content-length"];Object.entries(u).forEach(([l,m])=>{f.includes(l.toLowerCase())&&a.set(l,m)})}}if(je.hasStandardBrowserEnv&&(n&&g.isFunction(n)&&(n=n(t)),n||n!==!1&&ac(t.url))){const u=o&&i&&cc.read(i);u&&a.set(o,u)}return t},dc=typeof XMLHttpRequest<"u",fc=dc&&function(e){return new Promise(function(r,n){const o=wo(e);let i=o.data;const a=Ae.from(o.headers).normalize();let{responseType:c,onUploadProgress:u,onDownloadProgress:f}=o,l,m,v,S,y;function x(){S&&S(),y&&y(),o.cancelToken&&o.cancelToken.unsubscribe(l),o.signal&&o.signal.removeEventListener("abort",l)}let b=new XMLHttpRequest;b.open(o.method.toUpperCase(),o.url,!0),b.timeout=o.timeout;function N(){if(!b)return;const O=Ae.from("getAllResponseHeaders"in b&&b.getAllResponseHeaders()),se={data:!c||c==="text"||c==="json"?b.responseText:b.response,status:b.status,statusText:b.statusText,headers:O,config:e,request:b};xo(function(z){r(z),x()},function(z){n(z),x()},se),b=null}"onloadend"in b?b.onloadend=N:b.onreadystatechange=function(){!b||b.readyState!==4||b.status===0&&!(b.responseURL&&b.responseURL.indexOf("file:")===0)||setTimeout(N)},b.onabort=function(){b&&(n(new J("Request aborted",J.ECONNABORTED,e,b)),b=null)},b.onerror=function(V){const se=V&&V.message?V.message:"Network Error",$=new J(se,J.ERR_NETWORK,e,b);$.event=V||null,n($),b=null},b.ontimeout=function(){let V=o.timeout?"timeout of "+o.timeout+"ms exceeded":"timeout exceeded";const se=o.transitional||ho;o.timeoutErrorMessage&&(V=o.timeoutErrorMessage),n(new J(V,se.clarifyTimeoutError?J.ETIMEDOUT:J.ECONNABORTED,e,b)),b=null},i===void 0&&a.setContentType(null),"setRequestHeader"in b&&g.forEach(a.toJSON(),function(V,se){b.setRequestHeader(se,V)}),g.isUndefined(o.withCredentials)||(b.withCredentials=!!o.withCredentials),c&&c!=="json"&&(b.responseType=o.responseType),f&&([v,y]=Mr(f,!0),b.addEventListener("progress",v)),u&&b.upload&&([m,S]=Mr(u),b.upload.addEventListener("progress",m),b.upload.addEventListener("loadend",S)),(o.cancelToken||o.signal)&&(l=O=>{b&&(n(!O||O.type?new Ut(null,e,b):O),b.abort(),b=null)},o.cancelToken&&o.cancelToken.subscribe(l),o.signal&&(o.signal.aborted?l():o.signal.addEventListener("abort",l)));const E=sc(o.url);if(E&&je.protocols.indexOf(E)===-1){n(new J("Unsupported protocol "+E+":",J.ERR_BAD_REQUEST,e));return}b.send(i||null)})},pc=(e,t)=>{const{length:r}=e=e?e.filter(Boolean):[];if(t||r){let n=new AbortController,o;const i=function(f){if(!o){o=!0,c();const l=f instanceof Error?f:this.reason;n.abort(l instanceof J?l:new Ut(l instanceof Error?l.message:l))}};let a=t&&setTimeout(()=>{a=null,i(new J(`timeout ${t} of ms exceeded`,J.ETIMEDOUT))},t);const c=()=>{e&&(a&&clearTimeout(a),a=null,e.forEach(f=>{f.unsubscribe?f.unsubscribe(i):f.removeEventListener("abort",i)}),e=null)};e.forEach(f=>f.addEventListener("abort",i));const{signal:u}=n;return u.unsubscribe=()=>g.asap(c),u}},mc=function*(e,t){let r=e.byteLength;if(r<t){yield e;return}let n=0,o;for(;n<r;)o=n+t,yield e.slice(n,o),n=o},hc=async function*(e,t){for await(const r of gc(e))yield*mc(r,t)},gc=async function*(e){if(e[Symbol.asyncIterator]){yield*e;return}const t=e.getReader();try{for(;;){const{done:r,value:n}=await t.read();if(r)break;yield n}}finally{await t.cancel()}},Os=(e,t,r,n)=>{const o=hc(e,t);let i=0,a,c=u=>{a||(a=!0,n&&n(u))};return new ReadableStream({async pull(u){try{const{done:f,value:l}=await o.next();if(f){c(),u.close();return}let m=l.byteLength;if(r){let v=i+=m;r(v)}u.enqueue(new Uint8Array(l))}catch(f){throw c(f),f}},cancel(u){return c(u),o.return()}},{highWaterMark:2})},Fs=64*1024,{isFunction:kr}=g,yc=(({Request:e,Response:t})=>({Request:e,Response:t}))(g.global),{ReadableStream:Ls,TextEncoder:$s}=g.global,Ms=(e,...t)=>{try{return!!e(...t)}catch{return!1}},xc=e=>{e=g.merge.call({skipUndefined:!0},yc,e);const{fetch:t,Request:r,Response:n}=e,o=t?kr(t):typeof fetch=="function",i=kr(r),a=kr(n);if(!o)return!1;const c=o&&kr(Ls),u=o&&(typeof $s=="function"?(y=>x=>y.encode(x))(new $s):async y=>new Uint8Array(await new r(y).arrayBuffer())),f=i&&c&&Ms(()=>{let y=!1;const x=new r(je.origin,{body:new Ls,method:"POST",get duplex(){return y=!0,"half"}}).headers.has("Content-Type");return y&&!x}),l=a&&c&&Ms(()=>g.isReadableStream(new n("").body)),m={stream:l&&(y=>y.body)};o&&["text","arrayBuffer","blob","formData","stream"].forEach(y=>{!m[y]&&(m[y]=(x,b)=>{let N=x&&x[y];if(N)return N.call(x);throw new J(`Response type '${y}' is not supported`,J.ERR_NOT_SUPPORT,b)})});const v=async y=>{if(y==null)return 0;if(g.isBlob(y))return y.size;if(g.isSpecCompliantForm(y))return(await new r(je.origin,{method:"POST",body:y}).arrayBuffer()).byteLength;if(g.isArrayBufferView(y)||g.isArrayBuffer(y))return y.byteLength;if(g.isURLSearchParams(y)&&(y=y+""),g.isString(y))return(await u(y)).byteLength},S=async(y,x)=>{const b=g.toFiniteNumber(y.getContentLength());return b??v(x)};return async y=>{let{url:x,method:b,data:N,signal:E,cancelToken:O,timeout:V,onDownloadProgress:se,onUploadProgress:$,responseType:z,headers:F,withCredentials:q="same-origin",fetchOptions:C}=wo(y),D=t||fetch;z=z?(z+"").toLowerCase():"text";let H=pc([E,O&&O.toAbortSignal()],V),K=null;const me=H&&H.unsubscribe&&(()=>{H.unsubscribe()});let Ne;try{if($&&f&&b!=="get"&&b!=="head"&&(Ne=await S(F,N))!==0){let R=new r(x,{method:"POST",body:N,duplex:"half"}),P;if(g.isFormData(N)&&(P=R.headers.get("content-type"))&&F.setContentType(P),R.body){const[A,ce]=Ps(Ne,Mr(zs($)));N=Os(R.body,Fs,A,ce)}}g.isString(q)||(q=q?"include":"omit");const be=i&&"credentials"in r.prototype,it={...C,signal:H,method:b.toUpperCase(),headers:F.normalize().toJSON(),body:N,duplex:"half",credentials:be?q:void 0};K=i&&new r(x,it);let we=await(i?D(K,C):D(x,it));const jt=l&&(z==="stream"||z==="response");if(l&&(se||jt&&me)){const R={};["status","statusText","headers"].forEach(he=>{R[he]=we[he]});const P=g.toFiniteNumber(we.headers.get("content-length")),[A,ce]=se&&Ps(P,Mr(zs(se),!0))||[];we=new n(Os(we.body,Fs,A,()=>{ce&&ce(),me&&me()}),R)}z=z||"text";let Ve=await m[g.findKey(m,z)||"text"](we,y);return!jt&&me&&me(),await new Promise((R,P)=>{xo(R,P,{data:Ve,headers:Ae.from(we.headers),status:we.status,statusText:we.statusText,config:y,request:K})})}catch(be){throw me&&me(),be&&be.name==="TypeError"&&/Load failed|fetch/i.test(be.message)?Object.assign(new J("Network Error",J.ERR_NETWORK,y,K),{cause:be.cause||be}):J.from(be,be&&be.code,y,K)}}},bc=new Map,vo=e=>{let t=e?e.env:{};const{fetch:r,Request:n,Response:o}=t,i=[n,o,r];let a=i.length,c=a,u,f,l=bc;for(;c--;)u=i[c],f=l.get(u),f===void 0&&l.set(u,f=c?new Map:xc(t)),l=f;return f};vo();const _n={http:Fa,xhr:fc,fetch:{get:vo}};g.forEach(_n,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});const qs=e=>`- ${e}`,wc=e=>g.isFunction(e)||e===null||e===!1,So={getAdapter:(e,t)=>{e=g.isArray(e)?e:[e];const{length:r}=e;let n,o;const i={};for(let a=0;a<r;a++){n=e[a];let c;if(o=n,!wc(n)&&(o=_n[(c=String(n)).toLowerCase()],o===void 0))throw new J(`Unknown adapter '${c}'`);if(o&&(g.isFunction(o)||(o=o.get(t))))break;i[c||"#"+a]=o}if(!o){const a=Object.entries(i).map(([u,f])=>`adapter ${u} `+(f===!1?"is not supported by the environment":"is not available in the build"));let c=r?a.length>1?`since :
`+a.map(qs).join(`
`):" "+qs(a[0]):"as no adapter specified";throw new J("There is no suitable adapter to dispatch the request "+c,"ERR_NOT_SUPPORT")}return o},adapters:_n};function wn(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Ut(null,e)}function Ds(e){return wn(e),e.headers=Ae.from(e.headers),e.data=bn.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),So.getAdapter(e.adapter||ur.adapter,e)(e).then(function(n){return wn(e),n.data=bn.call(e,e.transformResponse,n),n.headers=Ae.from(n.headers),n},function(n){return yo(n)||(wn(e),n&&n.response&&(n.response.data=bn.call(e,e.transformResponse,n.response),n.response.headers=Ae.from(n.response.headers))),Promise.reject(n)})}const jo="1.12.2",Gr={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{Gr[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}});const Us={};Gr.transitional=function(t,r,n){function o(i,a){return"[Axios v"+jo+"] Transitional option '"+i+"'"+a+(n?". "+n:"")}return(i,a,c)=>{if(t===!1)throw new J(o(a," has been removed"+(r?" in "+r:"")),J.ERR_DEPRECATED);return r&&!Us[a]&&(Us[a]=!0,console.warn(o(a," has been deprecated since v"+r+" and will be removed in the near future"))),t?t(i,a,c):!0}};Gr.spelling=function(t){return(r,n)=>(console.warn(`${n} is likely a misspelling of ${t}`),!0)};function vc(e,t,r){if(typeof e!="object")throw new J("options must be an object",J.ERR_BAD_OPTION_VALUE);const n=Object.keys(e);let o=n.length;for(;o-- >0;){const i=n[o],a=t[i];if(a){const c=e[i],u=c===void 0||a(c,i,e);if(u!==!0)throw new J("option "+i+" must be "+u,J.ERR_BAD_OPTION_VALUE);continue}if(r!==!0)throw new J("Unknown option "+i,J.ERR_BAD_OPTION)}}const Fr={assertOptions:vc,validators:Gr},Ye=Fr.validators;let wt=class{constructor(t){this.defaults=t||{},this.interceptors={request:new As,response:new As}}async request(t,r){try{return await this._request(t,r)}catch(n){if(n instanceof Error){let o={};Error.captureStackTrace?Error.captureStackTrace(o):o=new Error;const i=o.stack?o.stack.replace(/^.+\n/,""):"";try{n.stack?i&&!String(n.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+i):n.stack=i}catch{}}throw n}}_request(t,r){typeof t=="string"?(r=r||{},r.url=t):r=t||{},r=vt(this.defaults,r);const{transitional:n,paramsSerializer:o,headers:i}=r;n!==void 0&&Fr.assertOptions(n,{silentJSONParsing:Ye.transitional(Ye.boolean),forcedJSONParsing:Ye.transitional(Ye.boolean),clarifyTimeoutError:Ye.transitional(Ye.boolean)},!1),o!=null&&(g.isFunction(o)?r.paramsSerializer={serialize:o}:Fr.assertOptions(o,{encode:Ye.function,serialize:Ye.function},!0)),r.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?r.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:r.allowAbsoluteUrls=!0),Fr.assertOptions(r,{baseUrl:Ye.spelling("baseURL"),withXsrfToken:Ye.spelling("withXSRFToken")},!0),r.method=(r.method||this.defaults.method||"get").toLowerCase();let a=i&&g.merge(i.common,i[r.method]);i&&g.forEach(["delete","get","head","post","put","patch","common"],y=>{delete i[y]}),r.headers=Ae.concat(a,i);const c=[];let u=!0;this.interceptors.request.forEach(function(x){typeof x.runWhen=="function"&&x.runWhen(r)===!1||(u=u&&x.synchronous,c.unshift(x.fulfilled,x.rejected))});const f=[];this.interceptors.response.forEach(function(x){f.push(x.fulfilled,x.rejected)});let l,m=0,v;if(!u){const y=[Ds.bind(this),void 0];for(y.unshift(...c),y.push(...f),v=y.length,l=Promise.resolve(r);m<v;)l=l.then(y[m++],y[m++]);return l}v=c.length;let S=r;for(;m<v;){const y=c[m++],x=c[m++];try{S=y(S)}catch(b){x.call(this,b);break}}try{l=Ds.call(this,S)}catch(y){return Promise.reject(y)}for(m=0,v=f.length;m<v;)l=l.then(f[m++],f[m++]);return l}getUri(t){t=vt(this.defaults,t);const r=bo(t.baseURL,t.url,t.allowAbsoluteUrls);return mo(r,t.params,t.paramsSerializer)}};g.forEach(["delete","get","head","options"],function(t){wt.prototype[t]=function(r,n){return this.request(vt(n||{},{method:t,url:r,data:(n||{}).data}))}});g.forEach(["post","put","patch"],function(t){function r(n){return function(i,a,c){return this.request(vt(c||{},{method:t,headers:n?{"Content-Type":"multipart/form-data"}:{},url:i,data:a}))}}wt.prototype[t]=r(),wt.prototype[t+"Form"]=r(!0)});let Sc=class No{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let r;this.promise=new Promise(function(i){r=i});const n=this;this.promise.then(o=>{if(!n._listeners)return;let i=n._listeners.length;for(;i-- >0;)n._listeners[i](o);n._listeners=null}),this.promise.then=o=>{let i;const a=new Promise(c=>{n.subscribe(c),i=c}).then(o);return a.cancel=function(){n.unsubscribe(i)},a},t(function(i,a,c){n.reason||(n.reason=new Ut(i,a,c),r(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const r=this._listeners.indexOf(t);r!==-1&&this._listeners.splice(r,1)}toAbortSignal(){const t=new AbortController,r=n=>{t.abort(n)};return this.subscribe(r),t.signal.unsubscribe=()=>this.unsubscribe(r),t.signal}static source(){let t;return{token:new No(function(o){t=o}),cancel:t}}};function jc(e){return function(r){return e.apply(null,r)}}function Nc(e){return g.isObject(e)&&e.isAxiosError===!0}const An={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(An).forEach(([e,t])=>{An[t]=e});function Co(e){const t=new wt(e),r=to(wt.prototype.request,t);return g.extend(r,wt.prototype,t,{allOwnKeys:!0}),g.extend(r,t,null,{allOwnKeys:!0}),r.create=function(o){return Co(vt(e,o))},r}const ie=Co(ur);ie.Axios=wt;ie.CanceledError=Ut;ie.CancelToken=Sc;ie.isCancel=yo;ie.VERSION=jo;ie.toFormData=Hr;ie.AxiosError=J;ie.Cancel=ie.CanceledError;ie.all=function(t){return Promise.all(t)};ie.spread=jc;ie.isAxiosError=Nc;ie.mergeConfig=vt;ie.AxiosHeaders=Ae;ie.formToJSON=e=>go(g.isHTMLForm(e)?new FormData(e):e);ie.getAdapter=So.getAdapter;ie.HttpStatusCode=An;ie.default=ie;const{Axios:sl,AxiosError:ol,CanceledError:il,isCancel:al,CancelToken:cl,VERSION:ll,all:ul,Cancel:dl,isAxiosError:fl,spread:pl,toFormData:ml,AxiosHeaders:hl,HttpStatusCode:gl,formToJSON:yl,getAdapter:xl,mergeConfig:bl}=ie,Cc=()=>"http://localhost:8000".replace(/\/+$/,""),pt=Cc(),It=()=>{const e=Ft();return e?{[jn]:e}:{}};function Ec(e){return(e||"").toString().normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").toLowerCase().replace(/[^a-z0-9]+/g," ").trim()}async function Pr(){try{const e=await ie.get(`${pt}/api/cart`,{headers:It()}),t=Le.getState().setCartFromServer;typeof t=="function"&&t(e.data)}catch(e){console.warn("Cart sync from server failed:",(e==null?void 0:e.message)||e)}}function xt(e){try{const t=(e||[]).map(n=>{var o,i,a;return{item_id:n.id,product_id:(o=n.product)==null?void 0:o.id,name:(i=n.product)==null?void 0:i.name,size:n.size,color:n.color,quantity:n.quantity,price:(a=n.product)==null?void 0:a.price}}),r={};for(const n of t){const o=Ec(`${n.name} ${n.size||""} ${n.color||""}`);o&&(r[o]=n.item_id)}window.cartSnapshot=t,window.cartItemsMap=r,window.dispatchEvent(new CustomEvent("aiva-cart-changed",{detail:t}))}catch{}}function Bs(e=5){var t;try{const r=Le.getState(),n=Array.isArray(r.cart)?r.cart:[];if(n.length===0)return"Il carrello è vuoto.";const o=[];for(let c=0;c<Math.min(n.length,e);c++){const u=n[c],f=((t=u==null?void 0:u.product)==null?void 0:t.name)||"prodotto",l=(u==null?void 0:u.quantity)||1,m=u!=null&&u.size?`, taglia ${u.size}`:"",v=u!=null&&u.color?`, ${u.color}`:"",S=l===1?"pezzo":"pezzi";o.push(`${l} ${S} di ${f}${m}${v}`)}const i=n.length-Math.min(n.length,e),a=i>0?`, e altri ${i} articoli.`:".";return`Nel carrello ci sono: ${o.join(". ")}${a}`}catch{return"Il carrello è vuoto."}}const Bt=()=>{const{cart:e,cartTotal:t,cartCount:r,addToCart:n,removeFromCart:o,clearCart:i,updateQuantity:a}=Le(),[c,u]=d.useState(!1),[f,l]=d.useState(null),[m,v]=d.useState(0);d.useEffect(()=>{t>=100?v(0):r>0?v(9.9):v(0)},[t,r]),d.useEffect(()=>{xt(e)},[e]);const S=d.useCallback(async(F,q,C,D=1)=>{try{if(u(!0),l(null),!(await ie.get(`${pt}/api/products/${F.id}/availability`,{params:{size:q,color:C},headers:It()})).data.available)throw new Error("Variante non disponibile");return n(F,q,C,D),xt(Le.getState().cart),await ie.post(`${pt}/api/cart/items`,{product_id:F.id,size:q,color:C,quantity:D},{headers:{...It(),"Content-Type":"application/json"}}),await Pr(),!0}catch(H){return l(H.message||"Errore aggiunta al carrello"),console.error("Add to cart error:",H),!1}finally{u(!1)}},[n]),y=d.useCallback(async F=>{try{return u(!0),l(null),o(F),xt(Le.getState().cart),await ie.delete(`${pt}/api/cart/items/${F}`,{headers:It()}),await Pr(),!0}catch(q){return l(q.message||"Errore rimozione dal carrello"),console.error("Remove from cart error:",q),!1}finally{u(!1)}},[o]),x=d.useCallback(async()=>{if(e.length===0)return l("Il carrello è vuoto"),!1;const F=e[e.length-1];return y(F.id)},[e,y]),b=d.useCallback(async F=>{try{u(!0),l(null);const q=e.filter(C=>C.product.category.toLowerCase()===F.toLowerCase());if(q.length===0)return l(`Nessun prodotto della categoria ${F} nel carrello`),!1;for(const C of q)o(C.id);return xt(Le.getState().cart),await ie.post(`${pt}/api/cart/remove-category`,{category:F}),!0}catch(q){return l(q.message||"Errore rimozione categoria"),!1}finally{u(!1)}},[e,o]),N=d.useCallback(async(F,q)=>{if(q<1||q>10)return l("Quantità deve essere tra 1 e 10"),!1;try{return u(!0),l(null),a(F,q),xt(Le.getState().cart),await ie.put(`${pt}/api/cart/items/${F}`,{quantity:q},{headers:It()}),await Pr(),!0}catch(C){return l(C.message||"Errore aggiornamento quantità"),!1}finally{u(!1)}},[a]),E=d.useCallback(async(F,q=1)=>{const C=e.find(H=>H.id===F);if(!C)return l("Prodotto non trovato nel carrello"),!1;const D=C.quantity+q;return N(F,D)},[e,N]),O=d.useCallback(async(F,q=1)=>{const C=e.find(H=>H.id===F);if(!C)return l("Prodotto non trovato nel carrello"),!1;const D=C.quantity-q;return D<=0?y(F):N(F,D)},[e,N,y]),V=d.useCallback(async()=>{try{return u(!0),l(null),i(),xt(Le.getState().cart),await ie.post(`${pt}/api/cart/clear`,{},{headers:It()}),await Pr(),!0}catch(F){return l(F.message||"Errore svuotamento carrello"),!1}finally{u(!1)}},[i]),se=d.useCallback(()=>{const F=t,q=m,C=F+q;return{items:e,itemCount:r,subtotal:F,shipping:q,total:C}},[e,r,t,m]),$=d.useCallback((F,q=null,C=null)=>e.some(D=>{const H=D.product.id===F,K=!q||D.size===q,me=!C||D.color===C;return H&&K&&me}),[e]),z=d.useCallback((F,q=null,C=null)=>{const D=e.find(H=>{const K=H.product.id===F,me=!q||H.size===q,Ne=!C||H.color===C;return K&&me&&Ne});return D?D.quantity:0},[e]);return d.useEffect(()=>{(async()=>{try{const q=await ie.get(`${pt}/api/cart`),C=Le.getState().setCartFromServer;typeof C=="function"&&C(q.data)}catch(q){console.error("Failed to sync cart:",q)}})()},[]),{cart:e,cartCount:r,cartTotal:t,shipping:m,grandTotal:t+m,loading:c,error:f,addToCart:S,removeFromCart:y,removeLastItem:x,removeByCategory:b,updateQuantity:N,increaseQuantity:E,decreaseQuantity:O,clearCart:V,getCartSummary:se,isInCart:$,getItemQuantity:z}},Eo=()=>{const[e,t]=d.useState([]),[r,n]=d.useState(!1);d.useEffect(()=>{const l=localStorage.getItem("aiva-favorites");if(l)try{t(JSON.parse(l))}catch(m){console.error("Error loading favorites:",m),t([])}},[]),d.useEffect(()=>{localStorage.setItem("aiva-favorites",JSON.stringify(e))},[e]);const o=d.useCallback(l=>{t(m=>m.some(S=>S.id===l.id)?m:[...m,l])},[]),i=d.useCallback(l=>{t(m=>m.filter(v=>v.id!==l))},[]),a=d.useCallback(l=>{e.some(v=>v.id===l.id)?i(l.id):o(l)},[e,o,i]),c=d.useCallback(l=>e.some(m=>m.id===l),[e]),u=d.useCallback(()=>{t([])},[]),f=e.length;return{favorites:e,favoritesCount:f,addToFavorites:o,removeFromFavorites:i,toggleFavorite:a,isFavorite:c,clearFavorites:u,loading:r}},Tc=({product:e,onAddToCart:t,onToggleFavorite:r,isFavorite:n})=>{var u;const[o,i]=d.useState(!1),a=or(),c=()=>{a(`/products/${e.id}`)};return s.jsxs(_.div,{className:"bg-white rounded-xl shadow-sm overflow-hidden cursor-pointer",whileHover:{y:-8,shadow:"xl"},transition:{type:"spring",stiffness:300},onHoverStart:()=>i(!0),onHoverEnd:()=>i(!1),onClick:c,children:[s.jsxs("div",{className:"relative overflow-hidden h-72 bg-gray-100",children:[s.jsx(_.img,{src:Nn(((u=e.images)==null?void 0:u[0])||e.image||"/static/images/placeholder.jpg"),alt:e.name,className:"w-full h-full object-cover",animate:{scale:o?1.1:1},transition:{duration:.3}}),(()=>{const f=Number(e.discount_percentage??e.discount??0),l=Number(e.original_price??e.originalPrice??0),m=Number(e.price??0);return f>0&&l>m})()&&s.jsxs(_.div,{className:"absolute top-4 left-4 bg-red-500 text-white px-3 py-1 rounded-full text-sm font-bold",initial:{rotate:-15},animate:{rotate:o?0:-15},children:["-",Number(e.discount_percentage??e.discount??0),"%"]}),s.jsx(_.div,{className:"absolute top-4 right-4",whileHover:{scale:1.2},whileTap:{scale:.9},onClick:f=>{f.stopPropagation(),r(e)},children:s.jsx("button",{className:`p-2 rounded-full shadow-md transition-colors ${n?"bg-red-500 text-white hover:bg-red-600":"bg-white text-gray-600 hover:bg-gray-100"}`,children:s.jsx(qr,{size:20,fill:n?"currentColor":"none"})})})]}),s.jsxs("div",{className:"p-4",children:[s.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wider mb-1",children:e.brand}),s.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:e.name}),s.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[s.jsx("div",{className:"flex items-center",children:[...Array(5)].map((f,l)=>s.jsx(Dr,{size:14,className:l<Math.floor(e.rating)?"text-yellow-400 fill-current":"text-gray-300"},l))}),s.jsxs("span",{className:"text-xs text-gray-500",children:["(",e.reviews,")"]})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[(()=>{const f=Number(e.discount_percentage??e.discount??0),l=Number(e.original_price??e.originalPrice??0),m=Number(e.price??0);return f>0&&l>m?s.jsxs("span",{className:"text-sm text-gray-400 line-through mr-2",children:["€",l.toFixed(2)]}):null})(),s.jsxs("span",{className:"text-xl font-bold text-gray-900",children:["€",Number(e.price??0).toFixed(2)]})]}),s.jsx(_.button,{onClick:f=>{f.stopPropagation(),t(e)},className:"p-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",whileHover:{scale:1.05},whileTap:{scale:.95},children:s.jsx(St,{size:20})})]})]})]})},Rc=()=>{var Ve;const[e,t]=d.useState([]),[r,n]=d.useState([]),[o,i]=d.useState(!0),[a,c]=d.useState(null),[u,f]=d.useState(""),[l,m]=d.useState(""),[v,S]=d.useState("name"),[y,x]=d.useState("grid"),[b,N]=d.useState(!1),[E,O]=d.useState(null),[V,se]=d.useState(""),[$,z]=d.useState(""),[F,q]=d.useState(!1),{toggleFavorite:C,isFavorite:D}=Eo(),{addToCart:H}=Bt(),K=[{id:"",name:"Tutte le categorie"},{id:"t-shirt",name:"T-Shirt"},{id:"camicia",name:"Camicie"},{id:"maglione",name:"Maglioni"},{id:"felpa",name:"Felpe"},{id:"giacca",name:"Giacche"},{id:"pantaloni",name:"Pantaloni"},{id:"shorts",name:"Shorts"},{id:"gonna",name:"Gonne"},{id:"vestito",name:"Vestiti"},{id:"scarpe",name:"Scarpe"},{id:"accessori",name:"Accessori"}];d.useEffect(()=>{(async()=>{try{i(!0),c(null);const P={};l&&(P.category=l),u&&(P.q=u);const A=await Lt.getProducts(P);t(A),n(A)}catch(P){console.error("Error loading products:",P),c("Errore nel caricamento dei prodotti. Riprova più tardi.")}finally{i(!1)}})()},[l,u]),d.useEffect(()=>{let R=[...e];R.sort((P,A)=>{switch(v){case"price-low":return P.price-A.price;case"price-high":return A.price-P.price;case"rating":return A.rating-P.rating;case"name":default:return P.name.localeCompare(A.name)}}),n(R)},[e,v]),d.useEffect(()=>{const R=ce=>(ce||"").toLowerCase().normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").replace(/[^a-z0-9\s]/g,"").trim(),P=(r||[]).map(ce=>ce.id),A=Object.fromEntries((r||[]).map(ce=>[R(ce.name),ce.id]));return window.visibleProductIds=P,window.visibleProductsMap=A,window.productsSearchQuery=u||"",window.productsSelectedCategory=l||"",window.applyProductFilters=({query:ce,q:he,category:W,sort:$e,price_range:Me}={})=>{const ke=ce??he;typeof ke=="string"&&f(ke),typeof W=="string"&&m(W),typeof $e=="string"&&S($e),Me==="low-to-high"&&S("price-low"),Me==="high-to-low"&&S("price-high"),window.scrollTo({top:0,behavior:"smooth"})},()=>{delete window.visibleProductIds,delete window.visibleProductsMap,delete window.applyProductFilters,delete window.productsSearchQuery,delete window.productsSelectedCategory}},[r,u,l,f,m,S]);const me=R=>{const P=new Set;return((R==null?void 0:R.variants)||[]).forEach(A=>{A.available&&P.add(A.size)}),Array.from(P)},Ne=R=>{const P=new Set;return((R==null?void 0:R.variants)||[]).forEach(A=>{A.available&&P.add(A.color)}),Array.from(P)},be=(R,P,A)=>((R==null?void 0:R.variants)||[]).some(he=>he.size===P&&he.color===A&&he.available),it=R=>{O(R);const P=me(R),A=Ne(R),ce=P[0]||"",he=A[0]||"";se(ce),z(he),N(!0)},we=R=>{it(R)},jt=async()=>{if(E&&!(!V||!$)&&be(E,V,$))try{q(!0),await H(E,V,$,1),N(!1),O(null),console.log("Product added to cart:",E==null?void 0:E.name)}catch(R){console.error("Error adding to cart:",R)}finally{q(!1)}};return o?s.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600 mx-auto mb-4"}),s.jsx("p",{className:"text-gray-600",children:"Caricamento prodotti..."})]})}):s.jsxs("div",{className:"min-h-screen bg-gray-50",children:[s.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[s.jsxs(_.div,{className:"mb-8",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[s.jsx("h1",{className:"text-4xl font-bold text-gray-900 mb-4",children:"Prodotti"}),s.jsx("p",{className:"text-gray-600",children:"Scopri la nostra collezione di moda italiana"})]}),s.jsx(_.div,{className:"bg-white rounded-lg shadow-sm p-6 mb-8",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:s.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 items-center justify-between",children:[s.jsx("div",{className:"flex-1 max-w-md",children:s.jsx("input",{type:"text",placeholder:"Cerca prodotti...",value:u,onChange:R=>f(R.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(hs,{size:20,className:"text-gray-500"}),s.jsx("select",{value:l,onChange:R=>m(R.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:K.map(R=>s.jsx("option",{value:R.id,children:R.name},R.id))})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-gray-500",children:"Ordina per:"}),s.jsxs("select",{value:v,onChange:R=>S(R.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[s.jsx("option",{value:"name",children:"Nome"}),s.jsx("option",{value:"price-low",children:"Prezzo: Basso-Alto"}),s.jsx("option",{value:"price-high",children:"Prezzo: Alto-Basso"}),s.jsx("option",{value:"rating",children:"Valutazione"})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:()=>x("grid"),className:`p-2 rounded ${y==="grid"?"bg-blue-100 text-blue-600":"text-gray-500"}`,children:s.jsx(ti,{size:20})}),s.jsx("button",{onClick:()=>x("list"),className:`p-2 rounded ${y==="list"?"bg-blue-100 text-blue-600":"text-gray-500"}`,children:s.jsx(ri,{size:20})})]})]})}),s.jsx("div",{className:"mb-6",children:s.jsxs("p",{className:"text-gray-600",children:[r.length," prodotti trovati",u&&` per "${u}"`,l&&` in ${(Ve=K.find(R=>R.id===l))==null?void 0:Ve.name}`]})}),s.jsx(_.div,{className:`grid gap-6 ${y==="grid"?"grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4":"grid-cols-1"}`,initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},children:r.map((R,P)=>s.jsx(_.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:P*.1},children:s.jsx(Tc,{product:R,onAddToCart:we,onToggleFavorite:C,isFavorite:D(R.id)})},R.id))}),r.length===0&&s.jsxs(_.div,{className:"text-center py-12",initial:{opacity:0},animate:{opacity:1},children:[s.jsx("div",{className:"text-gray-400 mb-4",children:s.jsx(hs,{size:64,className:"mx-auto"})}),s.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Nessun prodotto trovato"}),s.jsx("p",{className:"text-gray-600 mb-4",children:"Prova a modificare i filtri o la ricerca"}),s.jsx("button",{onClick:()=>{f(""),m("")},className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Rimuovi filtri"})]})]}),b&&E&&s.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[s.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>N(!1)}),s.jsxs(_.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"relative bg-white rounded-2xl shadow-xl w-full max-w-md p-6 z-10",onClick:R=>R.stopPropagation(),children:[s.jsxs("div",{className:"flex items-start justify-between mb-4",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:E.name}),s.jsx("p",{className:"text-sm text-gray-500",children:E.brand})]}),s.jsx("button",{onClick:()=>N(!1),className:"p-2 rounded-full hover:bg-gray-100",children:s.jsx(Mt,{size:18})})]}),s.jsxs("div",{className:"space-y-5",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Seleziona taglia"}),s.jsx("div",{className:"flex flex-wrap gap-2",children:me(E).map(R=>s.jsx("button",{onClick:()=>se(R),className:`px-3 py-2 rounded-lg border text-sm font-medium ${V===R?"border-blue-600 text-blue-600 bg-blue-50":"border-gray-300 text-gray-700 hover:border-gray-400"}`,children:R},R))})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Seleziona colore"}),s.jsx("div",{className:"flex flex-wrap gap-2",children:Ne(E).map(R=>s.jsx("button",{onClick:()=>z(R),className:`px-3 py-2 rounded-lg border text-sm font-medium capitalize ${$===R?"border-blue-600 text-blue-600 bg-blue-50":"border-gray-300 text-gray-700 hover:border-gray-400"}`,children:R},R))})]}),s.jsxs("div",{className:"flex items-center gap-3 pt-2",children:[s.jsxs("button",{onClick:jt,disabled:F||!V||!$||!be(E,V,$),className:"flex-1 inline-flex items-center justify-center gap-2 bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 disabled:opacity-60",children:[s.jsx(St,{size:18}),F?"Aggiungo...":"Aggiungi al carrello"]}),s.jsx("button",{onClick:()=>N(!1),className:"px-4 py-3 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-50",children:"Annulla"})]})]})]})]})]})},_c=({offer:e,onAddToCart:t})=>{const[r,n]=d.useState(!1);return s.jsxs(_.div,{className:"bg-white rounded-xl shadow-sm overflow-hidden cursor-pointer relative",whileHover:{y:-8,shadow:"xl"},transition:{type:"spring",stiffness:300},onHoverStart:()=>n(!0),onHoverEnd:()=>n(!1),children:[s.jsx("div",{className:"absolute top-4 left-4 z-10",children:s.jsxs(_.div,{className:"bg-red-500 text-white px-3 py-1 rounded-full text-sm font-bold flex items-center gap-1",initial:{rotate:-15},animate:{rotate:r?0:-15},children:[s.jsx(Ws,{size:14}),"-",e.discount,"%"]})}),s.jsxs("div",{className:"relative overflow-hidden h-72 bg-gray-100",children:[s.jsx(_.img,{src:e.image,alt:e.name,className:"w-full h-full object-cover",animate:{scale:r?1.1:1},transition:{duration:.3}}),s.jsx(_.div,{className:"absolute top-4 right-16",whileHover:{scale:1.2},whileTap:{scale:.9},children:s.jsx("button",{className:"p-2 bg-white rounded-full shadow-md hover:bg-gray-100",children:s.jsx(qr,{size:20,className:"text-gray-600"})})})]}),s.jsxs("div",{className:"p-4",children:[s.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wider mb-1",children:e.brand}),s.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:e.name}),s.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[s.jsx("div",{className:"flex items-center",children:[...Array(5)].map((o,i)=>s.jsx(Dr,{size:14,className:i<Math.floor(e.rating)?"text-yellow-400 fill-current":"text-gray-300"},i))}),s.jsxs("span",{className:"text-xs text-gray-500",children:["(",e.reviews,")"]})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsxs("span",{className:"text-sm text-gray-400 line-through mr-2",children:["€",Number(e.originalPrice??0).toFixed(2)]}),s.jsxs("span",{className:"text-xl font-bold text-red-600",children:["€",Number(e.price??0).toFixed(2)]}),s.jsxs("div",{className:"text-xs text-green-600 font-semibold",children:["Risparmi €",(Number(e.originalPrice??0)-Number(e.price??0)).toFixed(2)]})]}),s.jsx(_.button,{onClick:()=>t(e),className:"p-2 bg-red-600 text-white rounded-lg hover:bg-red-700",whileHover:{scale:1.05},whileTap:{scale:.95},children:s.jsx(St,{size:20})})]})]})]})},Ac=()=>{const[e,t]=d.useState([]),[r,n]=d.useState(!0),[o,i]=d.useState(null),{addToCart:a}=Bt(),[c,u]=d.useState(!1),[f,l]=d.useState(null),[m,v]=d.useState(""),[S,y]=d.useState(""),[x,b]=d.useState(!1);d.useEffect(()=>{(async()=>{try{n(!0),i(null);const H=(await Lt.getProducts({on_sale:!0})).map((K,me)=>{var Ne;return{id:K.id,name:K.name,brand:K.brand,price:K.price,originalPrice:K.original_price,discount:K.discount_percentage,image:((Ne=K.images)==null?void 0:Ne[0])||"https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?w=400",rating:K.rating,reviews:K.reviews,category:K.category,variants:K.variants}});t(H)}catch(D){console.error("Error loading offers:",D),i("Errore nel caricamento delle offerte. Riprova più tardi.")}finally{n(!1)}})()},[]),d.useEffect(()=>{try{const C={};(e||[]).forEach(D=>{const H=(D.name||"").toLowerCase().normalize("NFKD").replace(/[^\w\s]/g,"").trim();H&&(C[H]=D.id)}),window.visibleProductsMap=C,window.visibleProductIds=(e||[]).map(D=>D.id),window.currentPageContext="offers"}catch{}return()=>{if(window.currentPageContext==="offers")try{delete window.visibleProductsMap,delete window.visibleProductIds,delete window.currentPageContext}catch{}}},[e]),d.useEffect(()=>{const C=D=>{};return window.addEventListener("offers-apply-filters",C),()=>window.removeEventListener("offers-apply-filters",C)},[]);const N=C=>{const D=new Set;return((C==null?void 0:C.variants)||[]).forEach(H=>{H!=null&&H.available&&D.add(H.size)}),Array.from(D)},E=(C,D=null)=>{const H=new Set;return((C==null?void 0:C.variants)||[]).forEach(K=>{K!=null&&K.available&&(D&&K.size!==D||H.add(K.color))}),Array.from(H)},O=(C,D,H)=>!C||!D||!H?!1:(C.variants||[]).some(K=>(K==null?void 0:K.available)&&K.size===D&&K.color===H),V=()=>{u(!1),l(null),v(""),y(""),b(!1)},se=C=>{if(!C)return;l(C);const H=N(C)[0]||"",K=E(C,H),me=E(C),Ne=K[0]||me[0]||"";v(H),y(Ne),u(!0)},$=C=>{if(v(C),!f)return;const D=E(f,C);y(H=>D.includes(H)?H:D[0]||"")},z=C=>{y(C)},F=async()=>{if(!(!f||!m||!S)&&O(f,m,S))try{b(!0);const C=f==null?void 0:f.name;await a(f,m,S,1),V(),console.log("Offer added to cart:",C)}catch(C){console.error("Error adding offer to cart:",C)}finally{b(!1)}},q=C=>{se(C)};return r?s.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-red-600 mx-auto mb-4"}),s.jsx("p",{className:"text-gray-600",children:"Caricamento offerte..."})]})}):s.jsx("div",{className:"min-h-screen bg-gray-50",children:s.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[s.jsxs(_.div,{className:"mb-8",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[s.jsx("h1",{className:"text-4xl font-bold text-gray-900 mb-4",children:"Offerte Speciali"}),s.jsx("p",{className:"text-gray-600",children:"Scopri una selezione di prodotti in sconto"})]}),s.jsx("div",{className:"mb-6",children:s.jsxs("p",{className:"text-gray-600",children:[e.length," offerte disponibili"]})}),s.jsx(_.div,{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},children:e.map((C,D)=>s.jsx(_.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:D*.1},children:s.jsx(_c,{offer:C,onAddToCart:q})},C.id))}),e.length===0&&s.jsxs(_.div,{className:"text-center py-12",initial:{opacity:0},animate:{opacity:1},children:[s.jsx("div",{className:"text-gray-400 mb-4",children:s.jsx(Ws,{size:64,className:"mx-auto"})}),s.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Nessuna offerta trovata"}),s.jsx("p",{className:"text-gray-600 mb-4",children:"Controlla di nuovo più tardi per nuove offerte"})]}),c&&f&&s.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[s.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:V}),s.jsxs(_.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"relative bg-white rounded-2xl shadow-xl w-full max-w-md p-6 z-10",onClick:C=>C.stopPropagation(),children:[s.jsxs("div",{className:"flex items-start justify-between mb-4",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:f.name}),s.jsx("p",{className:"text-sm text-gray-500",children:f.brand})]}),s.jsx("button",{onClick:V,className:"p-2 rounded-full hover:bg-gray-100",children:s.jsx(Mt,{size:18})})]}),s.jsxs("div",{className:"space-y-5",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Seleziona taglia"}),s.jsx("div",{className:"flex flex-wrap gap-2",children:N(f).map(C=>s.jsx("button",{onClick:()=>$(C),className:`px-3 py-2 rounded-lg border text-sm font-medium ${m===C?"border-red-600 text-red-600 bg-red-50":"border-gray-300 text-gray-700 hover:border-gray-400"}`,children:C},C))})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Seleziona colore"}),s.jsx("div",{className:"flex flex-wrap gap-2",children:E(f,m||void 0).map(C=>s.jsx("button",{onClick:()=>z(C),className:`px-3 py-2 rounded-lg border text-sm font-medium capitalize ${S===C?"border-red-600 text-red-600 bg-red-50":"border-gray-300 text-gray-700 hover:border-gray-400"}`,children:C},C))})]}),s.jsxs("div",{className:"flex items-center gap-3 pt-2",children:[s.jsxs("button",{onClick:F,disabled:x||!m||!S||!O(f,m,S),className:"flex-1 inline-flex items-center justify-center gap-2 bg-red-600 text-white py-3 rounded-lg hover:bg-red-700 disabled:opacity-60",children:[s.jsx(St,{size:18}),x?"Aggiungo...":"Aggiungi al carrello"]}),s.jsx("button",{onClick:V,className:"px-4 py-3 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-50",children:"Annulla"})]})]})]})]}),s.jsxs(_.div,{className:"mt-16 bg-gradient-to-r from-red-500 to-orange-500 rounded-xl p-8 text-white text-center",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},children:[s.jsx("h2",{className:"text-3xl font-bold mb-4",children:"Non Perdere le Offerte!"}),s.jsx("p",{className:"text-xl mb-6 opacity-90",children:"Iscriviti alla newsletter per ricevere notifiche sulle offerte esclusive"}),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 max-w-md mx-auto",children:[s.jsx("input",{type:"email",placeholder:"La tua email",className:"flex-1 px-4 py-3 rounded-lg text-gray-900 placeholder-gray-500"}),s.jsx("button",{className:"px-6 py-3 bg-white text-red-600 font-semibold rounded-lg hover:bg-gray-100",children:"Iscriviti"})]})]})]})})},kc=({item:e,onUpdateQuantity:t,onRemove:r})=>{var c,u,f,l,m,v,S;const n=or(),[o,i]=d.useState(!1),a=()=>{i(!0),setTimeout(()=>{r(e.id)},300)};return s.jsx(_.div,{className:`bg-white rounded-lg shadow-sm p-4 border ${o?"opacity-50":""}`,initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.3},children:s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("div",{className:"w-20 h-20 bg-gray-100 rounded-lg overflow-hidden cursor-pointer",onClick:()=>{var y;(y=e==null?void 0:e.product)!=null&&y.id&&n(`/products/${e.product.id}`)},title:"Vai alla pagina prodotto",role:"button",children:s.jsx("img",{src:((u=(c=e.product)==null?void 0:c.images)==null?void 0:u[0])||((f=e.product)==null?void 0:f.image),alt:(l=e.product)==null?void 0:l.name,className:"w-full h-full object-cover"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"font-semibold text-gray-900 mb-1",children:(m=e.product)==null?void 0:m.name}),s.jsx("p",{className:"text-sm text-gray-500 mb-2",children:(v=e.product)==null?void 0:v.brand}),s.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[s.jsxs("span",{children:["Taglia: ",e.size]}),s.jsxs("span",{children:["Colore: ",e.color]})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:()=>t(e.id,e.quantity-1),disabled:e.quantity<=1,className:"p-1 rounded-full bg-gray-100 hover:bg-gray-200 disabled:opacity-50",children:s.jsx(Js,{size:16})}),s.jsx("span",{className:"w-8 text-center font-semibold",children:e.quantity}),s.jsx("button",{onClick:()=>t(e.id,e.quantity+1),disabled:e.quantity>=10,className:"p-1 rounded-full bg-gray-100 hover:bg-gray-200 disabled:opacity-50",children:s.jsx(Ks,{size:16})})]}),s.jsx("div",{className:"text-right",children:s.jsxs("div",{className:"font-semibold text-gray-900",children:["€",((((S=e.product)==null?void 0:S.price)||0)*e.quantity).toFixed(2)]})}),s.jsx("button",{onClick:a,className:"p-2 text-red-500 hover:bg-red-50 rounded-lg",children:s.jsx(oi,{size:18})})]})})},Pc=()=>{const e=or(),{cart:t,cartTotal:r,cartCount:n,shipping:o,updateQuantity:i,removeFromCart:a,clearCart:c}=Bt();d.useEffect(()=>{Array.isArray(t)&&xt(t)},[t]);const u=r,f=r+o;return t.length===0?s.jsx("div",{className:"min-h-screen bg-gray-50",children:s.jsx("div",{className:"max-w-4xl mx-auto px-4 py-8",children:s.jsxs(_.div,{className:"text-center py-16",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[s.jsx("div",{className:"text-gray-400 mb-6",children:s.jsx(St,{size:80,className:"mx-auto"})}),s.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Il tuo carrello è vuoto"}),s.jsx("p",{className:"text-gray-600 mb-8",children:"Aggiungi alcuni prodotti per iniziare lo shopping"}),s.jsx(_.button,{className:"px-8 py-4 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700",onClick:()=>e("/products"),whileHover:{scale:1.05},whileTap:{scale:.95},children:"Inizia Shopping"})]})})}):s.jsx("div",{className:"min-h-screen bg-gray-50",children:s.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-8",children:[s.jsxs(_.div,{className:"mb-8",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[s.jsx("h1",{className:"text-4xl font-bold text-gray-900 mb-4",children:"Carrello"}),s.jsxs("p",{className:"text-gray-600",children:[n," ",n===1?"articolo":"articoli"," nel carrello"]})]}),s.jsxs("div",{className:"grid lg:grid-cols-3 gap-8",children:[s.jsxs("div",{className:"lg:col-span-2",children:[s.jsxs(_.div,{className:"bg-white rounded-lg shadow-sm p-6 mb-6",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"I tuoi articoli"}),s.jsx("button",{onClick:c,className:"text-red-500 hover:text-red-700 text-sm font-medium",children:"Svuota carrello"})]}),s.jsx(ir,{children:s.jsx("div",{className:"space-y-4",children:t.map(l=>s.jsx(kc,{item:l,onUpdateQuantity:i,onRemove:a},l.id))})})]}),s.jsxs(_.div,{className:"bg-blue-50 rounded-lg p-6",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:[s.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[s.jsx(Qs,{className:"text-blue-600",size:24}),s.jsx("h3",{className:"font-semibold text-gray-900",children:"Spedizione"})]}),s.jsx("p",{className:"text-gray-600 mb-2",children:o===0?"🎉 Spedizione gratuita! Il tuo ordine supera i 100€":`Aggiungi €${(100-u).toFixed(2)} per la spedizione gratuita`}),s.jsx("div",{className:"text-sm text-gray-500",children:"Consegna stimata: 3-5 giorni lavorativi"})]})]}),s.jsxs("div",{className:"lg:col-span-1",children:[s.jsxs(_.div,{className:"bg-white rounded-lg shadow-sm p-6 sticky top-8",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:[s.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:"Riepilogo ordine"}),s.jsxs("div",{className:"space-y-4 mb-6",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"Subtotale"}),s.jsxs("span",{className:"font-semibold",children:["€",u.toFixed(2)]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"Spedizione"}),s.jsx("span",{className:"font-semibold",children:o===0?"Gratuita":`€${o.toFixed(2)}`})]}),s.jsx("div",{className:"border-t pt-4",children:s.jsxs("div",{className:"flex justify-between text-lg font-bold",children:[s.jsx("span",{children:"Totale"}),s.jsxs("span",{children:["€",f.toFixed(2)]})]})})]}),s.jsxs(_.button,{className:"w-full py-4 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 mb-4 flex items-center justify-center gap-2",whileHover:{scale:1.02},whileTap:{scale:.98},children:[s.jsx(ni,{size:20}),"Procedi al Checkout",s.jsx(si,{size:20})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("p",{className:"text-sm text-gray-500 mb-2",children:"Pagamenti sicuri"}),s.jsxs("div",{className:"flex justify-center gap-2",children:[s.jsx("div",{className:"w-8 h-5 bg-gray-200 rounded text-xs flex items-center justify-center",children:"VISA"}),s.jsx("div",{className:"w-8 h-5 bg-gray-200 rounded text-xs flex items-center justify-center",children:"MC"}),s.jsx("div",{className:"w-8 h-5 bg-gray-200 rounded text-xs flex items-center justify-center",children:"PP"})]})]})]}),s.jsxs(_.div,{className:"bg-white rounded-lg shadow-sm p-6 mt-6",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},children:[s.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Codice promozionale"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("input",{type:"text",placeholder:"Inserisci codice",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),s.jsx("button",{className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200",children:"Applica"})]})]})]})]})]})})},zc=()=>{var se;const{id:e}=Wo(),t=or(),{addToCart:r}=Bt(),{toggleFavorite:n,isFavorite:o}=Eo(),[i,a]=d.useState(null),[c,u]=d.useState(!0),[f,l]=d.useState(null),[m,v]=d.useState(""),[S,y]=d.useState(""),[x,b]=d.useState(1),[N,E]=d.useState(0);d.useEffect(()=>(e&&(async()=>{try{u(!0),l(null);const z=await Lt.getProduct(e);a(z);const q=(C=>(C||"").replace(/```[\s\S]*?```/g," ").replace(/`[^`]*`/g," ").replace(/[\*_~>#-]+/g," ").replace(/\[(.*?)\]\((.*?)\)/g,"$1").replace(/\s{2,}/g," ").trim())(z.description_long||z.description||"");window.currentProductContext={id:z.id,name:z.name,description_text:q,category:z.category,gender:z.gender,price:z.price,brand:z.brand,image:z.image,variants:(z.variants||[]).map(C=>{var D;return{size:typeof C.size=="string"?C.size:(D=C.size)==null?void 0:D.value,color:C.color,available:C.available,stock:C.stock}}),product:{...z,description:z.description,description_long:z.description_long},lastUpdated:Date.now()},z.variants&&z.variants.length>0&&(v(z.variants[0].size),y(z.variants[0].color))}catch(z){console.error("Error loading product:",z),l("Errore nel caricamento del prodotto")}finally{u(!1)}})(),()=>{var z;((z=window.currentProductContext)==null?void 0:z.id)===e&&delete window.currentProductContext}),[e]);const O=async()=>{if(!(!m||!S))try{await r(i,m,S,x)}catch($){console.error("Error adding to cart:",$)}},V=()=>{i&&n(i)};return c?s.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-purple-600 mx-auto mb-4"}),s.jsx("p",{className:"text-gray-600",children:"Caricamento prodotto..."})]})}):f||!i?s.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:s.jsxs("div",{className:"text-center p-8 bg-white rounded-lg shadow-md",children:[s.jsx("h2",{className:"text-2xl font-bold text-red-600 mb-4",children:"Errore!"}),s.jsx("p",{className:"text-gray-700 mb-6",children:f||"Prodotto non trovato"}),s.jsx("button",{onClick:()=>t("/products"),className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition duration-300",children:"Torna ai Prodotti"})]})}):s.jsx("div",{className:"min-h-screen bg-gray-50",children:s.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[s.jsxs(_.button,{onClick:()=>t(-1),className:"flex items-center text-gray-600 hover:text-gray-900 mb-6",whileHover:{x:-5},children:[s.jsx(ii,{size:20,className:"mr-2"}),"Torna indietro"]}),s.jsxs("div",{className:"grid lg:grid-cols-2 gap-12",children:[s.jsxs("div",{className:"space-y-4",children:[s.jsx(_.div,{className:"aspect-square bg-white rounded-2xl overflow-hidden shadow-lg",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.5},children:s.jsx("img",{src:Nn(((se=i.images)==null?void 0:se[N])||i.image||"/static/images/placeholder-lg.jpg"),alt:i.name,className:"w-full h-full object-cover"})}),i.images&&i.images.length>1&&s.jsx("div",{className:"grid grid-cols-4 gap-2",children:i.images.map(($,z)=>s.jsx(_.button,{onClick:()=>E(z),className:`aspect-square rounded-lg overflow-hidden ${N===z?"ring-2 ring-blue-500":""}`,whileHover:{scale:1.05},whileTap:{scale:.95},children:s.jsx("img",{src:Nn($),alt:`${i.name} ${z+1}`,className:"w-full h-full object-cover"})},z))})]}),s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:i.name}),s.jsx("p",{className:"text-lg text-gray-600 mb-4",children:i.brand}),s.jsxs("div",{className:"flex items-center mb-4",children:[s.jsx("div",{className:"flex text-yellow-400",children:[...Array(5)].map(($,z)=>s.jsx(Dr,{size:20,fill:z<Math.floor(i.rating)?"currentColor":"none",stroke:"currentColor"},z))}),s.jsxs("span",{className:"text-sm text-gray-500 ml-2",children:["(",i.reviews," recensioni)"]})]}),s.jsxs("div",{className:"mb-6",children:[Number(i.discount_percentage??0)>0&&Number(i.original_price??0)>Number(i.price??0)?s.jsxs("span",{className:"text-lg text-gray-400 line-through mr-2",children:["€",Number(i.original_price??0).toFixed(2)]}):null,s.jsxs("span",{className:"text-3xl font-bold text-gray-900",children:["€",Number(i.price??0).toFixed(2)]}),Number(i.discount_percentage??0)>0&&s.jsxs("span",{className:"ml-3 bg-red-500 text-white px-3 py-1 rounded-full text-sm font-bold",children:["-",Number(i.discount_percentage??0),"%"]})]})]}),i.variants&&s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Taglia"}),s.jsx("div",{className:"flex flex-wrap gap-2",children:[...new Set(i.variants.map($=>$.size))].map($=>s.jsx(_.button,{onClick:()=>v($),className:`px-4 py-2 border rounded-lg font-medium ${m===$?"border-blue-500 bg-blue-50 text-blue-600":"border-gray-300 text-gray-700 hover:border-gray-400"}`,whileHover:{scale:1.05},whileTap:{scale:.95},children:$},$))})]}),i.variants&&s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Colore"}),s.jsx("div",{className:"flex flex-wrap gap-2",children:[...new Set(i.variants.map($=>$.color))].map($=>s.jsx(_.button,{onClick:()=>y($),className:`px-4 py-2 border rounded-lg font-medium capitalize ${S===$?"border-blue-500 bg-blue-50 text-blue-600":"border-gray-300 text-gray-700 hover:border-gray-400"}`,whileHover:{scale:1.05},whileTap:{scale:.95},children:$},$))})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Quantità"}),s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(_.button,{onClick:()=>b(Math.max(1,x-1)),className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-50",whileTap:{scale:.95},children:s.jsx(Js,{size:16})}),s.jsx("span",{className:"text-lg font-medium px-4",children:x}),s.jsx(_.button,{onClick:()=>b(x+1),className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-50",whileTap:{scale:.95},children:s.jsx(Ks,{size:16})})]})]}),s.jsx("div",{className:"space-y-4",children:s.jsxs("div",{className:"flex space-x-4",children:[s.jsxs(_.button,{onClick:O,className:"flex-1 bg-blue-600 text-white py-4 px-6 rounded-lg font-semibold hover:bg-blue-700 flex items-center justify-center",whileHover:{scale:1.02},whileTap:{scale:.98},children:[s.jsx(St,{size:20,className:"mr-2"}),"Aggiungi al Carrello"]}),s.jsx(_.button,{onClick:V,className:`p-4 rounded-lg border-2 ${i&&o(i.id)?"border-red-500 bg-red-50 text-red-600":"border-gray-300 text-gray-600 hover:border-gray-400"}`,whileHover:{scale:1.05},whileTap:{scale:.95},children:s.jsx(qr,{size:20,fill:i&&o(i.id)?"currentColor":"none"})})]})}),s.jsxs("div",{className:"grid grid-cols-1 gap-4 pt-6 border-t",children:[s.jsxs("div",{className:"flex items-center text-gray-600",children:[s.jsx(Qs,{size:20,className:"mr-3"}),s.jsx("span",{children:"Spedizione gratuita sopra i €100"})]}),s.jsxs("div",{className:"flex items-center text-gray-600",children:[s.jsx(ai,{size:20,className:"mr-3"}),s.jsx("span",{children:"Reso gratuito entro 30 giorni"})]}),s.jsxs("div",{className:"flex items-center text-gray-600",children:[s.jsx(ci,{size:20,className:"mr-3"}),s.jsx("span",{children:"Pagamenti sicuri"})]})]})]})]})]})})},Ic=({isListening:e,isProcessing:t,isConnected:r,isSpeaking:n,isExecutingFunction:o,currentFunction:i,messages:a,error:c,onClose:u,isAssistantActive:f})=>{const[l,m]=d.useState(!1);d.useEffect(()=>{if(e||t||n||o||c||f)m(!0);else{const x=setTimeout(()=>{m(!1)},2e3);return()=>clearTimeout(x)}},[e,t,n,o,c,f]);const S=c?{icon:Mt,text:"Errore - Clicca per chiudere",color:"bg-red-500",textColor:"text-white",animate:!1}:o?{icon:{navigate_to_page:li,search_products:Xs,add_to_cart:$r,get_cart_summary:$r,get_recommendations:$t}[i]||Gs,text:"Eseguo comando...",color:"bg-green-500",textColor:"text-white",animate:!0}:n?{icon:Ys,text:"AIVA sta parlando",color:"bg-purple-500",textColor:"text-white",animate:!0}:t?{icon:ln,text:"",color:"bg-blue-500",textColor:"text-white",animate:!0}:e?{icon:Ot,text:"Ti sto ascoltando",color:"bg-blue-500",textColor:"text-white",animate:!0}:{icon:ui,text:"AIVA pronta",color:"bg-gray-700",textColor:"text-white",animate:!1},y=x=>{x.stopPropagation(),console.log("🔴 VoiceVisualizer: Closing assistant completely"),m(!1),u&&u()};return l?s.jsx(ir,{children:s.jsx(_.div,{initial:{opacity:0,y:-20,scale:.9},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-20,scale:.9},className:"fixed top-6 left-0 right-0 z-[100]",style:{pointerEvents:"none"},children:s.jsxs("div",{className:"relative mx-auto",style:{width:"400px",maxWidth:"90vw",pointerEvents:"auto"},children:[s.jsx(_.div,{className:"bg-black/90 backdrop-blur-xl rounded-2xl border border-white/10 shadow-2xl",style:{height:"80px",width:"100%"},initial:{scale:.9},animate:{scale:1},transition:{type:"spring",damping:20},children:s.jsxs("div",{className:"flex items-center justify-between p-4 h-full",children:[s.jsxs("div",{className:"flex items-center space-x-4 flex-1",children:[s.jsxs("div",{className:"relative flex-shrink-0",children:[s.jsx(_.div,{className:`w-12 h-12 rounded-full ${S.color} flex items-center justify-center`,animate:S.animate?{scale:[1,1.1,1]}:{},transition:{duration:1.2,repeat:S.animate?1/0:0,ease:"easeInOut"},children:S.icon===ln?s.jsx(ln,{className:"w-6 h-6 text-white animate-spin"}):s.jsx(S.icon,{className:"w-6 h-6 text-white"})}),S.animate&&s.jsx(_.div,{className:`absolute inset-0 rounded-full ${S.color} opacity-40`,animate:{scale:[1,1.6],opacity:[.4,0]},transition:{duration:1.8,repeat:1/0,ease:"easeOut"}})]}),s.jsxs("div",{className:"flex flex-col min-w-0 flex-1",children:[s.jsx("span",{className:`font-medium text-sm ${S.textColor} truncate`,children:S.text}),s.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[s.jsx("div",{className:`w-2 h-2 rounded-full ${r?"bg-green-400":"bg-red-400"}`}),s.jsx("span",{className:"text-white/60 text-xs",children:r?"Connesso":"Connessione..."})]})]})]}),s.jsxs("div",{className:"flex items-center space-x-3 flex-shrink-0",children:[(e||n)&&s.jsx("div",{className:"flex items-center space-x-1",children:[...Array(4)].map((x,b)=>s.jsx(_.div,{className:`w-1 rounded-full ${e?"bg-blue-400":"bg-purple-400"}`,animate:{height:[6,18,6]},transition:{duration:.8,repeat:1/0,delay:b*.15,ease:"easeInOut"}},b))}),s.jsx(_.button,{onClick:y,className:"p-2 rounded-full bg-white/10 hover:bg-white/20 transition-colors flex-shrink-0",whileHover:{scale:1.1},whileTap:{scale:.95},title:"Chiudi assistente vocale",children:s.jsx(Mt,{className:"w-4 h-4 text-white/80"})})]})]})}),!1,o&&i&&s.jsx(_.div,{className:"absolute -bottom-8 left-1/2 transform -translate-x-1/2",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},children:s.jsxs("div",{className:"bg-green-500/90 text-white text-xs px-3 py-1 rounded-full backdrop-blur-sm",children:[i==="search_products"&&"🔍 Ricerca in corso",i==="add_to_cart"&&"🛒 Aggiunta al carrello",i==="navigate_to_page"&&"📍 Navigazione",!["search_products","add_to_cart","navigate_to_page"].includes(i)&&"⚡ Esecuzione"]})})]})})}):null},Vs=(e=[])=>{if(!Array.isArray(e)||e.length===0)return"";const t=Math.floor(Math.random()*e.length);return e[t]??e[0]},Oc=(e="")=>(e||"").replace(/```[\s\S]*?```/g," ").replace(/`[^`]*`/g," ").replace(/[\*_~>#-]+/g," ").replace(/\[(.*?)\]\((.*?)\)/g,"$1").replace(/\s{2,}/g," ").trim(),nr=16e3,Fc=(e=[])=>{if(!Array.isArray(e)||e.length===0)return new Float32Array(0);const t=e.reduce((o,i)=>o+i.length,0),r=new Float32Array(t);let n=0;return e.forEach(o=>{r.set(o,n),n+=o.length}),r},Lc=(e,t,r=nr)=>{if(!e||!e.length||!t||t===r)return e||new Float32Array(0);const n=t/r,o=Math.round(e.length/n),i=new Float32Array(o);let a=0,c=0;for(;a<i.length;){const u=Math.round((a+1)*n);let f=0,l=0;for(let m=c;m<u&&m<e.length;m+=1)f+=e[m],l+=1;i[a]=l>0?f/l:0,a+=1,c=u}return i},$c=e=>{const t=new ArrayBuffer(e.length*2),r=new DataView(t);let n=0;for(let o=0;o<e.length;o+=1,n+=2){const i=Math.max(-1,Math.min(1,e[o]||0));r.setInt16(n,i<0?i*32768:i*32767,!0)}return new Uint8Array(t)},Mc=e=>{if(!e)return"";let t="";const r=new Uint8Array(e),n=32768;for(let o=0;o<r.length;o+=n){const i=r.subarray(o,o+n);t+=String.fromCharCode.apply(null,i)}return btoa(t)},qc=e=>{const t=atob(e),r=t.length,n=new Uint8Array(r);for(let o=0;o<r;o+=1)n[o]=t.charCodeAt(o);return n.buffer},Dc=(e={})=>{var t;return{size:typeof e.size=="string"?e.size:(t=e.size)==null?void 0:t.value,color:e.color,available:e.available,stock:e.stock}},vn=(e,t=1)=>{const r=Number(e);return Number.isFinite(r)?Math.min(10,Math.max(1,Math.round(r))):t},Sn=(e={},t=null)=>{if(!t||typeof t!="object")return e;const r=Oc(t.description_long||t.description||e.description_text||""),n=Array.isArray(t.variants)?t.variants.map(Dc):e.variants||[];return{...e,id:t.id||e.id,name:t.name||e.name,category:t.category||e.category,gender:t.gender||e.gender,price:t.price??e.price,brand:t.brand??e.brand,image:t.image??e.image,description_text:r,variants:n,product:t,lastUpdated:Date.now()}},Uc=()=>{const[e,t]=d.useState(!1),[r,n]=d.useState(!1),[o,i]=d.useState([]),[a,c]=d.useState(!1),[u,f]=d.useState(!1),[l,m]=d.useState(null),[v,S]=d.useState(null),[y,x]=d.useState(""),[b,N]=d.useState(!1),[E,O]=d.useState(!0),[V,se]=d.useState(!1),[$,z]=d.useState(0),F=or(),{addToCart:q,removeFromCart:C,clearCart:D,removeLastItem:H,updateQuantity:K}=Bt(),{setSearchQuery:me,filterProducts:Ne,setMultipleFilters:be,clearFilters:it}=Le(),we=d.useRef(null),jt=typeof window<"u"?Ft():null,Ve=d.useRef(jt||`session-${Date.now()}-${Math.random().toString(36).substr(2,9)}`);d.useRef(null),d.useRef(0);const R=d.useRef(null),P=d.useRef([]),A=d.useRef(!1);d.useEffect(()=>{A.current=a},[a]);const ce=d.useRef(!1),he=d.useRef(null),W=d.useRef(null);d.useRef([]);const $e=d.useRef(null),Me=d.useRef(""),ke=d.useRef(""),Nt=d.useRef(!1),dr=d.useRef(!1),Ct=d.useRef(!1),Ce=d.useRef([]),qe=d.useRef(null),Et=d.useRef([]),Wr=d.useRef(null),mt=d.useRef(null),Vt=d.useRef(!1),Qr=d.useRef(null),Ht=d.useRef(!1),Fn=d.useRef(!1),ve=d.useRef(!1),Ro=d.useRef(!1),Tt=d.useRef(Date.now()),Ln=d.useRef(""),et=d.useRef(!1),fr=d.useRef(null),pr=d.useRef([]),He=d.useRef(""),Jr=d.useRef({onceSpoken:!1}),$n=d.useRef(!1),Rt=d.useRef(""),at=typeof window<"u"&&typeof navigator<"u",Kr=!1,Mn=!1,mr=d.useRef(!1),Gt=d.useRef({active:!1,aborting:!1}),_t=d.useCallback(()=>!at||typeof window>"u"?!1:"webkitSpeechRecognition"in window||"SpeechRecognition"in window,[at]),hr=d.useMemo(()=>at?!_t():!1,[at,_t,Kr]),qn=d.useMemo(()=>!at||typeof window>"u"?!1:!("speechSynthesis"in window),[at,Kr]),ge=d.useCallback(()=>(typeof window<"u"&&window.speechSynthesis?window.speechSynthesis.speaking:!1)||Vt.current,[]),At=d.useRef(null),gr=d.useRef(null),_o=d.useRef(null),Wt=d.useRef(null),ht={default:{window:9e3,closingGrace:1e3,prompts:["Se hai bisogno di altro, sono qui.","Ok! Buon proseguimento, chiamami se ti serve aiuto.","Resto a disposizione se ti serve altro.","Quando vuoi riprendere, basta dirmelo.","Sono qui se ti viene in mente qualcos'altro da vedere.","Va bene, resto in ascolto per quando ti serve.","Va benissimo, resto disponibile se vuoi continuare più tardi.","Prenditi pure il tuo tempo, io rimango qui.","Chiamami pure quando ti viene voglia di esplorare altri look.","Se vuoi riprendere, basta dirmelo e continuiamo da dove eravamo."]},followUp:{window:13e3,closingGrace:1600,prompts:["Nessun problema, fammi sapere come vuoi procedere.","Va bene, ti ascolto quando sei pronto.","Prenditi pure un momento per pensarci, resto in ascolto.","Ok, dimmi pure appena hai deciso come continuare.","Tranquillo, fammi sapere quando vuoi proseguire."]},task:{window:11e3,closingGrace:1300,prompts:["Va bene, continuo a seguire la tua richiesta.","Perfetto, dimmi pure gli altri dettagli quando vuoi.","Ok, resto qui finché non mi dai nuove indicazioni.","Ricevuto, se vuoi aggiungere altro basta dirmelo.","Va benissimo, proseguiamo quando sei pronto."]}},Ao=450,ct=d.useRef(null),Xr=d.useRef(null),yr=d.useRef(!1),Ge=d.useRef(null),G=d.useRef(!1),Yr=d.useRef({}),Zr=d.useCallback(async()=>{const p=window.currentProductContext||{};if(p.product&&typeof p.product=="object"){const h=Sn(p,p.product);return window.currentProductContext=h,h}if(!p.id)return p;try{const h=await Lt.getProduct(p.id);if(h){const j=Sn(p,h);return window.currentProductContext=j,j}}catch(h){console.warn("Unable to hydrate current product context",h)}return window.currentProductContext||p},[Lt]),ko=["Ecco.","Subito.","Fatto.","Ci siamo."],Dn=["Ecco il carrello.","Carrello aperto.","Tieni il carrello.","Pronto."],Po=["Ecco le offerte.","Sconti in vista.","Promozioni aperte.","Offerte pronte."],zo=["Ecco i risultati.","Ecco qui.","Pronto.","Fatto."],Io=["Filtri applicati.","Lista aggiornata.","Pronto così.","Fatto."],Oo=["Ecco la scheda.","Mostrato.","Eccolo qui.","Fatto."],Fo=["Aggiunto al carrello.","Fatto.","Inserito.","Dentro al carrello."],Lo=["Tolto dal carrello.","Rimosso.","Fatto.","Via dal carrello."],$o=["Carrello svuotato.","Tutto pulito.","Vuoto.","Fatto."],Un=d.useCallback((p,h=[],j="")=>{const w=Array.isArray(h)?h.filter(Boolean):[];if(w.length===0)return j;const T=Yr.current[p],I=w.filter(M=>M!==T),U=Vs(I.length>0?I:w)||j||w[0];return Yr.current[p]=U,U||j},[]),tt=d.useCallback((p,h=[],j="",w,T={})=>{const{oncePerTurn:I=!1,overrideText:U=null,immediate:M=!1}=T||{},B=(U||Un(p,h,j)||"").trim();if(!B){typeof w=="function"&&w();return}if(I){if(Jr.current.onceSpoken){typeof w=="function"&&w();return}Jr.current.onceSpoken=!0}const fe=Qr.current;typeof fe=="function"?fe(B,w,M,{enqueue:!1}):typeof w=="function"&&w()},[Un]),Bn=d.useCallback(()=>{Jr.current.onceSpoken=!1},[]),Vn=d.useCallback(()=>{ct.current&&(clearTimeout(ct.current),ct.current=null),Ge.current&&(clearTimeout(Ge.current),Ge.current=null)},[]),en=d.useRef("default"),xr=d.useRef(""),We=d.useRef(""),br=d.useRef(null),tn=d.useRef(()=>{}),De=d.useCallback(p=>{const h=ht[p]?p:"default";en.current=h},[]),kt=d.useCallback(()=>{const p=en.current;return ht[p]||ht.default},[]),Hn=d.useCallback(()=>{const p=kt();return typeof p.window=="number"?p.window:ht.default.window},[kt]),Gn=d.useCallback(()=>{const p=kt();return typeof p.closingGrace=="number"?p.closingGrace:ht.default.closingGrace},[kt]),Wn=d.useCallback(()=>{const p=kt(),h=Array.isArray(p.prompts)?p.prompts.filter(Boolean):[],j=ht.default.prompts.filter(Boolean),w=h.length?h:j;if(!w.length)return"";const T=xr.current,I=w.filter(M=>M!==T),U=Vs(I.length?I:w)||w[0];return xr.current=U,U},[kt]),Pe=d.useCallback(()=>{br.current&&(clearTimeout(br.current),br.current=null)},[]),wr=d.useCallback((p,h)=>{if(h&&ht[h]){De(h);return}const j=(p||"").toString().trim().toLowerCase();if(!j)return;if(/[?]\s*$/.test(j)||/(preferisci|vuoi|ti serve|posso|che ne pensi|hai bisogno)/.test(j)){De("followUp");return}if(/(aggiunto|fatto|eccoti|ecco|ho trovato|dimmi se vuoi|quando sei pronto|se vuoi aggiungere)/.test(j)){De("task");return}en.current!=="default"&&De("default")},[De]),le=d.useRef(!1),Qn=d.useRef(!0),Qe=d.useRef(!1);d.useRef(!1);const gt=d.useRef(null),Jn=d.useRef(0),Kn=d.useCallback(()=>{try{if(A.current)return;const p=Date.now();if(p-Jn.current<2e3)return;const h=window.AudioContext||window.webkitAudioContext;gt.current||(gt.current=new h);const j=gt.current,w=j.createOscillator(),T=j.createGain();w.type="sine",w.frequency.setValueAtTime(880,j.currentTime),T.gain.setValueAtTime(1e-4,j.currentTime),T.gain.exponentialRampToValueAtTime(.2,j.currentTime+.01),w.connect(T).connect(j.destination),w.start(),T.gain.exponentialRampToValueAtTime(1e-4,j.currentTime+.15),w.stop(j.currentTime+.18),Jn.current=p}catch{}},[]),Xn=d.useCallback(()=>{if("speechSynthesis"in window)try{if(mr.current){if(window.speechSynthesis.paused)try{window.speechSynthesis.resume()}catch{}return}mr.current=!0;const p=new SpeechSynthesisUtterance(" ");p.volume=0,p.rate=1,p.pitch=1,p.onend=()=>{try{window.speechSynthesis.cancel()}catch{}},window.speechSynthesis.speak(p)}catch(p){mr.current=!1,console.warn("Speech synthesis prime failed",p)}},[]),lt=d.useCallback(async()=>{var p;try{const h=window.AudioContext||window.webkitAudioContext;if(h&&(gt.current||(gt.current=new h),((p=gt.current)==null?void 0:p.state)==="suspended"&&await gt.current.resume(),At.current&&At.current.state==="suspended"&&await At.current.resume()),typeof window.speechSynthesis<"u"){if(window.speechSynthesis.paused)try{window.speechSynthesis.resume()}catch{}Xn()}}catch(h){mr.current=!1,console.warn("Audio pipeline resume failed",h)}},[Xn]),rn=d.useCallback(async()=>{try{const p=window.AudioContext||window.webkitAudioContext;if(!p)return;At.current||(At.current=new p);const h=At.current,j=await navigator.mediaDevices.getUserMedia({audio:!0});gr.current=j;const w=h.createMediaStreamSource(j),T=h.createAnalyser();T.fftSize=512,_o.current=T,w.connect(T);let I=0;const U=.02,M=12,B=new Uint8Array(T.fftSize),fe=()=>{T.getByteTimeDomainData(B);let oe=0;for(let Ke=0;Ke<B.length;Ke++){const Xe=(B[Ke]-128)/128;oe+=Xe*Xe}if(I=Math.sqrt(oe/B.length)>U?I+1:0,I>=M){try{window.speechSynthesis.cancel()}catch{}Ce.current=[],Me.current="",Ht.current=!0,dr.current=!1,N(!1),le.current=!1,G.current&&!A.current&&!Qe.current&&!le.current&&P.current.length===0&&(G.current=!1),c(!1),A.current=!1,G.current=!1,Je(),W.current&&W.current();return}Wt.current=requestAnimationFrame(fe)};Wt.current=requestAnimationFrame(fe)}catch{}},[]),Je=d.useCallback(()=>{try{Wt.current&&cancelAnimationFrame(Wt.current)}catch{}Wt.current=null;try{gr.current&&gr.current.getTracks().forEach(p=>p.stop())}catch{}gr.current=null},[]),Qt=d.useCallback((p=!1)=>{if(Pe(),We.current="",R.current)try{const h=R.current;R.current=null;try{h.onend=null}catch{}try{h.stop()}catch{}}catch{}t(!1)},[Mn,Pe]);d.useEffect(()=>{le.current=b},[b]),d.useEffect(()=>{Qn.current=E},[E]),d.useEffect(()=>{Qe.current=u},[u]),d.useEffect(()=>{A.current=a},[a]),d.useEffect(()=>{Ro.current=r},[r]),d.useEffect(()=>{$n.current=e},[e]);const Yn=6e4,Mo=15e3,Zn=d.useCallback(()=>{const p=["Ciao! Sono AIVA, la tua personal shopper AI. Come posso aiutarti oggi?","Benvenuto. Sono AIVA, qui per aiutarti a navigare tra le nostre collezioni. Cerchi ispirazione o hai già un'idea precisa?","Ciao! Sono AIVA, l'assistente AI pronta a trasformare la tua esperienza di shopping. Cosa posso fare per te?","Benvenuto nel nostro ecommerce. Sono AIVA, la tua personal shopper AI. Quali prodotti ti piacerebbe vedere?","Sono AIVA, la tua assistente allo shopping. Insieme possiamo scoprire le nuove collezioni o trovare esattamente ciò che desideri. Da dove vogliamo cominciare?","Benvenuto! Sono AIVA e sono qui per aiutarti a trovare l'outfit perfetto. Puoi dirmi cosa cerchi oppure chiedermi di mostrarti le ultime offerte."],h=["Eccomi di nuovo.","Rieccomi.","Bentornato.","Sono di nuovo qui. Dimmi pure.","Pronta a continuare. Hai trovato qualcosa che ti piace o cerchiamo altro?","Ok, continuiamo. Cosa facciamo ora?","Pronti a ripartire. Ti ascolto."],j=w=>!w||w.length===0?"":w[Math.floor(Math.random()*w.length)]||"";return $===0?(z(1),j(p)):j(h)},[$]);d.useEffect(()=>{ve.current=V},[V]);const es=d.useCallback(()=>{const p=window.speechSynthesis.getVoices(),h=[{name:"Google italiano",lang:"it-IT",gender:"female"},{name:"Alice",lang:"it-IT"},{name:"Elsa",lang:"it-IT"},{name:"Carla",lang:"it-IT"},{name:"Microsoft Elsa",lang:"it-IT"},{name:"Microsoft Cosimo",lang:"it-IT"},{lang:"it-IT",gender:"female"},{lang:"it-IT"},{lang:"it"}];for(const w of h){const T=p.find(I=>{var fe;const U=I.lang.toLowerCase().startsWith(((fe=w.lang)==null?void 0:fe.toLowerCase())||"it"),M=!w.name||I.name.toLowerCase().includes(w.name.toLowerCase()),B=!w.gender||I.name.toLowerCase().includes("female")||I.name.toLowerCase().includes("donna")||I.name.toLowerCase().includes("alice")||I.name.toLowerCase().includes("elsa")||I.name.toLowerCase().includes("carla");return U&&M&&B});if(T)return console.log("🎤 Selected voice:",T.name,T.lang),fr.current=T,T}const j=p.find(w=>w.lang.toLowerCase().startsWith("it"));return j?(console.log("🎤 Fallback Italian voice:",j.name),fr.current=j,j):null},[]);d.useEffect(()=>{const p=()=>{es()};return p(),window.speechSynthesis.onvoiceschanged!==void 0&&(window.speechSynthesis.onvoiceschanged=p),setTimeout(p,100),setTimeout(p,500),()=>{window.speechSynthesis.onvoiceschanged!==void 0&&(window.speechSynthesis.onvoiceschanged=null)}},[es]);const vr=d.useCallback(p=>{const h=(p||"").split(new RegExp("(?<=[\\.!?])\\s+")).map(j=>j.trim()).filter(Boolean);return h.length?h:[(p||"").trim()].filter(Boolean)},[]),Sr=d.useCallback((p,h)=>{const j=(h||"").trim();if(!j)return;const w=[...pr.current,{role:p,content:j}];pr.current=w.slice(-20)},[]),ts=d.useCallback(p=>{Sr("user",p)},[Sr]),nn=d.useCallback(p=>{Sr("assistant",p),wr(p)},[Sr,wr]),Jt=d.useCallback((p=0)=>{p>3||ve.current&&($n.current||A.current||le.current||P.current.length>0||ge()||W.current&&(W.current(),setTimeout(()=>Jt(p+1),300+p*200)))},[ge]),pe=d.useCallback(()=>{!ge()&&!le.current&&Ce.current.length===0&&(G.current=!1,c(!1),A.current=!1,ve.current&&P.current.length===0&&(W.current&&W.current(),setTimeout(()=>Jt(),180)))},[Jt,ge]),jr=d.useCallback(p=>{console.log("[filters] Applying UI filters:",p),setTimeout(()=>{if(p.category){const h=document.querySelector("select");if(h){for(let j of h.options)if(j.value.toLowerCase()===p.category.toLowerCase()){h.value=j.value,h.dispatchEvent(new Event("change",{bubbles:!0}));break}}}if(p.price_range){const h=document.querySelectorAll("select")[1];h&&(p.price_range==="low-to-high"?h.value="price-low":p.price_range==="high-to-low"&&(h.value="price-high"),h.dispatchEvent(new Event("change",{bubbles:!0})))}Ne(p)},300)},[Ne]),Nr=d.useCallback((p=700)=>{setTimeout(()=>{ve.current&&!et.current&&!ge()&&!le.current&&!A.current&&P.current.length===0&&W.current&&W.current()},p)},[ge]),sn=d.useCallback(async(p,h)=>{var j,w,T,I;if(console.log("🎯 Executing function:",p,h),f(!0),m(p),Tt.current=Date.now(),R.current){try{R.current.stop()}catch(U){console.log("Could not stop recognition:",U.message)}t(!1)}try{switch(await new Promise(U=>setTimeout(U,300)),p){case"navigate_to_page":case"navigate":{const L={home:"/",prodotti:"/products",products:"/products",offerte:"/offers",offers:"/offers",carrello:"/cart",cart:"/cart",checkout:"/checkout"}[h.page]||"/";if(console.log("[nav] Navigating to:",L),F(L),Me.current="",Ht.current=!1,L==="/products"){const X=h.resetFilters===!0;let Z={};if(X)try{it(),me(""),typeof window<"u"&&(window.productsSearchQuery="",window.productsSelectedCategory="")}catch(Y){console.warn("Failed to reset filters on navigation",Y)}h.filters&&typeof h.filters=="object"&&(Z={...h.filters}),h.category&&!Z.category&&(Z.category=h.category);const te=P.current[0];te&&te.name==="apply_ui_filters"&&te.params&&typeof te.params.filters=="object"?(Z={...Z,...te.params.filters},P.current.shift()):te&&te.name==="search_products"&&te.params&&!te.params.query&&typeof te.params.filters=="object"&&(Z={...Z,...te.params.filters},P.current.shift());const de=Y=>{const Ie=Y&&Object.keys(Y).length>0?Y:{};setTimeout(()=>{try{Object.keys(Ie).length>0?be(Ie):X&&it(),typeof window<"u"&&typeof window.applyProductFilters=="function"?window.applyProductFilters(Ie):jr(Ie)}catch(Oe){console.warn("Failed to apply filters after navigation",Oe)}},350)};Object.keys(Z).length>0?de(Z):X&&de({})}const Q=L==="/cart"?{key:"nav-cart",messages:Dn,fallback:"Ecco il carrello."}:L==="/offers"?{key:"nav-offers",messages:Po,fallback:"Ecco le offerte."}:{key:"nav-default",messages:ko,fallback:"Ecco."},re=()=>{const X=P.current.length>0;c(!1),A.current=!1,X?(Bn(),G.current=!0):(G.current=!1,W.current&&W.current())};tt(Q.key,Q.messages,Q.fallback,re,{oncePerTurn:!0}),Nr(1e3);break}case"search_products":const U=h.query||"",M=h.filters||{};console.log("🔍 Searching:",U,"Filters:",M);const B=!!M.on_sale,fe=window.location.pathname;if(B){fe!=="/offers"&&F("/offers");try{window.dispatchEvent(new CustomEvent("offers-apply-filters",{detail:{filters:M,query:U}}))}catch{}}else fe!=="/products"&&F("/products"),setTimeout(()=>{if(U){me(U);const k=document.querySelector('input[placeholder="Cerca prodotti..."]');k&&(k.value=U,k.dispatchEvent(new Event("input",{bubbles:!0})))}Object.keys(M).length>0&&(be(M),h.applyUIFilters!==!1&&jr(M))},500);tt("search",zo,"Ecco i risultati.",()=>{const k=P.current.length>0;c(!1),A.current=!1,k?G.current=!0:(G.current=!1,W.current&&W.current())},{oncePerTurn:!0});break;case"apply_ui_filters":console.log("🎨 Applying UI filters:",h.filters),window.applyProductFilters?window.applyProductFilters(h.filters||{}):jr(h.filters||{}),tt("filters",Io,"Filtri applicati.",()=>{const k=P.current.length>0;c(!1),A.current=!1,k?G.current=!0:(G.current=!1,W.current&&W.current())},{oncePerTurn:!0});break;case"get_product_details":const Ke=h.product_id;console.log("📦 Showing product:",Ke),F(`/products/${Ke}`),tt("product",Oo,"Ecco la scheda.",()=>{const k=P.current.length>0;c(!1),A.current=!1,k?G.current=!0:(G.current=!1,W.current&&W.current())},{oncePerTurn:!0});break;case"open_product_by_name":{const k=((h==null?void 0:h.name)||"").toLowerCase().trim(),L=(j=window.visibleProductsMap)==null?void 0:j[k];L?(F(`/products/${L}`),Nr(800)):(F("/products"),setTimeout(()=>{window.applyProductFilters&&window.applyProductFilters({query:h==null?void 0:h.name})},300),Nr(800));break}case"add_to_cart":{console.log("[cart] Adding to cart:",h);const k=(L="")=>{const Q={nero:"nero",black:"nero",bianco:"bianco",white:"bianco","blu navy":"blu navy",navy:"blu navy","blu scuro":"blu navy",blu:"blu",azzurro:"azzurro",rosso:"rosso",borgogna:"bordeaux",bordeaux:"bordeaux","verde oliva":"verde oliva",oliva:"verde oliva",verde:"verde","grigio melange":"grigio melange",melange:"grigio melange",antracite:"grigio antracite",grigio:"grigio",beige:"beige",panna:"panna",crema:"panna",cammello:"cammello",marrone:"marrone",rosa:"rosa",giallo:"giallo",viola:"viola"},re=(L||"").toLowerCase(),X=Object.keys(Q).sort((te,de)=>de.length-te.length);for(const te of X)if(re.includes(te))return Q[te];const Z=re.split(/[\s/,-]+/).filter(Boolean);for(const te of Z)if(Q[te])return Q[te];return re||"nero"};try{const L=vn(h.quantity??1,1),Q=(h.size||"M").toUpperCase(),re=k(h.color||"nero");if(window.location.pathname.includes("/products/")){setTimeout(()=>{const Oe=document.querySelectorAll("button");for(let ot of Oe)if(ot.textContent.trim().toUpperCase()===Q.toUpperCase()){ot.click();break}setTimeout(()=>{for(let ot of document.querySelectorAll("button"))if(ot.textContent.toLowerCase().includes(re.toLowerCase())){ot.click();break}},300)},200);const Y=await Zr(),Ie=Y==null?void 0:Y.product;if(Ie){if(!await q(Ie,Q,re,L))throw new Error("Cart update rejected")}else{const Oe={id:h.product_id||(Y==null?void 0:Y.id)||"550e8400-0001-41d4-a716-446655440001",name:h.product_name||(Y==null?void 0:Y.name)||"Prodotto",price:(Y==null?void 0:Y.price)||h.price||49.9,brand:(Y==null?void 0:Y.brand)||"Fashion Brand"};if(!await q(Oe,Q,re,L))throw new Error("Fallback cart update failed")}}else{const Y={id:h.product_id||"550e8400-0001-41d4-a716-446655440001",name:h.product_name||"Prodotto",price:h.price||49.9,brand:"Fashion Brand"};if(!await q(Y,Q,re,L))throw new Error("Remote cart update failed")}const Z=h.skipAck===!0,te=typeof h.overrideAck=="string"?h.overrideAck:null,de=()=>{const Y=P.current.length>0;c(!1),A.current=!1,Y?G.current=!0:pe()};Z?de():tt("cart-add",Fo,"Aggiunto al carrello.",de,{oncePerTurn:!1,overrideText:te||void 0})}catch(L){console.error("Error adding to cart:",L),ue("Non sono riuscita ad aggiungerlo al carrello.",()=>{c(!1),A.current=!1,pe()},!1,{enqueue:!1})}break}case"remove_from_cart":{const{item_id:k,product_name:L,size:Q,color:re}=h||{};let X=k;if(!X&&L){const Z=(te=>(te||"").toString().normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").toLowerCase().replace(/[^a-z0-9]+/g," ").trim())(`${L} ${Q||""} ${re||""}`);X=(w=window.cartItemsMap)==null?void 0:w[Z]}console.log("[cart] Removing from cart:",X||k),X?(await C(X),tt("cart-remove",Lo,"Rimosso dal carrello.",()=>{const te=P.current.length>0;c(!1),A.current=!1,te?G.current=!0:pe()},{oncePerTurn:!1})):ue("Non trovo quel prodotto nel carrello. Puoi ripetere il nome o dirmi la taglia e il colore?");break}case"update_cart_quantity":console.log("📝 Updating quantity:",h),h.item_id&&h.quantity&&await K(h.item_id,h.quantity);break;case"get_cart_summary":case"view_cart":console.log("🛒 Opening cart"),F("/cart"),tt("nav-cart",Dn,"Ecco il carrello.",()=>{const k=P.current.length>0;c(!1),A.current=!1,k?G.current=!0:(G.current=!1,W.current&&W.current())},{oncePerTurn:!0});break;case"clear_cart":console.log("🗑️ Clearing cart"),await D(),tt("cart-clear",$o,"Carrello svuotato.",()=>{const k=P.current.length>0;c(!1),A.current=!1,k?G.current=!0:(G.current=!1,W.current&&W.current())},{oncePerTurn:!1});break;case"get_current_promotions":case"show_offers":console.log("🏷️ Showing offers"),F("/offers"),ue("Ecco le offerte.",()=>{c(!1),A.current=!1,G.current=!1,W.current&&W.current()},!1,{enqueue:!1});break;case"get_shipping_info":{console.log("🚚 Fetching shipping info");try{const k=await Ni.getShippingInfo(),L=(k.shipping_zones||[]).find(de=>(de.zone||"").toLowerCase().includes("italia")||(de.zone||"").toLowerCase().includes("penisola"))||((T=k.shipping_zones)==null?void 0:T[0]),Q=(L==null?void 0:L.standard)||k.standard_shipping,re=(L==null?void 0:L.express)||k.express_shipping,X=k.pickup_point,Z=[];if(k.free_shipping_threshold!=null&&Z.push(`spedizione gratuita sopra i €${Number(k.free_shipping_threshold).toFixed(2)}`),Q){const de=typeof Q=="object"?Q.price:Q,Y=typeof Q=="object"?Q.delivery_window||Q.delivery_time:k.delivery_time_standard;Z.push(`standard a €${Number(de).toFixed(2)} con consegna in ${Y||"pochi giorni"}`)}if(re){const de=typeof re=="object"?re.price:re,Y=typeof re=="object"?re.delivery_window||re.delivery_time:k.delivery_time_express;Z.push(`express a €${Number(de).toFixed(2)} con arrivo in ${Y||"1-2 giorni"}`)}if(X&&X.enabled!==!1){const de=X.delivery_window||X.delivery_time||"24 ore";Z.push(`ritiro gratuito in boutique disponibile entro ${de}`)}(I=k.saturday_delivery)!=null&&I.enabled&&Z.push(`consegna il sabato a €${Number(k.saturday_delivery.price).toFixed(2)} su ${k.saturday_delivery.area}`);const te=Z.length?`Ecco le nostre opzioni di spedizione: ${Z.join(", ")}.`:"Le nostre spedizioni sono attive, ma non riesco a recuperare tutti i dettagli in questo momento.";ue(te,()=>{c(!1),A.current=!1,G.current=!1,W.current&&W.current()},!1,{enqueue:!1})}catch(k){console.error("Errore recuperando le spedizioni",k),ue("Non riesco a recuperare le informazioni di spedizione ora, riprova tra qualche istante.",()=>{c(!1),A.current=!1,G.current=!1,W.current&&W.current()},!1,{enqueue:!1})}break}case"get_recommendations":console.log("💡 Getting recommendations"),F("/products"),setTimeout(()=>{const k=new CustomEvent("show-recommendations");window.dispatchEvent(k)},300);break;case"close_conversation":console.log("👋 Closing conversation"),nt();break;case"get_size_guide":try{const k=await Lt.getSizeGuide(h.category||"pantaloni"),L=[];for(const[Q,re]of Object.entries(k))L.push(`${Q}: ${Object.entries(re).map(([X,Z])=>`${X}=${Z}`).join(", ")}`);ue(`Ecco la guida taglie per ${h.category}: ${L.join(". ")}`,()=>{c(!1),A.current=!1,G.current=!1,W.current&&W.current()},!1,{enqueue:!1})}catch{ue("Non sono riuscita a recuperare la guida taglie al momento.",()=>{c(!1),A.current=!1,G.current=!1,W.current&&W.current()},!1,{enqueue:!1})}break;default:console.warn("❓ Unknown function:",p)}}catch(U){console.error("❌ Error executing function:",U),S("Errore nell'esecuzione del comando")}finally{setTimeout(()=>{f(!1),m(null),Ue(),!b&&!ge()&&(G.current=!1,c(!1),A.current=!1,ve.current&&!et.current&&P.current.length===0&&on())},200)}},[F,q,C,D,H,K,me,be,it,jr,Nr,tt,pe,b,ge]),Ue=d.useCallback(()=>{if(Qe.current)return;const p=P.current.shift();p&&(Qe.current=!0,setTimeout(async()=>{try{await sn(p.name,p.params)}finally{Qe.current=!1,P.current.length>0?Ue():ve.current&&!ge()&&!le.current&&!A.current&&W.current&&W.current()}},0))},[sn,ge]),rs=d.useCallback(()=>{var Yt;if(!hr)return null;if(typeof navigator>"u"||!((Yt=navigator.mediaDevices)!=null&&Yt.getUserMedia))return console.warn("Media devices API not available for server STT fallback"),null;const p={start:null,result:null,error:null,end:null,audioend:null};let h=null,j=null,w=null,T=null,I=[],U=!1,M=nr,B=0,fe=0;const oe=(k,L)=>{const Q=p[k];if(typeof Q=="function")try{Q(L)}catch(re){console.error(`Server STT listener ${k} failed`,re)}},st=async()=>{if(w){try{w.disconnect()}catch(k){console.warn("Processor disconnect failed",k)}w.onaudioprocess=null}if(T)try{T.disconnect()}catch{}if(h)try{await h.close()}catch{}j&&j.getTracks().forEach(k=>{try{k.stop()}catch{}}),h=null,j=null,w=null,T=null},Ke=(k,L=0)=>{const Q={transcript:k,confidence:L},X=[{0:Q,length:1,isFinal:!0,item:()=>Q}];return X.item=Z=>X[Z],{resultIndex:0,results:X}},Xe=async(k="stop",L=!0)=>{if(U)return;U=!0,Gt.current.active=!1;const Q=I.slice();I=[];const re=M;if(await st(),oe("audioend"),!L||Q.length===0){L&&Q.length===0&&oe("error",{error:"no-speech"}),oe("end"),U=!1;return}try{const X=Fc(Q),Z=Lc(X,re,nr),te=$c(Z),de=Mc(te.buffer);if(!de)oe("error",{error:"no-speech"});else{const Y=await tr.transcribeAudio({audio:de,sampleRate:nr,language:"it-IT",sessionId:Ve.current}),Ie=((Y==null?void 0:Y.text)||"").trim(),Oe=typeof(Y==null?void 0:Y.confidence)=="number"?Y.confidence:0;Ie?oe("result",Ke(Ie,Oe)):oe("error",{error:"no-speech"})}}catch(X){console.error("Server STT transcription error",X),oe("error",{error:"network",message:(X==null?void 0:X.message)||"Errore nella trascrizione audio"})}oe("end"),U=!1},Xt={continuous:!1,interimResults:!0,lang:"it-IT",maxAlternatives:1,start:async()=>{if(Gt.current.active)return;try{j=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0}})}catch(L){console.error("Microphone permission denied",L),oe("error",{error:(L==null?void 0:L.name)||"not-allowed",message:L==null?void 0:L.message}),oe("end");return}const k=window.AudioContext||window.webkitAudioContext;if(!k){oe("error",{error:"audio-context-unavailable"}),oe("end");return}try{if(h=new k,h.state==="suspended")try{await h.resume()}catch{}M=h.sampleRate||nr,T=h.createMediaStreamSource(j),w=h.createScriptProcessor(4096,1,1),I=[],B=Date.now(),fe=B,w.onaudioprocess=L=>{if(!Gt.current.active)return;const Q=L.inputBuffer.getChannelData(0);I.push(new Float32Array(Q));let re=0;for(let te=0;te<Q.length;te+=1){const de=Q[te];re+=de*de}const X=Math.sqrt(re/Q.length),Z=Date.now();X>.015?B=Z:Z-B>900&&I.length>4&&Xe("silence"),Z-fe>14e3&&Xe("timeout")},T.connect(w),w.connect(h.destination),Gt.current.active=!0,oe("start")}catch(L){console.error("Failed to init server STT pipeline",L),oe("error",{error:(L==null?void 0:L.name)||"unknown",message:L==null?void 0:L.message}),await st(),oe("end")}},stop:()=>Xe("stop"),abort:()=>Xe("abort",!1)};return Object.defineProperties(Xt,{onstart:{get:()=>p.start,set:k=>{p.start=k}},onresult:{get:()=>p.result,set:k=>{p.result=k}},onerror:{get:()=>p.error,set:k=>{p.error=k}},onend:{get:()=>p.end,set:k=>{p.end=k}},onaudioend:{get:()=>p.audioend,set:k=>{p.audioend=k}}}),Xt},[hr,tr,Ve,Gt]),Cr=d.useCallback(()=>{if(hr)return rs();if(!_t())return null;const p=window.SpeechRecognition||window.webkitSpeechRecognition,h=new p;h.continuous=!1,h.interimResults=!0,h.lang="it-IT",h.maxAlternatives=1,h.onstart=()=>{if(console.log("🎤 Recognition started"),Pe(),We.current="",t(!0),S(null),O(!0),Tt.current=Date.now(),et.current=!1,!ct.current){const w=Hn();ct.current=setTimeout(()=>{if(!le.current&&!A.current){const T=Wn(),I=()=>{const U=Gn();Ge.current=setTimeout(()=>{!le.current&&!A.current&&nt()},U)};T?ue(T,()=>{I()},!1,{enqueue:!1,listeningProfile:"default"}):I()}},w)}};const j=(w=!1)=>{Pe();const T=We.current.trim();if(T){if(We.current="",console.log("💬 User said:",T),Vn(),Xr.current=null,yr.current=!1,x(T),Er(),typeof tn.current=="function")try{tn.current(T)}catch(I){console.error("Voice command dispatch failed",I)}if(w&&R.current)try{R.current.stop()}catch{}}};return h.onresult=w=>{if(!le.current&&Qn.current){let T="",I="";for(let U=w.resultIndex;U<w.results.length;U++){const M=w.results[U][0].transcript;w.results[U].isFinal?T+=M:I+=M}I&&(x(I),ct.current&&(clearTimeout(ct.current),ct.current=null),Ge.current&&(clearTimeout(Ge.current),Ge.current=null)),T&&(We.current=`${We.current} ${T}`.trim(),Pe(),br.current=setTimeout(()=>j(!0),Ao))}},h.onerror=w=>{w.error!=="aborted"&&w.error!=="no-speech"&&(Pe(),We.current="",w.error==="network"?S("Errore di connessione. Riprova."):S(`Errore microfono: ${w.error}`),t(!1))},h.onend=()=>{console.log("🔚 Recognition ended"),j(!1),Pe(),We.current="",t(!1),ve.current&&!le.current&&!Qe.current&&!et.current&&!A.current&&!ge()&&!G.current&&!Ge.current&&P.current.length===0&&(lt(),setTimeout(()=>{ve.current&&!le.current&&!A.current&&!G.current&&!Ge.current&&W.current&&W.current()},500))},h},[lt,Kr,Wn,Hn,Gn,Pe,_t,rs,hr]),on=d.useCallback(()=>{if(!(et.current||!ve.current||le.current||Qe.current||A.current||P.current.length>0||ge())){if(Xr.current||(Xr.current=`ls-${Date.now()}`,yr.current=!1),yr.current||(Kn(),yr.current=!0),et.current=!0,R.current){try{R.current.stop()}catch{}R.current=null}setTimeout(()=>{if(ve.current&&!le.current&&!Qe.current&&!A.current)try{if(R.current||(R.current=Cr()),R.current)try{R.current.start()}catch(p){console.warn("Recognition restart failed",p)}}catch(p){console.error("Failed to restart:",p)}et.current=!1},220)}},[b,u,Cr,Kn,Mn,ge]);d.useEffect(()=>{W.current=on},[on]);const rt=d.useCallback(()=>{var p,h;if(mt.current){try{mt.current.onended=null,mt.current.stop(),(h=(p=mt.current).disconnect)==null||h.call(p)}catch(j){console.warn("Failed to stop server TTS source",j)}mt.current=null}Vt.current=!1,Et.current=[],N(!1),le.current=!1,Je()},[Je]),nt=d.useCallback(()=>{if(console.log("🛑 Stopping assistant"),R.current){try{R.current.stop()}catch{}R.current=null}if(typeof window<"u"&&window.speechSynthesis)try{window.speechSynthesis.cancel()}catch{}rt(),Ce.current=[],qe.current&&(clearTimeout(qe.current),qe.current=null),ke.current="",Nt.current=!1,$e.current&&(clearTimeout($e.current),$e.current=null),Vn(),Pe(),We.current="",xr.current="",typeof Je=="function"&&Je(),t(!1),N(!1),f(!1),c(!1),se(!1),O(!0),ve.current=!1,et.current=!1,P.current=[],G.current=!1,c(!1),A.current=!1,pr.current=[],He.current="",Rt.current="",Yr.current={},De("default"),console.log("✅ Assistant stopped")},[Pe,De,rt]),Er=d.useCallback(()=>{Tt.current=Date.now(),$e.current&&clearTimeout($e.current),ve.current&&($e.current=setTimeout(()=>{Date.now()-Tt.current>=Yn?(console.log("⏰ Inactivity timeout reached"),ue("Sono ancora qui se hai bisogno. Dì qualcosa o chiuderò la conversazione.",()=>{setTimeout(()=>{Date.now()-Tt.current>=Yn+1e4&&nt()},1e4)})):Er()},Mo))},[nt]);window.__AIVA_SINGLETON__||(window.__AIVA_SINGLETON__={ws:null,listeners:new Set,queue:[],lastFnSigTs:new Map});const ze=window.__AIVA_SINGLETON__;d.useEffect(()=>{if(ze.ws&&ze.ws.readyState===WebSocket.OPEN)console.log("🔌 WebSocket reusing existing connection"),n(!0),we.current=ze.ws;else{const h=()=>{try{const j=Ci(Ve.current);ze.ws=j,j.onopen=()=>{if(console.log("🔌 WebSocket connected"),n(!0),we.current=j,ze.queue&&ze.queue.length){for(const w of ze.queue)try{j.send(JSON.stringify(w))}catch{}ze.queue=[]}},j.onmessage=w=>{try{const T=JSON.parse(w.data);ze.listeners.forEach(I=>I(T))}catch(T){console.error("Parse error:",T)}},j.onerror=w=>{console.error("WebSocket error:",w)},j.onclose=()=>{console.log("WebSocket disconnected"),n(!1),we.current=null,ze.ws=null;let w=0;(()=>{if(w>=5)return;w+=1;const I=Math.min(1e3*Math.pow(2,w),1e4);setTimeout(()=>{h()},I)})()}}catch(j){console.error("Connection failed:",j)}};h()}const p=h=>{if(he.current)try{he.current(h)}catch(j){console.error(j)}};return ze.listeners.add(p),()=>{ze.listeners.delete(p)}},[]);const qo=p=>(p||"").replace(/```[\s\S]*?```/g," ").replace(/`[^`]*`/g," ").replace(/[\*_~>#-]+/g," ").replace(/\[(.*?)\]\((.*?)\)/g,"$1").replace(/\b\d+\s+(pezzi?|in\s+magazzino|disponibili)\b[^,.]*[.,]?/gi,"").replace(/(\btaglia\b[^.]*?)\s*(,\s*)?\b\d+\b[^.]*\./gi,"$1.").replace(/\bXXXL\b/gi,"ics ics ics elle").replace(/\bXXL\b/gi,"ics ics elle").replace(/\bXL\b/gi,"ics elle").replace(/\bXXS\b/gi,"ics ics esse").replace(/\bXS\b/gi,"ics esse").replace(/vuoi[^.?!]*(taglie|colori|materiali)[^.?!]*[.?!]/gi," ").replace(/\s{2,}/g," ").trim(),ns=d.useCallback(async()=>{if(!at)return null;const p=window.AudioContext||window.webkitAudioContext;if(!p)return null;Wr.current||(Wr.current=new p);const h=Wr.current;if(h.state==="suspended")try{await h.resume()}catch(j){console.warn("Unable to resume TTS audio context",j)}return h},[at]),ss=d.useCallback(async()=>{if(!Vt.current&&Et.current.length!==0){for(Vt.current=!0,lt(),Qt(),N(!0),le.current=!0,O(!1),Fn.current=!0,rn();Et.current.length>0;){const p=Et.current[0];try{const h=await tr.synthesizeSpeech({text:p.text,voice:p.voice,sessionId:Ve.current}),j=h==null?void 0:h.audio;if(!j)throw new Error("tts-empty-response");const w=qc(j),T=await ns();if(!T)throw new Error("audio-context-unavailable");const I=await new Promise((U,M)=>{const B=w.slice(0);T.decodeAudioData(B,U,M)});await new Promise(U=>{const M=T.createBufferSource();M.buffer=I,M.connect(T.destination),mt.current=M,M.onended=()=>{mt.current=null,U()},M.start(0)}),typeof p.onEnd=="function"&&p.onEnd()}catch(h){console.error("Server TTS playback error",h);const j=Qr.current;if(typeof window<"u"&&window.speechSynthesis&&typeof j=="function")try{j(p.text,p.onEnd,p.immediate,{enqueue:p.enqueue,listeningProfile:p.listeningProfile,forceBrowser:!0})}catch(T){console.error("Browser TTS fallback failed",T),typeof p.onEnd=="function"&&p.onEnd(h)}else typeof p.onEnd=="function"&&p.onEnd(h)}Et.current.shift()}Je(),N(!1),le.current=!1,Vt.current=!1,Ct.current&&(Ct.current=!1),pe()}},[ns,pe,lt,Qt,rn,Je,tr]),Tr=d.useCallback((p,h,j=!1,w={})=>{const T={text:p,onEnd:h,voice:(w==null?void 0:w.voice)||null,enqueue:(w==null?void 0:w.enqueue)??!1,listeningProfile:(w==null?void 0:w.listeningProfile)||null,immediate:j};j&&rt(),Et.current.push(T),ss()},[ss,rt]),ue=d.useCallback((p,h,j=!1,w={})=>{const{enqueue:T=!1,listeningProfile:I,forceBrowser:U=!1}=w||{},M=qo(p);if(wr(M,I),qn&&!U){Tr(M,h,j,{voice:I,enqueue:T,listeningProfile:I});return}if((typeof window>"u"||!window.speechSynthesis)&&!U){Tr(M,h,j,{voice:I,enqueue:T,listeningProfile:I});return}try{if(lt(),Qt(),N(!0),le.current=!0,j){try{window.speechSynthesis.cancel()}catch{}Ce.current=[]}if((T?vr(M):[M]).forEach(fe=>{if(!fe)return;const oe=new SpeechSynthesisUtterance(fe);oe.lang="it-IT",oe.rate=1,oe.pitch=1.1,oe.volume=.9,fr.current&&(oe.voice=fr.current),oe.onstart=()=>{N(!0),le.current=!0,O(!1),Fn.current=!0,qe.current&&(clearTimeout(qe.current),qe.current=null),rn()},oe.onend=()=>{if(Ce.current.shift(),Ce.current.length>0){const st=Ce.current[0];try{st&&window.speechSynthesis.speak(st)}catch{}}Ce.current.length===0&&(Je(),N(!1),le.current=!1,Ct.current&&(Ct.current=!1,pe()),typeof h=="function"&&h())},Ce.current.push(oe)}),!window.speechSynthesis.speaking){const fe=Ce.current[0];fe&&window.speechSynthesis.speak(fe)}qe.current||(qe.current=setTimeout(()=>{!window.speechSynthesis.speaking&&Ce.current.length===0&&(N(!1),le.current=!1,pe())},1500))}catch(B){console.error("Browser TTS failed, switching to server fallback",B),U?typeof h=="function"&&h(B):Tr(M,h,!0,{voice:I,enqueue:T,listeningProfile:I})}},[wr,Tr,pe,lt,Qt,vr,qn]);d.useEffect(()=>{Qr.current=ue},[ue]);const Kt=d.useCallback((p=!1)=>{const h=(ke.current||"").replace(/\s+/g," ").trim();if(!h)return!1;const j=vr(h);if(!j.length)return!1;const w=[];let T=!1;return j.forEach((I,U)=>{const M=I.trim();if(!M)return;const B=/[\.!?…:]\s*$/.test(M);p||B||M.length>160?(ue(M,()=>{},!1,{enqueue:!0}),T=!0,Nt.current=!0):w.push(M)}),ke.current=w.join(" "),T},[vr,ue]),os=d.useCallback(p=>{var h,j;if(ve.current){if(console.log("📨 WebSocket message:",p.type),Ht.current&&p.type!=="processing_start"){console.log("⏭️ Dropped stale WS message:",p.type);return}switch(i(w=>[...w,p]),Tt.current=Date.now(),p.type){case"processing_start":{c(!0),A.current=!0,O(!1),ce.current=!1,Qt(),Me.current="",ke.current="",Nt.current=!1,He.current="",Rt.current="",Ht.current=!1;break}case"function_start":break;case"stream_start":{Me.current="",ke.current="",Nt.current=!1,He.current="",dr.current=!0,Ct.current=!1;break}case"text_chunk":{if(typeof p.content=="string"){const w=(p.content||"").trim();w&&(He.current=`${He.current} ${w}`.trim(),Me.current=`${Me.current} ${w}`.trim(),ke.current=`${ke.current} ${w}`.trim(),Kt(!1)&&(ce.current=!0))}break}case"stream_complete":{Kt(!0)&&(ce.current=!0),dr.current=!1,Ct.current=!0,Me.current="",ke.current="",!ge()&&Ce.current.length===0&&(c(!1),A.current=!1,pe());break}case"function_complete":{const T=((M,B)=>{try{return`${M}:${JSON.stringify(B)}`}catch{return`${M}:<unserializable>`}})(p.function,p.parameters||{}),I=Date.now(),U=(((h=window.__AIVA_SINGLETON__)==null?void 0:h.lastFnSigTs)||new Map).get(T)||0;if(window.__AIVA_SINGLETON__){if(I-U<1500)break;window.__AIVA_SINGLETON__.lastFnSigTs.set(T,I)}if(c(!1),A.current=!1,p.function&&p.parameters){const M=(Ln.current||"").toLowerCase();if(/(carrello|svuota|rimuovi|togli|elenca|prodotti nel carrello)/.test(M)&&p.function==="navigate_to_page"&&((j=p.parameters)==null?void 0:j.page)==="prodotti")break;if(/^(sì|si|ok|va bene|perfetto|d'accordo|come no|certo|ottimo|grazie|no grazie|basta cos[ìi]|tutto ok|tutto bene|va benissimo|benissimo)[!.\s]*$/.test(M.trim())&&["navigate_to_page","navigate","search_products","get_product_details"].includes(p.function)){console.log("⏭️ Ignoro funzione non richiesta dopo conferma breve");break}P.current.push({name:p.function,params:p.parameters})}else ue("Ok. Puoi ripetere la richiesta con qualche dettaglio in più?",()=>{G.current=!1,pe()},!1,{enqueue:!1});break}case"response":{if(p.message){const w=(p.message||"").trim();if(w){He.current||(He.current=w);const T=p.streamed?He.current:w;T&&Rt.current!==T&&(nn(T),Rt.current=T),p.streamed?Kt(!0)&&(ce.current=!0):(c(!0),A.current=!0,ce.current=!0,ue(w,()=>{c(!1),A.current=!1,pe()},!1,{enqueue:!1}))}}break}case"complete":{if(Kt(!0)&&(ce.current=!0),p.message){const T=(p.message||"").trim();T&&(He.current||(He.current=T),Rt.current!==T&&(nn(T),Rt.current=T),!Nt.current&&!p.streamed&&(ce.current=!0,ue(T,()=>{c(!1),A.current=!1,pe()},!1,{enqueue:!1})))}else!dr.current&&Ce.current.length===0&&!ge()?(c(!1),A.current=!1,pe()):(qe.current&&clearTimeout(qe.current),qe.current=setTimeout(()=>{c(!1),A.current=!1,pe()},1500));P.current.length>0&&!Qe.current&&Ue();break}case"error":{if(typeof window<"u"&&window.speechSynthesis)try{window.speechSynthesis.cancel()}catch{}rt(),Ce.current=[],N(!1),le.current=!1,c(!1),A.current=!1,G.current=!1,ke.current="",Nt.current=!1,S(p.message||"Errore"),pe();break}}}},[ue,sn,nt,nn,Kt,pe,ge,rt]);d.useEffect(()=>{he.current=os},[os]);const is=d.useCallback(async p=>{var h;try{if((p==null?void 0:p.type)==="voice_command"){const j=await tr.processVoiceCommand(p.text,p.context,(h=p.context)==null?void 0:h.session_id),w=Array.isArray(j==null?void 0:j.events)?j.events:[];if(w.length===0){he.current&&he.current({type:"error",message:"Risposta vuota dal server vocale"});return}for(const T of w)try{he.current&&he.current(T)}catch{}}}catch(j){console.error("HTTP voice command failed",j),he.current&&he.current({type:"error",message:"Errore richiesta voce"})}},[]),as=d.useCallback(async p=>{var h,j,w,T,I,U,M;if(p.trim()){Ln.current=p,De("task");try{if(le.current||ge()){if(typeof window<"u"&&window.speechSynthesis)try{window.speechSynthesis.cancel()}catch{}rt(),typeof Je=="function"&&Je(),Ce.current=[],Me.current="",Ht.current=!0,G.current=!1,c(!1),A.current=!1,N(!1),le.current=!1}if(G.current||A.current){console.log("🔒 Ignoro comando: turno in corso"),W.current&&W.current();return}if(Ge.current){console.log("⏳ Ignoro comando: chiusura in corso");return}G.current=!0;const B=p.toLowerCase(),fe=/(apri|mostra|vai|portami).*(il\s+)?carrello|^carrello$/,oe=/(apri|mostra|vai|portami).*(offerte|in offerta|sconti)|^(offerte|sconti|saldi)$/,st=/(torna|vai).*(home|pagina iniziale)|^home$/,Ke=/((apri|mostra|vai|portami).*(pagina\s+)?prodotti(?!.*carrello))|^tutti i prodotti$|^prodotti$|^catalogo$|^mostra tutto$|^mostrami tutto$/,Xe=[/descrivimi/i,/descrivilo/i,/descrivila/i,/descriv[iy]/i,/descrizione/i,/dettagli/i,/informazioni?(?: sul| del)? prodotto/i,/leggi .*descrizione/i,/dimmi .*descrizione/i,/mostra .*descrizione/i],Xt=/(elenca|leggi|dimmi|quali|mostra).*(prodotti|articoli).*(nel\s+)?carrello|cosa.*(c\s'?|è|ho).*(nel\s+)?carrello/,Yt=/(svuota|svuotare|svuotalo|svuotami|rimuovi|togli|cancella).*(tutti|tutto)?.*(prodotti|articoli)?.*(dal\s+)?carrello/,k=/(?:mostra|apri).*(?:il\s+)?prodotto\s+(.+)/,L=(ne="")=>ne.toString().normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").toLowerCase().replace(/[^a-z0-9]+/g," ").trim(),Q=/(aggiungi|metti|mettilo|mettila).*(nel\s+)?carrello(?::|\s|\,)*(?:.*?(taglia)\s+([xslm]{1,3}|xs|xxs|xl|xxl|s|m|l))?(?:.*?(colore)\s+([a-zà-ù\s]+))?/i,re={xs:"XS",xxs:"XXS",s:"S",m:"M",l:"L",xl:"XL",xxl:"XXL"},X={nero:"nero",black:"nero",bianco:"bianco",white:"bianco",blu:"blu","blu navy":"blu navy",navy:"blu navy","blu scuro":"blu navy",azzurro:"azzurro",rosso:"rosso",borgogna:"bordeaux",bordeaux:"bordeaux","verde militare":"verde militare",militare:"verde militare",verde:"verde","verde oliva":"verde oliva",oliva:"verde oliva",grigio:"grigio","grigio melange":"grigio melange",melange:"grigio melange",antracite:"grigio antracite",beige:"beige",panna:"panna",crema:"panna",cammello:"cammello",rosa:"rosa",marrone:"marrone",giallo:"giallo",viola:"viola",kaki:"kaki",khaki:"kaki",cachi:"kaki",caqui:"kaki"},Z={uno:1,una:1,un:1,due:2,tre:3,quattro:4,cinque:5,sei:6,sette:7,otto:8,nove:9,dieci:10},te=(ne="")=>{const ee=ne.normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").toLowerCase().trim(),ye=Object.keys(X).sort((xe,Ee)=>Ee.length-xe.length);for(const xe of ye)if(ee.includes(xe))return X[xe];return ee||void 0},de=(ne="")=>{const ee=ne.normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").toLowerCase();if(!ee)return[];const ye=Object.keys(X).sort((Se,ut)=>ut.length-Se.length),xe=[];let Ee=ee;for(const Se of ye)if(Ee.includes(Se)){const ut=X[Se];xe.includes(ut)||xe.push(ut),Ee=Ee.replace(Se," ")}return xe},Y=(ne="")=>{const ee=ne.normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").toLowerCase(),ye=ee.match(/(?:aggiungi|aggiungine|metti|mettimene|mettil[oa])(.*)/),xe=ye?ye[1]:ee,Ee=xe.match(/(\d{1,2})\s*(?:pezzi|articoli|prodotti|paia|capi)?/);if(Ee){const Se=parseInt(Ee[1],10);if(!Number.isNaN(Se))return Se}for(const[Se,ut]of Object.entries(Z))if(new RegExp(`\\b${Se}\\b`,"i").test(xe))return ut;return null};if(fe.test(B)){G.current=!0,c(!0),A.current=!0,P.current.push({name:"get_cart_summary",params:{}}),Ue();return}if(Xt.test(B)){G.current=!0,c(!0),A.current=!0;const ne=Bs(6);ue(ne,()=>{c(!1),A.current=!1,G.current=!1,pe()},!1,{enqueue:!1});return}if(oe.test(B)){G.current=!0,c(!0),A.current=!0,P.current.push({name:"show_offers",params:{}}),Ue();return}if(st.test(B)){G.current=!0,c(!0),A.current=!0,P.current.push({name:"navigate_to_page",params:{page:"home"}}),Ue();return}if(Yt.test(B)){G.current=!0,c(!0),A.current=!0,P.current.push({name:"clear_cart",params:{}}),Ue();return}if(Ke.test(B)){const ne=/(tutti|mostra tutto|mostrami tutto|catalogo)/.test(B);c(!0),A.current=!0;const ee={page:"prodotti"};ne&&(ee.resetFilters=!0),P.current.push({name:"navigate_to_page",params:ee}),Ue();return}if((()=>{var ne;return(ne=window.currentProductContext)!=null&&ne.description_text?!!(Xe.some(ee=>ee.test(B))||B.includes("descrizione")&&(B.includes("prodotto")||B.includes("articolo"))||B.includes("descrivi")&&(B.includes("prodotto")||B.includes("articolo"))):!1})()){G.current=!0,c(!0),A.current=!0;try{const ne=await Zr(),ee=ne&&typeof ne=="object"?ne:window.currentProductContext||{};let ye=ee==null?void 0:ee.description_text;if(!ye&&(ee!=null&&ee.product)){const Se=Sn(ee,ee.product);window.currentProductContext=Se,ye=Se.description_text}const xe=(ee==null?void 0:ee.name)||((h=ee==null?void 0:ee.product)==null?void 0:h.name)||"prodotto",Ee=ye?`${xe}. ${ye}`.slice(0,900):`Non riesco a trovare ulteriori dettagli su ${xe}. Posso aiutarti in altro modo?`;ue(Ee,()=>{c(!1),A.current=!1,pe()},!1,{enqueue:!1})}catch(ne){console.error("Errore descrizione prodotto:",ne),ue("Non sono riuscita a recuperare la descrizione del prodotto.",()=>{c(!1),A.current=!1,pe()},!1,{enqueue:!1})}return}if(Q.test(p)&&((j=window.currentProductContext)!=null&&j.id)){const ne=Array.isArray((w=window.currentProductContext)==null?void 0:w.variants)?window.currentProductContext.variants:[],ee=((T=ne[0])==null?void 0:T.size)||"M",ye=((I=ne[0])==null?void 0:I.color)||"nero",xe=Y(p),Ee=vn(xe??1,1),Se=(ae="")=>{const Fe=ae.toLowerCase().replace(/[^a-z0-9]/g,"");return(re[Fe]||ae||ee||"M").toString().toUpperCase()},ut=new Set(ne.map(ae=>(ae.color||"").toLowerCase())),an=(ae="")=>{const Fe=de(ae);let Te=Fe.find(ft=>ut.has(ft.toLowerCase()))||Fe[0]||te(ae);Te||(Te=ye||"nero");const dt=ne.find(ft=>(ft.color||"").toLowerCase()===Te.toLowerCase());return(dt==null?void 0:dt.color)||Te},Uo=ae=>{const Te=Math.max(0,ae-40),dt=Math.min(p.length,ae+40),ft=p.slice(Te,dt).normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").toLowerCase(),Rr=ft.match(/(\d{1,2})\s*(pezzi|pezzo|articoli|prodotti|paia|capi)?/);if(Rr){const Pt=parseInt(Rr[1],10);if(Number.isFinite(Pt))return Pt}for(const[Pt,cn]of Object.entries(Z))if(new RegExp(`\b${Pt}\b`,"i").test(ft))return cn;return null},yt=[],cs=new Set,ls=ae=>{if(!ae||!ae.size)return;const Fe=`${ae.size.toUpperCase()}|${(ae.color||"").toLowerCase()}`;if(cs.has(Fe))return;cs.add(Fe);const Te=vn(ae.quantity??Ee,Ee);yt.push({size:ae.size.toUpperCase(),color:ae.color,quantity:Te})},Bo=/taglia\s+([a-z0-9]{1,3}|xxs|xs|s|m|l|xl|xxl|xxxl)/gi,us=Array.from(p.matchAll(Bo));us.forEach((ae,Fe)=>{var ps;const Te=ae.index??0,dt=ae[1]||"",ft=((ps=us[Fe+1])==null?void 0:ps.index)??p.length,Rr=p.slice(Te,ft),Pt=Uo(Te),cn=Se(dt||ee),fs=an(Rr||ye);ls({size:cn,color:fs,quantity:Pt??Ee})}),yt.length===0&&ls({size:Se(ee),color:an(ye),quantity:Ee});const Vo=window.currentProductContext.id,Ho=((U=window.currentProductContext)==null?void 0:U.name)||"questo prodotto",ds=yt.length>1?`Ho aggiunto ${yt.length} varianti di ${Ho} al carrello.`:null;G.current=!0,c(!0),A.current=!0,yt.forEach((ae,Fe)=>{const Te=Fe===yt.length-1;P.current.push({name:"add_to_cart",params:{product_id:Vo,size:ae.size,color:ae.color,quantity:ae.quantity,skipAck:yt.length>1&&!Te,overrideAck:Te&&ds?ds:void 0}})}),Ue();return}const Oe=B.match(k);if(Oe&&Oe[1]){const ne=L(Oe[1]),ee=window.visibleProductsMap||{};let ye=null;if(ee[ne])ye=ee[ne];else for(const xe of Object.keys(ee))if(xe.includes(ne)){ye=ee[xe];break}if(ye){G.current=!0,c(!0),A.current=!0,P.current.push({name:"get_product_details",params:{product_id:ye}}),Ue();return}}const ot=B.trim();if(/(basta|chiudi|puoi andare|stop|non.*altro|alla prossima|ci sentiamo|puoi riposarti)/i.test(B)||/^(grazie( mille)?( di tutto)?(,? (ciao|a presto|alla prossima|buona giornata|buona serata))?|ti ringrazio(,? (ciao|a presto|alla prossima|buona giornata|buona serata))?)$/.test(ot)||/^ciao(?:\s+(?:e\s+)?(grazie|alla prossima|per ora|ti ringrazio|a presto|buona serata|buona giornata).*)$/.test(ot)){ue("Perfetto, alla prossima!",()=>nt());return}i(ne=>[...ne,{type:"user",text:p,timestamp:new Date().toISOString()}]),x(""),is({type:"voice_command",text:p,context:{session_id:Ve.current,timestamp:new Date().toISOString(),current_page:window.location.pathname,cart_count:((M=window.cartSnapshot)==null?void 0:M.length)??Le.getState().cartCount,cart:window.cartSnapshot||[],cart_items_map:window.cartItemsMap||{},preferences:Le.getState().preferences,session_count:$,current_product:window.currentProductContext||null,visible_products:window.visibleProductIds||[],visible_products_map:window.visibleProductsMap||{},ui_filters:{q:window.productsSearchQuery||"",category:window.productsSelectedCategory||""},history:pr.current.slice(-12)}}),ts(p)}catch(B){console.error("Voice command handling error:",B),c(!1),A.current=!1,G.current=!1,pe()}}},[is,$,ue,nt,ts,pe,Zr,De,ge,rt,Bn,Ue,Bs]);d.useEffect(()=>{tn.current=as},[as]);const Do=d.useCallback(async()=>{if(console.log("🎤 Toggle listening:",e,"Active:",V),!_t()){S("Browser non supporta il riconoscimento vocale");return}if(S(null),e||V)nt();else{console.log("▶️ Starting assistant"),se(!0),ve.current=!0,et.current=!1,De("default"),xr.current="",We.current="",Pe(),Er();try{if((await navigator.mediaDevices.getUserMedia({audio:!0})).getTracks().forEach(j=>j.stop()),await lt(),R.current||(R.current=Cr()),R.current)try{R.current.start()}catch(j){console.warn("Initial recognition start failed",j)}const h=Zn();ue(h,()=>{setTimeout(()=>{ve.current&&!A.current&&!Qe.current&&!ge()&&W.current&&W.current(),setTimeout(()=>Jt(),180)},250)},!0,{enqueue:!1}),G.current=!1}catch(p){console.error("Microphone error:",p),S("Permessi microfono negati"),se(!1),ve.current=!1}}},[e,V,Cr,ue,Zn,nt,Er,lt,De,Pe,ge,Jt]);return d.useEffect(()=>()=>{R.current&&R.current.stop(),typeof window<"u"&&window.speechSynthesis&&window.speechSynthesis.cancel(),rt(),we.current&&we.current.close(),$e.current&&clearTimeout($e.current)},[]),{isListening:e,isConnected:r,messages:o,isProcessing:a,isExecutingFunction:u,currentFunction:l,error:v,transcript:y,isSpeaking:b,isUserTurn:E,isAssistantActive:V,toggleListening:Do,clearError:()=>S(null),browserSupportsSpeechRecognition:_t()}},Bc=({isListening:e,isConnected:t,error:r,onToggleListening:n,browserSupportsSpeechRecognition:o,isAssistantActive:i})=>{const[a,c]=d.useState(!1),u=()=>{if(!o){console.warn("Speech recognition not supported"),alert("Il riconoscimento vocale non è disponibile nel tuo browser. Prova con Chrome o Edge per la migliore esperienza.");return}n()},l=r?{bg:"bg-gradient-to-r from-red-500 to-red-600",pulse:!1,icon:pi,tooltip:"Errore - Clicca per riprovare"}:i?e?{bg:"bg-gradient-to-r from-blue-500 to-purple-500",pulse:!0,icon:Ot,tooltip:"In ascolto - Clicca per fermare"}:{bg:"bg-gradient-to-r from-purple-500 to-pink-500",pulse:!1,icon:Ys,tooltip:"AIVA attiva - Clicca per chiudere"}:{bg:"bg-gradient-to-r from-blue-600 to-purple-600",pulse:!1,icon:Ot,tooltip:"Attiva AIVA - Il tuo Personal Shopper AI"};return s.jsxs(_.div,{className:"fixed bottom-4 right-4 md:bottom-8 md:right-8 z-[120] pointer-events-auto",style:{bottom:"calc(env(safe-area-inset-bottom, 0px) + 1rem)",right:"calc(env(safe-area-inset-right, 0px) + 1rem)"},initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},transition:{delay:.5,type:"spring",stiffness:260,damping:20},children:[s.jsxs(_.button,{onClick:u,onHoverStart:()=>c(!0),onHoverEnd:()=>c(!1),className:`relative group ${l.bg} p-6 rounded-full shadow-2xl text-white overflow-hidden`,whileHover:{scale:1.1},whileTap:{scale:.95},disabled:!1,children:[s.jsx(_.div,{className:"absolute inset-0 bg-gradient-to-r from-pink-500 via-purple-500 to-blue-500",animate:{backgroundPosition:l.pulse?["0% 50%","100% 50%","0% 50%"]:["0% 50%"]},transition:{duration:2,repeat:l.pulse?1/0:0,ease:"linear"},style:{backgroundSize:"200% 200%"}}),l.pulse&&s.jsxs(s.Fragment,{children:[s.jsx(_.span,{className:"absolute inset-0 rounded-full border-4 border-white",animate:{scale:[1,2.2],opacity:[.6,0]},transition:{duration:1.5,repeat:1/0,ease:"easeOut"}}),s.jsx(_.span,{className:"absolute inset-0 rounded-full border-4 border-white",animate:{scale:[1,2.2],opacity:[.6,0]},transition:{duration:1.5,repeat:1/0,ease:"easeOut",delay:.5}})]}),s.jsx(_.div,{className:"relative z-10",animate:{rotate:l.pulse?[0,10,-10,0]:0,scale:i?[1,1.1,1]:1},transition:{duration:.8,repeat:l.pulse?1/0:0},children:s.jsx(l.icon,{size:28})}),a&&t&&s.jsx(_.div,{className:"absolute -top-1 -right-1",initial:{scale:0},animate:{scale:1},exit:{scale:0},children:s.jsx($t,{className:"text-yellow-300",size:20})})]}),s.jsx(ir,{children:a&&s.jsxs(_.div,{initial:{opacity:0,y:10,scale:.9},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:10,scale:.9},className:"absolute bottom-full mb-3 right-0 bg-gray-900 text-white text-sm py-2 px-4 rounded-lg whitespace-nowrap max-w-xs",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx($t,{size:16,className:"text-yellow-300 flex-shrink-0"}),s.jsx("span",{children:l.tooltip})]}),s.jsx("div",{className:"absolute bottom-0 right-8 transform translate-y-1/2 rotate-45 w-2 h-2 bg-gray-900"})]})}),s.jsx("div",{className:`absolute bottom-1 right-1 w-3 h-3 rounded-full border-2 border-white ${t?"bg-green-400":"bg-yellow-400"}`,title:t?"Connesso":"In connessione..."}),r&&s.jsx(_.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"absolute bottom-full mb-2 right-0 bg-red-500 text-white text-sm py-2 px-4 rounded-lg whitespace-nowrap max-w-xs",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Mt,{size:16}),s.jsx("span",{children:r})]})})]})},Vc=()=>s.jsx("div",{className:"min-h-screen bg-gradient-to-br from-rose-50 via-white to-purple-50 flex items-center justify-center px-6",children:s.jsxs("div",{className:"max-w-md text-center space-y-6",children:[s.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-gradient-to-r from-purple-500 to-pink-500 text-white shadow-lg",children:s.jsx($t,{size:28})}),s.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Versione mobile in arrivo!"}),s.jsx("p",{className:"text-gray-600 leading-relaxed",children:"Stiamo mettendo a punto l'esperienza mobile di AIVA. Collegati da desktop per provare la demo completa con la nostra personal shopper AI."}),s.jsx("p",{className:"text-sm text-gray-500",children:"Grazie della pazienza, torna a trovarci presto!"})]})}),Hc=({cartItemsCount:e})=>{const[t,r]=d.useState(!1),n=_(Lr),o=[{id:"products",label:"Prodotti",icon:"📦",path:"/products"},{id:"offers",label:"Offerte",icon:"🏷️",path:"/offers"},{id:"cart",label:"Carrello",icon:"🛒",path:"/cart",badge:e}];return s.jsxs(_.nav,{className:"sticky top-0 z-40 bg-white shadow-sm",initial:{y:-100},animate:{y:0},transition:{type:"spring",stiffness:100},children:[s.jsx("div",{className:"max-w-7xl mx-auto px-4",children:s.jsxs("div",{className:"flex items-center justify-between h-16",children:[s.jsxs("div",{className:"flex items-center gap-8",children:[s.jsx(n,{to:"/",className:"text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-purple-600 cursor-pointer select-none",whileHover:{scale:1.05},style:{userSelect:"none",WebkitUserSelect:"none"},children:"AIVA Fashion"}),s.jsx("div",{className:"hidden md:flex items-center gap-6",children:o.map(i=>s.jsx(ms,{to:i.path,className:({isActive:a})=>`text-gray-700 hover:text-blue-600 transition ${a?"text-blue-600 font-semibold":""}`,children:i.label},i.id))})]}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("button",{className:"p-2 text-gray-600 hover:text-blue-600",children:s.jsx(Xs,{size:20})}),s.jsx("button",{className:"p-2 text-gray-600 hover:text-blue-600",children:s.jsx(di,{size:20})}),s.jsxs(Lr,{to:"/cart",className:"relative p-2 text-gray-600 hover:text-blue-600",children:[s.jsx($r,{size:20}),e>0&&s.jsx(_.span,{initial:{scale:0},animate:{scale:1},className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center",children:e})]}),s.jsx("button",{onClick:()=>r(!t),className:"md:hidden p-2 text-gray-600",children:t?s.jsx(Mt,{size:20}):s.jsx(fi,{size:20})})]})]})}),s.jsx(ir,{children:t&&s.jsx(_.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"md:hidden bg-white border-t",children:s.jsx("div",{className:"px-4 py-4 space-y-2",children:o.map(i=>s.jsxs(ms,{to:i.path,className:({isActive:a})=>`block py-2 px-3 rounded-lg text-gray-700 hover:text-blue-600 hover:bg-blue-50 ${a?"text-blue-600 font-semibold bg-blue-50":""}`,onClick:()=>r(!1),children:[s.jsx("span",{className:"mr-2",children:i.icon}),i.label,i.badge>0&&s.jsx("span",{className:"ml-2 bg-red-500 text-white text-xs rounded-full px-2 py-1",children:i.badge})]},i.id))})})})]})},Gc=()=>{const e=()=>{try{window.scrollTo({top:0,behavior:"smooth"})}catch{}};return s.jsxs("footer",{className:"bg-gray-900 text-gray-300 py-12 px-4",children:[s.jsxs("div",{className:"max-w-7xl mx-auto grid md:grid-cols-3 gap-8",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-white font-bold text-xl mb-4",children:"AIVA Fashion"}),s.jsx("p",{className:"text-sm",children:"Concept interattivo per portfolio – non è un e‑commerce reale."})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"text-white font-semibold mb-4",children:"Info"}),s.jsx("p",{className:"text-sm leading-6",children:"Questo sito è un progetto dimostrativo creato da Michele Miranda per mostrare integrazione tra assistente vocale, AI e interfaccia e‑commerce. I prodotti, i prezzi e le promozioni hanno scopo illustrativo."})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"text-white font-semibold mb-4",children:"Shop"}),s.jsxs("ul",{className:"space-y-2 text-sm",children:[s.jsx("li",{children:s.jsx(Lr,{to:"/products",className:"hover:text-white transition",children:"Prodotti"})}),s.jsx("li",{children:s.jsx(Lr,{to:"/offers",className:"hover:text-white transition",children:"Offerte"})}),s.jsx("li",{children:s.jsx("button",{onClick:e,className:"hover:text-white transition",children:"Torna Su"})})]})]})]}),s.jsx("div",{className:"max-w-7xl mx-auto mt-8 pt-8 border-t border-gray-800 text-center text-sm",children:s.jsx("p",{children:"© 2025 AIVA Fashion – Concept per il portfolio di Michele Miranda"})})]})};function Wc(){const e=Qo(),{cartCount:t}=Bt(),{isListening:r,isConnected:n,messages:o,isProcessing:i,isExecutingFunction:a,currentFunction:c,error:u,isSpeaking:f,isAssistantActive:l,toggleListening:m,browserSupportsSpeechRecognition:v}=Uc();d.useEffect(()=>{if(typeof navigator>"u")return;const y=navigator.userAgent||"";setIsMobileViewport(/Mobi|Android|iPhone|iPad|iPod/i.test(y))},[]);const S=()=>{console.log("🔴 App: Closing assistant completely"),m()};return s.jsxs("div",{className:"min-h-screen bg-gray-50",children:[s.jsx(Hc,{cartItemsCount:t}),s.jsx(ir,{mode:"wait",children:s.jsx(_.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:s.jsxs(Jo,{children:[s.jsx(Zt,{path:"/",element:s.jsx(wi,{onVoiceToggle:m})}),s.jsx(Zt,{path:"/products",element:s.jsx(Rc,{})}),s.jsx(Zt,{path:"/products/:id",element:s.jsx(zc,{})}),s.jsx(Zt,{path:"/offers",element:s.jsx(Ac,{})}),s.jsx(Zt,{path:"/cart",element:s.jsx(Pc,{})})]})},e.pathname)}),s.jsx(Gc,{}),s.jsx(Bc,{isListening:r,isConnected:n,error:u,onToggleListening:m,browserSupportsSpeechRecognition:v,isAssistantActive:l}),l&&s.jsx(Ic,{isListening:r,isProcessing:i,isConnected:n,isSpeaking:f,isExecutingFunction:a,currentFunction:c,messages:o,error:u,onClose:S,isAssistantActive:l})]})}function Qc(){const[e,t]=d.useState(!1);return d.useEffect(()=>{if(typeof navigator>"u")return;const r=navigator.userAgent||"";t(/Mobi|Android|iPhone|iPad|iPod/i.test(r))},[]),d.useEffect(()=>{if(typeof window>"u")return;const r=()=>{const n=navigator&&navigator.userAgent?navigator.userAgent:"";t(/Mobi|Android|iPhone|iPad|iPod/i.test(n))};return window.addEventListener("resize",r),window.addEventListener("orientationchange",r),()=>{window.removeEventListener("resize",r),window.removeEventListener("orientationchange",r)}},[]),e?s.jsx(Vc,{}):s.jsx(Wc,{})}var Jc=mi();const To=Pn(Jc);typeof globalThis.regeneratorRuntime>"u"&&(globalThis.regeneratorRuntime=To);typeof window<"u"&&(window.regeneratorRuntime=To);console.log("Polyfills loaded successfully");const Kc=Hs.Fragment;bi.createRoot(document.getElementById("root")).render(s.jsx(Kc,{children:s.jsx(Ko,{children:s.jsx(Qc,{})})}));
//# sourceMappingURL=index-B08PQSUS.js.map
