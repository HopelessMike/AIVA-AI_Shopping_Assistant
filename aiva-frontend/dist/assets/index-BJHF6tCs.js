import{a as xn,b as Co,g as bn,R as js,r as d,u as Kt,c as Eo,d as To,e as _o,f as Bt,L as Tr,N as Wn,B as Ro}from"./react-vendor-Bydu6J3a.js";import{m as _,A as Xt}from"./animation-DoJXsEng.js";import{M as _t,S as Jt,a as Ao,b as _r,H as Ar,c as ht,G as ko,d as kr,P as Po,C as Io,Z as Ns,F as Jn,e as Oo,L as zo,X as kt,T as Cs,f as Es,g as Fo,A as Lo,h as Ts,i as _s,j as $o,k as qo,R as Do,l as Mo,m as Kr,n as Rs,N as Uo,V as As,o as Bo,U as Vo,p as Ho,q as Go}from"./ui-DjfJgPDo.js";import{r as Wo}from"./voice-BWufaHyz.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function r(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(o){if(o.ep)return;o.ep=!0;const i=r(o);fetch(o.href,i)}})();var Xr={exports:{}},Vt={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Qn;function Jo(){if(Qn)return Vt;Qn=1;var e=xn(),t=Symbol.for("react.element"),r=Symbol.for("react.fragment"),n=Object.prototype.hasOwnProperty,o=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function a(c,u,f){var l,m={},w=null,S=null;f!==void 0&&(w=""+f),u.key!==void 0&&(w=""+u.key),u.ref!==void 0&&(S=u.ref);for(l in u)n.call(u,l)&&!i.hasOwnProperty(l)&&(m[l]=u[l]);if(c&&c.defaultProps)for(l in u=c.defaultProps,u)m[l]===void 0&&(m[l]=u[l]);return{$$typeof:t,type:c,key:w,ref:S,props:m,_owner:o.current}}return Vt.Fragment=r,Vt.jsx=a,Vt.jsxs=a,Vt}var Kn;function Qo(){return Kn||(Kn=1,Xr.exports=Jo()),Xr.exports}var s=Qo(),br={},Xn;function Ko(){if(Xn)return br;Xn=1;var e=Co();return br.createRoot=e.createRoot,br.hydrateRoot=e.hydrateRoot,br}var Xo=Ko();const Yo=bn(Xo),Zo=({onVoiceToggle:e})=>s.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 via-blue-50 to-indigo-100",children:[s.jsx(_.section,{className:"relative overflow-hidden py-20 px-4",initial:{opacity:0},animate:{opacity:1},transition:{duration:.8},children:s.jsx("div",{className:"max-w-7xl mx-auto",children:s.jsxs("div",{className:"relative z-10 text-center",children:[s.jsxs(_.h1,{className:"text-6xl md:text-7xl font-bold mb-8",initial:{y:50,opacity:0},animate:{y:0,opacity:1},transition:{delay:.2,duration:.8},children:[s.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-purple-600 to-blue-600",children:"Il Futuro dello Shopping"}),s.jsx("br",{}),s.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-purple-600",children:"è Vocale"})]}),s.jsx(_.p,{className:"text-xl md:text-2xl text-gray-700 mb-12 max-w-4xl mx-auto leading-relaxed",initial:{y:30,opacity:0},animate:{y:0,opacity:1},transition:{delay:.4,duration:.8},children:"Scopri AIVA, il tuo personal shopper AI che ti aiuta a trovare l'outfit perfetto con comandi vocali in italiano."}),s.jsx(_.div,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},transition:{delay:.6,duration:.8,type:"spring",stiffness:200},className:"mb-16",children:s.jsxs(_.button,{onClick:e,className:"group relative px-12 py-6 bg-gradient-to-r from-purple-600 to-blue-600 text-white text-2xl font-bold rounded-full shadow-2xl hover:shadow-purple-500/25 transform transition-all duration-300",whileHover:{scale:1.05,boxShadow:"0 20px 40px rgba(147, 51, 234, 0.3)"},whileTap:{scale:.95},children:[s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsxs(_.div,{className:"relative",animate:{rotate:[0,10,-10,0]},transition:{duration:2,repeat:1/0},children:[s.jsx(_t,{size:32}),s.jsx(_.div,{className:"absolute -inset-2 bg-white/20 rounded-full",animate:{scale:[1,1.2,1]},transition:{duration:1.5,repeat:1/0}})]}),s.jsx("span",{children:"Inizia Shopping Vocale"}),s.jsx(Jt,{size:24,className:"text-yellow-300"})]}),s.jsx(_.div,{className:"absolute inset-0 rounded-full bg-white/20",initial:{scale:0,opacity:1},animate:{scale:2,opacity:0},transition:{duration:1,repeat:1/0,delay:.5}})]})}),s.jsxs("div",{className:"absolute inset-0 pointer-events-none hidden md:block z-0",children:[s.jsx(_.div,{className:"absolute top-16 left-8 text-pink-400",animate:{y:[0,-15,0],rotate:[0,10,0]},transition:{duration:3,repeat:1/0},children:s.jsx(Ao,{size:64})}),s.jsx(_.div,{className:"absolute top-24 right-12 text-purple-400",animate:{y:[0,20,0],rotate:[0,-8,0]},transition:{duration:4,repeat:1/0,delay:.5},children:s.jsx(_r,{size:56})}),s.jsx(_.div,{className:"absolute top-32 left-1/4 text-blue-400",animate:{y:[0,-10,0],rotate:[0,5,0]},transition:{duration:2.5,repeat:1/0,delay:1},children:s.jsx(Ar,{size:70})}),s.jsx(_.div,{className:"absolute top-48 right-8 text-green-400",animate:{y:[0,15,0],rotate:[0,-12,0]},transition:{duration:3.5,repeat:1/0,delay:.3},children:s.jsx(ht,{size:60})}),s.jsx(_.div,{className:"absolute top-56 left-12 text-yellow-400",animate:{y:[0,-20,0],rotate:[0,8,0]},transition:{duration:2.8,repeat:1/0,delay:.8},children:s.jsx(ko,{size:60})}),s.jsx(_.div,{className:"absolute top-64 right-1/3 text-red-400",animate:{y:[0,12,0],rotate:[0,-6,0]},transition:{duration:3.2,repeat:1/0,delay:1.2},children:"              "}),s.jsx(_.div,{className:"absolute bottom-48 left-16 text-indigo-400",animate:{y:[0,-18,0],rotate:[0,7,0]},transition:{duration:2.7,repeat:1/0,delay:.6},children:s.jsx(kr,{size:50})}),s.jsx(_.div,{className:"absolute bottom-40 right-16 text-orange-400",animate:{y:[0,14,0],rotate:[0,-9,0]},transition:{duration:3.8,repeat:1/0,delay:1.1},children:s.jsx(Po,{size:50})}),s.jsx(_.div,{className:"absolute bottom-32 left-1/3 text-cyan-400",animate:{y:[0,-16,0],rotate:[0,11,0]},transition:{duration:2.9,repeat:1/0,delay:.4}}),s.jsx(_.div,{className:"absolute bottom-24 right-1/4 text-rose-400",animate:{y:[0,22,0],rotate:[0,-7,0]},transition:{duration:3.3,repeat:1/0,delay:.9},children:s.jsx(Io,{size:75})})]})]})})}),s.jsx(_.section,{className:"py-20 px-4 bg-white/50 backdrop-blur-sm",initial:{opacity:0,y:50},animate:{opacity:1,y:0},transition:{delay:.8,duration:.8},children:s.jsxs("div",{className:"max-w-6xl mx-auto",children:[s.jsxs("div",{className:"text-center mb-16",children:[s.jsx("h2",{className:"text-4xl font-bold text-gray-800 mb-4",children:"Perché Scegliere AIVA"}),s.jsx("p",{className:"text-xl text-gray-600",children:"Un'esperienza di shopping rivoluzionaria"})]}),s.jsxs("div",{className:"grid md:grid-cols-3 gap-12",children:[s.jsxs(_.div,{className:"text-center p-8 bg-white/70 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300",whileHover:{y:-5},children:[s.jsx("div",{className:"w-20 h-20 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full flex items-center justify-center mx-auto mb-6",children:s.jsx(_t,{size:40,className:"text-white"})}),s.jsx("h3",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Comandi Vocali"}),s.jsx("p",{className:"text-gray-600 text-lg",children:"Cerca, filtra, apri le pagine e aggiungi al carrello con la voce"})]}),s.jsxs(_.div,{className:"text-center p-8 bg-white/70 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300",whileHover:{y:-5},children:[s.jsx("div",{className:"w-20 h-20 bg-gradient-to-r from-blue-500 to-cyan-500 rounded-full flex items-center justify-center mx-auto mb-6",children:s.jsx(Jt,{size:40,className:"text-white"})}),s.jsx("h3",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Risposte in Tempo Reale"}),s.jsx("p",{className:"text-gray-600 text-lg",children:"AIVA parla mentre elabora: risposte fluide e naturali, anche interruttibili"})]}),s.jsxs(_.div,{className:"text-center p-8 bg-white/70 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300",whileHover:{y:-5},children:[s.jsx("div",{className:"w-20 h-20 bg-gradient-to-r from-emerald-500 to-teal-500 rounded-full flex items-center justify-center mx-auto mb-6",children:s.jsx(Ns,{size:40,className:"text-white"})}),s.jsx("h3",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Navigazione Istantanea"}),s.jsx("p",{className:"text-gray-600 text-lg",children:"Vai a Prodotti, Offerte o Carrello senza toccare lo schermo: basta dirlo"})]})]})]})}),s.jsx(_.section,{className:"py-20 px-4 bg-gradient-to-r from-purple-600 to-blue-600",initial:{opacity:0,y:50},animate:{opacity:1,y:0},transition:{delay:1,duration:.8},children:s.jsx("div",{className:"max-w-4xl mx-auto text-center text-white",children:s.jsxs(_.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},transition:{delay:1.2,duration:.8},children:[s.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-6",children:"Prova l'Esperienza Shopping del Futuro"}),s.jsx("p",{className:"text-xl md:text-2xl mb-8 opacity-90",children:'Clicca sul microfono e dì "Cerco una felpa nera" per iniziare'}),s.jsx(_.button,{onClick:e,className:"px-10 py-5 bg-white text-purple-600 font-bold text-xl rounded-full shadow-2xl hover:shadow-white/25 transform transition-all duration-300",whileHover:{scale:1.05,boxShadow:"0 20px 40px rgba(255, 255, 255, 0.3)"},whileTap:{scale:.95},children:s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(_t,{size:28}),s.jsx("span",{children:"Attiva Assistente Vocale"})]})})]})})})]}),Yn="aiva_session_id",Yr="__AIVA_SESSION_ID__",un="X-Session-Id",ei=()=>`sess-${Date.now()}-${Math.random().toString(36).slice(2,10)}`;function Rt(){var t,r;if(typeof window>"u")return null;if(window[Yr])return window[Yr];let e=null;try{e=((t=window.localStorage)==null?void 0:t.getItem(Yn))||null}catch{e=null}if(!e){e=ei();try{(r=window.localStorage)==null||r.setItem(Yn,e)}catch{}}return window[Yr]=e,e}function Ke(e={}){const t=Rt();if(!t)return{...e};const r={...e.headers||{}};return r[un]||(r[un]=t),{...e,headers:r}}const ti=()=>"http://localhost:8000/api".replace(/\/+$/,""),Ce=ti();Ce.replace(/\/api$/,"");const ri=(e="")=>{if(!e)return Ce;if(e.startsWith("http"))return e;const t=Ce.endsWith("/")?Ce.slice(0,-1):Ce,r=e.startsWith("/")?e.slice(1):e;return`${t}/${r}`},Zr=async(e,t={})=>{const r=ri(e),n=Ke({credentials:t.credentials??"include",...t}),o=await fetch(r,n);if(!o.ok)throw new Error(`${t.method||"GET"} ${r} ${o.status}`);return o.json()},At={async getProducts(e={}){const t=new URLSearchParams(e),r=await fetch(`${Ce}/products?${t.toString()}`,Ke({credentials:"include"}));if(!r.ok)throw new Error(`GET /products ${r.status}`);return r.json()},async getSizeGuide(e){const t=await fetch(`${Ce}/size-guide/${encodeURIComponent(e)}`,Ke());if(!t.ok)throw new Error(`GET /size-guide ${t.status}`);return t.json()},async getProduct(e){const t=await fetch(`${Ce}/products/${e}`,Ke({credentials:"include"}));if(!t.ok)throw new Error(`GET /products/${e} ${t.status}`);return t.json()},async checkAvailability(e,t,r){const n=new URLSearchParams({size:t,color:r}),o=await fetch(`${Ce}/products/${e}/availability?${n.toString()}`,Ke());if(!o.ok)throw new Error(`GET /availability ${o.status}`);return o.json()},async getRecommendations(e={}){const t=new URLSearchParams(e),r=await fetch(`${Ce}/recommendations?${t.toString()}`,Ke());if(!r.ok)throw new Error(`GET /recommendations ${r.status}`);return r.json()},async searchProducts(e,t={}){const r=new URLSearchParams({q:e,...t}),n=await fetch(`${Ce}/products?${r.toString()}`,Ke());if(!n.ok)throw new Error(`GET /products ${n.status}`);return n.json()}},Ht={async processVoiceCommand(e,t={},r){var a;const n={text:e,context:t||{}},o=r||((a=n.context)==null?void 0:a.session_id)||Rt();o&&(n.session_id=o,n.context={...n.context,session_id:o});const i=await fetch(`${Ce}/voice/command`,Ke({method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(n)}));if(!i.ok)throw new Error(`POST /voice/command ${i.status}`);return i.json()},async transcribeAudio({audio:e,sampleRate:t=16e3,language:r="it-IT",sessionId:n}={}){const o=n||Rt(),i={audio:e,sample_rate:t,language:r,session_id:o},a=await fetch(`${Ce}/speech-to-text`,Ke({method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(i)}));if(!a.ok)throw new Error(`POST /speech-to-text ${a.status}`);return a.json()},async synthesizeSpeech({text:e,voice:t,sessionId:r}={}){const n=r||Rt(),o={text:e,voice:t,session_id:n},i=await fetch(`${Ce}/tts`,Ke({method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(o)}));if(!i.ok)throw new Error(`POST /tts ${i.status}`);return i.json()}},ni={getSizeGuide:async e=>Zr(`/size-guide/${encodeURIComponent(e)}`,{credentials:"omit"}),getShippingInfo:async()=>Zr("/shipping-info",{credentials:"omit"}),getPromotions:async()=>Zr("/promotions",{credentials:"omit"})};function si(e){throw new Error("WebSocket disabilitato in ambiente Vercel")}const ks="/ldr-icons";function oi(){return typeof window>"u"?!1:window.location.pathname.startsWith(ks)}function ii(e){const t=e.startsWith("/")?e:`/${e}`;return typeof window<"u"&&oi()?`${ks}${t}`:t}function ai(e){return ii(e)}function dn(e){if(!e)return e;const t=String(e);return t.startsWith("http://")||t.startsWith("https://")||t.startsWith("data:")?t:ai(t)}const ci={},Zn=e=>{let t;const r=new Set,n=(l,m)=>{const w=typeof l=="function"?l(t):l;if(!Object.is(w,t)){const S=t;t=m??(typeof w!="object"||w===null)?w:Object.assign({},t,w),r.forEach(y=>y(t,S))}},o=()=>t,u={setState:n,getState:o,getInitialState:()=>f,subscribe:l=>(r.add(l),()=>r.delete(l)),destroy:()=>{(ci?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),r.clear()}},f=t=e(n,o,u);return u},li=e=>e?Zn(e):Zn;var en={exports:{}},tn={},rn={exports:{}},nn={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var es;function ui(){if(es)return nn;es=1;var e=xn();function t(m,w){return m===w&&(m!==0||1/m===1/w)||m!==m&&w!==w}var r=typeof Object.is=="function"?Object.is:t,n=e.useState,o=e.useEffect,i=e.useLayoutEffect,a=e.useDebugValue;function c(m,w){var S=w(),y=n({inst:{value:S,getSnapshot:w}}),x=y[0].inst,b=y[1];return i(function(){x.value=S,x.getSnapshot=w,u(x)&&b({inst:x})},[m,S,w]),o(function(){return u(x)&&b({inst:x}),m(function(){u(x)&&b({inst:x})})},[m]),a(S),S}function u(m){var w=m.getSnapshot;m=m.value;try{var S=w();return!r(m,S)}catch{return!0}}function f(m,w){return w()}var l=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?f:c;return nn.useSyncExternalStore=e.useSyncExternalStore!==void 0?e.useSyncExternalStore:l,nn}var ts;function di(){return ts||(ts=1,rn.exports=ui()),rn.exports}/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var rs;function fi(){if(rs)return tn;rs=1;var e=xn(),t=di();function r(f,l){return f===l&&(f!==0||1/f===1/l)||f!==f&&l!==l}var n=typeof Object.is=="function"?Object.is:r,o=t.useSyncExternalStore,i=e.useRef,a=e.useEffect,c=e.useMemo,u=e.useDebugValue;return tn.useSyncExternalStoreWithSelector=function(f,l,m,w,S){var y=i(null);if(y.current===null){var x={hasValue:!1,value:null};y.current=x}else x=y.current;y=c(function(){function N(F){if(!E){if(E=!0,O=F,F=w(F),S!==void 0&&x.hasValue){var P=x.value;if(S(P,F))return B=P}return B=F}if(P=B,n(O,F))return P;var z=w(F);return S!==void 0&&S(P,z)?(O=F,P):(O=F,B=z)}var E=!1,O,B,re=m===void 0?null:m;return[function(){return N(l())},re===null?void 0:function(){return N(re())}]},[l,m,w,S]);var b=o(f,y[0],y[1]);return a(function(){x.hasValue=!0,x.value=b},[b]),u(b),b},tn}var ns;function pi(){return ns||(ns=1,en.exports=fi()),en.exports}var mi=pi();const hi=bn(mi),Ps={},{useDebugValue:gi}=js,{useSyncExternalStoreWithSelector:yi}=hi;let ss=!1;const xi=e=>e;function bi(e,t=xi,r){(Ps?"production":void 0)!=="production"&&r&&!ss&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),ss=!0);const n=yi(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,r);return gi(n),n}const os=e=>{(Ps?"production":void 0)!=="production"&&typeof e!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const t=typeof e=="function"?li(e):e,r=(n,o)=>bi(t,n,o);return Object.assign(r,t),r},wi=e=>e?os(e):os,jr={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_API_BASE_URL:"http://localhost:8000/api",VITE_ASSETS_BASE_URL:"http://localhost:8000/static/images",VITE_BACKEND_URL:"http://localhost:8000",VITE_DEBUG_MODE:"false",VITE_DEFAULT_LANGUAGE:"it-IT",VITE_ENABLE_ANALYTICS:"false",VITE_ENABLE_VOICE:"true",VITE_ENABLE_WEBSOCKET:"true",VITE_PRIMARY_COLOR:"",VITE_PUBLIC_URL:"http://localhost:5173",VITE_SECONDARY_COLOR:"",VITE_SUPPORTED_LANGUAGES:"it-IT,en-US",VITE_THEME:"light",VITE_TTS_LANGUAGE:"it-IT",VITE_TTS_PITCH:"1.0",VITE_TTS_RATE:"1.0",VITE_VERCEL_MODE:"true",VITE_VOICE_RECOGNITION_LANGUAGE:"it-IT",VITE_WS_URL:"ws://localhost:8000"},fn=new Map,wr=e=>{const t=fn.get(e);return t?Object.fromEntries(Object.entries(t.stores).map(([r,n])=>[r,n.getState()])):{}},vi=(e,t,r)=>{if(e===void 0)return{type:"untracked",connection:t.connect(r)};const n=fn.get(r.name);if(n)return{type:"tracked",store:e,...n};const o={connection:t.connect(r),stores:{}};return fn.set(r.name,o),{type:"tracked",store:e,...o}},Si=(e,t={})=>(r,n,o)=>{const{enabled:i,anonymousActionType:a,store:c,...u}=t;let f;try{f=(i??(jr?"production":void 0)!=="production")&&window.__REDUX_DEVTOOLS_EXTENSION__}catch{}if(!f)return(jr?"production":void 0)!=="production"&&i&&console.warn("[zustand devtools middleware] Please install/enable Redux devtools extension"),e(r,n,o);const{connection:l,...m}=vi(c,f,u);let w=!0;o.setState=(x,b,N)=>{const E=r(x,b);if(!w)return E;const O=N===void 0?{type:a||"anonymous"}:typeof N=="string"?{type:N}:N;return c===void 0?(l==null||l.send(O,n()),E):(l==null||l.send({...O,type:`${c}/${O.type}`},{...wr(u.name),[c]:o.getState()}),E)};const S=(...x)=>{const b=w;w=!1,r(...x),w=b},y=e(o.setState,n,o);if(m.type==="untracked"?l==null||l.init(y):(m.stores[m.store]=o,l==null||l.init(Object.fromEntries(Object.entries(m.stores).map(([x,b])=>[x,x===m.store?y:b.getState()])))),o.dispatchFromDevtools&&typeof o.dispatch=="function"){let x=!1;const b=o.dispatch;o.dispatch=(...N)=>{(jr?"production":void 0)!=="production"&&N[0].type==="__setState"&&!x&&(console.warn('[zustand devtools middleware] "__setState" action type is reserved to set state from the devtools. Avoid using it.'),x=!0),b(...N)}}return l.subscribe(x=>{var b;switch(x.type){case"ACTION":if(typeof x.payload!="string"){console.error("[zustand devtools middleware] Unsupported action format");return}return sn(x.payload,N=>{if(N.type==="__setState"){if(c===void 0){S(N.state);return}Object.keys(N.state).length!==1&&console.error(`
                    [zustand devtools middleware] Unsupported __setState action format. 
                    When using 'store' option in devtools(), the 'state' should have only one key, which is a value of 'store' that was passed in devtools(),
                    and value of this only key should be a state object. Example: { "type": "__setState", "state": { "abc123Store": { "foo": "bar" } } }
                    `);const E=N.state[c];if(E==null)return;JSON.stringify(o.getState())!==JSON.stringify(E)&&S(E);return}o.dispatchFromDevtools&&typeof o.dispatch=="function"&&o.dispatch(N)});case"DISPATCH":switch(x.payload.type){case"RESET":return S(y),c===void 0?l==null?void 0:l.init(o.getState()):l==null?void 0:l.init(wr(u.name));case"COMMIT":if(c===void 0){l==null||l.init(o.getState());return}return l==null?void 0:l.init(wr(u.name));case"ROLLBACK":return sn(x.state,N=>{if(c===void 0){S(N),l==null||l.init(o.getState());return}S(N[c]),l==null||l.init(wr(u.name))});case"JUMP_TO_STATE":case"JUMP_TO_ACTION":return sn(x.state,N=>{if(c===void 0){S(N);return}JSON.stringify(o.getState())!==JSON.stringify(N[c])&&S(N[c])});case"IMPORT_STATE":{const{nextLiftedState:N}=x.payload,E=(b=N.computedStates.slice(-1)[0])==null?void 0:b.state;if(!E)return;S(c===void 0?E:E[c]),l==null||l.send(null,N);return}case"PAUSE_RECORDING":return w=!w}return}}),y},ji=Si,sn=(e,t)=>{let r;try{r=JSON.parse(e)}catch(n){console.error("[zustand devtools middleware] Could not parse the received json",n)}r!==void 0&&t(r)};function Ni(e,t){let r;try{r=e()}catch{return}return{getItem:o=>{var i;const a=u=>u===null?null:JSON.parse(u,void 0),c=(i=r.getItem(o))!=null?i:null;return c instanceof Promise?c.then(a):a(c)},setItem:(o,i)=>r.setItem(o,JSON.stringify(i,void 0)),removeItem:o=>r.removeItem(o)}}const Qt=e=>t=>{try{const r=e(t);return r instanceof Promise?r:{then(n){return Qt(n)(r)},catch(n){return this}}}catch(r){return{then(n){return this},catch(n){return Qt(n)(r)}}}},Ci=(e,t)=>(r,n,o)=>{let i={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:b=>b,version:0,merge:(b,N)=>({...N,...b}),...t},a=!1;const c=new Set,u=new Set;let f;try{f=i.getStorage()}catch{}if(!f)return e((...b)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),r(...b)},n,o);const l=Qt(i.serialize),m=()=>{const b=i.partialize({...n()});let N;const E=l({state:b,version:i.version}).then(O=>f.setItem(i.name,O)).catch(O=>{N=O});if(N)throw N;return E},w=o.setState;o.setState=(b,N)=>{w(b,N),m()};const S=e((...b)=>{r(...b),m()},n,o);let y;const x=()=>{var b;if(!f)return;a=!1,c.forEach(E=>E(n()));const N=((b=i.onRehydrateStorage)==null?void 0:b.call(i,n()))||void 0;return Qt(f.getItem.bind(f))(i.name).then(E=>{if(E)return i.deserialize(E)}).then(E=>{if(E)if(typeof E.version=="number"&&E.version!==i.version){if(i.migrate)return i.migrate(E.state,E.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return E.state}).then(E=>{var O;return y=i.merge(E,(O=n())!=null?O:S),r(y,!0),m()}).then(()=>{N==null||N(y,void 0),a=!0,u.forEach(E=>E(y))}).catch(E=>{N==null||N(void 0,E)})};return o.persist={setOptions:b=>{i={...i,...b},b.getStorage&&(f=b.getStorage())},clearStorage:()=>{f==null||f.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>x(),hasHydrated:()=>a,onHydrate:b=>(c.add(b),()=>{c.delete(b)}),onFinishHydration:b=>(u.add(b),()=>{u.delete(b)})},x(),y||S},Ei=(e,t)=>(r,n,o)=>{let i={storage:Ni(()=>localStorage),partialize:x=>x,version:0,merge:(x,b)=>({...b,...x}),...t},a=!1;const c=new Set,u=new Set;let f=i.storage;if(!f)return e((...x)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),r(...x)},n,o);const l=()=>{const x=i.partialize({...n()});return f.setItem(i.name,{state:x,version:i.version})},m=o.setState;o.setState=(x,b)=>{m(x,b),l()};const w=e((...x)=>{r(...x),l()},n,o);o.getInitialState=()=>w;let S;const y=()=>{var x,b;if(!f)return;a=!1,c.forEach(E=>{var O;return E((O=n())!=null?O:w)});const N=((b=i.onRehydrateStorage)==null?void 0:b.call(i,(x=n())!=null?x:w))||void 0;return Qt(f.getItem.bind(f))(i.name).then(E=>{if(E)if(typeof E.version=="number"&&E.version!==i.version){if(i.migrate)return[!0,i.migrate(E.state,E.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,E.state];return[!1,void 0]}).then(E=>{var O;const[B,re]=E;if(S=i.merge(re,(O=n())!=null?O:w),r(S,!0),B)return l()}).then(()=>{N==null||N(S,void 0),S=n(),a=!0,u.forEach(E=>E(S))}).catch(E=>{N==null||N(void 0,E)})};return o.persist={setOptions:x=>{i={...i,...x},x.storage&&(f=x.storage)},clearStorage:()=>{f==null||f.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>y(),hasHydrated:()=>a,onHydrate:x=>(c.add(x),()=>{c.delete(x)}),onFinishHydration:x=>(u.add(x),()=>{u.delete(x)})},i.skipHydration||y(),S||w},Ti=(e,t)=>"getStorage"in t||"serialize"in t||"deserialize"in t?((jr?"production":void 0)!=="production"&&console.warn("[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead."),Ci(e,t)):Ei(e,t),_i=Ti,Ri=e=>(e||"").toString().normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").toLowerCase().replace(/[^a-z0-9]+/g," ").trim(),Et=e=>{if(typeof window>"u")return;const t=(e||[]).map(n=>{var o,i,a;return{item_id:n.id,product_id:(o=n.product)==null?void 0:o.id,name:(i=n.product)==null?void 0:i.name,size:n.size,color:n.color,quantity:n.quantity,price:(a=n.product)==null?void 0:a.price}}),r={};for(const n of t){const o=Ri(`${n.name} ${n.size||""} ${n.color||""}`);o&&(r[o]=n.item_id)}window.cartSnapshot=t,window.cartItemsMap=r},Ie=wi(ji(_i((e,t)=>({cart:[],cartTotal:0,cartCount:0,preferences:{size:null,color:null,gender:null,style:null},isVoiceAssistantOpen:!1,isMobileMenuOpen:!1,isCartOpen:!1,currentPage:"home",voiceHistory:[],isListening:!1,products:[],filteredProducts:[],selectedProduct:null,searchQuery:"",activeFilters:{category:null,gender:null,size:null,color:null,minPrice:0,maxPrice:1e3,onSale:!1,brand:null,style:null},addToCart:(r,n,o,i=1)=>{e(a=>{const c=a.cart.find(m=>m.product.id===r.id&&m.size===n&&m.color===o);let u;c?u=a.cart.map(m=>m===c?{...m,quantity:m.quantity+i}:m):u=[...a.cart,{id:`cart-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,product:r,size:n,color:o,quantity:i,addedAt:new Date().toISOString()}];const f=u.reduce((m,w)=>m+w.product.price*w.quantity,0),l=u.reduce((m,w)=>m+w.quantity,0);return Et(u),{cart:u,cartTotal:f,cartCount:l}})},removeFromCart:r=>{e(n=>{const o=n.cart.filter(c=>c.id!==r),i=o.reduce((c,u)=>c+u.product.price*u.quantity,0),a=o.reduce((c,u)=>c+u.quantity,0);return Et(o),{cart:o,cartTotal:i,cartCount:a}})},clearCart:()=>{e({cart:[],cartTotal:0,cartCount:0}),Et([])},updateQuantity:(r,n)=>{if(n<=0){t().removeFromCart(r);return}e(o=>{const i=o.cart.map(u=>u.id===r?{...u,quantity:n}:u),a=i.reduce((u,f)=>u+f.product.price*f.quantity,0),c=i.reduce((u,f)=>u+f.quantity,0);return Et(i),{cart:i,cartTotal:a,cartCount:c}})},setCartFromServer:r=>{e(n=>{const o=Array.isArray(r==null?void 0:r.items)?r.items:[],i=Number((r==null?void 0:r.item_count)??(r==null?void 0:r.count)??(r==null?void 0:r.total_items)??0)||0,a=Number((r==null?void 0:r.grand_total)??(r==null?void 0:r.total)??(r==null?void 0:r.subtotal)??0)||0,c=o.length>0||i>0||a>0||n.cart.length===0,u=c?o:n.cart,f=c?a||u.reduce((m,w)=>{var S;return m+(((S=w.product)==null?void 0:S.price)||0)*(w.quantity||0)},0):n.cartTotal,l=c?i||u.reduce((m,w)=>m+(w.quantity||0),0):n.cartCount;return Et(u),{cart:u,cartTotal:f,cartCount:l}})},setPreferences:r=>{e(n=>({preferences:{...n.preferences,...r}}))},updatePreference:(r,n)=>{e(o=>({preferences:{...o.preferences,[r]:n}}))},setCurrentPage:r=>e({currentPage:r}),toggleVoiceAssistant:()=>{e(r=>({isVoiceAssistantOpen:!r.isVoiceAssistantOpen}))},addVoiceHistory:r=>{e(n=>({voiceHistory:[...n.voiceHistory,{...r,timestamp:new Date().toISOString(),id:`voice-${Date.now()}`}].slice(-50)}))},clearVoiceHistory:()=>e({voiceHistory:[]}),setProducts:r=>{e({products:r,filteredProducts:r})},setSearchQuery:r=>{e(n=>{const o=r.toLowerCase();if(!r)return{searchQuery:"",filteredProducts:n.products};const i={maglia:["maglia","maglietta","t-shirt","polo"],felpa:["felpa","hoodie","felpa con cappuccio"],pantaloni:["pantaloni","jeans","denim","chino"],scarpe:["scarpe","sneakers","stivali","sandali"],giacca:["giacca","giubbotto","bomber","cappotto"]};let a=[o];for(const[u,f]of Object.entries(i))f.some(l=>o.includes(l))&&(a=[...a,...f]);const c=n.products.filter(u=>{const f=[u.name,u.description,u.brand,u.category,u.subcategory,...u.tags||[]].join(" ").toLowerCase();return a.some(l=>f.includes(l))});return{searchQuery:r,filteredProducts:c}})},setFilter:(r,n)=>{e(o=>{const i={...o.activeFilters,[r]:n},a=t().applyFilters(o.products,i,o.searchQuery);return{activeFilters:i,filteredProducts:a}})},setMultipleFilters:r=>{e(n=>{const o={...n.activeFilters,...r},i=t().applyFilters(n.products,o,n.searchQuery);return{activeFilters:o,filteredProducts:i}})},clearFilters:()=>{e(r=>({activeFilters:{category:null,gender:null,size:null,color:null,minPrice:0,maxPrice:1e3,onSale:!1,brand:null,style:null},filteredProducts:r.products,searchQuery:""}))},applyFilters:(r,n,o="")=>{let i=[...r];if(o){const a=o.toLowerCase();i=i.filter(c=>[c.name,c.description,c.brand,c.category,c.subcategory,...c.tags||[]].join(" ").toLowerCase().includes(a))}return n.category&&(i=i.filter(a=>a.category===n.category||a.subcategory===n.category)),n.gender&&(i=i.filter(a=>a.gender===n.gender||a.gender==="unisex")),n.size&&(i=i.filter(a=>a.variants&&a.variants.some(c=>c.size===n.size&&c.available))),n.color&&(i=i.filter(a=>a.variants&&a.variants.some(c=>c.color.toLowerCase().includes(n.color.toLowerCase())))),n.minPrice>0&&(i=i.filter(a=>a.price>=n.minPrice)),n.maxPrice<1e3&&(i=i.filter(a=>a.price<=n.maxPrice)),n.onSale&&(i=i.filter(a=>a.on_sale||a.discount_percentage>0)),n.brand&&(i=i.filter(a=>a.brand.toLowerCase().includes(n.brand.toLowerCase()))),n.style&&(i=i.filter(a=>a.style&&a.style.toLowerCase().includes(n.style.toLowerCase()))),i},filterProducts:r=>{e(n=>{const o={...n.activeFilters,...r},i=t().applyFilters(n.products,o,n.searchQuery);return{activeFilters:o,filteredProducts:i}})},searchProducts:(r,n={})=>{e(o=>{const i={...o.activeFilters,...n},a=t().applyFilters(o.products,i,r);return{searchQuery:r,activeFilters:i,filteredProducts:a}})},setSelectedProduct:r=>e({selectedProduct:r}),getProductById:r=>t().products.find(o=>o.id===r),isProductInCart:(r,n=null,o=null)=>t().cart.some(a=>{const c=a.product.id===r,u=!n||a.size===n,f=!o||a.color===o;return c&&u&&f}),getCartItemCount:(r,n=null,o=null)=>{const a=t().cart.find(c=>{const u=c.product.id===r,f=!n||c.size===n,l=!o||c.color===o;return u&&f&&l});return a?a.quantity:0},processVoiceCommand:(r,n)=>{switch(t(),r){case"search_products":n.query&&t().searchProducts(n.query,n.filters||{});break;case"add_to_cart":if(n.product_id){const o=t().getProductById(n.product_id);o&&t().addToCart(o,n.size||"M",n.color||"nero",n.quantity||1)}break;case"clear_cart":t().clearCart();break;case"set_preferences":n.preferences&&t().setPreferences(n.preferences);break;default:console.log("Unknown voice command:",r)}t().addVoiceHistory({command:r,parameters:n,result:"processed"})},getShoppingInsights:()=>{const r=t(),n=r.cartTotal,o=r.cartCount,i=r.voiceHistory.filter(c=>c.command==="search_products").map(c=>{var u;return(u=c.parameters)==null?void 0:u.query}).filter(Boolean),a=r.preferences.size||(r.cart.length>0?r.cart[0].size:null);return{totalSpent:n,itemsInCart:o,favoriteCategories:i,preferredSize:a,searchHistory:r.voiceHistory.slice(-10),lastUpdated:new Date().toISOString()}}}),{name:"aiva-storage",partialize:e=>({cart:e.cart,cartTotal:e.cartTotal,cartCount:e.cartCount,preferences:e.preferences,voiceHistory:e.voiceHistory.slice(-20)}),onRehydrateStorage:()=>(e,t)=>{if(!t)try{Et((e==null?void 0:e.cart)||[])}catch(r){console.warn("Failed to publish cart snapshot after rehydrate:",r)}}}),{name:"aiva-store"}));function Is(e,t){return function(){return e.apply(t,arguments)}}const{toString:Ai}=Object.prototype,{getPrototypeOf:wn}=Object,{iterator:Pr,toStringTag:Os}=Symbol,Ir=(e=>t=>{const r=Ai.call(t);return e[r]||(e[r]=r.slice(8,-1).toLowerCase())})(Object.create(null)),qe=e=>(e=e.toLowerCase(),t=>Ir(t)===e),Or=e=>t=>typeof t===e,{isArray:It}=Array,Pt=Or("undefined");function Yt(e){return e!==null&&!Pt(e)&&e.constructor!==null&&!Pt(e.constructor)&&Ee(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const zs=qe("ArrayBuffer");function ki(e){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(e):t=e&&e.buffer&&zs(e.buffer),t}const Pi=Or("string"),Ee=Or("function"),Fs=Or("number"),Zt=e=>e!==null&&typeof e=="object",Ii=e=>e===!0||e===!1,Nr=e=>{if(Ir(e)!=="object")return!1;const t=wn(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Os in e)&&!(Pr in e)},Oi=e=>{if(!Zt(e)||Yt(e))return!1;try{return Object.keys(e).length===0&&Object.getPrototypeOf(e)===Object.prototype}catch{return!1}},zi=qe("Date"),Fi=qe("File"),Li=qe("Blob"),$i=qe("FileList"),qi=e=>Zt(e)&&Ee(e.pipe),Di=e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||Ee(e.append)&&((t=Ir(e))==="formdata"||t==="object"&&Ee(e.toString)&&e.toString()==="[object FormData]"))},Mi=qe("URLSearchParams"),[Ui,Bi,Vi,Hi]=["ReadableStream","Request","Response","Headers"].map(qe),Gi=e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function er(e,t,{allOwnKeys:r=!1}={}){if(e===null||typeof e>"u")return;let n,o;if(typeof e!="object"&&(e=[e]),It(e))for(n=0,o=e.length;n<o;n++)t.call(null,e[n],n,e);else{if(Yt(e))return;const i=r?Object.getOwnPropertyNames(e):Object.keys(e),a=i.length;let c;for(n=0;n<a;n++)c=i[n],t.call(null,e[c],c,e)}}function Ls(e,t){if(Yt(e))return null;t=t.toLowerCase();const r=Object.keys(e);let n=r.length,o;for(;n-- >0;)if(o=r[n],t===o.toLowerCase())return o;return null}const ft=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:globalThis,$s=e=>!Pt(e)&&e!==ft;function pn(){const{caseless:e,skipUndefined:t}=$s(this)&&this||{},r={},n=(o,i)=>{const a=e&&Ls(r,i)||i;Nr(r[a])&&Nr(o)?r[a]=pn(r[a],o):Nr(o)?r[a]=pn({},o):It(o)?r[a]=o.slice():(!t||!Pt(o))&&(r[a]=o)};for(let o=0,i=arguments.length;o<i;o++)arguments[o]&&er(arguments[o],n);return r}const Wi=(e,t,r,{allOwnKeys:n}={})=>(er(t,(o,i)=>{r&&Ee(o)?e[i]=Is(o,r):e[i]=o},{allOwnKeys:n}),e),Ji=e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),Qi=(e,t,r,n)=>{e.prototype=Object.create(t.prototype,n),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),r&&Object.assign(e.prototype,r)},Ki=(e,t,r,n)=>{let o,i,a;const c={};if(t=t||{},e==null)return t;do{for(o=Object.getOwnPropertyNames(e),i=o.length;i-- >0;)a=o[i],(!n||n(a,e,t))&&!c[a]&&(t[a]=e[a],c[a]=!0);e=r!==!1&&wn(e)}while(e&&(!r||r(e,t))&&e!==Object.prototype);return t},Xi=(e,t,r)=>{e=String(e),(r===void 0||r>e.length)&&(r=e.length),r-=t.length;const n=e.indexOf(t,r);return n!==-1&&n===r},Yi=e=>{if(!e)return null;if(It(e))return e;let t=e.length;if(!Fs(t))return null;const r=new Array(t);for(;t-- >0;)r[t]=e[t];return r},Zi=(e=>t=>e&&t instanceof e)(typeof Uint8Array<"u"&&wn(Uint8Array)),ea=(e,t)=>{const n=(e&&e[Pr]).call(e);let o;for(;(o=n.next())&&!o.done;){const i=o.value;t.call(e,i[0],i[1])}},ta=(e,t)=>{let r;const n=[];for(;(r=e.exec(t))!==null;)n.push(r);return n},ra=qe("HTMLFormElement"),na=e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,n,o){return n.toUpperCase()+o}),is=(({hasOwnProperty:e})=>(t,r)=>e.call(t,r))(Object.prototype),sa=qe("RegExp"),qs=(e,t)=>{const r=Object.getOwnPropertyDescriptors(e),n={};er(r,(o,i)=>{let a;(a=t(o,i,e))!==!1&&(n[i]=a||o)}),Object.defineProperties(e,n)},oa=e=>{qs(e,(t,r)=>{if(Ee(e)&&["arguments","caller","callee"].indexOf(r)!==-1)return!1;const n=e[r];if(Ee(n)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")})}})},ia=(e,t)=>{const r={},n=o=>{o.forEach(i=>{r[i]=!0})};return It(e)?n(e):n(String(e).split(t)),r},aa=()=>{},ca=(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t;function la(e){return!!(e&&Ee(e.append)&&e[Os]==="FormData"&&e[Pr])}const ua=e=>{const t=new Array(10),r=(n,o)=>{if(Zt(n)){if(t.indexOf(n)>=0)return;if(Yt(n))return n;if(!("toJSON"in n)){t[o]=n;const i=It(n)?[]:{};return er(n,(a,c)=>{const u=r(a,o+1);!Pt(u)&&(i[c]=u)}),t[o]=void 0,i}}return n};return r(e,0)},da=qe("AsyncFunction"),fa=e=>e&&(Zt(e)||Ee(e))&&Ee(e.then)&&Ee(e.catch),Ds=((e,t)=>e?setImmediate:t?((r,n)=>(ft.addEventListener("message",({source:o,data:i})=>{o===ft&&i===r&&n.length&&n.shift()()},!1),o=>{n.push(o),ft.postMessage(r,"*")}))(`axios@${Math.random()}`,[]):r=>setTimeout(r))(typeof setImmediate=="function",Ee(ft.postMessage)),pa=typeof queueMicrotask<"u"?queueMicrotask.bind(ft):typeof process<"u"&&process.nextTick||Ds,ma=e=>e!=null&&Ee(e[Pr]),g={isArray:It,isArrayBuffer:zs,isBuffer:Yt,isFormData:Di,isArrayBufferView:ki,isString:Pi,isNumber:Fs,isBoolean:Ii,isObject:Zt,isPlainObject:Nr,isEmptyObject:Oi,isReadableStream:Ui,isRequest:Bi,isResponse:Vi,isHeaders:Hi,isUndefined:Pt,isDate:zi,isFile:Fi,isBlob:Li,isRegExp:sa,isFunction:Ee,isStream:qi,isURLSearchParams:Mi,isTypedArray:Zi,isFileList:$i,forEach:er,merge:pn,extend:Wi,trim:Gi,stripBOM:Ji,inherits:Qi,toFlatObject:Ki,kindOf:Ir,kindOfTest:qe,endsWith:Xi,toArray:Yi,forEachEntry:ea,matchAll:ta,isHTMLForm:ra,hasOwnProperty:is,hasOwnProp:is,reduceDescriptors:qs,freezeMethods:oa,toObjectSet:ia,toCamelCase:na,noop:aa,toFiniteNumber:ca,findKey:Ls,global:ft,isContextDefined:$s,isSpecCompliantForm:la,toJSONObject:ua,isAsyncFn:da,isThenable:fa,setImmediate:Ds,asap:pa,isIterable:ma};function G(e,t,r,n,o){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),r&&(this.config=r),n&&(this.request=n),o&&(this.response=o,this.status=o.status?o.status:null)}g.inherits(G,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:g.toJSONObject(this.config),code:this.code,status:this.status}}});const Ms=G.prototype,Us={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{Us[e]={value:e}});Object.defineProperties(G,Us);Object.defineProperty(Ms,"isAxiosError",{value:!0});G.from=(e,t,r,n,o,i)=>{const a=Object.create(Ms);g.toFlatObject(e,a,function(l){return l!==Error.prototype},f=>f!=="isAxiosError");const c=e&&e.message?e.message:"Error",u=t==null&&e?e.code:t;return G.call(a,c,u,r,n,o),e&&a.cause==null&&Object.defineProperty(a,"cause",{value:e,configurable:!0}),a.name=e&&e.name||"Error",i&&Object.assign(a,i),a};const ha=null;function mn(e){return g.isPlainObject(e)||g.isArray(e)}function Bs(e){return g.endsWith(e,"[]")?e.slice(0,-2):e}function as(e,t,r){return e?e.concat(t).map(function(o,i){return o=Bs(o),!r&&i?"["+o+"]":o}).join(r?".":""):t}function ga(e){return g.isArray(e)&&!e.some(mn)}const ya=g.toFlatObject(g,{},null,function(t){return/^is[A-Z]/.test(t)});function zr(e,t,r){if(!g.isObject(e))throw new TypeError("target must be an object");t=t||new FormData,r=g.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,function(x,b){return!g.isUndefined(b[x])});const n=r.metaTokens,o=r.visitor||l,i=r.dots,a=r.indexes,u=(r.Blob||typeof Blob<"u"&&Blob)&&g.isSpecCompliantForm(t);if(!g.isFunction(o))throw new TypeError("visitor must be a function");function f(y){if(y===null)return"";if(g.isDate(y))return y.toISOString();if(g.isBoolean(y))return y.toString();if(!u&&g.isBlob(y))throw new G("Blob is not supported. Use a Buffer instead.");return g.isArrayBuffer(y)||g.isTypedArray(y)?u&&typeof Blob=="function"?new Blob([y]):Buffer.from(y):y}function l(y,x,b){let N=y;if(y&&!b&&typeof y=="object"){if(g.endsWith(x,"{}"))x=n?x:x.slice(0,-2),y=JSON.stringify(y);else if(g.isArray(y)&&ga(y)||(g.isFileList(y)||g.endsWith(x,"[]"))&&(N=g.toArray(y)))return x=Bs(x),N.forEach(function(O,B){!(g.isUndefined(O)||O===null)&&t.append(a===!0?as([x],B,i):a===null?x:x+"[]",f(O))}),!1}return mn(y)?!0:(t.append(as(b,x,i),f(y)),!1)}const m=[],w=Object.assign(ya,{defaultVisitor:l,convertValue:f,isVisitable:mn});function S(y,x){if(!g.isUndefined(y)){if(m.indexOf(y)!==-1)throw Error("Circular reference detected in "+x.join("."));m.push(y),g.forEach(y,function(N,E){(!(g.isUndefined(N)||N===null)&&o.call(t,N,g.isString(E)?E.trim():E,x,w))===!0&&S(N,x?x.concat(E):[E])}),m.pop()}}if(!g.isObject(e))throw new TypeError("data must be an object");return S(e),t}function cs(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(n){return t[n]})}function vn(e,t){this._pairs=[],e&&zr(e,this,t)}const Vs=vn.prototype;Vs.append=function(t,r){this._pairs.push([t,r])};Vs.toString=function(t){const r=t?function(n){return t.call(this,n,cs)}:cs;return this._pairs.map(function(o){return r(o[0])+"="+r(o[1])},"").join("&")};function xa(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function Hs(e,t,r){if(!t)return e;const n=r&&r.encode||xa;g.isFunction(r)&&(r={serialize:r});const o=r&&r.serialize;let i;if(o?i=o(t,r):i=g.isURLSearchParams(t)?t.toString():new vn(t,r).toString(n),i){const a=e.indexOf("#");a!==-1&&(e=e.slice(0,a)),e+=(e.indexOf("?")===-1?"?":"&")+i}return e}class ls{constructor(){this.handlers=[]}use(t,r,n){return this.handlers.push({fulfilled:t,rejected:r,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){g.forEach(this.handlers,function(n){n!==null&&t(n)})}}const Gs={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},ba=typeof URLSearchParams<"u"?URLSearchParams:vn,wa=typeof FormData<"u"?FormData:null,va=typeof Blob<"u"?Blob:null,Sa={isBrowser:!0,classes:{URLSearchParams:ba,FormData:wa,Blob:va},protocols:["http","https","file","blob","url","data"]},Sn=typeof window<"u"&&typeof document<"u",hn=typeof navigator=="object"&&navigator||void 0,ja=Sn&&(!hn||["ReactNative","NativeScript","NS"].indexOf(hn.product)<0),Na=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Ca=Sn&&window.location.href||"http://localhost",Ea=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Sn,hasStandardBrowserEnv:ja,hasStandardBrowserWebWorkerEnv:Na,navigator:hn,origin:Ca},Symbol.toStringTag,{value:"Module"})),we={...Ea,...Sa};function Ta(e,t){return zr(e,new we.classes.URLSearchParams,{visitor:function(r,n,o,i){return we.isNode&&g.isBuffer(r)?(this.append(n,r.toString("base64")),!1):i.defaultVisitor.apply(this,arguments)},...t})}function _a(e){return g.matchAll(/\w+|\[(\w*)]/g,e).map(t=>t[0]==="[]"?"":t[1]||t[0])}function Ra(e){const t={},r=Object.keys(e);let n;const o=r.length;let i;for(n=0;n<o;n++)i=r[n],t[i]=e[i];return t}function Ws(e){function t(r,n,o,i){let a=r[i++];if(a==="__proto__")return!0;const c=Number.isFinite(+a),u=i>=r.length;return a=!a&&g.isArray(o)?o.length:a,u?(g.hasOwnProp(o,a)?o[a]=[o[a],n]:o[a]=n,!c):((!o[a]||!g.isObject(o[a]))&&(o[a]=[]),t(r,n,o[a],i)&&g.isArray(o[a])&&(o[a]=Ra(o[a])),!c)}if(g.isFormData(e)&&g.isFunction(e.entries)){const r={};return g.forEachEntry(e,(n,o)=>{t(_a(n),o,r,0)}),r}return null}function Aa(e,t,r){if(g.isString(e))try{return(t||JSON.parse)(e),g.trim(e)}catch(n){if(n.name!=="SyntaxError")throw n}return(r||JSON.stringify)(e)}const tr={transitional:Gs,adapter:["xhr","http","fetch"],transformRequest:[function(t,r){const n=r.getContentType()||"",o=n.indexOf("application/json")>-1,i=g.isObject(t);if(i&&g.isHTMLForm(t)&&(t=new FormData(t)),g.isFormData(t))return o?JSON.stringify(Ws(t)):t;if(g.isArrayBuffer(t)||g.isBuffer(t)||g.isStream(t)||g.isFile(t)||g.isBlob(t)||g.isReadableStream(t))return t;if(g.isArrayBufferView(t))return t.buffer;if(g.isURLSearchParams(t))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let c;if(i){if(n.indexOf("application/x-www-form-urlencoded")>-1)return Ta(t,this.formSerializer).toString();if((c=g.isFileList(t))||n.indexOf("multipart/form-data")>-1){const u=this.env&&this.env.FormData;return zr(c?{"files[]":t}:t,u&&new u,this.formSerializer)}}return i||o?(r.setContentType("application/json",!1),Aa(t)):t}],transformResponse:[function(t){const r=this.transitional||tr.transitional,n=r&&r.forcedJSONParsing,o=this.responseType==="json";if(g.isResponse(t)||g.isReadableStream(t))return t;if(t&&g.isString(t)&&(n&&!this.responseType||o)){const a=!(r&&r.silentJSONParsing)&&o;try{return JSON.parse(t,this.parseReviver)}catch(c){if(a)throw c.name==="SyntaxError"?G.from(c,G.ERR_BAD_RESPONSE,this,null,this.response):c}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:we.classes.FormData,Blob:we.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};g.forEach(["delete","get","head","post","put","patch"],e=>{tr.headers[e]={}});const ka=g.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Pa=e=>{const t={};let r,n,o;return e&&e.split(`
`).forEach(function(a){o=a.indexOf(":"),r=a.substring(0,o).trim().toLowerCase(),n=a.substring(o+1).trim(),!(!r||t[r]&&ka[r])&&(r==="set-cookie"?t[r]?t[r].push(n):t[r]=[n]:t[r]=t[r]?t[r]+", "+n:n)}),t},us=Symbol("internals");function Gt(e){return e&&String(e).trim().toLowerCase()}function Cr(e){return e===!1||e==null?e:g.isArray(e)?e.map(Cr):String(e)}function Ia(e){const t=Object.create(null),r=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=r.exec(e);)t[n[1]]=n[2];return t}const Oa=e=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim());function on(e,t,r,n,o){if(g.isFunction(n))return n.call(this,t,r);if(o&&(t=r),!!g.isString(t)){if(g.isString(n))return t.indexOf(n)!==-1;if(g.isRegExp(n))return n.test(t)}}function za(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,r,n)=>r.toUpperCase()+n)}function Fa(e,t){const r=g.toCamelCase(" "+t);["get","set","has"].forEach(n=>{Object.defineProperty(e,n+r,{value:function(o,i,a){return this[n].call(this,t,o,i,a)},configurable:!0})})}let Te=class{constructor(t){t&&this.set(t)}set(t,r,n){const o=this;function i(c,u,f){const l=Gt(u);if(!l)throw new Error("header name must be a non-empty string");const m=g.findKey(o,l);(!m||o[m]===void 0||f===!0||f===void 0&&o[m]!==!1)&&(o[m||u]=Cr(c))}const a=(c,u)=>g.forEach(c,(f,l)=>i(f,l,u));if(g.isPlainObject(t)||t instanceof this.constructor)a(t,r);else if(g.isString(t)&&(t=t.trim())&&!Oa(t))a(Pa(t),r);else if(g.isObject(t)&&g.isIterable(t)){let c={},u,f;for(const l of t){if(!g.isArray(l))throw TypeError("Object iterator must return a key-value pair");c[f=l[0]]=(u=c[f])?g.isArray(u)?[...u,l[1]]:[u,l[1]]:l[1]}a(c,r)}else t!=null&&i(r,t,n);return this}get(t,r){if(t=Gt(t),t){const n=g.findKey(this,t);if(n){const o=this[n];if(!r)return o;if(r===!0)return Ia(o);if(g.isFunction(r))return r.call(this,o,n);if(g.isRegExp(r))return r.exec(o);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,r){if(t=Gt(t),t){const n=g.findKey(this,t);return!!(n&&this[n]!==void 0&&(!r||on(this,this[n],n,r)))}return!1}delete(t,r){const n=this;let o=!1;function i(a){if(a=Gt(a),a){const c=g.findKey(n,a);c&&(!r||on(n,n[c],c,r))&&(delete n[c],o=!0)}}return g.isArray(t)?t.forEach(i):i(t),o}clear(t){const r=Object.keys(this);let n=r.length,o=!1;for(;n--;){const i=r[n];(!t||on(this,this[i],i,t,!0))&&(delete this[i],o=!0)}return o}normalize(t){const r=this,n={};return g.forEach(this,(o,i)=>{const a=g.findKey(n,i);if(a){r[a]=Cr(o),delete r[i];return}const c=t?za(i):String(i).trim();c!==i&&delete r[i],r[c]=Cr(o),n[c]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const r=Object.create(null);return g.forEach(this,(n,o)=>{n!=null&&n!==!1&&(r[o]=t&&g.isArray(n)?n.join(", "):n)}),r}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,r])=>t+": "+r).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...r){const n=new this(t);return r.forEach(o=>n.set(o)),n}static accessor(t){const n=(this[us]=this[us]={accessors:{}}).accessors,o=this.prototype;function i(a){const c=Gt(a);n[c]||(Fa(o,a),n[c]=!0)}return g.isArray(t)?t.forEach(i):i(t),this}};Te.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);g.reduceDescriptors(Te.prototype,({value:e},t)=>{let r=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(n){this[r]=n}}});g.freezeMethods(Te);function an(e,t){const r=this||tr,n=t||r,o=Te.from(n.headers);let i=n.data;return g.forEach(e,function(c){i=c.call(r,i,o.normalize(),t?t.status:void 0)}),o.normalize(),i}function Js(e){return!!(e&&e.__CANCEL__)}function Ot(e,t,r){G.call(this,e??"canceled",G.ERR_CANCELED,t,r),this.name="CanceledError"}g.inherits(Ot,G,{__CANCEL__:!0});function Qs(e,t,r){const n=r.config.validateStatus;!r.status||!n||n(r.status)?e(r):t(new G("Request failed with status code "+r.status,[G.ERR_BAD_REQUEST,G.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r))}function La(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}function $a(e,t){e=e||10;const r=new Array(e),n=new Array(e);let o=0,i=0,a;return t=t!==void 0?t:1e3,function(u){const f=Date.now(),l=n[i];a||(a=f),r[o]=u,n[o]=f;let m=i,w=0;for(;m!==o;)w+=r[m++],m=m%e;if(o=(o+1)%e,o===i&&(i=(i+1)%e),f-a<t)return;const S=l&&f-l;return S?Math.round(w*1e3/S):void 0}}function qa(e,t){let r=0,n=1e3/t,o,i;const a=(f,l=Date.now())=>{r=l,o=null,i&&(clearTimeout(i),i=null),e(...f)};return[(...f)=>{const l=Date.now(),m=l-r;m>=n?a(f,l):(o=f,i||(i=setTimeout(()=>{i=null,a(o)},n-m)))},()=>o&&a(o)]}const Rr=(e,t,r=3)=>{let n=0;const o=$a(50,250);return qa(i=>{const a=i.loaded,c=i.lengthComputable?i.total:void 0,u=a-n,f=o(u),l=a<=c;n=a;const m={loaded:a,total:c,progress:c?a/c:void 0,bytes:u,rate:f||void 0,estimated:f&&c&&l?(c-a)/f:void 0,event:i,lengthComputable:c!=null,[t?"download":"upload"]:!0};e(m)},r)},ds=(e,t)=>{const r=e!=null;return[n=>t[0]({lengthComputable:r,total:e,loaded:n}),t[1]]},fs=e=>(...t)=>g.asap(()=>e(...t)),Da=we.hasStandardBrowserEnv?((e,t)=>r=>(r=new URL(r,we.origin),e.protocol===r.protocol&&e.host===r.host&&(t||e.port===r.port)))(new URL(we.origin),we.navigator&&/(msie|trident)/i.test(we.navigator.userAgent)):()=>!0,Ma=we.hasStandardBrowserEnv?{write(e,t,r,n,o,i){const a=[e+"="+encodeURIComponent(t)];g.isNumber(r)&&a.push("expires="+new Date(r).toGMTString()),g.isString(n)&&a.push("path="+n),g.isString(o)&&a.push("domain="+o),i===!0&&a.push("secure"),document.cookie=a.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function Ua(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}function Ba(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}function Ks(e,t,r){let n=!Ua(t);return e&&(n||r==!1)?Ba(e,t):t}const ps=e=>e instanceof Te?{...e}:e;function mt(e,t){t=t||{};const r={};function n(f,l,m,w){return g.isPlainObject(f)&&g.isPlainObject(l)?g.merge.call({caseless:w},f,l):g.isPlainObject(l)?g.merge({},l):g.isArray(l)?l.slice():l}function o(f,l,m,w){if(g.isUndefined(l)){if(!g.isUndefined(f))return n(void 0,f,m,w)}else return n(f,l,m,w)}function i(f,l){if(!g.isUndefined(l))return n(void 0,l)}function a(f,l){if(g.isUndefined(l)){if(!g.isUndefined(f))return n(void 0,f)}else return n(void 0,l)}function c(f,l,m){if(m in t)return n(f,l);if(m in e)return n(void 0,f)}const u={url:i,method:i,data:i,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:c,headers:(f,l,m)=>o(ps(f),ps(l),m,!0)};return g.forEach(Object.keys({...e,...t}),function(l){const m=u[l]||o,w=m(e[l],t[l],l);g.isUndefined(w)&&m!==c||(r[l]=w)}),r}const Xs=e=>{const t=mt({},e);let{data:r,withXSRFToken:n,xsrfHeaderName:o,xsrfCookieName:i,headers:a,auth:c}=t;if(t.headers=a=Te.from(a),t.url=Hs(Ks(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),c&&a.set("Authorization","Basic "+btoa((c.username||"")+":"+(c.password?unescape(encodeURIComponent(c.password)):""))),g.isFormData(r)){if(we.hasStandardBrowserEnv||we.hasStandardBrowserWebWorkerEnv)a.setContentType(void 0);else if(g.isFunction(r.getHeaders)){const u=r.getHeaders(),f=["content-type","content-length"];Object.entries(u).forEach(([l,m])=>{f.includes(l.toLowerCase())&&a.set(l,m)})}}if(we.hasStandardBrowserEnv&&(n&&g.isFunction(n)&&(n=n(t)),n||n!==!1&&Da(t.url))){const u=o&&i&&Ma.read(i);u&&a.set(o,u)}return t},Va=typeof XMLHttpRequest<"u",Ha=Va&&function(e){return new Promise(function(r,n){const o=Xs(e);let i=o.data;const a=Te.from(o.headers).normalize();let{responseType:c,onUploadProgress:u,onDownloadProgress:f}=o,l,m,w,S,y;function x(){S&&S(),y&&y(),o.cancelToken&&o.cancelToken.unsubscribe(l),o.signal&&o.signal.removeEventListener("abort",l)}let b=new XMLHttpRequest;b.open(o.method.toUpperCase(),o.url,!0),b.timeout=o.timeout;function N(){if(!b)return;const O=Te.from("getAllResponseHeaders"in b&&b.getAllResponseHeaders()),re={data:!c||c==="text"||c==="json"?b.responseText:b.response,status:b.status,statusText:b.statusText,headers:O,config:e,request:b};Qs(function(P){r(P),x()},function(P){n(P),x()},re),b=null}"onloadend"in b?b.onloadend=N:b.onreadystatechange=function(){!b||b.readyState!==4||b.status===0&&!(b.responseURL&&b.responseURL.indexOf("file:")===0)||setTimeout(N)},b.onabort=function(){b&&(n(new G("Request aborted",G.ECONNABORTED,e,b)),b=null)},b.onerror=function(B){const re=B&&B.message?B.message:"Network Error",F=new G(re,G.ERR_NETWORK,e,b);F.event=B||null,n(F),b=null},b.ontimeout=function(){let B=o.timeout?"timeout of "+o.timeout+"ms exceeded":"timeout exceeded";const re=o.transitional||Gs;o.timeoutErrorMessage&&(B=o.timeoutErrorMessage),n(new G(B,re.clarifyTimeoutError?G.ETIMEDOUT:G.ECONNABORTED,e,b)),b=null},i===void 0&&a.setContentType(null),"setRequestHeader"in b&&g.forEach(a.toJSON(),function(B,re){b.setRequestHeader(re,B)}),g.isUndefined(o.withCredentials)||(b.withCredentials=!!o.withCredentials),c&&c!=="json"&&(b.responseType=o.responseType),f&&([w,y]=Rr(f,!0),b.addEventListener("progress",w)),u&&b.upload&&([m,S]=Rr(u),b.upload.addEventListener("progress",m),b.upload.addEventListener("loadend",S)),(o.cancelToken||o.signal)&&(l=O=>{b&&(n(!O||O.type?new Ot(null,e,b):O),b.abort(),b=null)},o.cancelToken&&o.cancelToken.subscribe(l),o.signal&&(o.signal.aborted?l():o.signal.addEventListener("abort",l)));const E=La(o.url);if(E&&we.protocols.indexOf(E)===-1){n(new G("Unsupported protocol "+E+":",G.ERR_BAD_REQUEST,e));return}b.send(i||null)})},Ga=(e,t)=>{const{length:r}=e=e?e.filter(Boolean):[];if(t||r){let n=new AbortController,o;const i=function(f){if(!o){o=!0,c();const l=f instanceof Error?f:this.reason;n.abort(l instanceof G?l:new Ot(l instanceof Error?l.message:l))}};let a=t&&setTimeout(()=>{a=null,i(new G(`timeout ${t} of ms exceeded`,G.ETIMEDOUT))},t);const c=()=>{e&&(a&&clearTimeout(a),a=null,e.forEach(f=>{f.unsubscribe?f.unsubscribe(i):f.removeEventListener("abort",i)}),e=null)};e.forEach(f=>f.addEventListener("abort",i));const{signal:u}=n;return u.unsubscribe=()=>g.asap(c),u}},Wa=function*(e,t){let r=e.byteLength;if(r<t){yield e;return}let n=0,o;for(;n<r;)o=n+t,yield e.slice(n,o),n=o},Ja=async function*(e,t){for await(const r of Qa(e))yield*Wa(r,t)},Qa=async function*(e){if(e[Symbol.asyncIterator]){yield*e;return}const t=e.getReader();try{for(;;){const{done:r,value:n}=await t.read();if(r)break;yield n}}finally{await t.cancel()}},ms=(e,t,r,n)=>{const o=Ja(e,t);let i=0,a,c=u=>{a||(a=!0,n&&n(u))};return new ReadableStream({async pull(u){try{const{done:f,value:l}=await o.next();if(f){c(),u.close();return}let m=l.byteLength;if(r){let w=i+=m;r(w)}u.enqueue(new Uint8Array(l))}catch(f){throw c(f),f}},cancel(u){return c(u),o.return()}},{highWaterMark:2})},hs=64*1024,{isFunction:vr}=g,Ka=(({Request:e,Response:t})=>({Request:e,Response:t}))(g.global),{ReadableStream:gs,TextEncoder:ys}=g.global,xs=(e,...t)=>{try{return!!e(...t)}catch{return!1}},Xa=e=>{e=g.merge.call({skipUndefined:!0},Ka,e);const{fetch:t,Request:r,Response:n}=e,o=t?vr(t):typeof fetch=="function",i=vr(r),a=vr(n);if(!o)return!1;const c=o&&vr(gs),u=o&&(typeof ys=="function"?(y=>x=>y.encode(x))(new ys):async y=>new Uint8Array(await new r(y).arrayBuffer())),f=i&&c&&xs(()=>{let y=!1;const x=new r(we.origin,{body:new gs,method:"POST",get duplex(){return y=!0,"half"}}).headers.has("Content-Type");return y&&!x}),l=a&&c&&xs(()=>g.isReadableStream(new n("").body)),m={stream:l&&(y=>y.body)};o&&["text","arrayBuffer","blob","formData","stream"].forEach(y=>{!m[y]&&(m[y]=(x,b)=>{let N=x&&x[y];if(N)return N.call(x);throw new G(`Response type '${y}' is not supported`,G.ERR_NOT_SUPPORT,b)})});const w=async y=>{if(y==null)return 0;if(g.isBlob(y))return y.size;if(g.isSpecCompliantForm(y))return(await new r(we.origin,{method:"POST",body:y}).arrayBuffer()).byteLength;if(g.isArrayBufferView(y)||g.isArrayBuffer(y))return y.byteLength;if(g.isURLSearchParams(y)&&(y=y+""),g.isString(y))return(await u(y)).byteLength},S=async(y,x)=>{const b=g.toFiniteNumber(y.getContentLength());return b??w(x)};return async y=>{let{url:x,method:b,data:N,signal:E,cancelToken:O,timeout:B,onDownloadProgress:re,onUploadProgress:F,responseType:P,headers:z,withCredentials:L="same-origin",fetchOptions:C}=Xs(y),$=t||fetch;P=P?(P+"").toLowerCase():"text";let U=Ga([E,O&&O.toAbortSignal()],B),W=null;const fe=U&&U.unsubscribe&&(()=>{U.unsubscribe()});let ve;try{if(F&&f&&b!=="get"&&b!=="head"&&(ve=await S(z,N))!==0){let T=new r(x,{method:"POST",body:N,duplex:"half"}),q;if(g.isFormData(N)&&(q=T.headers.get("content-type"))&&z.setContentType(q),T.body){const[A,ce]=ds(ve,Rr(fs(F)));N=ms(T.body,hs,A,ce)}}g.isString(L)||(L=L?"include":"omit");const xe=i&&"credentials"in r.prototype,Ft={...C,signal:U,method:b.toUpperCase(),headers:z.normalize().toJSON(),body:N,duplex:"half",credentials:xe?L:void 0};W=i&&new r(x,Ft);let be=await(i?$(W,C):$(x,Ft));const gt=l&&(P==="stream"||P==="response");if(l&&(re||gt&&fe)){const T={};["status","statusText","headers"].forEach(pe=>{T[pe]=be[pe]});const q=g.toFiniteNumber(be.headers.get("content-length")),[A,ce]=re&&ds(q,Rr(fs(re),!0))||[];be=new n(ms(be.body,hs,A,()=>{ce&&ce(),fe&&fe()}),T)}P=P||"text";let De=await m[g.findKey(m,P)||"text"](be,y);return!gt&&fe&&fe(),await new Promise((T,q)=>{Qs(T,q,{data:De,headers:Te.from(be.headers),status:be.status,statusText:be.statusText,config:y,request:W})})}catch(xe){throw fe&&fe(),xe&&xe.name==="TypeError"&&/Load failed|fetch/i.test(xe.message)?Object.assign(new G("Network Error",G.ERR_NETWORK,y,W),{cause:xe.cause||xe}):G.from(xe,xe&&xe.code,y,W)}}},Ya=new Map,Ys=e=>{let t=e?e.env:{};const{fetch:r,Request:n,Response:o}=t,i=[n,o,r];let a=i.length,c=a,u,f,l=Ya;for(;c--;)u=i[c],f=l.get(u),f===void 0&&l.set(u,f=c?new Map:Xa(t)),l=f;return f};Ys();const gn={http:ha,xhr:Ha,fetch:{get:Ys}};g.forEach(gn,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});const bs=e=>`- ${e}`,Za=e=>g.isFunction(e)||e===null||e===!1,Zs={getAdapter:(e,t)=>{e=g.isArray(e)?e:[e];const{length:r}=e;let n,o;const i={};for(let a=0;a<r;a++){n=e[a];let c;if(o=n,!Za(n)&&(o=gn[(c=String(n)).toLowerCase()],o===void 0))throw new G(`Unknown adapter '${c}'`);if(o&&(g.isFunction(o)||(o=o.get(t))))break;i[c||"#"+a]=o}if(!o){const a=Object.entries(i).map(([u,f])=>`adapter ${u} `+(f===!1?"is not supported by the environment":"is not available in the build"));let c=r?a.length>1?`since :
`+a.map(bs).join(`
`):" "+bs(a[0]):"as no adapter specified";throw new G("There is no suitable adapter to dispatch the request "+c,"ERR_NOT_SUPPORT")}return o},adapters:gn};function cn(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Ot(null,e)}function ws(e){return cn(e),e.headers=Te.from(e.headers),e.data=an.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),Zs.getAdapter(e.adapter||tr.adapter,e)(e).then(function(n){return cn(e),n.data=an.call(e,e.transformResponse,n),n.headers=Te.from(n.headers),n},function(n){return Js(n)||(cn(e),n&&n.response&&(n.response.data=an.call(e,e.transformResponse,n.response),n.response.headers=Te.from(n.response.headers))),Promise.reject(n)})}const eo="1.12.2",Fr={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{Fr[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}});const vs={};Fr.transitional=function(t,r,n){function o(i,a){return"[Axios v"+eo+"] Transitional option '"+i+"'"+a+(n?". "+n:"")}return(i,a,c)=>{if(t===!1)throw new G(o(a," has been removed"+(r?" in "+r:"")),G.ERR_DEPRECATED);return r&&!vs[a]&&(vs[a]=!0,console.warn(o(a," has been deprecated since v"+r+" and will be removed in the near future"))),t?t(i,a,c):!0}};Fr.spelling=function(t){return(r,n)=>(console.warn(`${n} is likely a misspelling of ${t}`),!0)};function ec(e,t,r){if(typeof e!="object")throw new G("options must be an object",G.ERR_BAD_OPTION_VALUE);const n=Object.keys(e);let o=n.length;for(;o-- >0;){const i=n[o],a=t[i];if(a){const c=e[i],u=c===void 0||a(c,i,e);if(u!==!0)throw new G("option "+i+" must be "+u,G.ERR_BAD_OPTION_VALUE);continue}if(r!==!0)throw new G("Unknown option "+i,G.ERR_BAD_OPTION)}}const Er={assertOptions:ec,validators:Fr},Qe=Er.validators;let pt=class{constructor(t){this.defaults=t||{},this.interceptors={request:new ls,response:new ls}}async request(t,r){try{return await this._request(t,r)}catch(n){if(n instanceof Error){let o={};Error.captureStackTrace?Error.captureStackTrace(o):o=new Error;const i=o.stack?o.stack.replace(/^.+\n/,""):"";try{n.stack?i&&!String(n.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+i):n.stack=i}catch{}}throw n}}_request(t,r){typeof t=="string"?(r=r||{},r.url=t):r=t||{},r=mt(this.defaults,r);const{transitional:n,paramsSerializer:o,headers:i}=r;n!==void 0&&Er.assertOptions(n,{silentJSONParsing:Qe.transitional(Qe.boolean),forcedJSONParsing:Qe.transitional(Qe.boolean),clarifyTimeoutError:Qe.transitional(Qe.boolean)},!1),o!=null&&(g.isFunction(o)?r.paramsSerializer={serialize:o}:Er.assertOptions(o,{encode:Qe.function,serialize:Qe.function},!0)),r.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?r.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:r.allowAbsoluteUrls=!0),Er.assertOptions(r,{baseUrl:Qe.spelling("baseURL"),withXsrfToken:Qe.spelling("withXSRFToken")},!0),r.method=(r.method||this.defaults.method||"get").toLowerCase();let a=i&&g.merge(i.common,i[r.method]);i&&g.forEach(["delete","get","head","post","put","patch","common"],y=>{delete i[y]}),r.headers=Te.concat(a,i);const c=[];let u=!0;this.interceptors.request.forEach(function(x){typeof x.runWhen=="function"&&x.runWhen(r)===!1||(u=u&&x.synchronous,c.unshift(x.fulfilled,x.rejected))});const f=[];this.interceptors.response.forEach(function(x){f.push(x.fulfilled,x.rejected)});let l,m=0,w;if(!u){const y=[ws.bind(this),void 0];for(y.unshift(...c),y.push(...f),w=y.length,l=Promise.resolve(r);m<w;)l=l.then(y[m++],y[m++]);return l}w=c.length;let S=r;for(;m<w;){const y=c[m++],x=c[m++];try{S=y(S)}catch(b){x.call(this,b);break}}try{l=ws.call(this,S)}catch(y){return Promise.reject(y)}for(m=0,w=f.length;m<w;)l=l.then(f[m++],f[m++]);return l}getUri(t){t=mt(this.defaults,t);const r=Ks(t.baseURL,t.url,t.allowAbsoluteUrls);return Hs(r,t.params,t.paramsSerializer)}};g.forEach(["delete","get","head","options"],function(t){pt.prototype[t]=function(r,n){return this.request(mt(n||{},{method:t,url:r,data:(n||{}).data}))}});g.forEach(["post","put","patch"],function(t){function r(n){return function(i,a,c){return this.request(mt(c||{},{method:t,headers:n?{"Content-Type":"multipart/form-data"}:{},url:i,data:a}))}}pt.prototype[t]=r(),pt.prototype[t+"Form"]=r(!0)});let tc=class to{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let r;this.promise=new Promise(function(i){r=i});const n=this;this.promise.then(o=>{if(!n._listeners)return;let i=n._listeners.length;for(;i-- >0;)n._listeners[i](o);n._listeners=null}),this.promise.then=o=>{let i;const a=new Promise(c=>{n.subscribe(c),i=c}).then(o);return a.cancel=function(){n.unsubscribe(i)},a},t(function(i,a,c){n.reason||(n.reason=new Ot(i,a,c),r(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const r=this._listeners.indexOf(t);r!==-1&&this._listeners.splice(r,1)}toAbortSignal(){const t=new AbortController,r=n=>{t.abort(n)};return this.subscribe(r),t.signal.unsubscribe=()=>this.unsubscribe(r),t.signal}static source(){let t;return{token:new to(function(o){t=o}),cancel:t}}};function rc(e){return function(r){return e.apply(null,r)}}function nc(e){return g.isObject(e)&&e.isAxiosError===!0}const yn={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(yn).forEach(([e,t])=>{yn[t]=e});function ro(e){const t=new pt(e),r=Is(pt.prototype.request,t);return g.extend(r,pt.prototype,t,{allOwnKeys:!0}),g.extend(r,t,null,{allOwnKeys:!0}),r.create=function(o){return ro(mt(e,o))},r}const oe=ro(tr);oe.Axios=pt;oe.CanceledError=Ot;oe.CancelToken=tc;oe.isCancel=Js;oe.VERSION=eo;oe.toFormData=zr;oe.AxiosError=G;oe.Cancel=oe.CanceledError;oe.all=function(t){return Promise.all(t)};oe.spread=rc;oe.isAxiosError=nc;oe.mergeConfig=mt;oe.AxiosHeaders=Te;oe.formToJSON=e=>Ws(g.isHTMLForm(e)?new FormData(e):e);oe.getAdapter=Zs.getAdapter;oe.HttpStatusCode=yn;oe.default=oe;const{Axios:Lc,AxiosError:$c,CanceledError:qc,isCancel:Dc,CancelToken:Mc,VERSION:Uc,all:Bc,Cancel:Vc,isAxiosError:Hc,spread:Gc,toFormData:Wc,AxiosHeaders:Jc,HttpStatusCode:Qc,formToJSON:Kc,getAdapter:Xc,mergeConfig:Yc}=oe,sc=()=>"http://localhost:8000".replace(/\/+$/,""),ot=sc(),Tt=()=>{const e=Rt();return e?{[un]:e}:{}};function oc(e){return(e||"").toString().normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").toLowerCase().replace(/[^a-z0-9]+/g," ").trim()}async function Sr(){try{const e=await oe.get(`${ot}/api/cart`,{headers:Tt()}),t=Ie.getState().setCartFromServer;typeof t=="function"&&t(e.data)}catch(e){console.warn("Cart sync from server failed:",(e==null?void 0:e.message)||e)}}function dt(e){try{const t=(e||[]).map(n=>{var o,i,a;return{item_id:n.id,product_id:(o=n.product)==null?void 0:o.id,name:(i=n.product)==null?void 0:i.name,size:n.size,color:n.color,quantity:n.quantity,price:(a=n.product)==null?void 0:a.price}}),r={};for(const n of t){const o=oc(`${n.name} ${n.size||""} ${n.color||""}`);o&&(r[o]=n.item_id)}window.cartSnapshot=t,window.cartItemsMap=r,window.dispatchEvent(new CustomEvent("aiva-cart-changed",{detail:t}))}catch{}}function ic(e=5){var t;try{const r=Ie.getState(),n=Array.isArray(r.cart)?r.cart:[];if(n.length===0)return"Il carrello è vuoto.";const o=[];for(let c=0;c<Math.min(n.length,e);c++){const u=n[c],f=((t=u==null?void 0:u.product)==null?void 0:t.name)||"prodotto",l=(u==null?void 0:u.quantity)||1,m=u!=null&&u.size?`, taglia ${u.size}`:"",w=u!=null&&u.color?`, ${u.color}`:"";o.push(`${l} x ${f}${m}${w}`)}const i=n.length-Math.min(n.length,e),a=i>0?`, e altri ${i} articoli.`:".";return`Nel carrello ci sono: ${o.join(". ")}${a}`}catch{return"Il carrello è vuoto."}}const zt=()=>{const{cart:e,cartTotal:t,cartCount:r,addToCart:n,removeFromCart:o,clearCart:i,updateQuantity:a}=Ie(),[c,u]=d.useState(!1),[f,l]=d.useState(null),[m,w]=d.useState(0);d.useEffect(()=>{t>=100?w(0):r>0?w(9.9):w(0)},[t,r]),d.useEffect(()=>{dt(e)},[e]);const S=d.useCallback(async(z,L,C,$=1)=>{try{if(u(!0),l(null),!(await oe.get(`${ot}/api/products/${z.id}/availability`,{params:{size:L,color:C},headers:Tt()})).data.available)throw new Error("Variante non disponibile");return n(z,L,C,$),dt(Ie.getState().cart),await oe.post(`${ot}/api/cart/items`,{product_id:z.id,size:L,color:C,quantity:$},{headers:{...Tt(),"Content-Type":"application/json"}}),await Sr(),!0}catch(U){return l(U.message||"Errore aggiunta al carrello"),console.error("Add to cart error:",U),!1}finally{u(!1)}},[n]),y=d.useCallback(async z=>{try{return u(!0),l(null),o(z),dt(Ie.getState().cart),await oe.delete(`${ot}/api/cart/items/${z}`,{headers:Tt()}),await Sr(),!0}catch(L){return l(L.message||"Errore rimozione dal carrello"),console.error("Remove from cart error:",L),!1}finally{u(!1)}},[o]),x=d.useCallback(async()=>{if(e.length===0)return l("Il carrello è vuoto"),!1;const z=e[e.length-1];return y(z.id)},[e,y]),b=d.useCallback(async z=>{try{u(!0),l(null);const L=e.filter(C=>C.product.category.toLowerCase()===z.toLowerCase());if(L.length===0)return l(`Nessun prodotto della categoria ${z} nel carrello`),!1;for(const C of L)o(C.id);return dt(Ie.getState().cart),await oe.post(`${ot}/api/cart/remove-category`,{category:z}),!0}catch(L){return l(L.message||"Errore rimozione categoria"),!1}finally{u(!1)}},[e,o]),N=d.useCallback(async(z,L)=>{if(L<1||L>10)return l("Quantità deve essere tra 1 e 10"),!1;try{return u(!0),l(null),a(z,L),dt(Ie.getState().cart),await oe.put(`${ot}/api/cart/items/${z}`,{quantity:L},{headers:Tt()}),await Sr(),!0}catch(C){return l(C.message||"Errore aggiornamento quantità"),!1}finally{u(!1)}},[a]),E=d.useCallback(async(z,L=1)=>{const C=e.find(U=>U.id===z);if(!C)return l("Prodotto non trovato nel carrello"),!1;const $=C.quantity+L;return N(z,$)},[e,N]),O=d.useCallback(async(z,L=1)=>{const C=e.find(U=>U.id===z);if(!C)return l("Prodotto non trovato nel carrello"),!1;const $=C.quantity-L;return $<=0?y(z):N(z,$)},[e,N,y]),B=d.useCallback(async()=>{try{return u(!0),l(null),i(),dt(Ie.getState().cart),await oe.post(`${ot}/api/cart/clear`,{},{headers:Tt()}),await Sr(),!0}catch(z){return l(z.message||"Errore svuotamento carrello"),!1}finally{u(!1)}},[i]),re=d.useCallback(()=>{const z=t,L=m,C=z+L;return{items:e,itemCount:r,subtotal:z,shipping:L,total:C}},[e,r,t,m]),F=d.useCallback((z,L=null,C=null)=>e.some($=>{const U=$.product.id===z,W=!L||$.size===L,fe=!C||$.color===C;return U&&W&&fe}),[e]),P=d.useCallback((z,L=null,C=null)=>{const $=e.find(U=>{const W=U.product.id===z,fe=!L||U.size===L,ve=!C||U.color===C;return W&&fe&&ve});return $?$.quantity:0},[e]);return d.useEffect(()=>{(async()=>{try{const L=await oe.get(`${ot}/api/cart`),C=Ie.getState().setCartFromServer;typeof C=="function"&&C(L.data)}catch(L){console.error("Failed to sync cart:",L)}})()},[]),{cart:e,cartCount:r,cartTotal:t,shipping:m,grandTotal:t+m,loading:c,error:f,addToCart:S,removeFromCart:y,removeLastItem:x,removeByCategory:b,updateQuantity:N,increaseQuantity:E,decreaseQuantity:O,clearCart:B,getCartSummary:re,isInCart:F,getItemQuantity:P}},no=()=>{const[e,t]=d.useState([]),[r,n]=d.useState(!1);d.useEffect(()=>{const l=localStorage.getItem("aiva-favorites");if(l)try{t(JSON.parse(l))}catch(m){console.error("Error loading favorites:",m),t([])}},[]),d.useEffect(()=>{localStorage.setItem("aiva-favorites",JSON.stringify(e))},[e]);const o=d.useCallback(l=>{t(m=>m.some(S=>S.id===l.id)?m:[...m,l])},[]),i=d.useCallback(l=>{t(m=>m.filter(w=>w.id!==l))},[]),a=d.useCallback(l=>{e.some(w=>w.id===l.id)?i(l.id):o(l)},[e,o,i]),c=d.useCallback(l=>e.some(m=>m.id===l),[e]),u=d.useCallback(()=>{t([])},[]),f=e.length;return{favorites:e,favoritesCount:f,addToFavorites:o,removeFromFavorites:i,toggleFavorite:a,isFavorite:c,clearFavorites:u,loading:r}},ac=({product:e,onAddToCart:t,onToggleFavorite:r,isFavorite:n})=>{var u;const[o,i]=d.useState(!1),a=Kt(),c=()=>{a(`/products/${e.id}`)};return s.jsxs(_.div,{className:"bg-white rounded-xl shadow-sm overflow-hidden cursor-pointer",whileHover:{y:-8,shadow:"xl"},transition:{type:"spring",stiffness:300},onHoverStart:()=>i(!0),onHoverEnd:()=>i(!1),onClick:c,children:[s.jsxs("div",{className:"relative overflow-hidden h-72 bg-gray-100",children:[s.jsx(_.img,{src:dn(((u=e.images)==null?void 0:u[0])||e.image||"/static/images/placeholder.jpg"),alt:e.name,className:"w-full h-full object-cover",animate:{scale:o?1.1:1},transition:{duration:.3}}),(()=>{const f=Number(e.discount_percentage??e.discount??0),l=Number(e.original_price??e.originalPrice??0),m=Number(e.price??0);return f>0&&l>m})()&&s.jsxs(_.div,{className:"absolute top-4 left-4 bg-red-500 text-white px-3 py-1 rounded-full text-sm font-bold",initial:{rotate:-15},animate:{rotate:o?0:-15},children:["-",Number(e.discount_percentage??e.discount??0),"%"]}),s.jsx(_.div,{className:"absolute top-4 right-4",whileHover:{scale:1.2},whileTap:{scale:.9},onClick:f=>{f.stopPropagation(),r(e)},children:s.jsx("button",{className:`p-2 rounded-full shadow-md transition-colors ${n?"bg-red-500 text-white hover:bg-red-600":"bg-white text-gray-600 hover:bg-gray-100"}`,children:s.jsx(Ar,{size:20,fill:n?"currentColor":"none"})})})]}),s.jsxs("div",{className:"p-4",children:[s.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wider mb-1",children:e.brand}),s.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:e.name}),s.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[s.jsx("div",{className:"flex items-center",children:[...Array(5)].map((f,l)=>s.jsx(kr,{size:14,className:l<Math.floor(e.rating)?"text-yellow-400 fill-current":"text-gray-300"},l))}),s.jsxs("span",{className:"text-xs text-gray-500",children:["(",e.reviews,")"]})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[(()=>{const f=Number(e.discount_percentage??e.discount??0),l=Number(e.original_price??e.originalPrice??0),m=Number(e.price??0);return f>0&&l>m?s.jsxs("span",{className:"text-sm text-gray-400 line-through mr-2",children:["€",l.toFixed(2)]}):null})(),s.jsxs("span",{className:"text-xl font-bold text-gray-900",children:["€",Number(e.price??0).toFixed(2)]})]}),s.jsx(_.button,{onClick:f=>{f.stopPropagation(),t(e)},className:"p-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",whileHover:{scale:1.05},whileTap:{scale:.95},children:s.jsx(ht,{size:20})})]})]})]})},cc=()=>{var De;const[e,t]=d.useState([]),[r,n]=d.useState([]),[o,i]=d.useState(!0),[a,c]=d.useState(null),[u,f]=d.useState(""),[l,m]=d.useState(""),[w,S]=d.useState("name"),[y,x]=d.useState("grid"),[b,N]=d.useState(!1),[E,O]=d.useState(null),[B,re]=d.useState(""),[F,P]=d.useState(""),[z,L]=d.useState(!1),{toggleFavorite:C,isFavorite:$}=no(),{addToCart:U}=zt(),W=[{id:"",name:"Tutte le categorie"},{id:"t-shirt",name:"T-Shirt"},{id:"camicia",name:"Camicie"},{id:"maglione",name:"Maglioni"},{id:"felpa",name:"Felpe"},{id:"giacca",name:"Giacche"},{id:"pantaloni",name:"Pantaloni"},{id:"shorts",name:"Shorts"},{id:"gonna",name:"Gonne"},{id:"vestito",name:"Vestiti"},{id:"scarpe",name:"Scarpe"},{id:"accessori",name:"Accessori"}];d.useEffect(()=>{(async()=>{try{i(!0),c(null);const q={};l&&(q.category=l),u&&(q.q=u);const A=await At.getProducts(q);t(A),n(A)}catch(q){console.error("Error loading products:",q),c("Errore nel caricamento dei prodotti. Riprova più tardi.")}finally{i(!1)}})()},[l,u]),d.useEffect(()=>{let T=[...e];T.sort((q,A)=>{switch(w){case"price-low":return q.price-A.price;case"price-high":return A.price-q.price;case"rating":return A.rating-q.rating;case"name":default:return q.name.localeCompare(A.name)}}),n(T)},[e,w]),d.useEffect(()=>{const T=ce=>(ce||"").toLowerCase().normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").replace(/[^a-z0-9\s]/g,"").trim(),q=(r||[]).map(ce=>ce.id),A=Object.fromEntries((r||[]).map(ce=>[T(ce.name),ce.id]));return window.visibleProductIds=q,window.visibleProductsMap=A,window.productsSearchQuery=u||"",window.productsSelectedCategory=l||"",window.applyProductFilters=({query:ce,q:pe,category:J,sort:Oe,price_range:ze}={})=>{const _e=ce??pe;typeof _e=="string"&&f(_e),typeof J=="string"&&m(J),typeof Oe=="string"&&S(Oe),ze==="low-to-high"&&S("price-low"),ze==="high-to-low"&&S("price-high"),window.scrollTo({top:0,behavior:"smooth"})},()=>{delete window.visibleProductIds,delete window.visibleProductsMap,delete window.applyProductFilters,delete window.productsSearchQuery,delete window.productsSelectedCategory}},[r,u,l,f,m,S]);const fe=T=>{const q=new Set;return((T==null?void 0:T.variants)||[]).forEach(A=>{A.available&&q.add(A.size)}),Array.from(q)},ve=T=>{const q=new Set;return((T==null?void 0:T.variants)||[]).forEach(A=>{A.available&&q.add(A.color)}),Array.from(q)},xe=(T,q,A)=>((T==null?void 0:T.variants)||[]).some(pe=>pe.size===q&&pe.color===A&&pe.available),Ft=T=>{O(T);const q=fe(T),A=ve(T),ce=q[0]||"",pe=A[0]||"";re(ce),P(pe),N(!0)},be=T=>{Ft(T)},gt=async()=>{if(E&&!(!B||!F)&&xe(E,B,F))try{L(!0),await U(E,B,F,1),N(!1),O(null),console.log("Product added to cart:",E==null?void 0:E.name)}catch(T){console.error("Error adding to cart:",T)}finally{L(!1)}};return o?s.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600 mx-auto mb-4"}),s.jsx("p",{className:"text-gray-600",children:"Caricamento prodotti..."})]})}):s.jsxs("div",{className:"min-h-screen bg-gray-50",children:[s.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[s.jsxs(_.div,{className:"mb-8",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[s.jsx("h1",{className:"text-4xl font-bold text-gray-900 mb-4",children:"Prodotti"}),s.jsx("p",{className:"text-gray-600",children:"Scopri la nostra collezione di moda italiana"})]}),s.jsx(_.div,{className:"bg-white rounded-lg shadow-sm p-6 mb-8",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:s.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 items-center justify-between",children:[s.jsx("div",{className:"flex-1 max-w-md",children:s.jsx("input",{type:"text",placeholder:"Cerca prodotti...",value:u,onChange:T=>f(T.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Jn,{size:20,className:"text-gray-500"}),s.jsx("select",{value:l,onChange:T=>m(T.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:W.map(T=>s.jsx("option",{value:T.id,children:T.name},T.id))})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-gray-500",children:"Ordina per:"}),s.jsxs("select",{value:w,onChange:T=>S(T.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[s.jsx("option",{value:"name",children:"Nome"}),s.jsx("option",{value:"price-low",children:"Prezzo: Basso-Alto"}),s.jsx("option",{value:"price-high",children:"Prezzo: Alto-Basso"}),s.jsx("option",{value:"rating",children:"Valutazione"})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:()=>x("grid"),className:`p-2 rounded ${y==="grid"?"bg-blue-100 text-blue-600":"text-gray-500"}`,children:s.jsx(Oo,{size:20})}),s.jsx("button",{onClick:()=>x("list"),className:`p-2 rounded ${y==="list"?"bg-blue-100 text-blue-600":"text-gray-500"}`,children:s.jsx(zo,{size:20})})]})]})}),s.jsx("div",{className:"mb-6",children:s.jsxs("p",{className:"text-gray-600",children:[r.length," prodotti trovati",u&&` per "${u}"`,l&&` in ${(De=W.find(T=>T.id===l))==null?void 0:De.name}`]})}),s.jsx(_.div,{className:`grid gap-6 ${y==="grid"?"grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4":"grid-cols-1"}`,initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},children:r.map((T,q)=>s.jsx(_.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:q*.1},children:s.jsx(ac,{product:T,onAddToCart:be,onToggleFavorite:C,isFavorite:$(T.id)})},T.id))}),r.length===0&&s.jsxs(_.div,{className:"text-center py-12",initial:{opacity:0},animate:{opacity:1},children:[s.jsx("div",{className:"text-gray-400 mb-4",children:s.jsx(Jn,{size:64,className:"mx-auto"})}),s.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Nessun prodotto trovato"}),s.jsx("p",{className:"text-gray-600 mb-4",children:"Prova a modificare i filtri o la ricerca"}),s.jsx("button",{onClick:()=>{f(""),m("")},className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Rimuovi filtri"})]})]}),b&&E&&s.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[s.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>N(!1)}),s.jsxs(_.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"relative bg-white rounded-2xl shadow-xl w-full max-w-md p-6 z-10",onClick:T=>T.stopPropagation(),children:[s.jsxs("div",{className:"flex items-start justify-between mb-4",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:E.name}),s.jsx("p",{className:"text-sm text-gray-500",children:E.brand})]}),s.jsx("button",{onClick:()=>N(!1),className:"p-2 rounded-full hover:bg-gray-100",children:s.jsx(kt,{size:18})})]}),s.jsxs("div",{className:"space-y-5",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Seleziona taglia"}),s.jsx("div",{className:"flex flex-wrap gap-2",children:fe(E).map(T=>s.jsx("button",{onClick:()=>re(T),className:`px-3 py-2 rounded-lg border text-sm font-medium ${B===T?"border-blue-600 text-blue-600 bg-blue-50":"border-gray-300 text-gray-700 hover:border-gray-400"}`,children:T},T))})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Seleziona colore"}),s.jsx("div",{className:"flex flex-wrap gap-2",children:ve(E).map(T=>s.jsx("button",{onClick:()=>P(T),className:`px-3 py-2 rounded-lg border text-sm font-medium capitalize ${F===T?"border-blue-600 text-blue-600 bg-blue-50":"border-gray-300 text-gray-700 hover:border-gray-400"}`,children:T},T))})]}),s.jsxs("div",{className:"flex items-center gap-3 pt-2",children:[s.jsxs("button",{onClick:gt,disabled:z||!B||!F||!xe(E,B,F),className:"flex-1 inline-flex items-center justify-center gap-2 bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 disabled:opacity-60",children:[s.jsx(ht,{size:18}),z?"Aggiungo...":"Aggiungi al carrello"]}),s.jsx("button",{onClick:()=>N(!1),className:"px-4 py-3 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-50",children:"Annulla"})]})]})]})]})]})},lc=({offer:e,onAddToCart:t})=>{const[r,n]=d.useState(!1);return s.jsxs(_.div,{className:"bg-white rounded-xl shadow-sm overflow-hidden cursor-pointer relative",whileHover:{y:-8,shadow:"xl"},transition:{type:"spring",stiffness:300},onHoverStart:()=>n(!0),onHoverEnd:()=>n(!1),children:[s.jsx("div",{className:"absolute top-4 left-4 z-10",children:s.jsxs(_.div,{className:"bg-red-500 text-white px-3 py-1 rounded-full text-sm font-bold flex items-center gap-1",initial:{rotate:-15},animate:{rotate:r?0:-15},children:[s.jsx(Cs,{size:14}),"-",e.discount,"%"]})}),s.jsxs("div",{className:"relative overflow-hidden h-72 bg-gray-100",children:[s.jsx(_.img,{src:e.image,alt:e.name,className:"w-full h-full object-cover",animate:{scale:r?1.1:1},transition:{duration:.3}}),s.jsx(_.div,{className:"absolute top-4 right-16",whileHover:{scale:1.2},whileTap:{scale:.9},children:s.jsx("button",{className:"p-2 bg-white rounded-full shadow-md hover:bg-gray-100",children:s.jsx(Ar,{size:20,className:"text-gray-600"})})})]}),s.jsxs("div",{className:"p-4",children:[s.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wider mb-1",children:e.brand}),s.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:e.name}),s.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[s.jsx("div",{className:"flex items-center",children:[...Array(5)].map((o,i)=>s.jsx(kr,{size:14,className:i<Math.floor(e.rating)?"text-yellow-400 fill-current":"text-gray-300"},i))}),s.jsxs("span",{className:"text-xs text-gray-500",children:["(",e.reviews,")"]})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsxs("span",{className:"text-sm text-gray-400 line-through mr-2",children:["€",Number(e.originalPrice??0).toFixed(2)]}),s.jsxs("span",{className:"text-xl font-bold text-red-600",children:["€",Number(e.price??0).toFixed(2)]}),s.jsxs("div",{className:"text-xs text-green-600 font-semibold",children:["Risparmi €",(Number(e.originalPrice??0)-Number(e.price??0)).toFixed(2)]})]}),s.jsx(_.button,{onClick:()=>t(e),className:"p-2 bg-red-600 text-white rounded-lg hover:bg-red-700",whileHover:{scale:1.05},whileTap:{scale:.95},children:s.jsx(ht,{size:20})})]})]})]})},uc=()=>{const[e,t]=d.useState([]),[r,n]=d.useState(!0),[o,i]=d.useState(null),{addToCart:a}=zt(),[c,u]=d.useState(!1),[f,l]=d.useState(null),[m,w]=d.useState(""),[S,y]=d.useState(""),[x,b]=d.useState(!1);d.useEffect(()=>{(async()=>{try{n(!0),i(null);const U=(await At.getProducts({on_sale:!0})).map((W,fe)=>{var ve;return{id:W.id,name:W.name,brand:W.brand,price:W.price,originalPrice:W.original_price,discount:W.discount_percentage,image:((ve=W.images)==null?void 0:ve[0])||"https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?w=400",rating:W.rating,reviews:W.reviews,category:W.category,variants:W.variants}});t(U)}catch($){console.error("Error loading offers:",$),i("Errore nel caricamento delle offerte. Riprova più tardi.")}finally{n(!1)}})()},[]),d.useEffect(()=>{try{const C={};(e||[]).forEach($=>{const U=($.name||"").toLowerCase().normalize("NFKD").replace(/[^\w\s]/g,"").trim();U&&(C[U]=$.id)}),window.visibleProductsMap=C,window.visibleProductIds=(e||[]).map($=>$.id),window.currentPageContext="offers"}catch{}return()=>{if(window.currentPageContext==="offers")try{delete window.visibleProductsMap,delete window.visibleProductIds,delete window.currentPageContext}catch{}}},[e]),d.useEffect(()=>{const C=$=>{};return window.addEventListener("offers-apply-filters",C),()=>window.removeEventListener("offers-apply-filters",C)},[]);const N=C=>{const $=new Set;return((C==null?void 0:C.variants)||[]).forEach(U=>{U!=null&&U.available&&$.add(U.size)}),Array.from($)},E=(C,$=null)=>{const U=new Set;return((C==null?void 0:C.variants)||[]).forEach(W=>{W!=null&&W.available&&($&&W.size!==$||U.add(W.color))}),Array.from(U)},O=(C,$,U)=>!C||!$||!U?!1:(C.variants||[]).some(W=>(W==null?void 0:W.available)&&W.size===$&&W.color===U),B=()=>{u(!1),l(null),w(""),y(""),b(!1)},re=C=>{if(!C)return;l(C);const U=N(C)[0]||"",W=E(C,U),fe=E(C),ve=W[0]||fe[0]||"";w(U),y(ve),u(!0)},F=C=>{if(w(C),!f)return;const $=E(f,C);y(U=>$.includes(U)?U:$[0]||"")},P=C=>{y(C)},z=async()=>{if(!(!f||!m||!S)&&O(f,m,S))try{b(!0);const C=f==null?void 0:f.name;await a(f,m,S,1),B(),console.log("Offer added to cart:",C)}catch(C){console.error("Error adding offer to cart:",C)}finally{b(!1)}},L=C=>{re(C)};return r?s.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-red-600 mx-auto mb-4"}),s.jsx("p",{className:"text-gray-600",children:"Caricamento offerte..."})]})}):s.jsx("div",{className:"min-h-screen bg-gray-50",children:s.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[s.jsxs(_.div,{className:"mb-8",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[s.jsx("h1",{className:"text-4xl font-bold text-gray-900 mb-4",children:"Offerte Speciali"}),s.jsx("p",{className:"text-gray-600",children:"Scopri una selezione di prodotti in sconto"})]}),s.jsx("div",{className:"mb-6",children:s.jsxs("p",{className:"text-gray-600",children:[e.length," offerte disponibili"]})}),s.jsx(_.div,{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},children:e.map((C,$)=>s.jsx(_.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:$*.1},children:s.jsx(lc,{offer:C,onAddToCart:L})},C.id))}),e.length===0&&s.jsxs(_.div,{className:"text-center py-12",initial:{opacity:0},animate:{opacity:1},children:[s.jsx("div",{className:"text-gray-400 mb-4",children:s.jsx(Cs,{size:64,className:"mx-auto"})}),s.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Nessuna offerta trovata"}),s.jsx("p",{className:"text-gray-600 mb-4",children:"Controlla di nuovo più tardi per nuove offerte"})]}),c&&f&&s.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[s.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:B}),s.jsxs(_.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"relative bg-white rounded-2xl shadow-xl w-full max-w-md p-6 z-10",onClick:C=>C.stopPropagation(),children:[s.jsxs("div",{className:"flex items-start justify-between mb-4",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:f.name}),s.jsx("p",{className:"text-sm text-gray-500",children:f.brand})]}),s.jsx("button",{onClick:B,className:"p-2 rounded-full hover:bg-gray-100",children:s.jsx(kt,{size:18})})]}),s.jsxs("div",{className:"space-y-5",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Seleziona taglia"}),s.jsx("div",{className:"flex flex-wrap gap-2",children:N(f).map(C=>s.jsx("button",{onClick:()=>F(C),className:`px-3 py-2 rounded-lg border text-sm font-medium ${m===C?"border-red-600 text-red-600 bg-red-50":"border-gray-300 text-gray-700 hover:border-gray-400"}`,children:C},C))})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Seleziona colore"}),s.jsx("div",{className:"flex flex-wrap gap-2",children:E(f,m||void 0).map(C=>s.jsx("button",{onClick:()=>P(C),className:`px-3 py-2 rounded-lg border text-sm font-medium capitalize ${S===C?"border-red-600 text-red-600 bg-red-50":"border-gray-300 text-gray-700 hover:border-gray-400"}`,children:C},C))})]}),s.jsxs("div",{className:"flex items-center gap-3 pt-2",children:[s.jsxs("button",{onClick:z,disabled:x||!m||!S||!O(f,m,S),className:"flex-1 inline-flex items-center justify-center gap-2 bg-red-600 text-white py-3 rounded-lg hover:bg-red-700 disabled:opacity-60",children:[s.jsx(ht,{size:18}),x?"Aggiungo...":"Aggiungi al carrello"]}),s.jsx("button",{onClick:B,className:"px-4 py-3 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-50",children:"Annulla"})]})]})]})]}),s.jsxs(_.div,{className:"mt-16 bg-gradient-to-r from-red-500 to-orange-500 rounded-xl p-8 text-white text-center",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},children:[s.jsx("h2",{className:"text-3xl font-bold mb-4",children:"Non Perdere le Offerte!"}),s.jsx("p",{className:"text-xl mb-6 opacity-90",children:"Iscriviti alla newsletter per ricevere notifiche sulle offerte esclusive"}),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 max-w-md mx-auto",children:[s.jsx("input",{type:"email",placeholder:"La tua email",className:"flex-1 px-4 py-3 rounded-lg text-gray-900 placeholder-gray-500"}),s.jsx("button",{className:"px-6 py-3 bg-white text-red-600 font-semibold rounded-lg hover:bg-gray-100",children:"Iscriviti"})]})]})]})})},dc=({item:e,onUpdateQuantity:t,onRemove:r})=>{var c,u,f,l,m,w,S;const n=Kt(),[o,i]=d.useState(!1),a=()=>{i(!0),setTimeout(()=>{r(e.id)},300)};return s.jsx(_.div,{className:`bg-white rounded-lg shadow-sm p-4 border ${o?"opacity-50":""}`,initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.3},children:s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("div",{className:"w-20 h-20 bg-gray-100 rounded-lg overflow-hidden cursor-pointer",onClick:()=>{var y;(y=e==null?void 0:e.product)!=null&&y.id&&n(`/products/${e.product.id}`)},title:"Vai alla pagina prodotto",role:"button",children:s.jsx("img",{src:((u=(c=e.product)==null?void 0:c.images)==null?void 0:u[0])||((f=e.product)==null?void 0:f.image),alt:(l=e.product)==null?void 0:l.name,className:"w-full h-full object-cover"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"font-semibold text-gray-900 mb-1",children:(m=e.product)==null?void 0:m.name}),s.jsx("p",{className:"text-sm text-gray-500 mb-2",children:(w=e.product)==null?void 0:w.brand}),s.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[s.jsxs("span",{children:["Taglia: ",e.size]}),s.jsxs("span",{children:["Colore: ",e.color]})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:()=>t(e.id,e.quantity-1),disabled:e.quantity<=1,className:"p-1 rounded-full bg-gray-100 hover:bg-gray-200 disabled:opacity-50",children:s.jsx(Ts,{size:16})}),s.jsx("span",{className:"w-8 text-center font-semibold",children:e.quantity}),s.jsx("button",{onClick:()=>t(e.id,e.quantity+1),disabled:e.quantity>=10,className:"p-1 rounded-full bg-gray-100 hover:bg-gray-200 disabled:opacity-50",children:s.jsx(_s,{size:16})})]}),s.jsx("div",{className:"text-right",children:s.jsxs("div",{className:"font-semibold text-gray-900",children:["€",((((S=e.product)==null?void 0:S.price)||0)*e.quantity).toFixed(2)]})}),s.jsx("button",{onClick:a,className:"p-2 text-red-500 hover:bg-red-50 rounded-lg",children:s.jsx($o,{size:18})})]})})},fc=()=>{const e=Kt(),{cart:t,cartTotal:r,cartCount:n,shipping:o,updateQuantity:i,removeFromCart:a,clearCart:c}=zt();d.useEffect(()=>{Array.isArray(t)&&dt(t)},[t]);const u=r,f=r+o;return t.length===0?s.jsx("div",{className:"min-h-screen bg-gray-50",children:s.jsx("div",{className:"max-w-4xl mx-auto px-4 py-8",children:s.jsxs(_.div,{className:"text-center py-16",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[s.jsx("div",{className:"text-gray-400 mb-6",children:s.jsx(ht,{size:80,className:"mx-auto"})}),s.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Il tuo carrello è vuoto"}),s.jsx("p",{className:"text-gray-600 mb-8",children:"Aggiungi alcuni prodotti per iniziare lo shopping"}),s.jsx(_.button,{className:"px-8 py-4 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700",onClick:()=>e("/products"),whileHover:{scale:1.05},whileTap:{scale:.95},children:"Inizia Shopping"})]})})}):s.jsx("div",{className:"min-h-screen bg-gray-50",children:s.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-8",children:[s.jsxs(_.div,{className:"mb-8",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[s.jsx("h1",{className:"text-4xl font-bold text-gray-900 mb-4",children:"Carrello"}),s.jsxs("p",{className:"text-gray-600",children:[n," ",n===1?"articolo":"articoli"," nel carrello"]})]}),s.jsxs("div",{className:"grid lg:grid-cols-3 gap-8",children:[s.jsxs("div",{className:"lg:col-span-2",children:[s.jsxs(_.div,{className:"bg-white rounded-lg shadow-sm p-6 mb-6",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"I tuoi articoli"}),s.jsx("button",{onClick:c,className:"text-red-500 hover:text-red-700 text-sm font-medium",children:"Svuota carrello"})]}),s.jsx(Xt,{children:s.jsx("div",{className:"space-y-4",children:t.map(l=>s.jsx(dc,{item:l,onUpdateQuantity:i,onRemove:a},l.id))})})]}),s.jsxs(_.div,{className:"bg-blue-50 rounded-lg p-6",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:[s.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[s.jsx(Es,{className:"text-blue-600",size:24}),s.jsx("h3",{className:"font-semibold text-gray-900",children:"Spedizione"})]}),s.jsx("p",{className:"text-gray-600 mb-2",children:o===0?"🎉 Spedizione gratuita! Il tuo ordine supera i 100€":`Aggiungi €${(100-u).toFixed(2)} per la spedizione gratuita`}),s.jsx("div",{className:"text-sm text-gray-500",children:"Consegna stimata: 3-5 giorni lavorativi"})]})]}),s.jsxs("div",{className:"lg:col-span-1",children:[s.jsxs(_.div,{className:"bg-white rounded-lg shadow-sm p-6 sticky top-8",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:[s.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:"Riepilogo ordine"}),s.jsxs("div",{className:"space-y-4 mb-6",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"Subtotale"}),s.jsxs("span",{className:"font-semibold",children:["€",u.toFixed(2)]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"Spedizione"}),s.jsx("span",{className:"font-semibold",children:o===0?"Gratuita":`€${o.toFixed(2)}`})]}),s.jsx("div",{className:"border-t pt-4",children:s.jsxs("div",{className:"flex justify-between text-lg font-bold",children:[s.jsx("span",{children:"Totale"}),s.jsxs("span",{children:["€",f.toFixed(2)]})]})})]}),s.jsxs(_.button,{className:"w-full py-4 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 mb-4 flex items-center justify-center gap-2",whileHover:{scale:1.02},whileTap:{scale:.98},children:[s.jsx(Fo,{size:20}),"Procedi al Checkout",s.jsx(Lo,{size:20})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("p",{className:"text-sm text-gray-500 mb-2",children:"Pagamenti sicuri"}),s.jsxs("div",{className:"flex justify-center gap-2",children:[s.jsx("div",{className:"w-8 h-5 bg-gray-200 rounded text-xs flex items-center justify-center",children:"VISA"}),s.jsx("div",{className:"w-8 h-5 bg-gray-200 rounded text-xs flex items-center justify-center",children:"MC"}),s.jsx("div",{className:"w-8 h-5 bg-gray-200 rounded text-xs flex items-center justify-center",children:"PP"})]})]})]}),s.jsxs(_.div,{className:"bg-white rounded-lg shadow-sm p-6 mt-6",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},children:[s.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Codice promozionale"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("input",{type:"text",placeholder:"Inserisci codice",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),s.jsx("button",{className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200",children:"Applica"})]})]})]})]})]})})},pc=()=>{var re;const{id:e}=Eo(),t=Kt(),{addToCart:r}=zt(),{toggleFavorite:n,isFavorite:o}=no(),[i,a]=d.useState(null),[c,u]=d.useState(!0),[f,l]=d.useState(null),[m,w]=d.useState(""),[S,y]=d.useState(""),[x,b]=d.useState(1),[N,E]=d.useState(0);d.useEffect(()=>(e&&(async()=>{try{u(!0),l(null);const P=await At.getProduct(e);a(P);const L=(C=>(C||"").replace(/```[\s\S]*?```/g," ").replace(/`[^`]*`/g," ").replace(/[\*_~>#-]+/g," ").replace(/\[(.*?)\]\((.*?)\)/g,"$1").replace(/\s{2,}/g," ").trim())(P.description_long||P.description||"");window.currentProductContext={id:P.id,name:P.name,description_text:L,category:P.category,gender:P.gender,price:P.price,brand:P.brand,image:P.image,variants:(P.variants||[]).map(C=>{var $;return{size:typeof C.size=="string"?C.size:($=C.size)==null?void 0:$.value,color:C.color,available:C.available,stock:C.stock}}),product:{...P,description:P.description,description_long:P.description_long},lastUpdated:Date.now()},P.variants&&P.variants.length>0&&(w(P.variants[0].size),y(P.variants[0].color))}catch(P){console.error("Error loading product:",P),l("Errore nel caricamento del prodotto")}finally{u(!1)}})(),()=>{var P;((P=window.currentProductContext)==null?void 0:P.id)===e&&delete window.currentProductContext}),[e]);const O=async()=>{if(!(!m||!S))try{await r(i,m,S,x)}catch(F){console.error("Error adding to cart:",F)}},B=()=>{i&&n(i)};return c?s.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-purple-600 mx-auto mb-4"}),s.jsx("p",{className:"text-gray-600",children:"Caricamento prodotto..."})]})}):f||!i?s.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:s.jsxs("div",{className:"text-center p-8 bg-white rounded-lg shadow-md",children:[s.jsx("h2",{className:"text-2xl font-bold text-red-600 mb-4",children:"Errore!"}),s.jsx("p",{className:"text-gray-700 mb-6",children:f||"Prodotto non trovato"}),s.jsx("button",{onClick:()=>t("/products"),className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition duration-300",children:"Torna ai Prodotti"})]})}):s.jsx("div",{className:"min-h-screen bg-gray-50",children:s.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[s.jsxs(_.button,{onClick:()=>t(-1),className:"flex items-center text-gray-600 hover:text-gray-900 mb-6",whileHover:{x:-5},children:[s.jsx(qo,{size:20,className:"mr-2"}),"Torna indietro"]}),s.jsxs("div",{className:"grid lg:grid-cols-2 gap-12",children:[s.jsxs("div",{className:"space-y-4",children:[s.jsx(_.div,{className:"aspect-square bg-white rounded-2xl overflow-hidden shadow-lg",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.5},children:s.jsx("img",{src:dn(((re=i.images)==null?void 0:re[N])||i.image||"/static/images/placeholder-lg.jpg"),alt:i.name,className:"w-full h-full object-cover"})}),i.images&&i.images.length>1&&s.jsx("div",{className:"grid grid-cols-4 gap-2",children:i.images.map((F,P)=>s.jsx(_.button,{onClick:()=>E(P),className:`aspect-square rounded-lg overflow-hidden ${N===P?"ring-2 ring-blue-500":""}`,whileHover:{scale:1.05},whileTap:{scale:.95},children:s.jsx("img",{src:dn(F),alt:`${i.name} ${P+1}`,className:"w-full h-full object-cover"})},P))})]}),s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:i.name}),s.jsx("p",{className:"text-lg text-gray-600 mb-4",children:i.brand}),s.jsxs("div",{className:"flex items-center mb-4",children:[s.jsx("div",{className:"flex text-yellow-400",children:[...Array(5)].map((F,P)=>s.jsx(kr,{size:20,fill:P<Math.floor(i.rating)?"currentColor":"none",stroke:"currentColor"},P))}),s.jsxs("span",{className:"text-sm text-gray-500 ml-2",children:["(",i.reviews," recensioni)"]})]}),s.jsxs("div",{className:"mb-6",children:[Number(i.discount_percentage??0)>0&&Number(i.original_price??0)>Number(i.price??0)?s.jsxs("span",{className:"text-lg text-gray-400 line-through mr-2",children:["€",Number(i.original_price??0).toFixed(2)]}):null,s.jsxs("span",{className:"text-3xl font-bold text-gray-900",children:["€",Number(i.price??0).toFixed(2)]}),Number(i.discount_percentage??0)>0&&s.jsxs("span",{className:"ml-3 bg-red-500 text-white px-3 py-1 rounded-full text-sm font-bold",children:["-",Number(i.discount_percentage??0),"%"]})]})]}),i.variants&&s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Taglia"}),s.jsx("div",{className:"flex flex-wrap gap-2",children:[...new Set(i.variants.map(F=>F.size))].map(F=>s.jsx(_.button,{onClick:()=>w(F),className:`px-4 py-2 border rounded-lg font-medium ${m===F?"border-blue-500 bg-blue-50 text-blue-600":"border-gray-300 text-gray-700 hover:border-gray-400"}`,whileHover:{scale:1.05},whileTap:{scale:.95},children:F},F))})]}),i.variants&&s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Colore"}),s.jsx("div",{className:"flex flex-wrap gap-2",children:[...new Set(i.variants.map(F=>F.color))].map(F=>s.jsx(_.button,{onClick:()=>y(F),className:`px-4 py-2 border rounded-lg font-medium capitalize ${S===F?"border-blue-500 bg-blue-50 text-blue-600":"border-gray-300 text-gray-700 hover:border-gray-400"}`,whileHover:{scale:1.05},whileTap:{scale:.95},children:F},F))})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Quantità"}),s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(_.button,{onClick:()=>b(Math.max(1,x-1)),className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-50",whileTap:{scale:.95},children:s.jsx(Ts,{size:16})}),s.jsx("span",{className:"text-lg font-medium px-4",children:x}),s.jsx(_.button,{onClick:()=>b(x+1),className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-50",whileTap:{scale:.95},children:s.jsx(_s,{size:16})})]})]}),s.jsx("div",{className:"space-y-4",children:s.jsxs("div",{className:"flex space-x-4",children:[s.jsxs(_.button,{onClick:O,className:"flex-1 bg-blue-600 text-white py-4 px-6 rounded-lg font-semibold hover:bg-blue-700 flex items-center justify-center",whileHover:{scale:1.02},whileTap:{scale:.98},children:[s.jsx(ht,{size:20,className:"mr-2"}),"Aggiungi al Carrello"]}),s.jsx(_.button,{onClick:B,className:`p-4 rounded-lg border-2 ${i&&o(i.id)?"border-red-500 bg-red-50 text-red-600":"border-gray-300 text-gray-600 hover:border-gray-400"}`,whileHover:{scale:1.05},whileTap:{scale:.95},children:s.jsx(Ar,{size:20,fill:i&&o(i.id)?"currentColor":"none"})})]})}),s.jsxs("div",{className:"grid grid-cols-1 gap-4 pt-6 border-t",children:[s.jsxs("div",{className:"flex items-center text-gray-600",children:[s.jsx(Es,{size:20,className:"mr-3"}),s.jsx("span",{children:"Spedizione gratuita sopra i €100"})]}),s.jsxs("div",{className:"flex items-center text-gray-600",children:[s.jsx(Do,{size:20,className:"mr-3"}),s.jsx("span",{children:"Reso gratuito entro 30 giorni"})]}),s.jsxs("div",{className:"flex items-center text-gray-600",children:[s.jsx(Mo,{size:20,className:"mr-3"}),s.jsx("span",{children:"Pagamenti sicuri"})]})]})]})]})]})})},mc=({isListening:e,isProcessing:t,isConnected:r,isSpeaking:n,isExecutingFunction:o,currentFunction:i,messages:a,error:c,onClose:u,isAssistantActive:f})=>{const[l,m]=d.useState(!1);d.useEffect(()=>{if(e||t||n||o||c||f)m(!0);else{const x=setTimeout(()=>{m(!1)},2e3);return()=>clearTimeout(x)}},[e,t,n,o,c,f]);const S=c?{icon:kt,text:"Errore - Clicca per chiudere",color:"bg-red-500",textColor:"text-white",animate:!1}:o?{icon:{navigate_to_page:Uo,search_products:Rs,add_to_cart:_r,get_cart_summary:_r,get_recommendations:Jt}[i]||Ns,text:"Eseguo comando...",color:"bg-green-500",textColor:"text-white",animate:!0}:n?{icon:As,text:"AIVA sta parlando",color:"bg-purple-500",textColor:"text-white",animate:!0}:t?{icon:Kr,text:"",color:"bg-blue-500",textColor:"text-white",animate:!0}:e?{icon:_t,text:"Ti sto ascoltando",color:"bg-blue-500",textColor:"text-white",animate:!0}:{icon:Bo,text:"AIVA pronta",color:"bg-gray-700",textColor:"text-white",animate:!1},y=x=>{x.stopPropagation(),console.log("🔴 VoiceVisualizer: Closing assistant completely"),m(!1),u&&u()};return l?s.jsx(Xt,{children:s.jsx(_.div,{initial:{opacity:0,y:-20,scale:.9},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-20,scale:.9},className:"fixed top-6 left-0 right-0 z-[100]",style:{pointerEvents:"none"},children:s.jsxs("div",{className:"relative mx-auto",style:{width:"400px",maxWidth:"90vw",pointerEvents:"auto"},children:[s.jsx(_.div,{className:"bg-black/90 backdrop-blur-xl rounded-2xl border border-white/10 shadow-2xl",style:{height:"80px",width:"100%"},initial:{scale:.9},animate:{scale:1},transition:{type:"spring",damping:20},children:s.jsxs("div",{className:"flex items-center justify-between p-4 h-full",children:[s.jsxs("div",{className:"flex items-center space-x-4 flex-1",children:[s.jsxs("div",{className:"relative flex-shrink-0",children:[s.jsx(_.div,{className:`w-12 h-12 rounded-full ${S.color} flex items-center justify-center`,animate:S.animate?{scale:[1,1.1,1]}:{},transition:{duration:1.2,repeat:S.animate?1/0:0,ease:"easeInOut"},children:S.icon===Kr?s.jsx(Kr,{className:"w-6 h-6 text-white animate-spin"}):s.jsx(S.icon,{className:"w-6 h-6 text-white"})}),S.animate&&s.jsx(_.div,{className:`absolute inset-0 rounded-full ${S.color} opacity-40`,animate:{scale:[1,1.6],opacity:[.4,0]},transition:{duration:1.8,repeat:1/0,ease:"easeOut"}})]}),s.jsxs("div",{className:"flex flex-col min-w-0 flex-1",children:[s.jsx("span",{className:`font-medium text-sm ${S.textColor} truncate`,children:S.text}),s.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[s.jsx("div",{className:`w-2 h-2 rounded-full ${r?"bg-green-400":"bg-red-400"}`}),s.jsx("span",{className:"text-white/60 text-xs",children:r?"Connesso":"Connessione..."})]})]})]}),s.jsxs("div",{className:"flex items-center space-x-3 flex-shrink-0",children:[(e||n)&&s.jsx("div",{className:"flex items-center space-x-1",children:[...Array(4)].map((x,b)=>s.jsx(_.div,{className:`w-1 rounded-full ${e?"bg-blue-400":"bg-purple-400"}`,animate:{height:[6,18,6]},transition:{duration:.8,repeat:1/0,delay:b*.15,ease:"easeInOut"}},b))}),s.jsx(_.button,{onClick:y,className:"p-2 rounded-full bg-white/10 hover:bg-white/20 transition-colors flex-shrink-0",whileHover:{scale:1.1},whileTap:{scale:.95},title:"Chiudi assistente vocale",children:s.jsx(kt,{className:"w-4 h-4 text-white/80"})})]})]})}),!1,o&&i&&s.jsx(_.div,{className:"absolute -bottom-8 left-1/2 transform -translate-x-1/2",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},children:s.jsxs("div",{className:"bg-green-500/90 text-white text-xs px-3 py-1 rounded-full backdrop-blur-sm",children:[i==="search_products"&&"🔍 Ricerca in corso",i==="add_to_cart"&&"🛒 Aggiunta al carrello",i==="navigate_to_page"&&"📍 Navigazione",!["search_products","add_to_cart","navigate_to_page"].includes(i)&&"⚡ Esecuzione"]})})]})})}):null},Ss=(e=[])=>{if(!Array.isArray(e)||e.length===0)return"";const t=Math.floor(Math.random()*e.length);return e[t]??e[0]},hc=(e="")=>(e||"").replace(/```[\s\S]*?```/g," ").replace(/`[^`]*`/g," ").replace(/[\*_~>#-]+/g," ").replace(/\[(.*?)\]\((.*?)\)/g,"$1").replace(/\s{2,}/g," ").trim(),Wt=16e3,gc=(e=[])=>{if(!Array.isArray(e)||e.length===0)return new Float32Array(0);const t=e.reduce((o,i)=>o+i.length,0),r=new Float32Array(t);let n=0;return e.forEach(o=>{r.set(o,n),n+=o.length}),r},yc=(e,t,r=Wt)=>{if(!e||!e.length||!t||t===r)return e||new Float32Array(0);const n=t/r,o=Math.round(e.length/n),i=new Float32Array(o);let a=0,c=0;for(;a<i.length;){const u=Math.round((a+1)*n);let f=0,l=0;for(let m=c;m<u&&m<e.length;m+=1)f+=e[m],l+=1;i[a]=l>0?f/l:0,a+=1,c=u}return i},xc=e=>{const t=new ArrayBuffer(e.length*2),r=new DataView(t);let n=0;for(let o=0;o<e.length;o+=1,n+=2){const i=Math.max(-1,Math.min(1,e[o]||0));r.setInt16(n,i<0?i*32768:i*32767,!0)}return new Uint8Array(t)},bc=e=>{if(!e)return"";let t="";const r=new Uint8Array(e),n=32768;for(let o=0;o<r.length;o+=n){const i=r.subarray(o,o+n);t+=String.fromCharCode.apply(null,i)}return btoa(t)},wc=e=>{const t=atob(e),r=t.length,n=new Uint8Array(r);for(let o=0;o<r;o+=1)n[o]=t.charCodeAt(o);return n.buffer},vc=(e={})=>{var t;return{size:typeof e.size=="string"?e.size:(t=e.size)==null?void 0:t.value,color:e.color,available:e.available,stock:e.stock}},Sc=(e,t=1)=>{const r=Number(e);return Number.isFinite(r)?Math.min(10,Math.max(1,Math.round(r))):t},ln=(e={},t=null)=>{if(!t||typeof t!="object")return e;const r=hc(t.description_long||t.description||e.description_text||""),n=Array.isArray(t.variants)?t.variants.map(vc):e.variants||[];return{...e,id:t.id||e.id,name:t.name||e.name,category:t.category||e.category,gender:t.gender||e.gender,price:t.price??e.price,brand:t.brand??e.brand,image:t.image??e.image,description_text:r,variants:n,product:t,lastUpdated:Date.now()}},jc=()=>{const[e,t]=d.useState(!1),[r,n]=d.useState(!1),[o,i]=d.useState([]),[a,c]=d.useState(!1),[u,f]=d.useState(!1),[l,m]=d.useState(null),[w,S]=d.useState(null),[y,x]=d.useState(""),[b,N]=d.useState(!1),[E,O]=d.useState(!0),[B,re]=d.useState(!1),[F,P]=d.useState(0),z=Kt(),{addToCart:L,removeFromCart:C,clearCart:$,removeLastItem:U,updateQuantity:W}=zt(),{setSearchQuery:fe,filterProducts:ve,setMultipleFilters:xe,clearFilters:Ft}=Ie(),be=d.useRef(null),gt=typeof window<"u"?Rt():null,De=d.useRef(gt||`session-${Date.now()}-${Math.random().toString(36).substr(2,9)}`);d.useRef(null),d.useRef(0);const T=d.useRef(null),q=d.useRef([]),A=d.useRef(!1);d.useEffect(()=>{A.current=a},[a]);const ce=d.useRef(!1),pe=d.useRef(null),J=d.useRef(null);d.useRef([]);const Oe=d.useRef(null),ze=d.useRef(""),_e=d.useRef(""),yt=d.useRef(!1),rr=d.useRef(!1),xt=d.useRef(!1),Se=d.useRef([]),Fe=d.useRef(null),bt=d.useRef([]),Lr=d.useRef(null),it=d.useRef(null),Lt=d.useRef(!1),jn=d.useRef(null),$t=d.useRef(!1),Nn=d.useRef(!1),je=d.useRef(!1),oo=d.useRef(!1),wt=d.useRef(Date.now()),Cn=d.useRef(""),Xe=d.useRef(!1),nr=d.useRef(null),sr=d.useRef([]),Me=d.useRef(""),vt=d.useRef(""),Ue=typeof window<"u"&&typeof navigator<"u",at=Ue&&/iP(ad|hone|od)/i.test(navigator.userAgent),io=Ue&&/Safari/i.test(navigator.userAgent)&&!/Chrome|CriOS|Android/i.test(navigator.userAgent),or=at&&io,ir=d.useRef(!1),qt=d.useRef({active:!1,aborting:!1}),St=d.useCallback(()=>!Ue||typeof window>"u"?!1:"webkitSpeechRecognition"in window||"SpeechRecognition"in window,[Ue]),ar=d.useMemo(()=>Ue?!!(!St()||at):!1,[Ue,St,at]),En=d.useMemo(()=>!Ue||typeof window>"u"?!1:!!(!("speechSynthesis"in window)||at),[Ue,at]),ge=d.useCallback(()=>(typeof window<"u"&&window.speechSynthesis?window.speechSynthesis.speaking:!1)||Lt.current,[]),jt=d.useRef(null),cr=d.useRef(null),ao=d.useRef(null),Dt=d.useRef(null),ct={default:{window:9e3,closingGrace:1e3,prompts:["Se hai bisogno di altro, sono qui.","Ok! Buon proseguimento, chiamami se ti serve aiuto.","Resto a disposizione se ti serve altro.","Quando vuoi riprendere, basta dirmelo.","Sono qui se ti viene in mente qualcos'altro da vedere.","Va bene, resto in ascolto per quando ti serve.","Va benissimo, resto disponibile se vuoi continuare più tardi.","Prenditi pure il tuo tempo, io rimango qui.","Chiamami pure quando ti viene voglia di esplorare altri look.","Se vuoi riprendere, basta dirmelo e continuiamo da dove eravamo."]},followUp:{window:13e3,closingGrace:1600,prompts:["Nessun problema, fammi sapere come vuoi procedere.","Va bene, ti ascolto quando sei pronto.","Prenditi pure un momento per pensarci, resto in ascolto.","Ok, dimmi pure appena hai deciso come continuare.","Tranquillo, fammi sapere quando vuoi proseguire."]},task:{window:11e3,closingGrace:1300,prompts:["Va bene, continuo a seguire la tua richiesta.","Perfetto, dimmi pure gli altri dettagli quando vuoi.","Ok, resto qui finché non mi dai nuove indicazioni.","Ricevuto, se vuoi aggiungere altro basta dirmelo.","Va benissimo, proseguiamo quando sei pronto."]}},co=450,tt=d.useRef(null),$r=d.useRef(null),lr=d.useRef(!1),Be=d.useRef(null),X=d.useRef(!1),qr=d.useRef({}),Dr=d.useCallback(async()=>{const p=window.currentProductContext||{};if(p.product&&typeof p.product=="object"){const h=ln(p,p.product);return window.currentProductContext=h,h}if(!p.id)return p;try{const h=await At.getProduct(p.id);if(h){const j=ln(p,h);return window.currentProductContext=j,j}}catch(h){console.warn("Unable to hydrate current product context",h)}return window.currentProductContext||p},[At]),lo=["Ecco.","Subito.","Fatto.","Ci siamo."],Tn=["Ecco il carrello.","Carrello aperto.","Tieni il carrello.","Pronto."],uo=["Ecco le offerte.","Sconti in vista.","Promozioni aperte.","Offerte pronte."],fo=["Ecco i risultati.","Ecco qui.","Pronto.","Fatto."],po=["Filtri applicati.","Lista aggiornata.","Pronto così.","Fatto."],mo=["Ecco la scheda.","Mostrato.","Eccolo qui.","Fatto."],ho=["Aggiunto al carrello.","Fatto.","Inserito.","Dentro al carrello."],go=["Tolto dal carrello.","Rimosso.","Fatto.","Via dal carrello."],yo=["Carrello svuotato.","Tutto pulito.","Vuoto.","Fatto."],Le=d.useCallback((p,h=[],j="")=>{const v=Array.isArray(h)?h.filter(Boolean):[];if(v.length===0)return j;const R=qr.current[p],I=v.filter(k=>k!==R),H=Ss(I.length>0?I:v)||j||v[0];return qr.current[p]=H,H||j},[]),_n=d.useCallback(()=>{tt.current&&(clearTimeout(tt.current),tt.current=null),Be.current&&(clearTimeout(Be.current),Be.current=null)},[]),Mr=d.useRef("default"),ur=d.useRef(""),Ve=d.useRef(""),dr=d.useRef(null),Ur=d.useRef(()=>{}),$e=d.useCallback(p=>{const h=ct[p]?p:"default";Mr.current=h},[]),Nt=d.useCallback(()=>{const p=Mr.current;return ct[p]||ct.default},[]),Rn=d.useCallback(()=>{const p=Nt();return typeof p.window=="number"?p.window:ct.default.window},[Nt]),An=d.useCallback(()=>{const p=Nt();return typeof p.closingGrace=="number"?p.closingGrace:ct.default.closingGrace},[Nt]),kn=d.useCallback(()=>{const p=Nt(),h=Array.isArray(p.prompts)?p.prompts.filter(Boolean):[],j=ct.default.prompts.filter(Boolean),v=h.length?h:j;if(!v.length)return"";const R=ur.current,I=v.filter(k=>k!==R),H=Ss(I.length?I:v)||v[0];return ur.current=H,H},[Nt]),Re=d.useCallback(()=>{dr.current&&(clearTimeout(dr.current),dr.current=null)},[]),fr=d.useCallback((p,h)=>{if(h&&ct[h]){$e(h);return}const j=(p||"").toString().trim().toLowerCase();if(!j)return;if(/[?]\s*$/.test(j)||/(preferisci|vuoi|ti serve|posso|che ne pensi|hai bisogno)/.test(j)){$e("followUp");return}if(/(aggiunto|fatto|eccoti|ecco|ho trovato|dimmi se vuoi|quando sei pronto|se vuoi aggiungere)/.test(j)){$e("task");return}Mr.current!=="default"&&$e("default")},[$e]),ue=d.useRef(!1),Pn=d.useRef(!0),Ye=d.useRef(!1);d.useRef(!1);const lt=d.useRef(null),In=d.useRef(0),On=d.useCallback(()=>{try{if(A.current)return;const p=Date.now();if(p-In.current<2e3)return;const h=window.AudioContext||window.webkitAudioContext;lt.current||(lt.current=new h);const j=lt.current,v=j.createOscillator(),R=j.createGain();v.type="sine",v.frequency.setValueAtTime(880,j.currentTime),R.gain.setValueAtTime(1e-4,j.currentTime),R.gain.exponentialRampToValueAtTime(.2,j.currentTime+.01),v.connect(R).connect(j.destination),v.start(),R.gain.exponentialRampToValueAtTime(1e-4,j.currentTime+.15),v.stop(j.currentTime+.18),In.current=p}catch{}},[]),zn=d.useCallback(()=>{if("speechSynthesis"in window)try{if(ir.current){if(window.speechSynthesis.paused)try{window.speechSynthesis.resume()}catch{}return}ir.current=!0;const p=new SpeechSynthesisUtterance(" ");p.volume=0,p.rate=1,p.pitch=1,p.onend=()=>{try{window.speechSynthesis.cancel()}catch{}},window.speechSynthesis.speak(p)}catch(p){ir.current=!1,console.warn("Speech synthesis prime failed",p)}},[]),rt=d.useCallback(async()=>{var p;try{const h=window.AudioContext||window.webkitAudioContext;if(h&&(lt.current||(lt.current=new h),((p=lt.current)==null?void 0:p.state)==="suspended"&&await lt.current.resume(),jt.current&&jt.current.state==="suspended"&&await jt.current.resume()),typeof window.speechSynthesis<"u"){if(window.speechSynthesis.paused)try{window.speechSynthesis.resume()}catch{}zn()}}catch(h){ir.current=!1,console.warn("Audio pipeline resume failed",h)}},[zn]),Br=d.useCallback(async()=>{try{const p=window.AudioContext||window.webkitAudioContext;if(!p)return;jt.current||(jt.current=new p);const h=jt.current,j=await navigator.mediaDevices.getUserMedia({audio:!0});cr.current=j;const v=h.createMediaStreamSource(j),R=h.createAnalyser();R.fftSize=512,ao.current=R,v.connect(R);let I=0;const H=.02,k=12,ie=new Uint8Array(R.fftSize),le=()=>{R.getByteTimeDomainData(ie);let Q=0;for(let Je=0;Je<ie.length;Je++){const ke=(ie[Je]-128)/128;Q+=ke*ke}if(I=Math.sqrt(Q/ie.length)>H?I+1:0,I>=k){try{window.speechSynthesis.cancel()}catch{}Se.current=[],ze.current="",$t.current=!0,rr.current=!1,N(!1),ue.current=!1,c(!1),A.current=!1,X.current=!1,He(),J.current&&J.current();return}Dt.current=requestAnimationFrame(le)};Dt.current=requestAnimationFrame(le)}catch{}},[]),He=d.useCallback(()=>{try{Dt.current&&cancelAnimationFrame(Dt.current)}catch{}Dt.current=null;try{cr.current&&cr.current.getTracks().forEach(p=>p.stop())}catch{}cr.current=null},[]),Mt=d.useCallback((p=!1)=>{if(or&&!p){t(!1);return}if(Re(),Ve.current="",T.current)try{const h=T.current;T.current=null;try{h.onend=null}catch{}try{h.stop()}catch{}}catch{}t(!1)},[or,Re]);d.useEffect(()=>{ue.current=b},[b]),d.useEffect(()=>{Pn.current=E},[E]),d.useEffect(()=>{Ye.current=u},[u]),d.useEffect(()=>{A.current=a},[a]),d.useEffect(()=>{oo.current=r},[r]);const Fn=6e4,xo=15e3,Ln=d.useCallback(()=>{const p=["Ciao! Sono AIVA, la tua personal shopper AI. Come posso aiutarti oggi?","Benvenuto. Sono AIVA, qui per aiutarti a navigare tra le nostre collezioni. Cerchi ispirazione o hai già un'idea precisa?","Ciao! Sono AIVA, l'assistente AI pronta a trasformare la tua esperienza di shopping. Cosa posso fare per te?","Benvenuto nel nostro ecommerce. Sono AIVA, la tua personal shopper AI. Quali prodotti ti piacerebbe vedere?","Sono AIVA, la tua assistente allo shopping. Insieme possiamo scoprire le nuove collezioni o trovare esattamente ciò che desideri. Da dove vogliamo cominciare?","Benvenuto! Sono AIVA e sono qui per aiutarti a trovare l'outfit perfetto. Puoi dirmi cosa cerchi oppure chiedermi di mostrarti le ultime offerte."],h=["Eccomi di nuovo.","Rieccomi.","Bentornato.","Sono di nuovo qui. Dimmi pure.","Pronta a continuare. Hai trovato qualcosa che ti piace o cerchiamo altro?","Ok, continuiamo. Cosa facciamo ora?","Pronti a ripartire. Ti ascolto."],j=v=>!v||v.length===0?"":v[Math.floor(Math.random()*v.length)]||"";return F===0?(P(1),j(p)):j(h)},[F]);d.useEffect(()=>{je.current=B},[B]);const $n=d.useCallback(()=>{const p=window.speechSynthesis.getVoices(),h=[{name:"Google italiano",lang:"it-IT",gender:"female"},{name:"Alice",lang:"it-IT"},{name:"Elsa",lang:"it-IT"},{name:"Carla",lang:"it-IT"},{name:"Microsoft Elsa",lang:"it-IT"},{name:"Microsoft Cosimo",lang:"it-IT"},{lang:"it-IT",gender:"female"},{lang:"it-IT"},{lang:"it"}];for(const v of h){const R=p.find(I=>{var le;const H=I.lang.toLowerCase().startsWith(((le=v.lang)==null?void 0:le.toLowerCase())||"it"),k=!v.name||I.name.toLowerCase().includes(v.name.toLowerCase()),ie=!v.gender||I.name.toLowerCase().includes("female")||I.name.toLowerCase().includes("donna")||I.name.toLowerCase().includes("alice")||I.name.toLowerCase().includes("elsa")||I.name.toLowerCase().includes("carla");return H&&k&&ie});if(R)return console.log("🎤 Selected voice:",R.name,R.lang),nr.current=R,R}const j=p.find(v=>v.lang.toLowerCase().startsWith("it"));return j?(console.log("🎤 Fallback Italian voice:",j.name),nr.current=j,j):null},[]);d.useEffect(()=>{const p=()=>{$n()};return p(),window.speechSynthesis.onvoiceschanged!==void 0&&(window.speechSynthesis.onvoiceschanged=p),setTimeout(p,100),setTimeout(p,500),()=>{window.speechSynthesis.onvoiceschanged!==void 0&&(window.speechSynthesis.onvoiceschanged=null)}},[$n]);const pr=d.useCallback(p=>{const h=(p||"").split(new RegExp("(?<=[\\.!?])\\s+")).map(j=>j.trim()).filter(Boolean);return h.length?h:[(p||"").trim()].filter(Boolean)},[]),mr=d.useCallback((p,h)=>{const j=(h||"").trim();if(!j)return;const v=[...sr.current,{role:p,content:j}];sr.current=v.slice(-20)},[]),qn=d.useCallback(p=>{mr("user",p)},[mr]),Vr=d.useCallback(p=>{mr("assistant",p),fr(p)},[mr,fr]),me=d.useCallback(()=>{!ge()&&!ue.current&&Se.current.length===0&&(X.current=!1,c(!1),A.current=!1,je.current&&q.current.length===0&&J.current&&J.current())},[ge]),Hr=d.useCallback(async(p,h)=>{var j,v,R,I;if(console.log("🎯 Executing function:",p,h),f(!0),m(p),wt.current=Date.now(),T.current){try{T.current.stop()}catch(H){console.log("Could not stop recognition:",H.message)}t(!1)}try{switch(await new Promise(H=>setTimeout(H,300)),p){case"navigate_to_page":case"navigate":const k={home:"/",prodotti:"/products",products:"/products",offerte:"/offers",offers:"/offers",carrello:"/cart",cart:"/cart",checkout:"/checkout"}[h.page]||"/";console.log("📍 Navigating to:",k),z(k),ze.current="",$t.current=!1;const ie=k==="/cart"?Le("nav-cart",Tn,"Ecco il carrello."):k==="/offers"?Le("nav-offers",uo,"Ecco le offerte."):Le("nav-default",lo,"Ecco.");Y(ie||"Ecco!",()=>{c(!1),A.current=!1,X.current=!1,J.current&&J.current()},!1,{enqueue:!1}),Wr(1e3);break;case"search_products":const le=h.query||"",Q=h.filters||{};console.log("🔍 Searching:",le,"Filters:",Q);const We=!!Q.on_sale,Je=window.location.pathname;if(We){Je!=="/offers"&&z("/offers");try{window.dispatchEvent(new CustomEvent("offers-apply-filters",{detail:{filters:Q,query:le}}))}catch{}}else Je!=="/products"&&z("/products"),setTimeout(()=>{if(le){fe(le);const K=document.querySelector('input[placeholder="Cerca prodotti..."]');K&&(K.value=le,K.dispatchEvent(new Event("input",{bubbles:!0})))}Object.keys(Q).length>0&&(xe(Q),h.applyUIFilters!==!1&&Dn(Q))},500);Y(Le("search",fo,"Ecco i risultati."),()=>{c(!1),A.current=!1,X.current=!1,J.current&&J.current()},!1,{enqueue:!1});break;case"apply_ui_filters":console.log("🎨 Applying UI filters:",h.filters),window.applyProductFilters?window.applyProductFilters(h.filters||{}):Dn(h.filters||{}),Y(Le("filters",po,"Filtri applicati."),()=>{c(!1),A.current=!1,X.current=!1,J.current&&J.current()},!1,{enqueue:!1});break;case"get_product_details":const ke=h.product_id;console.log("📦 Showing product:",ke),z(`/products/${ke}`),Y(Le("product",mo,"Ecco la scheda."),()=>{c(!1),A.current=!1,X.current=!1,J.current&&J.current()},!1,{enqueue:!1});break;case"open_product_by_name":{const K=((h==null?void 0:h.name)||"").toLowerCase().trim(),se=(j=window.visibleProductsMap)==null?void 0:j[K];se?(z(`/products/${se}`),Wr(800)):(z("/products"),setTimeout(()=>{window.applyProductFilters&&window.applyProductFilters({query:h==null?void 0:h.name})},300),Wr(800));break}case"add_to_cart":{console.log("🛒 Adding to cart:",h);const K=(se="")=>{const M={nero:"nero",black:"nero",bianco:"bianco",white:"bianco","blu navy":"blu navy",navy:"blu navy","blu scuro":"blu navy",blu:"blu",azzurro:"azzurro",rosso:"rosso",borgogna:"bordeaux",bordeaux:"bordeaux","verde oliva":"verde oliva",oliva:"verde oliva",verde:"verde","grigio melange":"grigio melange",melange:"grigio melange",antracite:"grigio antracite",grigio:"grigio",beige:"beige",panna:"panna",crema:"panna",cammello:"cammello",marrone:"marrone",rosa:"rosa",giallo:"giallo",viola:"viola"},D=(se||"").toLowerCase(),Z=Object.keys(M).sort((ne,ae)=>ae.length-ne.length);for(const ne of Z)if(D.includes(ne))return M[ne];const V=D.split(/[\s/,-]+/).filter(Boolean);for(const ne of V)if(M[ne])return M[ne];return D||"nero"};try{const se=Sc(h.quantity??1,1),M=(h.size||"M").toUpperCase(),D=K(h.color||"nero");if(window.location.pathname.includes("/products/")){setTimeout(()=>{const ae=document.querySelectorAll("button");for(let ye of ae)if(ye.textContent.trim().toUpperCase()===M.toUpperCase()){ye.click();break}setTimeout(()=>{for(let ye of document.querySelectorAll("button"))if(ye.textContent.toLowerCase().includes(D.toLowerCase())){ye.click();break}},300)},200);const V=await Dr(),ne=V==null?void 0:V.product;if(ne){if(!await L(ne,M,D,se))throw new Error("Cart update rejected")}else{const ae={id:h.product_id||(V==null?void 0:V.id)||"550e8400-0001-41d4-a716-446655440001",name:h.product_name||(V==null?void 0:V.name)||"Prodotto",price:(V==null?void 0:V.price)||h.price||49.9,brand:(V==null?void 0:V.brand)||"Fashion Brand"};if(!await L(ae,M,D,se))throw new Error("Fallback cart update failed")}}else{const V={id:h.product_id||"550e8400-0001-41d4-a716-446655440001",name:h.product_name||"Prodotto",price:h.price||49.9,brand:"Fashion Brand"};if(!await L(V,M,D,se))throw new Error("Remote cart update failed")}Y(Le("cart-add",ho,"Aggiunto al carrello."),()=>{c(!1),A.current=!1,me()},!1,{enqueue:!1})}catch(se){console.error("Error adding to cart:",se),Y("Non sono riuscita ad aggiungerlo al carrello.",()=>{c(!1),A.current=!1,me()},!1,{enqueue:!1})}break}case"remove_from_cart":{const{item_id:K,product_name:se,size:M,color:D}=h||{};let Z=K;if(!Z&&se){const V=(ne=>(ne||"").toString().normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").toLowerCase().replace(/[^a-z0-9]+/g," ").trim())(`${se} ${M||""} ${D||""}`);Z=(v=window.cartItemsMap)==null?void 0:v[V]}console.log("🗑️ Removing from cart:",Z||K),Z?(await C(Z),Y(Le("cart-remove",go,"Rimosso dal carrello."))):Y("Non trovo quel prodotto nel carrello. Puoi ripetere il nome o dirmi la taglia e il colore?");break}case"remove_last_cart_item":console.log("🗑️ Removing last cart item"),await U();break;case"update_cart_quantity":console.log("📝 Updating quantity:",h),h.item_id&&h.quantity&&await W(h.item_id,h.quantity);break;case"get_cart_summary":case"view_cart":console.log("🛒 Opening cart"),z("/cart"),Y(Le("nav-cart",Tn,"Ecco il carrello."),()=>{c(!1),A.current=!1,X.current=!1,J.current&&J.current()},!1,{enqueue:!1});break;case"clear_cart":console.log("🗑️ Clearing cart"),await $(),Y(Le("cart-clear",yo,"Carrello svuotato."),()=>{c(!1),A.current=!1,X.current=!1,J.current&&J.current()},!1,{enqueue:!1});break;case"get_current_promotions":case"show_offers":console.log("🏷️ Showing offers"),z("/offers"),Y("Ecco le offerte.",()=>{c(!1),A.current=!1,X.current=!1,J.current&&J.current()},!1,{enqueue:!1});break;case"get_shipping_info":{console.log("🚚 Fetching shipping info");try{const K=await ni.getShippingInfo(),se=(K.shipping_zones||[]).find(ae=>(ae.zone||"").toLowerCase().includes("italia")||(ae.zone||"").toLowerCase().includes("penisola"))||((R=K.shipping_zones)==null?void 0:R[0]),M=(se==null?void 0:se.standard)||K.standard_shipping,D=(se==null?void 0:se.express)||K.express_shipping,Z=K.pickup_point,V=[];if(K.free_shipping_threshold!=null&&V.push(`spedizione gratuita sopra i €${Number(K.free_shipping_threshold).toFixed(2)}`),M){const ae=typeof M=="object"?M.price:M,ye=typeof M=="object"?M.delivery_window||M.delivery_time:K.delivery_time_standard;V.push(`standard a €${Number(ae).toFixed(2)} con consegna in ${ye||"pochi giorni"}`)}if(D){const ae=typeof D=="object"?D.price:D,ye=typeof D=="object"?D.delivery_window||D.delivery_time:K.delivery_time_express;V.push(`express a €${Number(ae).toFixed(2)} con arrivo in ${ye||"1-2 giorni"}`)}if(Z&&Z.enabled!==!1){const ae=Z.delivery_window||Z.delivery_time||"24 ore";V.push(`ritiro gratuito in boutique disponibile entro ${ae}`)}(I=K.saturday_delivery)!=null&&I.enabled&&V.push(`consegna il sabato a €${Number(K.saturday_delivery.price).toFixed(2)} su ${K.saturday_delivery.area}`);const ne=V.length?`Ecco le nostre opzioni di spedizione: ${V.join(", ")}.`:"Le nostre spedizioni sono attive, ma non riesco a recuperare tutti i dettagli in questo momento.";Y(ne,()=>{c(!1),A.current=!1,X.current=!1,J.current&&J.current()},!1,{enqueue:!1})}catch(K){console.error("Errore recuperando le spedizioni",K),Y("Non riesco a recuperare le informazioni di spedizione ora, riprova tra qualche istante.",()=>{c(!1),A.current=!1,X.current=!1,J.current&&J.current()},!1,{enqueue:!1})}break}case"get_recommendations":console.log("💡 Getting recommendations"),z("/products"),setTimeout(()=>{const K=new CustomEvent("show-recommendations");window.dispatchEvent(K)},300);break;case"close_conversation":console.log("👋 Closing conversation"),Ze();break;case"get_size_guide":try{const K=await At.getSizeGuide(h.category||"pantaloni"),se=[];for(const[M,D]of Object.entries(K))se.push(`${M}: ${Object.entries(D).map(([Z,V])=>`${Z}=${V}`).join(", ")}`);Y(`Ecco la guida taglie per ${h.category}: ${se.join(". ")}`,()=>{c(!1),A.current=!1,X.current=!1,J.current&&J.current()},!1,{enqueue:!1})}catch{Y("Non sono riuscita a recuperare la guida taglie al momento.",()=>{c(!1),A.current=!1,X.current=!1,J.current&&J.current()},!1,{enqueue:!1})}break;default:console.warn("❓ Unknown function:",p)}}catch(H){console.error("❌ Error executing function:",H),S("Errore nell'esecuzione del comando")}finally{setTimeout(()=>{f(!1),m(null),Ge(),!b&&!ge()&&(X.current=!1,c(!1),A.current=!1,je.current&&!Xe.current&&q.current.length===0&&Gr())},200)}},[z,L,C,$,U,W,fe,xe,b,Le,ge]),Ge=d.useCallback(()=>{if(Ye.current)return;const p=q.current.shift();p&&(Ye.current=!0,setTimeout(async()=>{try{await Hr(p.name,p.params)}finally{Ye.current=!1,q.current.length>0?Ge():je.current&&!ge()&&!ue.current&&!A.current&&J.current&&J.current()}},0))},[Hr,ge]),Dn=d.useCallback(p=>{console.log("🎨 Applying UI filters:",p),setTimeout(()=>{if(p.category){const h=document.querySelector("select");if(h){for(let j of h.options)if(j.value.toLowerCase()===p.category.toLowerCase()){h.value=j.value,h.dispatchEvent(new Event("change",{bubbles:!0}));break}}}if(p.price_range){const h=document.querySelectorAll("select")[1];h&&(p.price_range==="low-to-high"?h.value="price-low":p.price_range==="high-to-low"&&(h.value="price-high"),h.dispatchEvent(new Event("change",{bubbles:!0})))}ve(p)},300)},[ve]),Mn=d.useCallback(()=>{var se;if(!ar)return null;if(typeof navigator>"u"||!((se=navigator.mediaDevices)!=null&&se.getUserMedia))return console.warn("Media devices API not available for server STT fallback"),null;const p={start:null,result:null,error:null,end:null,audioend:null};let h=null,j=null,v=null,R=null,I=[],H=!1,k=Wt,ie=0,le=0;const Q=(M,D)=>{const Z=p[M];if(typeof Z=="function")try{Z(D)}catch(V){console.error(`Server STT listener ${M} failed`,V)}},We=async()=>{if(v){try{v.disconnect()}catch(M){console.warn("Processor disconnect failed",M)}v.onaudioprocess=null}if(R)try{R.disconnect()}catch{}if(h)try{await h.close()}catch{}j&&j.getTracks().forEach(M=>{try{M.stop()}catch{}}),h=null,j=null,v=null,R=null},Je=(M,D=0)=>{const Z={transcript:M,confidence:D},ne=[{0:Z,length:1,isFinal:!0,item:()=>Z}];return ne.item=ae=>ne[ae],{resultIndex:0,results:ne}},ke=async(M="stop",D=!0)=>{if(H)return;H=!0,qt.current.active=!1;const Z=I.slice();I=[];const V=k;if(await We(),Q("audioend"),!D||Z.length===0){D&&Z.length===0&&Q("error",{error:"no-speech"}),Q("end"),H=!1;return}try{const ne=gc(Z),ae=yc(ne,V,Wt),ye=xc(ae),ut=bc(ye.buffer);if(!ut)Q("error",{error:"no-speech"});else{const nt=await Ht.transcribeAudio({audio:ut,sampleRate:Wt,language:"it-IT",sessionId:De.current}),Ct=((nt==null?void 0:nt.text)||"").trim(),xr=typeof(nt==null?void 0:nt.confidence)=="number"?nt.confidence:0;Ct?Q("result",Je(Ct,xr)):Q("error",{error:"no-speech"})}}catch(ne){console.error("Server STT transcription error",ne),Q("error",{error:"network",message:(ne==null?void 0:ne.message)||"Errore nella trascrizione audio"})}Q("end"),H=!1},K={continuous:!1,interimResults:!0,lang:"it-IT",maxAlternatives:1,start:async()=>{if(qt.current.active)return;try{j=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0}})}catch(D){console.error("Microphone permission denied",D),Q("error",{error:(D==null?void 0:D.name)||"not-allowed",message:D==null?void 0:D.message}),Q("end");return}const M=window.AudioContext||window.webkitAudioContext;if(!M){Q("error",{error:"audio-context-unavailable"}),Q("end");return}try{if(h=new M,h.state==="suspended")try{await h.resume()}catch{}k=h.sampleRate||Wt,R=h.createMediaStreamSource(j),v=h.createScriptProcessor(4096,1,1),I=[],ie=Date.now(),le=ie,v.onaudioprocess=D=>{if(!qt.current.active)return;const Z=D.inputBuffer.getChannelData(0);I.push(new Float32Array(Z));let V=0;for(let ye=0;ye<Z.length;ye+=1){const ut=Z[ye];V+=ut*ut}const ne=Math.sqrt(V/Z.length),ae=Date.now();ne>.015?ie=ae:ae-ie>900&&I.length>4&&ke("silence"),ae-le>14e3&&ke("timeout")},R.connect(v),v.connect(h.destination),qt.current.active=!0,Q("start")}catch(D){console.error("Failed to init server STT pipeline",D),Q("error",{error:(D==null?void 0:D.name)||"unknown",message:D==null?void 0:D.message}),await We(),Q("end")}},stop:()=>ke("stop"),abort:()=>ke("abort",!1)};return Object.defineProperties(K,{onstart:{get:()=>p.start,set:M=>{p.start=M}},onresult:{get:()=>p.result,set:M=>{p.result=M}},onerror:{get:()=>p.error,set:M=>{p.error=M}},onend:{get:()=>p.end,set:M=>{p.end=M}},onaudioend:{get:()=>p.audioend,set:M=>{p.audioend=M}}}),K},[ar,Ht,De,qt]),hr=d.useCallback(()=>{if(ar)return Mn();if(!St())return null;const p=window.SpeechRecognition||window.webkitSpeechRecognition,h=new p;h.continuous=!1,h.interimResults=!0,h.lang="it-IT",h.maxAlternatives=1,h.onstart=()=>{if(console.log("🎤 Recognition started"),Re(),Ve.current="",t(!0),S(null),O(!0),wt.current=Date.now(),Xe.current=!1,!tt.current){const v=Rn();tt.current=setTimeout(()=>{if(!ue.current&&!A.current){const R=kn(),I=()=>{const H=An();Be.current=setTimeout(()=>{!ue.current&&!A.current&&Ze()},H)};R?Y(R,()=>{I()},!1,{enqueue:!1,listeningProfile:"default"}):I()}},v)}};const j=(v=!1)=>{Re();const R=Ve.current.trim();if(R){if(Ve.current="",console.log("💬 User said:",R),_n(),$r.current=null,lr.current=!1,x(R),gr(),typeof Ur.current=="function")try{Ur.current(R)}catch(I){console.error("Voice command dispatch failed",I)}if(v&&T.current)try{T.current.stop()}catch{}}};return h.onresult=v=>{if(!ue.current&&Pn.current){let R="",I="";for(let H=v.resultIndex;H<v.results.length;H++){const k=v.results[H][0].transcript;v.results[H].isFinal?R+=k:I+=k}I&&(x(I),tt.current&&(clearTimeout(tt.current),tt.current=null),Be.current&&(clearTimeout(Be.current),Be.current=null)),R&&(Ve.current=`${Ve.current} ${R}`.trim(),Re(),dr.current=setTimeout(()=>j(!0),co))}},h.onerror=v=>{v.error!=="aborted"&&v.error!=="no-speech"&&(Re(),Ve.current="",v.error==="network"?S("Errore di connessione. Riprova."):S(`Errore microfono: ${v.error}`),t(!1))},h.onend=()=>{console.log("🔚 Recognition ended"),j(!1),Re(),Ve.current="",t(!1),je.current&&!ue.current&&!Ye.current&&!Xe.current&&!A.current&&!ge()&&!X.current&&!Be.current&&q.current.length===0&&(rt(),setTimeout(()=>{je.current&&!ue.current&&!A.current&&!X.current&&!Be.current&&J.current&&J.current()},at?250:500))},h},[rt,at,kn,Rn,An,Re,St,Mn,ar]),Gr=d.useCallback(()=>{if(!(Xe.current||!je.current||ue.current||Ye.current||A.current||q.current.length>0||ge())){if($r.current||($r.current=`ls-${Date.now()}`,lr.current=!1),lr.current||(On(),lr.current=!0),Xe.current=!0,!or&&T.current){try{T.current.stop()}catch{}T.current=null}setTimeout(()=>{if(je.current&&!ue.current&&!Ye.current&&!A.current)try{if(T.current||(T.current=hr()),T.current)try{T.current.start()}catch(p){console.warn("Recognition restart failed",p)}}catch(p){console.error("Failed to restart:",p)}Xe.current=!1},220)}},[b,u,hr,On,or,ge]),Wr=d.useCallback((p=700)=>{setTimeout(()=>{je.current&&!Xe.current&&!ge()&&!ue.current&&!A.current&&q.current.length===0&&J.current&&J.current()},p)},[ge]);d.useEffect(()=>{J.current=Gr},[Gr]);const Ze=d.useCallback(()=>{if(console.log("🛑 Stopping assistant"),T.current){try{T.current.stop()}catch{}T.current=null}if(typeof window<"u"&&window.speechSynthesis)try{window.speechSynthesis.cancel()}catch{}et(),Se.current=[],Fe.current&&(clearTimeout(Fe.current),Fe.current=null),_e.current="",yt.current=!1,Oe.current&&(clearTimeout(Oe.current),Oe.current=null),_n(),Re(),Ve.current="",ur.current="",typeof He=="function"&&He(),t(!1),N(!1),f(!1),c(!1),re(!1),O(!0),je.current=!1,Xe.current=!1,q.current=[],X.current=!1,c(!1),A.current=!1,sr.current=[],Me.current="",vt.current="",qr.current={},$e("default"),console.log("✅ Assistant stopped")},[Re,$e,et]),gr=d.useCallback(()=>{wt.current=Date.now(),Oe.current&&clearTimeout(Oe.current),je.current&&(Oe.current=setTimeout(()=>{Date.now()-wt.current>=Fn?(console.log("⏰ Inactivity timeout reached"),Y("Sono ancora qui se hai bisogno. Dì qualcosa o chiuderò la conversazione.",()=>{setTimeout(()=>{Date.now()-wt.current>=Fn+1e4&&Ze()},1e4)})):gr()},xo))},[Ze]);window.__AIVA_SINGLETON__||(window.__AIVA_SINGLETON__={ws:null,listeners:new Set,queue:[],lastFnSigTs:new Map});const Ae=window.__AIVA_SINGLETON__;d.useEffect(()=>{if(Ae.ws&&Ae.ws.readyState===WebSocket.OPEN)console.log("🔌 WebSocket reusing existing connection"),n(!0),be.current=Ae.ws;else{const h=()=>{try{const j=si(De.current);Ae.ws=j,j.onopen=()=>{if(console.log("🔌 WebSocket connected"),n(!0),be.current=j,Ae.queue&&Ae.queue.length){for(const v of Ae.queue)try{j.send(JSON.stringify(v))}catch{}Ae.queue=[]}},j.onmessage=v=>{try{const R=JSON.parse(v.data);Ae.listeners.forEach(I=>I(R))}catch(R){console.error("Parse error:",R)}},j.onerror=v=>{console.error("WebSocket error:",v)},j.onclose=()=>{console.log("WebSocket disconnected"),n(!1),be.current=null,Ae.ws=null;let v=0;(()=>{if(v>=5)return;v+=1;const I=Math.min(1e3*Math.pow(2,v),1e4);setTimeout(()=>{h()},I)})()}}catch(j){console.error("Connection failed:",j)}};h()}const p=h=>{if(pe.current)try{pe.current(h)}catch(j){console.error(j)}};return Ae.listeners.add(p),()=>{Ae.listeners.delete(p)}},[]);const bo=p=>(p||"").replace(/```[\s\S]*?```/g," ").replace(/`[^`]*`/g," ").replace(/[\*_~>#-]+/g," ").replace(/\[(.*?)\]\((.*?)\)/g,"$1").replace(/\b\d+\s+(pezzi?|in\s+magazzino|disponibili)\b[^,.]*[.,]?/gi,"").replace(/(\btaglia\b[^.]*?)\s*(,\s*)?\b\d+\b[^.]*\./gi,"$1.").replace(/\bXXXL\b/gi,"ics ics ics elle").replace(/\bXXL\b/gi,"ics ics elle").replace(/\bXL\b/gi,"ics elle").replace(/\bXXS\b/gi,"ics ics esse").replace(/\bXS\b/gi,"ics esse").replace(/vuoi[^.?!]*(taglie|colori|materiali)[^.?!]*[.?!]/gi," ").replace(/\s{2,}/g," ").trim(),Un=d.useCallback(async()=>{if(!Ue)return null;const p=window.AudioContext||window.webkitAudioContext;if(!p)return null;Lr.current||(Lr.current=new p);const h=Lr.current;if(h.state==="suspended")try{await h.resume()}catch(j){console.warn("Unable to resume TTS audio context",j)}return h},[Ue]),et=d.useCallback(()=>{var p,h;if(it.current){try{it.current.onended=null,it.current.stop(),(h=(p=it.current).disconnect)==null||h.call(p)}catch(j){console.warn("Failed to stop server TTS source",j)}it.current=null}Lt.current=!1,bt.current=[],N(!1),ue.current=!1,He()},[He]),Bn=d.useCallback(async()=>{if(!Lt.current&&bt.current.length!==0){for(Lt.current=!0,rt(),Mt(),N(!0),ue.current=!0,O(!1),Nn.current=!0,Br();bt.current.length>0;){const p=bt.current[0];try{const h=await Ht.synthesizeSpeech({text:p.text,voice:p.voice,sessionId:De.current}),j=h==null?void 0:h.audio;if(!j)throw new Error("tts-empty-response");const v=wc(j),R=await Un();if(!R)throw new Error("audio-context-unavailable");const I=await new Promise((H,k)=>{const ie=v.slice(0);R.decodeAudioData(ie,H,k)});await new Promise(H=>{const k=R.createBufferSource();k.buffer=I,k.connect(R.destination),it.current=k,k.onended=()=>{it.current=null,H()},k.start(0)}),typeof p.onEnd=="function"&&p.onEnd()}catch(h){console.error("Server TTS playback error",h);const j=jn.current;if(typeof window<"u"&&window.speechSynthesis&&typeof j=="function")try{j(p.text,p.onEnd,p.immediate,{enqueue:p.enqueue,listeningProfile:p.listeningProfile,forceBrowser:!0})}catch(R){console.error("Browser TTS fallback failed",R),typeof p.onEnd=="function"&&p.onEnd(h)}else typeof p.onEnd=="function"&&p.onEnd(h)}bt.current.shift()}He(),N(!1),ue.current=!1,Lt.current=!1,xt.current&&(xt.current=!1),me()}},[Un,me,rt,Mt,Br,He,Ht]),yr=d.useCallback((p,h,j=!1,v={})=>{const R={text:p,onEnd:h,voice:(v==null?void 0:v.voice)||null,enqueue:(v==null?void 0:v.enqueue)??!1,listeningProfile:(v==null?void 0:v.listeningProfile)||null,immediate:j};j&&et(),bt.current.push(R),Bn()},[Bn,et]),Y=d.useCallback((p,h,j=!1,v={})=>{const{enqueue:R=!1,listeningProfile:I,forceBrowser:H=!1}=v||{},k=bo(p);if(fr(k,I),En&&!H){yr(k,h,j,{voice:I,enqueue:R,listeningProfile:I});return}if((typeof window>"u"||!window.speechSynthesis)&&!H){yr(k,h,j,{voice:I,enqueue:R,listeningProfile:I});return}try{if(rt(),Mt(),N(!0),ue.current=!0,j){try{window.speechSynthesis.cancel()}catch{}Se.current=[]}if((R?pr(k):[k]).forEach(le=>{if(!le)return;const Q=new SpeechSynthesisUtterance(le);Q.lang="it-IT",Q.rate=1,Q.pitch=1.1,Q.volume=.9,nr.current&&(Q.voice=nr.current),Q.onstart=()=>{N(!0),ue.current=!0,O(!1),Nn.current=!0,Fe.current&&(clearTimeout(Fe.current),Fe.current=null),Br()},Q.onend=()=>{if(Se.current.shift(),Se.current.length>0){const We=Se.current[0];try{We&&window.speechSynthesis.speak(We)}catch{}}Se.current.length===0&&(He(),N(!1),ue.current=!1,xt.current&&(xt.current=!1,me()),typeof h=="function"&&h())},Se.current.push(Q)}),!window.speechSynthesis.speaking){const le=Se.current[0];le&&window.speechSynthesis.speak(le)}Fe.current||(Fe.current=setTimeout(()=>{!window.speechSynthesis.speaking&&Se.current.length===0&&(N(!1),ue.current=!1,me())},1500))}catch(ie){console.error("Browser TTS failed, switching to server fallback",ie),H?typeof h=="function"&&h(ie):yr(k,h,!0,{voice:I,enqueue:R,listeningProfile:I})}},[fr,yr,me,rt,Mt,pr,En]);d.useEffect(()=>{jn.current=Y},[Y]);const Ut=d.useCallback((p=!1)=>{const h=(_e.current||"").replace(/\s+/g," ").trim();if(!h)return!1;const j=pr(h);if(!j.length)return!1;const v=[];let R=!1;return j.forEach((I,H)=>{const k=I.trim();if(!k)return;const ie=/[\.!?…:]\s*$/.test(k);p||ie||k.length>160?(Y(k,()=>{},!1,{enqueue:!0}),R=!0,yt.current=!0):v.push(k)}),_e.current=v.join(" "),R},[pr,Y]),Vn=d.useCallback(p=>{var h,j;if(je.current){if(console.log("📨 WebSocket message:",p.type),$t.current&&p.type!=="processing_start"){console.log("⏭️ Dropped stale WS message:",p.type);return}switch(i(v=>[...v,p]),wt.current=Date.now(),p.type){case"processing_start":{c(!0),A.current=!0,O(!1),ce.current=!1,Mt(),ze.current="",_e.current="",yt.current=!1,Me.current="",vt.current="",$t.current=!1;break}case"function_start":break;case"stream_start":{ze.current="",_e.current="",yt.current=!1,Me.current="",rr.current=!0,xt.current=!1;break}case"text_chunk":{if(typeof p.content=="string"){const v=(p.content||"").trim();v&&(Me.current=`${Me.current} ${v}`.trim(),ze.current=`${ze.current} ${v}`.trim(),_e.current=`${_e.current} ${v}`.trim(),Ut(!1)&&(ce.current=!0))}break}case"stream_complete":{Ut(!0)&&(ce.current=!0),rr.current=!1,xt.current=!0,ze.current="",_e.current="",!ge()&&Se.current.length===0&&(c(!1),A.current=!1,me());break}case"function_complete":{const R=((k,ie)=>{try{return`${k}:${JSON.stringify(ie)}`}catch{return`${k}:<unserializable>`}})(p.function,p.parameters||{}),I=Date.now(),H=(((h=window.__AIVA_SINGLETON__)==null?void 0:h.lastFnSigTs)||new Map).get(R)||0;if(window.__AIVA_SINGLETON__){if(I-H<1500)break;window.__AIVA_SINGLETON__.lastFnSigTs.set(R,I)}if(c(!1),A.current=!1,p.function&&p.parameters){const k=(Cn.current||"").toLowerCase();if(/(carrello|svuota|rimuovi|togli|elenca|prodotti nel carrello)/.test(k)&&p.function==="navigate_to_page"&&((j=p.parameters)==null?void 0:j.page)==="prodotti")break;if(/^(sì|si|ok|va bene|perfetto|d'accordo|come no|certo|ottimo|grazie|no grazie|basta cos[ìi]|tutto ok|tutto bene|va benissimo|benissimo)[!.\s]*$/.test(k.trim())&&["navigate_to_page","navigate","search_products","get_product_details"].includes(p.function)){console.log("⏭️ Ignoro funzione non richiesta dopo conferma breve");break}q.current.push({name:p.function,params:p.parameters})}else Y("Ok. Puoi ripetere la richiesta con qualche dettaglio in più?",()=>{X.current=!1,me()},!1,{enqueue:!1});break}case"response":{if(p.message){const v=(p.message||"").trim();if(v){Me.current||(Me.current=v);const R=p.streamed?Me.current:v;R&&vt.current!==R&&(Vr(R),vt.current=R),p.streamed?Ut(!0)&&(ce.current=!0):(c(!0),A.current=!0,ce.current=!0,Y(v,()=>{c(!1),A.current=!1,me()},!1,{enqueue:!1}))}}break}case"complete":{if(Ut(!0)&&(ce.current=!0),p.message){const R=(p.message||"").trim();R&&(Me.current||(Me.current=R),vt.current!==R&&(Vr(R),vt.current=R),!yt.current&&!p.streamed&&(ce.current=!0,Y(R,()=>{c(!1),A.current=!1,me()},!1,{enqueue:!1})))}else!rr.current&&Se.current.length===0&&!ge()?(c(!1),A.current=!1,me()):(Fe.current&&clearTimeout(Fe.current),Fe.current=setTimeout(()=>{c(!1),A.current=!1,me()},1500));q.current.length>0&&!Ye.current&&Ge();break}case"error":{if(typeof window<"u"&&window.speechSynthesis)try{window.speechSynthesis.cancel()}catch{}et(),Se.current=[],N(!1),ue.current=!1,c(!1),A.current=!1,X.current=!1,_e.current="",yt.current=!1,S(p.message||"Errore"),me();break}}}},[Y,Hr,Ze,Vr,Ut,me,ge,et]);d.useEffect(()=>{pe.current=Vn},[Vn]);const Hn=d.useCallback(async p=>{var h;try{if((p==null?void 0:p.type)==="voice_command"){const j=await Ht.processVoiceCommand(p.text,p.context,(h=p.context)==null?void 0:h.session_id),v=Array.isArray(j==null?void 0:j.events)?j.events:[];if(v.length===0){pe.current&&pe.current({type:"error",message:"Risposta vuota dal server vocale"});return}for(const R of v)try{pe.current&&pe.current(R)}catch{}}}catch(j){console.error("HTTP voice command failed",j),pe.current&&pe.current({type:"error",message:"Errore richiesta voce"})}},[]),Gn=d.useCallback(async p=>{var h,j,v,R,I,H;if(p.trim()){Cn.current=p,$e("task");try{if(ue.current||ge()){if(typeof window<"u"&&window.speechSynthesis)try{window.speechSynthesis.cancel()}catch{}et(),typeof He=="function"&&He(),Se.current=[],ze.current="",$t.current=!0,X.current=!1,c(!1),A.current=!1,N(!1),ue.current=!1}if(X.current||A.current){console.log("🔒 Ignoro comando: turno in corso"),J.current&&J.current();return}if(Be.current){console.log("⏳ Ignoro comando: chiusura in corso");return}X.current=!0;const k=p.toLowerCase(),ie=/(apri|mostra|vai|portami).*(il\s+)?carrello|^carrello$/,le=/(apri|mostra|vai|portami).*(offerte|in offerta|sconti)|^(offerte|sconti|saldi)$/,Q=/(torna|vai).*(home|pagina iniziale)|^home$/,We=/((apri|mostra|vai|portami).*(pagina\s+)?prodotti(?!.*carrello))|^tutti i prodotti$|^prodotti$|^catalogo$|^mostra tutto$|^mostrami tutto$/,Je=[/descrivimi/i,/descrivilo/i,/descrivila/i,/descriv[iy]/i,/descrizione/i,/dettagli/i,/informazioni?(?: sul| del)? prodotto/i,/leggi .*descrizione/i,/dimmi .*descrizione/i,/mostra .*descrizione/i],ke=/(elenca|leggi|dimmi|quali|mostra).*(prodotti|articoli).*(nel\s+)?carrello|cosa.*(c\s'?|è|ho).*(nel\s+)?carrello/,K=/(svuota|svuotare|svuotalo|svuotami|rimuovi|togli|cancella).*(tutti|tutto)?.*(prodotti|articoli)?.*(dal\s+)?carrello/,se=/(?:mostra|apri).*(?:il\s+)?prodotto\s+(.+)/,M=(te="")=>te.toString().normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").toLowerCase().replace(/[^a-z0-9]+/g," ").trim(),D=/(aggiungi|metti|mettilo|mettila).*(nel\s+)?carrello(?::|\s|\,)*(?:.*?(taglia)\s+([xslm]{1,3}|xs|xxs|xl|xxl|s|m|l))?(?:.*?(colore)\s+([a-zà-ù\s]+))?/i,Z={xs:"XS",xxs:"XXS",s:"S",m:"M",l:"L",xl:"XL",xxl:"XXL"},V={nero:"nero",black:"nero",bianco:"bianco",white:"bianco",blu:"blu","blu navy":"blu navy",navy:"blu navy","blu scuro":"blu navy",azzurro:"azzurro",rosso:"rosso",borgogna:"bordeaux",bordeaux:"bordeaux",verde:"verde","verde oliva":"verde oliva",oliva:"verde oliva",grigio:"grigio","grigio melange":"grigio melange",melange:"grigio melange",antracite:"grigio antracite",beige:"beige",panna:"panna",crema:"panna",cammello:"cammello",rosa:"rosa",marrone:"marrone",giallo:"giallo",viola:"viola"},ne={uno:1,una:1,un:1,due:2,tre:3,quattro:4,cinque:5,sei:6,sette:7,otto:8,nove:9,dieci:10},ae=(te="")=>{const ee=te.normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").toLowerCase().trim(),he=Object.keys(V).sort((de,Pe)=>Pe.length-de.length);for(const de of he)if(ee.includes(de))return V[de];return ee||void 0},ye=(te="")=>{const ee=te.normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").toLowerCase();if(!ee)return[];const he=Object.keys(V).sort((Ne,st)=>st.length-Ne.length),de=[];let Pe=ee;for(const Ne of he)if(Pe.includes(Ne)){const st=V[Ne];de.includes(st)||de.push(st),Pe=Pe.replace(Ne," ")}return de},ut=(te="")=>{const ee=te.normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").toLowerCase(),he=ee.match(/(?:aggiungi|aggiungine|metti|mettimene|mettil[oa])(.*)/),de=he?he[1]:ee,Pe=de.match(/(\d{1,2})\s*(?:pezzi|articoli|prodotti|paia|capi)?/);if(Pe){const Ne=parseInt(Pe[1],10);if(!Number.isNaN(Ne))return Ne}for(const[Ne,st]of Object.entries(ne))if(new RegExp(`\\b${Ne}\\b`,"i").test(de))return st;return null};if(ie.test(k)){X.current=!0,c(!0),A.current=!0,q.current.push({name:"get_cart_summary",params:{}}),Ge();return}if(ke.test(k)){X.current=!0,c(!0),A.current=!0;const te=ic(6);Y(te,()=>{c(!1),A.current=!1,X.current=!1,me()},!1,{enqueue:!1});return}if(le.test(k)){X.current=!0,c(!0),A.current=!0,q.current.push({name:"show_offers",params:{}}),Ge();return}if(Q.test(k)){X.current=!0,c(!0),A.current=!0,q.current.push({name:"navigate_to_page",params:{page:"home"}}),Ge();return}if(K.test(k)){X.current=!0,c(!0),A.current=!0,q.current.push({name:"clear_cart",params:{}}),Ge();return}if(We.test(k)){X.current=!0,c(!0),A.current=!0,q.current.push({name:"navigate_to_page",params:{page:"prodotti"}}),Ge();return}if((()=>{var te;return(te=window.currentProductContext)!=null&&te.description_text?!!(Je.some(ee=>ee.test(k))||k.includes("descrizione")&&(k.includes("prodotto")||k.includes("articolo"))||k.includes("descrivi")&&(k.includes("prodotto")||k.includes("articolo"))):!1})()){X.current=!0,c(!0),A.current=!0;try{const te=await Dr(),ee=te&&typeof te=="object"?te:window.currentProductContext||{};let he=ee==null?void 0:ee.description_text;if(!he&&(ee!=null&&ee.product)){const Ne=ln(ee,ee.product);window.currentProductContext=Ne,he=Ne.description_text}const de=(ee==null?void 0:ee.name)||((h=ee==null?void 0:ee.product)==null?void 0:h.name)||"prodotto",Pe=he?`${de}. ${he}`.slice(0,900):`Non riesco a trovare ulteriori dettagli su ${de}. Posso aiutarti in altro modo?`;Y(Pe,()=>{c(!1),A.current=!1,me()},!1,{enqueue:!1})}catch(te){console.error("Errore descrizione prodotto:",te),Y("Non sono riuscita a recuperare la descrizione del prodotto.",()=>{c(!1),A.current=!1,me()},!1,{enqueue:!1})}return}if(D.test(p)&&((j=window.currentProductContext)!=null&&j.id)){const te=p.match(D),ee=((te==null?void 0:te[3])||"").toLowerCase(),he=((te==null?void 0:te[4])||"").toLowerCase(),de=Array.isArray((v=window.currentProductContext)==null?void 0:v.variants)?window.currentProductContext.variants:[],Pe=((R=de[0])==null?void 0:R.size)||"M",Ne=((I=de[0])==null?void 0:I.color)||"nero",st=(Z[ee]||Pe||"M").toUpperCase(),Jr=ye(he),vo=new Set(de.map(Qr=>(Qr.color||"").toLowerCase()));let So=Jr.find(Qr=>vo.has(Qr.toLowerCase()))||Jr[0]||ae(he)||Ne||"nero";const jo=ut(p),No=Math.min(10,Math.max(1,jo||1));X.current=!0,c(!0),A.current=!0,q.current.push({name:"add_to_cart",params:{product_id:window.currentProductContext.id,size:st,color:So,quantity:No}}),Ge();return}const Ct=k.match(se);if(Ct&&Ct[1]){const te=M(Ct[1]),ee=window.visibleProductsMap||{};let he=null;if(ee[te])he=ee[te];else for(const de of Object.keys(ee))if(de.includes(te)){he=ee[de];break}if(he){X.current=!0,c(!0),A.current=!0,q.current.push({name:"get_product_details",params:{product_id:he}}),Ge();return}}const xr=k.trim();if(/(basta|chiudi|puoi andare|stop|non.*altro|alla prossima|ci sentiamo|puoi riposarti)/i.test(k)||/^(grazie( mille)?( di tutto)?(,? (ciao|a presto|alla prossima|buona giornata|buona serata))?|ti ringrazio(,? (ciao|a presto|alla prossima|buona giornata|buona serata))?)$/.test(xr)||/^ciao(?:\s+(?:e\s+)?(grazie|alla prossima|per ora|ti ringrazio|a presto|buona serata|buona giornata).*)$/.test(xr)){Y("Perfetto, alla prossima!",()=>Ze());return}i(te=>[...te,{type:"user",text:p,timestamp:new Date().toISOString()}]),x(""),Hn({type:"voice_command",text:p,context:{session_id:De.current,timestamp:new Date().toISOString(),current_page:window.location.pathname,cart_count:((H=window.cartSnapshot)==null?void 0:H.length)??Ie.getState().cartCount,cart:window.cartSnapshot||[],cart_items_map:window.cartItemsMap||{},preferences:Ie.getState().preferences,session_count:F,current_product:window.currentProductContext||null,visible_products:window.visibleProductIds||[],visible_products_map:window.visibleProductsMap||{},ui_filters:{q:window.productsSearchQuery||"",category:window.productsSelectedCategory||""},history:sr.current.slice(-12)}}),qn(p)}catch(k){console.error("Voice command handling error:",k),c(!1),A.current=!1,X.current=!1,me()}}},[Hn,F,Y,Ze,qn,me,Dr,$e,ge,et]);d.useEffect(()=>{Ur.current=Gn},[Gn]);const wo=d.useCallback(async()=>{if(console.log("🎤 Toggle listening:",e,"Active:",B),!St()){S("Browser non supporta il riconoscimento vocale");return}if(S(null),e||B)Ze();else{console.log("▶️ Starting assistant"),re(!0),je.current=!0,Xe.current=!1,$e("default"),ur.current="",Ve.current="",Re(),gr();try{if((await navigator.mediaDevices.getUserMedia({audio:!0})).getTracks().forEach(j=>j.stop()),await rt(),T.current||(T.current=hr()),T.current)try{T.current.start()}catch(j){console.warn("Initial recognition start failed",j)}const h=Ln();Y(h,()=>{setTimeout(()=>{je.current&&!A.current&&!Ye.current&&!ge()&&J.current&&J.current()},250)},!0,{enqueue:!1}),X.current=!1}catch(p){console.error("Microphone error:",p),S("Permessi microfono negati"),re(!1),je.current=!1}}},[e,B,hr,Y,Ln,Ze,gr,rt,$e,Re,ge]);return d.useEffect(()=>()=>{T.current&&T.current.stop(),typeof window<"u"&&window.speechSynthesis&&window.speechSynthesis.cancel(),et(),be.current&&be.current.close(),Oe.current&&clearTimeout(Oe.current)},[]),{isListening:e,isConnected:r,messages:o,isProcessing:a,isExecutingFunction:u,currentFunction:l,error:w,transcript:y,isSpeaking:b,isUserTurn:E,isAssistantActive:B,toggleListening:wo,clearError:()=>S(null),browserSupportsSpeechRecognition:St()}},Nc=({isListening:e,isConnected:t,error:r,onToggleListening:n,browserSupportsSpeechRecognition:o,isAssistantActive:i})=>{const[a,c]=d.useState(!1),u=()=>{if(!o){console.warn("Speech recognition not supported"),alert("Il riconoscimento vocale non è disponibile nel tuo browser. Prova con Chrome o Edge per la migliore esperienza.");return}n()},l=r?{bg:"bg-gradient-to-r from-red-500 to-red-600",pulse:!1,icon:Go,tooltip:"Errore - Clicca per riprovare"}:i?e?{bg:"bg-gradient-to-r from-blue-500 to-purple-500",pulse:!0,icon:_t,tooltip:"In ascolto - Clicca per fermare"}:{bg:"bg-gradient-to-r from-purple-500 to-pink-500",pulse:!1,icon:As,tooltip:"AIVA attiva - Clicca per chiudere"}:{bg:"bg-gradient-to-r from-blue-600 to-purple-600",pulse:!1,icon:_t,tooltip:"Attiva AIVA - Il tuo Personal Shopper AI"};return s.jsxs(_.div,{className:"fixed bottom-4 right-4 md:bottom-8 md:right-8 z-[120] pointer-events-auto",style:{bottom:"calc(env(safe-area-inset-bottom, 0px) + 1rem)",right:"calc(env(safe-area-inset-right, 0px) + 1rem)"},initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},transition:{delay:.5,type:"spring",stiffness:260,damping:20},children:[s.jsxs(_.button,{onClick:u,onHoverStart:()=>c(!0),onHoverEnd:()=>c(!1),className:`relative group ${l.bg} p-6 rounded-full shadow-2xl text-white overflow-hidden`,whileHover:{scale:1.1},whileTap:{scale:.95},disabled:!1,children:[s.jsx(_.div,{className:"absolute inset-0 bg-gradient-to-r from-pink-500 via-purple-500 to-blue-500",animate:{backgroundPosition:l.pulse?["0% 50%","100% 50%","0% 50%"]:["0% 50%"]},transition:{duration:2,repeat:l.pulse?1/0:0,ease:"linear"},style:{backgroundSize:"200% 200%"}}),l.pulse&&s.jsxs(s.Fragment,{children:[s.jsx(_.span,{className:"absolute inset-0 rounded-full border-4 border-white",animate:{scale:[1,2.2],opacity:[.6,0]},transition:{duration:1.5,repeat:1/0,ease:"easeOut"}}),s.jsx(_.span,{className:"absolute inset-0 rounded-full border-4 border-white",animate:{scale:[1,2.2],opacity:[.6,0]},transition:{duration:1.5,repeat:1/0,ease:"easeOut",delay:.5}})]}),s.jsx(_.div,{className:"relative z-10",animate:{rotate:l.pulse?[0,10,-10,0]:0,scale:i?[1,1.1,1]:1},transition:{duration:.8,repeat:l.pulse?1/0:0},children:s.jsx(l.icon,{size:28})}),a&&t&&s.jsx(_.div,{className:"absolute -top-1 -right-1",initial:{scale:0},animate:{scale:1},exit:{scale:0},children:s.jsx(Jt,{className:"text-yellow-300",size:20})})]}),s.jsx(Xt,{children:a&&s.jsxs(_.div,{initial:{opacity:0,y:10,scale:.9},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:10,scale:.9},className:"absolute bottom-full mb-3 right-0 bg-gray-900 text-white text-sm py-2 px-4 rounded-lg whitespace-nowrap max-w-xs",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Jt,{size:16,className:"text-yellow-300 flex-shrink-0"}),s.jsx("span",{children:l.tooltip})]}),s.jsx("div",{className:"absolute bottom-0 right-8 transform translate-y-1/2 rotate-45 w-2 h-2 bg-gray-900"})]})}),s.jsx("div",{className:`absolute bottom-1 right-1 w-3 h-3 rounded-full border-2 border-white ${t?"bg-green-400":"bg-yellow-400"}`,title:t?"Connesso":"In connessione..."}),r&&s.jsx(_.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"absolute bottom-full mb-2 right-0 bg-red-500 text-white text-sm py-2 px-4 rounded-lg whitespace-nowrap max-w-xs",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(kt,{size:16}),s.jsx("span",{children:r})]})})]})},Cc=({cartItemsCount:e})=>{const[t,r]=d.useState(!1),n=_(Tr),o=[{id:"products",label:"Prodotti",icon:"📦",path:"/products"},{id:"offers",label:"Offerte",icon:"🏷️",path:"/offers"},{id:"cart",label:"Carrello",icon:"🛒",path:"/cart",badge:e}];return s.jsxs(_.nav,{className:"sticky top-0 z-40 bg-white shadow-sm",initial:{y:-100},animate:{y:0},transition:{type:"spring",stiffness:100},children:[s.jsx("div",{className:"max-w-7xl mx-auto px-4",children:s.jsxs("div",{className:"flex items-center justify-between h-16",children:[s.jsxs("div",{className:"flex items-center gap-8",children:[s.jsx(n,{to:"/",className:"text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-purple-600 cursor-pointer select-none",whileHover:{scale:1.05},style:{userSelect:"none",WebkitUserSelect:"none"},children:"AIVA Fashion"}),s.jsx("div",{className:"hidden md:flex items-center gap-6",children:o.map(i=>s.jsx(Wn,{to:i.path,className:({isActive:a})=>`text-gray-700 hover:text-blue-600 transition ${a?"text-blue-600 font-semibold":""}`,children:i.label},i.id))})]}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("button",{className:"p-2 text-gray-600 hover:text-blue-600",children:s.jsx(Rs,{size:20})}),s.jsx("button",{className:"p-2 text-gray-600 hover:text-blue-600",children:s.jsx(Vo,{size:20})}),s.jsxs(Tr,{to:"/cart",className:"relative p-2 text-gray-600 hover:text-blue-600",children:[s.jsx(_r,{size:20}),e>0&&s.jsx(_.span,{initial:{scale:0},animate:{scale:1},className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center",children:e})]}),s.jsx("button",{onClick:()=>r(!t),className:"md:hidden p-2 text-gray-600",children:t?s.jsx(kt,{size:20}):s.jsx(Ho,{size:20})})]})]})}),s.jsx(Xt,{children:t&&s.jsx(_.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"md:hidden bg-white border-t",children:s.jsx("div",{className:"px-4 py-4 space-y-2",children:o.map(i=>s.jsxs(Wn,{to:i.path,className:({isActive:a})=>`block py-2 px-3 rounded-lg text-gray-700 hover:text-blue-600 hover:bg-blue-50 ${a?"text-blue-600 font-semibold bg-blue-50":""}`,onClick:()=>r(!1),children:[s.jsx("span",{className:"mr-2",children:i.icon}),i.label,i.badge>0&&s.jsx("span",{className:"ml-2 bg-red-500 text-white text-xs rounded-full px-2 py-1",children:i.badge})]},i.id))})})})]})},Ec=()=>{const e=()=>{try{window.scrollTo({top:0,behavior:"smooth"})}catch{}};return s.jsxs("footer",{className:"bg-gray-900 text-gray-300 py-12 px-4",children:[s.jsxs("div",{className:"max-w-7xl mx-auto grid md:grid-cols-3 gap-8",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-white font-bold text-xl mb-4",children:"AIVA Fashion"}),s.jsx("p",{className:"text-sm",children:"Concept interattivo per portfolio – non è un e‑commerce reale."})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"text-white font-semibold mb-4",children:"Info"}),s.jsx("p",{className:"text-sm leading-6",children:"Questo sito è un progetto dimostrativo creato da Michele Miranda per mostrare integrazione tra assistente vocale, AI e interfaccia e‑commerce. I prodotti, i prezzi e le promozioni hanno scopo illustrativo."})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"text-white font-semibold mb-4",children:"Shop"}),s.jsxs("ul",{className:"space-y-2 text-sm",children:[s.jsx("li",{children:s.jsx(Tr,{to:"/products",className:"hover:text-white transition",children:"Prodotti"})}),s.jsx("li",{children:s.jsx(Tr,{to:"/offers",className:"hover:text-white transition",children:"Offerte"})}),s.jsx("li",{children:s.jsx("button",{onClick:e,className:"hover:text-white transition",children:"Torna Su"})})]})]})]}),s.jsx("div",{className:"max-w-7xl mx-auto mt-8 pt-8 border-t border-gray-800 text-center text-sm",children:s.jsx("p",{children:"© 2025 AIVA Fashion – Concept per il portfolio di Michele Miranda"})})]})};function Tc(){const e=To(),{cartCount:t}=zt(),{isListening:r,isConnected:n,messages:o,isProcessing:i,isExecutingFunction:a,currentFunction:c,error:u,isSpeaking:f,isAssistantActive:l,toggleListening:m,clearError:w,browserSupportsSpeechRecognition:S}=jc();d.useEffect(()=>{if(u){const x=setTimeout(()=>{w()},5e3);return()=>clearTimeout(x)}},[u,w]);const y=()=>{console.log("🔴 App: Closing assistant completely"),m()};return s.jsxs("div",{className:"min-h-screen bg-gray-50",children:[s.jsx(Cc,{cartItemsCount:t}),s.jsx(Xt,{mode:"wait",children:s.jsx(_.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:s.jsxs(_o,{children:[s.jsx(Bt,{path:"/",element:s.jsx(Zo,{onVoiceToggle:m})}),s.jsx(Bt,{path:"/products",element:s.jsx(cc,{})}),s.jsx(Bt,{path:"/products/:id",element:s.jsx(pc,{})}),s.jsx(Bt,{path:"/offers",element:s.jsx(uc,{})}),s.jsx(Bt,{path:"/cart",element:s.jsx(fc,{})})]})},e.pathname)}),s.jsx(Ec,{}),s.jsx(Nc,{isListening:r,isConnected:n,error:u,onToggleListening:m,browserSupportsSpeechRecognition:S,isAssistantActive:l}),l&&s.jsx(mc,{isListening:r,isProcessing:i,isConnected:n,isSpeaking:f,isExecutingFunction:a,currentFunction:c,messages:o,error:u,onClose:y,isAssistantActive:l})]})}var _c=Wo();const so=bn(_c);typeof globalThis.regeneratorRuntime>"u"&&(globalThis.regeneratorRuntime=so);typeof window<"u"&&(window.regeneratorRuntime=so);console.log("Polyfills loaded successfully");const Rc=js.Fragment;Yo.createRoot(document.getElementById("root")).render(s.jsx(Rc,{children:s.jsx(Ro,{children:s.jsx(Tc,{})})}));
//# sourceMappingURL=index-BJHF6tCs.js.map
